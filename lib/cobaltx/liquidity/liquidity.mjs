var bs=Object.defineProperty,ys=Object.defineProperties;var gs=Object.getOwnPropertyDescriptors;var Ln=Object.getOwnPropertySymbols;var ki=Object.prototype.hasOwnProperty,hi=Object.prototype.propertyIsEnumerable;var wi=(r,e,t)=>e in r?bs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,q=(r,e)=>{for(var t in e||(e={}))ki.call(e,t)&&wi(r,t,e[t]);if(Ln)for(var t of Ln(e))hi.call(e,t)&&wi(r,t,e[t]);return r},te=(r,e)=>ys(r,gs(e));var Xe=(r,e)=>{var t={};for(var n in r)ki.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Ln)for(var n of Ln(r))e.indexOf(n)<0&&hi.call(r,n)&&(t[n]=r[n]);return t};import{MINT_SIZE as Nd,TOKEN_PROGRAM_ID as Cd,getTransferFeeConfig as Rd,unpackMint as Md}from"@solana/spl-token";import{PublicKey as za}from"@solana/web3.js";import lt from"bn.js";var Ht=9e15,ht=1e9,mr="0123456789abcdef",Cn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",dr={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Ht,maxE:Ht,crypto:!1},xi,ut,j=!0,En="[DecimalError] ",kt=En+"Invalid argument: ",Si=En+"Precision limit exceeded",Bi=En+"crypto unavailable",Ii="[object Decimal]",Ce=Math.floor,Te=Math.pow,ws=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ks=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,hs=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ki=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ye=1e7,z=7,As=9007199254740991,Ps=Cn.length-1,pr=Rn.length-1,I={toStringTag:Ii};I.absoluteValue=I.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),F(r)};I.ceil=function(){return F(new this.constructor(this),this.e+1,2)};I.clampedTo=I.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(kt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};I.comparedTo=I.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};I.cosine=I.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+z,n.rounding=1,t=Ts(n,Mi(n,t)),n.precision=r,n.rounding=e,F(ut==2||ut==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};I.cubeRoot=I.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(j=!1,o=l.s*Te(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ie(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Te(t,1/3),r=Ce((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ce(c.plus(l).times(a),c.plus(u),s+2,1),Ie(a.d).slice(0,s)===(t=Ie(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(F(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return j=!0,F(n,r,m.rounding,e)};I.decimalPlaces=I.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Ce(this.e/z))*z,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};I.dividedBy=I.div=function(r){return ce(this,new this.constructor(r))};I.dividedToIntegerBy=I.divToInt=function(r){var e=this,t=e.constructor;return F(ce(e,new t(r),0,1,1),t.precision,t.rounding)};I.equals=I.eq=function(r){return this.cmp(r)===0};I.floor=function(){return F(new this.constructor(this),this.e+1,3)};I.greaterThan=I.gt=function(r){return this.cmp(r)>0};I.greaterThanOrEqualTo=I.gte=function(r){var e=this.cmp(r);return e==1||e===0};I.hyperbolicCosine=I.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/_n(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=jt(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};I.hyperbolicSine=I.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=jt(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/_n(5,r)),i=jt(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,F(i,e,t,!0)};I.hyperbolicTangent=I.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,ce(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};I.inverseCosine=I.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ze(t,i,o):new t(0):new t(NaN):e.isZero()?Ze(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=Ze(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};I.inverseHyperbolicCosine=I.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,j=!1,t=t.times(t).minus(1).sqrt().plus(t),j=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};I.inverseHyperbolicSine=I.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,j=!1,t=t.times(t).plus(1).sqrt().plus(t),j=!0,n.precision=r,n.rounding=e,t.ln())};I.inverseHyperbolicTangent=I.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?F(new o(i),r,e,!0):(o.precision=t=n-i.e,i=ce(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};I.inverseSine=I.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=Ze(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};I.inverseTangent=I.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=pr)return s=Ze(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=pr)return s=Ze(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/z+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(j=!1,e=Math.ceil(a/z),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),j=!0,F(s,l.precision=m,l.rounding=d,!0)};I.isFinite=function(){return!!this.d};I.isInteger=I.isInt=function(){return!!this.d&&Ce(this.e/z)>this.d.length-2};I.isNaN=function(){return!this.s};I.isNegative=I.isNeg=function(){return this.s<0};I.isPositive=I.isPos=function(){return this.s>0};I.isZero=function(){return!!this.d&&this.d[0]===0};I.lessThan=I.lt=function(r){return this.cmp(r)<0};I.lessThanOrEqualTo=I.lte=function(r){return this.cmp(r)<1};I.logarithm=I.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(j=!1,a=m+p,s=wt(c,a),n=e?Mn(l,a+10):wt(r,a),u=ce(s,n,a,1),an(u.d,i=m,d))do if(a+=10,s=wt(c,a),n=e?Mn(l,a+10):wt(r,a),u=ce(s,n,a,1),!o){+Ie(u.d).slice(i+1,i+15)+1==1e14&&(u=F(u,m+1,0));break}while(an(u.d,i+=10,d));return j=!0,F(u,m,d)};I.minus=I.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.constructor;if(r=new b(r),!p.d||!r.d)return!p.s||!r.s?r=new b(NaN):p.d?r.s=-r.s:r=new b(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=b.precision,u=b.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new b(p);else return new b(u===3?-0:0);return j?F(r,a,u):r}if(t=Ce(r.e/z),l=Ce(p.e/z),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/z),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=Ye-1;--c[i],c[n]+=Ye}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=vn(c,t),j?F(r,a,u):r):new b(u===3?-0:0)};I.modulo=I.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(j=!1,n.modulo==9?(e=ce(t,r.abs(),0,3,1),e.s*=r.s):e=ce(t,r,0,n.modulo,1),e=e.times(r),j=!0,t.minus(e))};I.naturalExponential=I.exp=function(){return fr(this)};I.naturalLogarithm=I.ln=function(){return wt(this)};I.negated=I.neg=function(){var r=new this.constructor(this);return r.s=-r.s,F(r)};I.plus=I.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),j?F(r,a,u):r;if(o=Ce(m.e/z),n=Ce(r.e/z),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/z),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/Ye|0,c[i]%=Ye;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=vn(c,n),j?F(r,a,u):r};I.precision=I.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(kt+r);return t.d?(e=Li(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};I.round=function(){var r=this,e=r.constructor;return F(new e(r),r.e+1,e.rounding)};I.sine=I.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+z,n.rounding=1,t=Ss(n,Mi(n,t)),n.precision=r,n.rounding=e,F(ut>2?t.neg():t,r,e,!0)):new n(NaN)};I.squareRoot=I.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(j=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Ie(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ce((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ce(s,o,t+2,1)).times(.5),Ie(o.d).slice(0,t)===(e=Ie(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(F(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,u+1,1),r=!n.times(n).eq(s));break}return j=!0,F(n,u,l.rounding,r)};I.tangent=I.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=ce(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,F(ut==2||ut==4?t.neg():t,r,e,!0)):new n(NaN)};I.times=I.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=Ce(l.e/z)+Ce(r.e/z),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%Ye|0,e=a/Ye|0;o[i]=(o[i]+e)%Ye|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=vn(o,t),j?F(r,m.precision,m.rounding):r};I.toBinary=function(r,e){return yr(this,2,r,e)};I.toDecimalPlaces=I.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Oe(r,0,ht),e===void 0?e=n.rounding:Oe(e,0,8),F(t,r+t.e+1,e))};I.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=nt(n,!0):(Oe(r,0,ht),e===void 0?e=i.rounding:Oe(e,0,8),n=F(new i(n),r+1,e),t=nt(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=nt(i):(Oe(r,0,ht),e===void 0?e=o.rounding:Oe(e,0,8),n=F(new o(i),r+i.e+1,e),t=nt(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};I.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Li(b)-p.e-1,s=o%z,e.d[0]=Te(10,s<0?z+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(kt+a);r=a.gt(e)?o>0?e:c:a}for(j=!1,a=new f(Ie(b)),l=f.precision,f.precision=o=b.length*z*2;m=ce(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=ce(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=ce(c,n,o,1).minus(p).abs().cmp(ce(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,j=!0,d};I.toHexadecimal=I.toHex=function(r,e){return yr(this,16,r,e)};I.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Oe(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(j=!1,t=ce(t,r,0,e,1).times(r),j=!0,F(t)):(r.s=t.s,t=r),t};I.toNumber=function(){return+this};I.toOctal=function(r,e){return yr(this,8,r,e)};I.toPower=I.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(Te(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return F(a,n,o);if(e=Ce(r.e/z),e>=r.d.length-1&&(t=c<0?-c:c)<=As)return i=Ni(u,a,t,n),r.s<0?new u(1).div(i):F(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Te(+a,c),e=t==0||!isFinite(t)?Ce(c*(Math.log("0."+Ie(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(j=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=fr(r.times(wt(a,n+t)),n),i.d&&(i=F(i,n+5,1),an(i.d,n,o)&&(e=n+10,i=F(fr(r.times(wt(a,e+t)),e),e+5,1),+Ie(i.d).slice(n+1,n+15)+1==1e14&&(i=F(i,n+1,0)))),i.s=s,j=!0,u.rounding=o,F(i,n,o))};I.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=nt(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Oe(r,1,ht),e===void 0?e=i.rounding:Oe(e,0,8),n=F(new i(n),r,e),t=nt(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toSignificantDigits=I.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Oe(r,1,ht),e===void 0?e=n.rounding:Oe(e,0,8)),F(new n(t),r,e)};I.toString=function(){var r=this,e=r.constructor,t=nt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};I.truncated=I.trunc=function(){return F(new this.constructor(this),this.e+1,1)};I.valueOf=I.toJSON=function(){var r=this,e=r.constructor,t=nt(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function Ie(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=z-n.length,t&&(o+=gt(t)),o+=n;s=r[e],n=s+"",t=z-n.length,t&&(o+=gt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Oe(r,e,t){if(r!==~~r||r<e||r>t)throw Error(kt+r)}function an(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=z,i=0):(i=Math.ceil((e+1)/z),e%=z),o=Te(10,z-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==Te(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==Te(10,e-3)-1,s}function Nn(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=mr.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Ts(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/_n(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=jt(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var ce=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,b,f,w,g,h,A,P,x,k,B,T,C,_,M,G,W=n.constructor,H=n.s==i.s?1:-1,ee=n.d,D=i.d;if(!ee||!ee[0]||!D||!D[0])return new W(!n.s||!i.s||(ee?D&&ee[0]==D[0]:!D)?NaN:ee&&ee[0]==0||!D?H*0:H/0);for(u?(p=1,l=n.e-i.e):(u=Ye,p=z,l=Ce(n.e/p)-Ce(i.e/p)),M=D.length,C=ee.length,g=new W(H),h=g.d=[],m=0;D[m]==(ee[m]||0);m++);if(D[m]>(ee[m]||0)&&l--,o==null?(k=o=W.precision,s=W.rounding):a?k=o+(n.e-i.e)+1:k=o,k<0)h.push(1),b=!0;else{if(k=k/p+2|0,m=0,M==1){for(d=0,D=D[0],k++;(m<C||d)&&k--;m++)B=d*u+(ee[m]||0),h[m]=B/D|0,d=B%D|0;b=d||m<C}else{for(d=u/(D[0]+1)|0,d>1&&(D=r(D,d,u),ee=r(ee,d,u),M=D.length,C=ee.length),T=M,A=ee.slice(0,M),P=A.length;P<M;)A[P++]=0;G=D.slice(),G.unshift(0),_=D[0],D[1]>=u/2&&++_;do d=0,c=e(D,A,M,P),c<0?(x=A[0],M!=P&&(x=x*u+(A[1]||0)),d=x/_|0,d>1?(d>=u&&(d=u-1),f=r(D,d,u),w=f.length,P=A.length,c=e(f,A,w,P),c==1&&(d--,t(f,M<w?G:D,w,u))):(d==0&&(c=d=1),f=D.slice()),w=f.length,w<P&&f.unshift(0),t(A,f,P,u),c==-1&&(P=A.length,c=e(D,A,M,P),c<1&&(d++,t(A,M<P?G:D,P,u))),P=A.length):c===0&&(d++,A=[0]),h[m++]=d,c&&A[0]?A[P++]=ee[T]||0:(A=[ee[T]],P=1);while((T++<C||A[0]!==void 0)&&k--);b=A[0]!==void 0}h[0]||h.shift()}if(p==1)g.e=l,xi=b;else{for(m=1,d=h[0];d>=10;d/=10)m++;g.e=m+l*p-1,F(g,a?o+g.e+1:o,s,b)}return g}}();function F(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=z,s=e,l=m[d=0],u=l/Te(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/z),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=z,s=o-z+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=z,s=o-z+i,u=s<0?0:l/Te(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%Te(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/Te(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=Te(10,(z-e%z)%z),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=Te(10,z-o),m[d]=s>0?(l/Te(10,i-s)%Te(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Ye&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ye)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return j&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function nt(r,e,t){if(!r.isFinite())return Ri(r);var n,i=r.e,o=Ie(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+gt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+gt(-i-1)+o,t&&(n=t-s)>0&&(o+=gt(n))):i>=s?(o+=gt(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+gt(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=gt(n))),o}function vn(r,e){var t=r[0];for(e*=z;t>=10;t/=10)e++;return e}function Mn(r,e,t){if(e>Ps)throw j=!0,t&&(r.precision=t),Error(Si);return F(new r(Cn),e,1,!0)}function Ze(r,e,t){if(e>pr)throw Error(Si);return F(new r(Rn),e,t,!0)}function Li(r){var e=r.length-1,t=e*z+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function gt(r){for(var e="";r--;)e+="0";return e}function Ni(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/z+4);for(j=!1;;){if(t%2&&(o=o.times(e),Pi(o.d,s)&&(i=!0)),t=Ce(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Pi(e.d,s)}return j=!0,o}function Ai(r){return r.d[r.d.length-1]&1}function Ci(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function fr(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,b=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(j=!1,u=b):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(Te(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=F(o.times(r),u,1),t=t.times(++l),a=s.plus(ce(o,t,u,1)),Ie(a.d).slice(0,u)===Ie(s.d).slice(0,u)){for(i=m;i--;)s=F(s.times(s),u,1);if(e==null)if(c<3&&an(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return F(s,d.precision=b,p,j=!0);else return d.precision=b,s}s=a}}function wt(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,b=10,f=r,w=f.d,g=f.constructor,h=g.rounding,A=g.precision;if(f.s<0||!w||!w[0]||!f.e&&w[0]==1&&w.length==1)return new g(w&&!w[0]?-1/0:f.s!=1?NaN:w?0:f);if(e==null?(j=!1,l=A):l=e,g.precision=l+=b,t=Ie(w),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=Ie(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return c=Mn(g,l+2,A).times(o+""),f=wt(new g(n+"."+t.slice(1)),l-b).plus(c),g.precision=A,e==null?F(f,A,h,j=!0):f;for(m=f,u=s=f=ce(f.minus(1),f.plus(1),l,1),d=F(f.times(f),l,1),i=3;;){if(s=F(s.times(d),l,1),c=u.plus(ce(s,new g(i),l,1)),Ie(c.d).slice(0,l)===Ie(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Mn(g,l+2,A).times(o+""))),u=ce(u,new g(p),l,1),e==null)if(an(u.d,l-b,h,a))g.precision=l+=b,c=s=f=ce(m.minus(1),m.plus(1),l,1),d=F(f.times(f),l,1),i=a=1;else return F(u,g.precision=A,h,j=!0);else return g.precision=A,u;u=c,i+=2}}function Ri(r){return String(r.s*r.s/0)}function br(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%z,t<0&&(n+=z),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=z;n<i;)r.d.push(+e.slice(n,n+=z));e=e.slice(n),n=z-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),j&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function xs(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Ki.test(e))return br(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(ks.test(e))t=16,e=e.toLowerCase();else if(ws.test(e))t=2;else if(hs.test(e))t=8;else throw Error(kt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ni(n,new n(t),o,o*2)),c=Nn(e,t,Ye),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=vn(c,l),r.d=c,j=!1,s&&(r=ce(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?Te(2,u):un.pow(2,u))),j=!0,r)}function Ss(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:jt(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/_n(5,t)),e=jt(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function jt(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/z);for(j=!1,u=t.times(t),a=new r(n);;){if(s=ce(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=ce(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return j=!0,s.d.length=m+1,s}function _n(r,e){for(var t=r;--e;)t*=r;return t}function Mi(r,e){var t,n=e.s<0,i=Ze(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return ut=n?4:1,e;if(t=e.divToInt(i),t.isZero())ut=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return ut=Ai(t)?n?2:3:n?4:1,e;ut=Ai(t)?n?1:4:n?3:2}return e.minus(i).abs()}function yr(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,b=t!==void 0;if(b?(Oe(t,1,ht),n===void 0?n=p.rounding:Oe(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=Ri(r);else{for(l=nt(r),s=l.indexOf("."),b?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Nn(nt(d),10,i),d.e=d.d.length),m=Nn(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=b?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=ce(r,d,t,n,0,i),m=r.d,o=r.e,c=xi),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=mr.charAt(m[s]);if(b){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Nn(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=mr.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Pi(r,e){if(r.length>e)return r.length=e,!0}function Bs(r){return new this(r).abs()}function Is(r){return new this(r).acos()}function Ks(r){return new this(r).acosh()}function Ls(r,e){return new this(r).plus(e)}function Ns(r){return new this(r).asin()}function Cs(r){return new this(r).asinh()}function Rs(r){return new this(r).atan()}function Ms(r){return new this(r).atanh()}function Es(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=Ze(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?Ze(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=Ze(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ce(r,e,o,1)),e=Ze(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(ce(r,e,o,1)),t}function vs(r){return new this(r).cbrt()}function _s(r){return F(r=new this(r),r.e+1,2)}function Os(r,e,t){return new this(r).clamp(e,t)}function Ws(r){if(!r||typeof r!="object")throw Error(En+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,ht,"rounding",0,8,"toExpNeg",-Ht,0,"toExpPos",0,Ht,"maxE",0,Ht,"minE",-Ht,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=dr[t]),(n=r[t])!==void 0)if(Ce(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(kt+t+": "+n);if(t="crypto",i&&(this[t]=dr[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Bi);else this[t]=!1;else throw Error(kt+t+": "+n);return this}function Vs(r){return new this(r).cos()}function Fs(r){return new this(r).cosh()}function Ei(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Ti(o)){c.s=o.s,j?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;j?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return br(c,o.toString())}else if(u!=="string")throw Error(kt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Ki.test(o)?br(c,o):xs(c,o)}if(i.prototype=I,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Ws,i.clone=Ei,i.isDecimal=Ti,i.abs=Bs,i.acos=Is,i.acosh=Ks,i.add=Ls,i.asin=Ns,i.asinh=Cs,i.atan=Rs,i.atanh=Ms,i.atan2=Es,i.cbrt=vs,i.ceil=_s,i.clamp=Os,i.cos=Vs,i.cosh=Fs,i.div=Ds,i.exp=qs,i.floor=Gs,i.hypot=Us,i.ln=Xs,i.log=zs,i.log10=Hs,i.log2=Qs,i.max=js,i.min=Zs,i.mod=Ys,i.mul=$s,i.pow=Js,i.random=ea,i.round=ta,i.sign=na,i.sin=ra,i.sinh=ia,i.sqrt=oa,i.sub=sa,i.sum=aa,i.tan=ua,i.tanh=ca,i.trunc=la,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Ds(r,e){return new this(r).div(e)}function qs(r){return new this(r).exp()}function Gs(r){return F(r=new this(r),r.e+1,3)}function Us(){var r,e,t=new this(0);for(j=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return j=!0,new this(1/0);t=e}return j=!0,t.sqrt()}function Ti(r){return r instanceof un||r&&r.toStringTag===Ii||!1}function Xs(r){return new this(r).ln()}function zs(r,e){return new this(r).log(e)}function Qs(r){return new this(r).log(2)}function Hs(r){return new this(r).log(10)}function js(){return Ci(this,arguments,"lt")}function Zs(){return Ci(this,arguments,"gt")}function Ys(r,e){return new this(r).mod(e)}function $s(r,e){return new this(r).mul(e)}function Js(r,e){return new this(r).pow(e)}function ea(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Oe(r,1,ht),n=Math.ceil(r/z),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Bi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=z,n&&r&&(i=Te(10,z-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=z)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<z&&(t-=z-n)}return s.e=t,s.d=a,s}function ta(r){return F(r=new this(r),r.e+1,this.rounding)}function na(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function ra(r){return new this(r).sin()}function ia(r){return new this(r).sinh()}function oa(r){return new this(r).sqrt()}function sa(r,e){return new this(r).sub(e)}function aa(){var r=0,e=arguments,t=new this(e[r]);for(j=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return j=!0,F(t,this.precision,this.rounding)}function ua(r){return new this(r).tan()}function ca(r){return new this(r).tanh()}function la(r){return F(r=new this(r),r.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString;I[Symbol.toStringTag]="Decimal";var un=I.constructor=Ei(dr);Cn=new un(Cn);Rn=new un(Rn);var N=un;import ha from"big.js";import Vn from"bn.js";import{get as vi,set as ma}from"lodash";var gr=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},_i={},da={};function ae(r){let e=vi(_i,r);if(!e){let t=vi(da,r);e=new gr({name:r,logLevel:t}),ma(_i,r,e)}return e}import pa from"toformat";var fa=pa,cn=fa;import Wn from"big.js";import ya from"bn.js";import ga from"decimal.js-light";import ln from"bn.js";var Oi=9007199254740991;function ne(r){let e=ae("CobaltX_parseBigNumberish");if(r instanceof ln)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new ln(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Oi||r<=-Oi)&&e.logWithError(`BigNumberish number overflow: ${r}`),new ln(String(r))):typeof r=="bigint"?new ln(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new ln(0))}var On=ae("module/fraction"),wr=cn(Wn),mn=cn(ga),wa={[0]:mn.ROUND_DOWN,[1]:mn.ROUND_HALF_UP,[2]:mn.ROUND_UP},ka={[0]:Wn.roundDown,[1]:Wn.roundHalfUp,[2]:Wn.roundUp},oe=class{constructor(e,t=new ya(1)){this.numerator=ne(e),this.denominator=ne(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new oe(this.denominator,this.numerator)}add(e){let t=e instanceof oe?e:new oe(ne(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.add(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof oe?e:new oe(ne(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.sub(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof oe?e:new oe(ne(e));return new oe(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof oe?e:new oe(ne(e));return new oe(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||On.logWithError(`${e} is not an integer.`),e<=0&&On.logWithError(`${e} is not positive.`),mn.set({precision:e+1,rounding:wa[n]});let i=new mn(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||On.logWithError(`${e} is not an integer.`),e<0&&On.logWithError(`${e} is negative.`),wr.DP=e,wr.RM=ka[n]||1,new wr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Aa=ae("CobaltX_amount"),Wi=cn(ha);function Pa(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Aa.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var ye=class extends oe{constructor(t,n,i=!0,o){let s=new Vn(0),a=kr.pow(new Vn(t.decimals));if(i)s=ne(n);else{let u=new Vn(0),c=new Vn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Pa(n.toString(),t.decimals);u=ne(l),c=ne(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Wi.DP=this.token.decimals,new Wi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{TOKEN_PROGRAM_ID as Vi}from"@solana/spl-token";import{PublicKey as Ta}from"@solana/web3.js";var hr={chainId:101,address:Ta.default.toBase58(),programId:Vi.toBase58(),decimals:9,symbol:"ETH",name:"Ethereum",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}},ct={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Vi.toBase58(),decimals:9,symbol:"WETH",name:"Wrapped ETH",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}};import{PublicKey as xr}from"@solana/web3.js";import{PublicKey as Ke,SystemProgram as Fi,SYSVAR_RENT_PUBKEY as xa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sa}from"@solana/spl-token";function S({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ba=[S({pubkey:Sa,isWritable:!1}),S({pubkey:Fi.programId,isWritable:!1}),S({pubkey:xa,isWritable:!1})];function Ar({publicKey:r,transformSol:e}){let t=Pr(r.toString());if(t instanceof Ke)return e&&t.equals(Yt)?Zt:t;if(e&&t.toString()===Yt.toBase58())return Zt;if(typeof t=="string"){if(t===Ke.default.toBase58())return Ke.default;try{return new Ke(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pr(r){try{return new Ke(r)}catch{return r}}var Fn=new Ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Tr=new Ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),$e=new Ke("SysvarRent111111111111111111111111111111111"),rl=new Ke("SysvarC1ock11111111111111111111111111111111"),Nt=new Ke("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ia=new Ke("Sysvar1nstructions1111111111111111111111111"),il=Fi.programId,ol=new Ke("a2Gt18uJC8puJT9JRYQLU6rPi6okxQb4WqCjwtYshZB"),sl=new Ke("bXSKiFqYrALF9gJy1KqHm8tv4QXk8nCgbLN8WRsGEbh"),Zt=new Ke("So11111111111111111111111111111111111111112"),Yt=Ke.default,al=new Ke("71kRXzJMvSeArtXYNEWa8KAjpRJosdMQ7Dpgy5Jt5zfd"),ul=new Ke("ERFzpDteGNo8LTDKW1WwVGrkRMmA2y9WZHXNHxMA6BSV");function $t(r){return Ar({publicKey:r,transformSol:!0})}var Sr=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Yt.toBase58()||e instanceof xr&&Yt.equals(e)){this.decimals=ct.decimals,this.symbol=ct.symbol,this.name=ct.name,this.mint=new xr(ct.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?xr.default:Ar({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Re=Sr;Re.WSOL=new Sr(te(q({},ct),{mint:ct.address}));var Br=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Dn=Br;Dn.SOL=new Br(hr);import Ka from"bn.js";var Di=new oe(new Ka(100)),ze=class extends oe{toSignificant(e=5,t,n){return this.mul(Di).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Di).toFixed(e,t,n)}};var La=ae("CobaltX_price"),Qe=class extends oe{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new oe(Ir(n.decimals),Ir(i.decimals))}get raw(){return new oe(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Qe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&La.logWithError("mul token not equals");let n=super.mul(t);return new Qe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as Na}from"@solana/web3.js";import Ca from"bn.js";function qi(r){return typeof r=="object"&&r!==null&&![Re,ye,Na,oe,Ca,Qe,ze].some(e=>typeof e=="object"&&r instanceof e)}function Ct(r){return typeof r=="string"?Pr(r):Array.isArray(r)?r.map(e=>Ct(e)):qi(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,Ct(t)])):r}var At=new lt(0),Gi=new lt(1),rm=new lt(2),im=new lt(3),om=new lt(5),kr=new lt(10),sm=new lt(100),am=new lt(1e3),um=new lt(1e4);function Ir(r){return kr.pow(ne(r))}function qn(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function Kr(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Wa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Va}from"@solana/spl-token";import{ComputeBudgetProgram as Ui,Keypair as zi,PublicKey as Ra,Transaction as Qi,TransactionMessage as Ma,VersionedTransaction as Hi}from"@solana/web3.js";var Q={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Ea}from"@solana/spl-token";var Xi=ae("CobaltX_txUtil"),ji=1644;function Gn(r){let e=[],t=[];return r.microLamports&&(e.push(Ui.setComputeUnitPrice({microLamports:r.microLamports})),t.push(Q.SetComputeUnitPrice)),r.units&&(e.push(Ui.setComputeUnitLimit({units:r.units})),t.push(Q.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Jt(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Un(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function va(r,e){r.length<1&&Xi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Xi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Qi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ji}catch{return!1}}function pe(r,e){let[t,n]=Ra.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function dn({instructions:r,payer:e,signers:t}){return va(r,[e,...t])}function pn({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=zi.generate().publicKey.toString()}){let o=new Ma({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Hi(o).serialize()).toString("base64").length<ji}catch{return!1}}var _a=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Oa=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Hi&&(e=_a(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Rt(r){let e=[];return r.forEach(t=>{t instanceof Qi&&(t.recentBlockhash||(t.recentBlockhash=Ea.toBase58()),t.feePayer||(t.feePayer=zi.generate().publicKey)),e.push(Oa(t))}),console.log("simulate tx string:",e),e}function le(r,e,t){return pe([r.toBuffer(),(t!=null?t:Va).toBuffer(),e.toBuffer()],new Wa("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as Y}from"@solana/web3.js";var Zi=new Y("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Yi=new Y("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),$i=new Y("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ji=new Y("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Lm=new Y("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),eo=new Y("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Nm=new Y("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),to=new Y("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Cm=new Y("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Rm=new Y("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Mm=new Y("2TnjBuwqyBB9to5jURagDT7jLmBPefGRiKL2yh1zPZ4V"),Em=new Y("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),vm=new Y("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),_m=new Y("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),no=new Y("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Om=new Y("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Wm=new Y("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Vm=new Y("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Fm=new Y("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Dm=new Y("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),qm=new Y("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Gm=new Y("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Fa=new Y("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Da=new Y("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),qa=new Y("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Um=new Y("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ga=new Y("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Xm=new Y("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ua=new Y("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var zm={SERUM_MARKET:Y.default,OPENBOOK_MARKET:new Y("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:Y.default,FarmV3:new Y("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new Y("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new Y("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new Y("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new Y("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new Y("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new Y("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new Y("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new Y("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Fa,CREATE_CPMM_POOL_AUTH:Da,CREATE_CPMM_POOL_FEE_ACC:qa,FEE_DESTINATION_ID:new Y("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Ga,LCOK_CPMM_AUTH:Ua};import Je from"bn.js";var fn=1e4;function ge(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=te(q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Je(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===fn){let u=new Je(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=bn(r.mul(new Je(fn)),new Je(fn-o.transferFeeBasisPoints)),c=new Je(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=bn(l.mul(new Je(o.transferFeeBasisPoints)),new Je(fn)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=bn(r.mul(new Je(o.transferFeeBasisPoints)),new Je(fn)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function Pt(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function bn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Je(0))?t.add(new Je(1)):t}import{PublicKey as ro,AddressLookupTableAccount as Xn}from"@solana/web3.js";async function Lr({connection:r,address:e}){let t=await mt(r,[...new Set(e.map(i=>i.toString()))].map(i=>new ro(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new Xn({key:s,state:Xn.deserialize(o.data)});n[s.toString()]=a,zn[s.toString()]=a}return n}var zn={AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM:new Xn({key:new ro("AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM"),state:Xn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as yn,sendAndConfirmTransaction as Nr,Transaction as gn,TransactionMessage as wn,VersionedTransaction as kn}from"@solana/web3.js";import Xa from"axios";var Qn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await Xa.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Gn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==yn.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(q({},t||{})):this.build(t)}build(e){var n;let t=new gn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await Jt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Rt([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await Nr(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var c;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var g;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:b,skipPreflight:f=!0}=l||{},w=b!=null?b:await Jt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(m){let h=[],A=0;for(let P of s){if(++A,A<=p)continue;let x=await Nr(this.connection,P,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});h.push(x)}return{txIds:h,signedTxs:s}}return{txIds:await await Promise.all(s.map(async h=>(h.recentBlockhash=w,await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let h=s.map((P,x)=>(P.recentBlockhash=w,a[x].length&&P.sign(...a[x]),P));Rt(h);let A=await this.signAllTransactions(h);if(m){let P=0,x=[],k=async()=>{if(!A[P])return;let B=await this.connection.sendRawTransaction(A[P].serialize(),{skipPreflight:f});x.push({txId:B,status:"sent",signedTx:A[P]}),d==null||d([...x]),P++,this.connection.onSignature(B,T=>{let C=x.findIndex(_=>_.txId===B);C>-1&&(x[C].status=T.err?"error":"success"),d==null||d([...x]),T.err||k()},"processed"),this.connection.getSignatureStatus(B)};return await k(),{txIds:x.map(B=>B.txId),signedTxs:A}}else{let P=[];for(let x=0;x<A.length;x+=1){let k=await this.connection.sendRawTransaction(A[x].serialize(),{skipPreflight:f});P.push(k)}return{txIds:P,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let b=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=b,s=Xe(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=q(q({},this.cluster==="devnet"?{}:zn),t),u=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let w of u)a[w]===void 0&&c.push(new yn(w));let l=await Lr({connection:this.connection,address:c});for(let[w,g]of Object.entries(l))a[w]=g;let m=i?yn.default.toBase58():o!=null?o:await Jt(this.connection,this.blockhashCommitment),d=new wn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message();((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new kn(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var A;let{skipPreflight:g=!0,sendAndConfirm:h}=w||{};if(Rt([p]),(A=this.owner)!=null&&A.isKeyPair){let P=await this.connection.sendTransaction(p,{skipPreflight:g});return h&&await Un(this.connection,P),{txId:P,signedTx:p}}if(this.signAllTransactions){let P=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(P[0],{skipPreflight:g}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var c;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:b=!0}=l||{};if(p&&s.forEach(w=>w.message.recentBlockhash=p),Rt(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let w=[];for(let g of s){let h=await this.connection.sendTransaction(g,{skipPreflight:b});await Un(this.connection,h),w.push(h)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(m){let g=0,h=[],A=async()=>{if(!w[g])return;let P=await this.connection.sendTransaction(w[g],{skipPreflight:b});h.push({txId:P,status:"sent",signedTx:w[g]}),d==null||d([...h]),g++,this.connection.onSignature(P,x=>{let k=h.findIndex(B=>B.txId===P);k>-1&&(h[k].status=x.err?"error":"success"),d==null||d([...h]),x.err||A()},"processed"),this.connection.getSignatureStatus(P)};return A(),{txIds:[],signedTxs:w}}else{let g=[];for(let h=0;h<w.length;h+=1){let A=await this.connection.sendTransaction(w[h],{skipPreflight:b});g.push(A)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=Xe(m,["splitIns","computeBudgetConfig"]),o=n?Gn(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,b)=>te(q({},p),{[b.publicKey.toBase58()]:b}),{}),a=[],u=[],c=[],l=0;if(this.allInstructions.forEach(p=>{let b=[...c,p],f=n?[...o.instructions,...b]:b,g=[...new Set(b.map(h=>h.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(h=>new yn(h));if(p!==t[l]&&c.length<12&&(dn({instructions:f,payer:this.feePayer,signers:g})||dn({instructions:b,payer:this.feePayer,signers:g})))c.push(p);else{if(c.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,dn({instructions:n?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:g})?a.push(new gn().add(...o.instructions,...c)):a.push(new gn().add(...c)),u.push(Array.from(new Set(c.map(h=>h.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat())).map(h=>s[h]).filter(h=>h!==void 0)),c=[p]}}),c.length>0){let b=[...new Set(c.map(f=>f.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);dn({instructions:n?[...o.instructions,...c]:[...c],payer:this.feePayer,signers:b.map(f=>f.publicKey)})?a.push(new gn().add(...o.instructions,...c)):a.push(new gn().add(...c)),u.push(b)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&u.forEach(p=>{p.some(b=>b.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:u,instructionTypes:this.instructionTypes,execute:async p=>{var P;let{sequentially:b,onTxUpdate:f,skipTxCount:w=0,recentBlockHash:g,skipPreflight:h=!0}=p||{},A=g!=null?g:await Jt(this.connection,this.blockhashCommitment);if(a.forEach(async(x,k)=>{x.recentBlockhash=A,u[k].length&&x.sign(...u[k])}),Rt(a),(P=this.owner)!=null&&P.isKeyPair){if(b){let x=0,k=[];for(let B of a){if(++x,x<=w){k.push("tx skipped");continue}let T=await Nr(this.connection,B,this.signers.find(C=>C.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:h});k.push(T)}return{txIds:k,signedTxs:a}}return{txIds:await Promise.all(a.map(async x=>await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:h}))),signedTxs:a}}if(this.signAllTransactions){let x=await this.signAllTransactions(a.slice(w,a.length)),k=[...a.slice(0,w),...x];if(b){let B=0,T=[],C=async()=>{if(!k[B])return;B<w&&(T.push({txId:"",status:"success",signedTx:k[B]}),f==null||f([...T]),B++,C());let _=await this.connection.sendRawTransaction(k[B].serialize(),{skipPreflight:h});T.push({txId:_,status:"sent",signedTx:k[B]}),f==null||f([...T]),B++,this.connection.onSignature(_,M=>{let G=T.findIndex(W=>W.txId===_);G>-1&&(T[G].status=M.err?"error":"success"),f==null||f([...T]),M.err||C()},"processed"),this.connection.getSignatureStatus(_)};return await C(),{txIds:T.map(_=>_.txId),signedTxs:k}}else{let B=[];for(let T=0;T<k.length;T+=1){let C=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:h});B.push(C)}return{txIds:B,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var A;let h=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=h,s=Xe(h,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=q(q({},this.cluster==="devnet"?{}:zn),i),u=Array.from(new Set([...this.lookupTableAddress,...o])),c=[];for(let P of u)a[P]===void 0&&c.push(new yn(P));let l=await Lr({connection:this.connection,address:c});for(let[P,x]of Object.entries(l))a[P]=x;let m=t?Gn(t):{instructions:[],instructionTypes:[]},d=await Jt(this.connection,this.blockhashCommitment),p=this.signers.reduce((P,x)=>te(q({},P),{[x.publicKey.toBase58()]:x}),{}),b=[],f=[],w=[],g=0;if(this.allInstructions.forEach(P=>{let x=[...w,P],k=t?[...m.instructions,...x]:x;if(P!==n[g]&&w.length<12&&(pn({instructions:k,payer:this.feePayer,lookupTableAddressAccount:a})||pn({instructions:x,payer:this.feePayer,lookupTableAddressAccount:a})))w.push(P);else{if(w.length===0)throw Error("item ins too big");g+=P===n[g]?1:0;let B={};for(let T of[...new Set(u)])a[T]!==void 0&&(B[T]=a[T]);if(t&&pn({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let T=new wn({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(a));b.push(new kn(T))}else{let T=new wn({payerKey:this.feePayer,recentBlockhash:d,instructions:[...w]}).compileToV0Message(Object.values(a));b.push(new kn(T))}f.push(Array.from(new Set(w.map(T=>T.keys.filter(C=>C.isSigner).map(C=>C.pubkey.toString())).flat())).map(T=>p[T]).filter(T=>T!==void 0)),w=[P]}}),w.length>0){let x=[...new Set(w.map(k=>k.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(k=>p[k]).filter(k=>k!==void 0);if(t&&pn({instructions:[...m.instructions,...w],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let k=new wn({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...w]}).compileToV0Message(Object.values(a));b.push(new kn(k))}else{let k=new wn({payerKey:this.feePayer,recentBlockhash:d,instructions:[...w]}).compileToV0Message(Object.values(a));b.push(new kn(k))}f.push(x)}return(A=this.owner)!=null&&A.signer&&f.forEach(P=>{P.some(x=>x.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:b,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async P=>{var _;let{sequentially:x,onTxUpdate:k,skipTxCount:B=0,recentBlockHash:T,skipPreflight:C=!0}=P||{};if(b.map(async(M,G)=>{f[G].length&&M.sign(f[G]),T&&(M.message.recentBlockhash=T)}),Rt(b),(_=this.owner)!=null&&_.isKeyPair){if(x){let M=0,G=[];for(let W of b){if(++M,M<=B){console.log("skip tx: ",M),G.push("tx skipped");continue}let H=await this.connection.sendTransaction(W,{skipPreflight:C});await Un(this.connection,H),G.push(H)}return{txIds:G,signedTxs:b}}return{txIds:await Promise.all(b.map(async M=>await this.connection.sendTransaction(M,{skipPreflight:C}))),signedTxs:b}}if(this.signAllTransactions){let M=await this.signAllTransactions(b.slice(B,b.length)),G=[...b.slice(0,B),...M];if(x){let W=0,H=[],ee=async()=>{if(!G[W])return;if(W<B){H.push({txId:"",status:"success",signedTx:G[W]}),k==null||k([...H]),W++,ee();return}let D=await this.connection.sendTransaction(G[W],{skipPreflight:C});H.push({txId:D,status:"sent",signedTx:G[W]}),k==null||k([...H]),W++,this.connection.onSignature(D,Ge=>{let at=H.findIndex(bt=>bt.txId===D);at>-1&&(H[at].status=Ge.err?"error":"success"),k==null||k([...H]),Ge.err||ee()},"processed"),this.connection.getSignatureStatus(D)};return ee(),{txIds:[],signedTxs:G}}else{let W=[];for(let H=0;H<G.length;H+=1){let ee=await this.connection.sendTransaction(G[H],{skipPreflight:C});W.push(ee)}return{txIds:W,signedTxs:G}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Cr=ae("CobaltX_accountInfo_util");async function mt(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=q({batchRequest:!1},t),s=Kr(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=r._buildArgs([m.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Kr(u,10);a=(await(await Promise.all(c.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Cr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:b,lamports:f,owner:w,rentEpoch:g}=d;return p.length!==2&&p[1]!=="base64"&&Cr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:f,owner:new za(w),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(u=>r.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&Cr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Mt(r,e,t){let n=await mt(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>te(q({},i),{accountInfo:n[o]}))}import{AccountLayout as Pc,NATIVE_MINT as cr,TOKEN_PROGRAM_ID as Bt}from"@solana/spl-token";import{PublicKey as he}from"@solana/web3.js";import{PublicKey as ru}from"@solana/web3.js";import uo,{isBN as co}from"bn.js";import{bits as Qa,BitStructure as qd,blob as Ha,Blob as Gd,cstr as Ud,f32 as Xd,f32be as zd,f64 as Qd,f64be as Hd,greedy as jd,Layout as ja,ns64 as Zd,ns64be as Yd,nu64 as $d,nu64be as Jd,offset as ep,s16 as tp,s16be as np,s24 as rp,s24be as ip,s32 as Za,s32be as op,s40 as sp,s40be as ap,s48 as up,s48be as cp,s8 as lp,seq as Ya,struct as mp,Structure as $a,u16 as Ja,u16be as dp,u24 as pp,u24be as fp,u32 as eu,u32be as bp,u40 as yp,u40be as gp,u48 as wp,u48be as kp,u8 as tu,UInt as nu,union as hp,Union as Ap,unionLayoutDiscriminator as Pp,utf8 as Tp}from"@solana/buffer-layout";var Hn=ja,oo=$a;var Rr=nu;var so=tu,Et=Ja;var Mr=eu;var me=Za;var ao=Ya;var Ae=Ha;var Er=Qa;var vt=class extends Hn{constructor(t,n,i){super(t,i);this.blob=Ae(t),this.signed=n}decode(t,n=0){let i=new uo(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new uo(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}},jn=class extends Hn{constructor(t){super(8,t);this._lower=Er(Mr(),!1),this._upper=Er(Mr(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let i=this._lower.decode(t,n),o=this._upper.decode(t,n+this._lower.span);return q(q({},i),o)}encode(t,n,i=0){return this._lower.encode(t,n,i)+this._upper.encode(t,n,i+this._lower.span)}};function O(r){return new Rr(1,r)}function Me(r){return new Rr(4,r)}function y(r){return new vt(8,!1,r)}function U(r){return new vt(16,!1,r)}function lo(r){return new vt(1,!0,r)}function en(r){return new vt(8,!0,r)}function mo(r){return new vt(16,!0,r)}var Zn=class extends Hn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function K(r){return new Zn(Ae(32),e=>new ru(e),e=>e.toBuffer(),r)}function xe(r){return new Zn(so(),iu,ou,r)}function iu(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function ou(r){return r?1:0}var vr=class extends oo{decode(e,t){return super.decode(e,t)}};function R(r,e,t){return new vr(r,e,t)}function X(r,e,t){let n,i=typeof e=="number"?e:co(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=co(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ao(r,i,t)}import{ASSOCIATED_TOKEN_PROGRAM_ID as Bn,TOKEN_2022_PROGRAM_ID as fe,TOKEN_PROGRAM_ID as ue}from"@solana/spl-token";import{Keypair as er,PublicKey as L,SystemProgram as ft,TransactionInstruction as Ne}from"@solana/web3.js";import Ur from"bn.js";import bu from"bn.js";import He from"bn.js";var we=new He(0),rt=new He(1),dt=new He(-1),Ve=new He(1).shln(64),Yn=new He(1).shln(128),_r=Ve.sub(rt),hn=64,po=Yn.subn(1),Ee=-443636,_e=-Ee,_t=new He("4295048016"),Ot=new He("79226673521066979257578248091"),vp=new He("4295048017"),_p=new He("79226673521066979257578248090"),fo=16,bo="59543866431248",yo="184467440737095516",go="15793534762490258745",$n=new He(10).pow(new He(6));var Op=new He("18446744073700000000");import J from"bn.js";function Jn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Or(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function Wr(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function An(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function wo(r,e){return An(r,e)?null:Or(r,e)}function ko(r,e){return An(r,e)?null:Wr(r,e)}var Gp=Buffer.from("amm_config","utf8"),su=Buffer.from("pool","utf8"),au=Buffer.from("pool_vault","utf8"),uu=Buffer.from("pool_reward_vault","utf8"),ho=Buffer.from("position","utf8"),cu=Buffer.from("tick_array","utf8"),lu=Buffer.from("operation","utf8"),mu=Buffer.from("pool_tick_array_bitmap_extension","utf8"),du=Buffer.from("observation","utf8");function Ao(r,e,t,n){return pe([su,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function Vr(r,e,t){return pe([au,e.toBuffer(),t.toBuffer()],r)}function Po(r,e,t){return pe([uu,e.toBuffer(),t.toBuffer()],r)}function se(r,e,t){return pe([cu,e.toBuffer(),Jn(t)],r)}function Tt(r,e,t,n){return pe([ho,e.toBuffer(),Jn(t),Jn(n)],r)}function Fe(r,e){return pe([ho,e.toBuffer()],r)}function Pn(r){return pe([Buffer.from("metadata","utf8"),Nt.toBuffer(),r.toBuffer()],Nt)}function Fr(r){return pe([lu],r)}function Le(r,e){return pe([mu,e.toBuffer()],r)}function To(r,e){return pe([du,e.toBuffer()],r)}var xo=Buffer.from("locked_position","utf8");function Dr(r,e){return pe([xo,e.toBuffer()],r)}function So(r,e){return pe([xo,e.toBuffer()],r)}import{TOKEN_2022_PROGRAM_ID as Bo}from"@solana/spl-token";import{PublicKey as De}from"@solana/web3.js";import de from"bn.js";import it from"bn.js";var Tn=class{static getfeeGrowthInside(e,t,n){let i=new it(0),o=new it(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new it(0),a=new it(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=$.wrappingSubU128($.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=$.wrappingSubU128($.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=$.mulDivFloor($.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),u=t.tokenFeesOwedA.add(a),c=$.mulDivFloor($.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=$.mulDivFloor($.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),u=t.tokenFeesOwedA.add(a),c=$.mulDivFloor($.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=$.wrappingSubU128(u,c.growthInsideLastX64),m=$.mulDivFloor(l,t.liquidity,Ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=$.wrappingSubU128(u,c.growthInsideLastX64),m=$.mulDivFloor(l,t.liquidity,Ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new it(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new it(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push($.wrappingSubU128($.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new it(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new it(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push($.wrappingSubU128($.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var w,g,h,A;let a=Z.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=Z.getSqrtPriceX64FromTick(t.tickLower),c=Z.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=ie.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ge(m.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),ge(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[b,f]=[ge(new it(new N(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),ge(new it(new N(m.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:Pt(d.expirationTime,p.expirationTime)}}};var pu=15,re=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=V.getTickArrayStartIndexByTick(i,o),l=V.getInitializedTickArrayInRange(s,a,o,c,Math.floor(pu/2));for(let p=0;p<l.length;p++){let{publicKey:b}=se(t,n,l[p]);u.push(b)}let m=(await mt(e,u)).map(p=>p!==null?xn.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let b=m[p];b!==null&&(d[b.startTickIndex]=te(q({},b),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=V.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/re.tickCount(t)),a=n?V.searchLowBitFromStart(i,o,s-1,1,t):V.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=Se-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<Se;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=se(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=V.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<Se;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=se(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(V.checkIsOutOfBoundary(e)){if(e>_e)return!1;let n=V.getTickArrayStartIndexByTick(Ee,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Se*e}};var qr=14,pt=class{static maxTickInTickarrayBitmap(e){return e*Se*Wt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!re.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-re.tickCount(n):t+re.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Se,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=wo(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=ko(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-re.tickCount(n)}}}},Sn=class{static getBitmapOffset(e,t){if(!re.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=pt.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=pt.maxTickInTickarrayBitmap(e),n=-t;if(_e<=t)throw Error(`extensionTickBoundary check error: ${_e}, ${t}`);if(n<=Ee)throw Error(`extensionTickBoundary check error: ${n}, ${Ee}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:V.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=re.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=pt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=V.mergeTickArrayBitmap(e).shln(Wt-1-a),c=An(512,u)?null:Or(512,u);if(c!==null){let l=t-c*re.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=V.mergeTickArrayBitmap(e).shrn(a),c=An(512,u)?null:Wr(512,u);if(c!==null){let l=t+c*re.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-re.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%pt.maxTickInTickarrayBitmap(t),i=Math.floor(n/re.tickCount(t));return e<0&&n!=0&&(i=Wt-i),i}};var ke=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:b,sqrtPriceX64:f,feeAmount:w}=Vt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,o,s);return u.push(...b),{allTrade:d,expectedAmountOut:p.mul(dt),remainingAccounts:u,executionPrice:f,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:w}=se(e.programId,e.id,f.nextStartIndex);a.push(w)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:b}=Vt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(dt),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:b}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=ke.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Sn.checkTickArrayIsInit(re.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):V.checkTickArrayIsInitialized(V.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=se(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,re.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=se(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/re.tickCount(e.tickSpacing)),i=t?V.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):V.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=re.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=pt.nextInitializedTickArrayStartIndex(V.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Sn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ee||t>_e)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te(q({},m),{perSecond:$.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new De(d)});if(p.tokenMint.equals(De.default))continue;if(n<=p.openTime.toNumber()||i.eq(we)){s.push(p);continue}let b=new de(Math.min(p.endTime.toNumber(),n)),f=b.sub(p.lastUpdateTime),w=$.mulDivFloor(f,p.emissionsPerSecondX64,i),g=p.rewardGrowthGlobalX64.add(w),h=$.mulDivFloor(f,p.emissionsPerSecondX64,Ve),A=p.rewardTotalEmissioned.add(h);s.push(te(q({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:A,lastUpdateTime:b}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=V.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=pt.maxTickInTickarrayBitmap(e),n=-t;return t>_e&&(t=re.getArrayStartIndex(_e,e)+re.tickCount(e)),n<Ee&&(n=re.getArrayStartIndex(Ee,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!re.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/re.tickCount(t)*Wt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Mt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=Lo.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=V.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=V.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=se(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await Mt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=xn.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te(q({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Fe(p,d).publicKey);let l=await mt(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=Ko.decode(d.data),b=p.poolId.toString(),f=e.find(T=>T.state.id.toBase58()===b);if(f===void 0)continue;let w=f.state,g=V._getTickPriceLegacy({poolInfo:w,tick:p.tickLower,baseIn:!0}),h=V._getTickPriceLegacy({poolInfo:w,tick:p.tickUpper,baseIn:!0}),{amountA:A,amountB:P}=ie.getAmountsFromLiquidity(w.sqrtPriceX64,g.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),x=1/(1-Math.sqrt(Math.sqrt(g.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:h.price,amountA:A,amountB:P,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(T=>te(q({},T),{pendingReward:new de(0)})),leverage:x,tokenFeeAmountA:new de(0),tokenFeeAmountB:new de(0)}];let k=await V.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),B=await V.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=k,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=B}if(o){let d=Object.values(m),p=await mt(t,d,{batchRequest:i}),b={};for(let f=0;f<d.length;f++){let w=p[f];if(w===null)continue;let g=d[f].toString();b[g]=xn.decode(w.data)}for(let{state:f,positionAccount:w}of e)if(!!w)for(let g of w){let h=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,P=b[m[h].toString()],x=b[m[A].toString()],k=P.ticks[V.getTickOffsetInArray(g.tickLower,f.tickSpacing)],B=x.ticks[V.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:T,tokenFeeAmountB:C}=await Tn.GetPositionFees(f,g,k,B),_=await Tn.GetPositionRewards(f,g,k,B);g.tokenFeeAmountA=T.gte(new de(0))?T:new de(0),g.tokenFeeAmountB=C.gte(new de(0))?C:new de(0);for(let M=0;M<_.length;M++)g.rewardInfos[M].pendingReward=_[M].gte(new de(0))?_[M]:new de(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new N(0),catchLiquidityInsufficient:u=!1}){var G;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?c=l?_t.add(new de(1)):Ot.sub(new de(1)):c=Z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ge(o,m,i,!1),{allTrade:b,expectedAmountOut:f,remainingAccounts:w,executionPrice:g,feeAmount:h}=ke.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((G=p.fee)!=null?G:we),c,u),A=ge(f,d,i,!1),P=Z.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),x=l?P:new N(1).div(P),k=f.mul(new de(Math.floor((1-s)*1e10))).div(new de(1e10)),B=ge(k,d,i,!1),T=l?e.currentPrice:new N(1).div(e.currentPrice),C=new N(x).sub(T).abs(),_=T,M=new ze(new N(C).mul(10**15).toFixed(0),new N(_).mul(10**15).toFixed(0));return{allTrade:b,realAmountIn:p,amountOut:A,minAmountOut:B,expirationTime:Pt(p.expirationTime,A.expirationTime),currentPrice:e.currentPrice,executionPrice:x,priceImpact:M,fee:h,remainingAccounts:w,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=i.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Re(te(q({},c),{mint:c.address,isToken2022:c.programId===Bo.toBase58()})),new Re(te(q({},l),{mint:l.address,isToken2022:l.programId===Bo.toBase58()}))],{allTrade:p,realAmountIn:b,amountOut:f,minAmountOut:w,expirationTime:g,currentPrice:h,executionPrice:A,priceImpact:P,fee:x,remainingAccounts:k,executionPriceX64:B}=ke.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new De(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),T=te(q({},b),{amount:new ye(m,b.amount),fee:b.fee===void 0?void 0:new ye(m,b.fee)}),C=te(q({},f),{amount:new ye(d,f.amount),fee:f.fee===void 0?void 0:new ye(d,f.fee)}),_=te(q({},w),{amount:new ye(d,w.amount),fee:w.fee===void 0?void 0:new ye(d,w.fee)}),M=new Qe({baseToken:m,denominator:new de(10).pow(new de(20+m.decimals)),quoteToken:d,numerator:h.mul(new N(10**(20+d.decimals))).toFixed(0)}),G=new Qe({baseToken:m,denominator:new de(10).pow(new de(20+m.decimals)),quoteToken:d,numerator:A.mul(new N(10**(20+d.decimals))).toFixed(0)}),W=new ye(m,x);return{allTrade:p,realAmountIn:T,amountOut:C,minAmountOut:_,expirationTime:g,currentPrice:M,executionPrice:G,priceImpact:P,fee:W,remainingAccounts:k,executionPriceX64:B}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new N(0)}){var _;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new N(0))?l=u?Ot.sub(new de(1)):_t.add(new de(1)):l=Z.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ge(o,c[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:b,feeAmount:f}=ke.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((_=m.fee)!=null?_:we),l),w=u?e.mintB.address:e.mintA.address,g=ge(d,c[w],i,!1),h=Z.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),A=u?h:new N(1).div(h),P=d.mul(new de(Math.floor((1+s)*1e10))).div(new de(1e10)),x=ge(P,c[w],i,!0),k=u?e.currentPrice:new N(1).div(e.currentPrice),B=new N(A).sub(k).abs(),T=k,C=new ze(new N(B).mul(10**15).toFixed(0),new N(T).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:x,realAmountOut:m,expirationTime:Pt(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:C,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var b,f,w;let o=e[t],s=V.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=V.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((b=o.rewardApr[0])!=null?b:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((w=o.rewardApr[2])!=null?w:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[$t(e.mintA.address).toString()],d=i[$t(e.mintB.address).toString()],p=e.mintA.decimals,b=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=Z.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),w=Z.getSqrtPriceX64FromTick(s),g=Z.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:A}=ie.getAmountsFromLiquidityWithSlippage(f,w,g,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:x}=ie.getAmountsFromLiquidityWithSlippage(f,w,g,o,!1,!1,0),k=new N(h.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(A.toString()).div(new N(10).pow(b)).mul(d.value)),B=new N(P.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(x.toString()).div(new N(10).pow(b)).mul(d.value)),T=new N(1).div(k.add(B)),_=new N(l.volumeFee).mul(365).div(c).mul(T).mul(100).toNumber(),M=3600*24*365,G=e.rewardDefaultInfos.map(W=>{var D,Ge;let H=W.mint.decimals,ee=i[W.mint.address];return u<((D=W.startTime)!=null?D:0)||u>((Ge=W.endTime)!=null?Ge:0)||!W.perSecond||!ee||H===void 0?0:new N(ee.value).mul(new N(W.perSecond).mul(M)).div(new N(10).pow(H)).mul(T).mul(100).toNumber()});return{feeApr:_,rewardsApr:G,apr:_+G.reduce((W,H)=>W+H,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,h;let l=Z.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=Z.getSqrtPriceX64FromTick(n),d=Z.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,b=ge(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),f=new de(new N(b.amount.sub((h=b.fee)!=null?h:we).toString()).mul(p).toFixed(0)),w;if(l.lte(m))w=t?ie.getLiquidityFromTokenAmountA(m,d,f,!a):new de(0);else if(l.lte(d)){let A=ie.getLiquidityFromTokenAmountA(l,d,f,!a),P=ie.getLiquidityFromTokenAmountB(m,l,f);w=t?A:P}else w=t?new de(0):ie.getLiquidityFromTokenAmountB(m,d,f);return ke.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:w,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var w,g,h,A;let u=Z.getSqrtPriceX64FromTick(n),c=Z.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=ie.getAmountsFromLiquidity(Z.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ge(m.amountA,(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),ge(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[b,f]=[ge(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ge(m.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:b,amountSlippageB:f,expirationTime:Pt(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(u=>!n[u.id]).map(u=>new De(u.id));(await mt(e,i)).forEach((u,c)=>{!u||(n[i[c].toBase58()]=Io.decode(u.data))});let s=t.map(u=>Le(new De(u.programId),new De(u.id)).publicKey),a=await ke.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>te(q({},u),{[c.id]:te(q({},n[c.id]),{id:new De(c.id),version:6,programId:new De(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te(q({},c.config),{id:new De(c.config.id),fundOwner:""}),currentPrice:new N(c.price),exBitmapAccount:Le(new De(c.programId),new De(c.id)).publicKey,exBitmapInfo:a[Le(new De(c.programId),new De(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var $=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(we)||(o=o.add(rt)),o}static mulDivFloor(e,t,n){if(n.eq(we))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(we))throw new Error("division by 0");return e.mul(t).add(n.sub(rt)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new J(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Yn).sub(t).mod(Yn)}};function Be(r,e){return Gr(r.mul(e),64,256)}function fu(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Gr(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Z=class{static sqrtPriceX64ToPrice(e,t,n){return $.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return $.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(we))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(we))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(we))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(we))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(we))return e;let o=t.shln(hn);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?$.mulDivCeil(s,e,a):$.mulDivRoundingUp(s,rt,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return $.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(hn);if(i)return e.add(o.div(t));{let s=$.mulDivRoundingUp(o,rt,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ee||e>_e)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new J("18445821805675395072"):new J("18446744073709551616");return(t&2)!=0&&(n=Be(n,new J("18444899583751176192"))),(t&4)!=0&&(n=Be(n,new J("18443055278223355904"))),(t&8)!=0&&(n=Be(n,new J("18439367220385607680"))),(t&16)!=0&&(n=Be(n,new J("18431993317065453568"))),(t&32)!=0&&(n=Be(n,new J("18417254355718170624"))),(t&64)!=0&&(n=Be(n,new J("18387811781193609216"))),(t&128)!=0&&(n=Be(n,new J("18329067761203558400"))),(t&256)!=0&&(n=Be(n,new J("18212142134806163456"))),(t&512)!=0&&(n=Be(n,new J("17980523815641700352"))),(t&1024)!=0&&(n=Be(n,new J("17526086738831433728"))),(t&2048)!=0&&(n=Be(n,new J("16651378430235570176"))),(t&4096)!=0&&(n=Be(n,new J("15030750278694412288"))),(t&8192)!=0&&(n=Be(n,new J("12247334978884435968"))),(t&16384)!=0&&(n=Be(n,new J("8131365268886854656"))),(t&32768)!=0&&(n=Be(n,new J("3584323654725218816"))),(t&65536)!=0&&(n=Be(n,new J("696457651848324352"))),(t&131072)!=0&&(n=Be(n,new J("26294789957507116"))),(t&262144)!=0&&(n=Be(n,new J("37481735321082"))),e>0&&(n=po.div(n)),n}static getTickFromPrice(e,t,n){return Z.getTickFromSqrtPriceX64(Z.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ot)||e.lt(_t))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new J(t-64),i=fu(n,32,128),o=new J("8000000000000000","hex"),s=0,a=new J(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new J(0))&&s<fo;){u=u.mul(u);let b=u.shrn(127);u=u.shrn(63+b.toNumber()),a=a.add(o.mul(b)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new J(bo)),d=Gr(m.sub(new J(yo)),64,128).toNumber(),p=Gr(m.add(new J(go)),64,128).toNumber();return d==p?d:Z.getSqrtPriceX64FromTick(p).lte(e)?p:d}},Ft=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=Z.getTickFromSqrtPriceX64(Z.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=Ft.getTickWithPriceAndTickspacing(e,t,n,i),s=Z.getSqrtPriceX64FromTick(o);return Z.sqrtPriceX64ToPrice(s,n,i)}},ie=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(we))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(hn),s=t.sub(e);return i?$.mulDivRoundingUp($.mulDivCeil(o,s,t),rt,e):$.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(we))throw new Error("sqrtPriceX64A must greater than 0");return i?$.mulDivCeil(n,t.sub(e),Ve):$.mulDivFloor(n,t.sub(e),Ve)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?$.mulDivRoundingUp(a,rt,_r):a.shrn(hn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),$.mulDivFloor(n,_r,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ie.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=ie.getLiquidityFromTokenAmountA(e,n,i,!1),a=ie.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ie.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ie.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new J(0)};if(e.lt(n)){let s=ie.getTokenAmountAFromLiquidity(e,n,i,o),a=ie.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new J(0),amountB:ie.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=ie.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new J(new N(u.toString()).mul(l).toFixed(0)),d=new J(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,A,P,x;let c=Z.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=Z.getSqrtPriceX64FromTick(t),m=Z.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=ie.getAmountsFromLiquidity(c,l,m,i,s),[b,f]=[ge(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),ge(p.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[w,g]=[ge(new J(new N(p.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,u),ge(new J(new N(p.amountB.toString()).mul(d).toFixed(0)),(x=e.mintB.extensions)==null?void 0:x.feeConfig,a,u)];return{liquidity:i,amountA:b,amountB:f,amountSlippageA:w,amountSlippageB:g,expirationTime:Pt(b.expirationTime,f.expirationTime)}}},Vt=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f=!1){if(d.eq(we))throw new Error("amountSpecified must not be 0");if(b||(b=s?_t.add(rt):Ot.sub(rt)),s){if(b.lt(_t))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(b.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(b.gt(Ot))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(b.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let w=d.gt(we),g={amountSpecifiedRemaining:d,amountCalculated:we,sqrtPriceX64:m,tick:c>p?Math.min(p+re.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new J(0)},h=p,A=n[p],P=0,x=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(we)&&!g.sqrtPriceX64.eq(b);){P>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let B=V.nextInitTick(A,g.tick,l,s,x),T=B||null,C=null;if(!(T!=null&&T.liquidityGross.gtn(0))){let M=ke.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},h,s);if(!M.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}h=M.nextStartIndex;let{publicKey:G}=se(e,t,h);C=G,A=n[h];try{T=V.firstInitializedTick(A,s)}catch{throw Error("not found next tick info")}}k.tickNext=T.tick,k.initialized=T.liquidityGross.gtn(0),p!==h&&C&&(g.accounts.push(C),p=h),k.tickNext<Ee?k.tickNext=Ee:k.tickNext>_e&&(k.tickNext=_e),k.sqrtPriceNextX64=Z.getSqrtPriceX64FromTick(k.tickNext);let _;if(s&&k.sqrtPriceNextX64.lt(b)||!s&&k.sqrtPriceNextX64.gt(b)?_=b:_=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=Vt.swapStepCompute(g.sqrtPriceX64,_,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(k.feeAmount),w?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let M=T.liquidityNet;s&&(M=M.mul(dt)),g.liquidity=ie.addDelta(g.liquidity,M)}x=k.tickNext!=g.tick&&!s&&A.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let M=Z.getTickFromSqrtPriceX64(g.sqrtPriceX64);x=M!=g.tick&&!s&&A.startTickIndex===M,g.tick=M}++P}try{let{nextStartIndex:k,isExist:B}=re.nextInitializedTickArray(g.tick,l,s,i,o);B&&p!==k&&(g.accounts.push(se(e,t,k).publicKey),p=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:we,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new J(0),amountIn:new J(0),amountOut:new J(0),feeAmount:new J(0)},a=e.gte(t),u=i.gte(we);if(u){let l=$.mulDivFloor(i,$n.sub(new J(o.toString())),$n);s.amountIn=a?ie.getTokenAmountAFromLiquidity(t,e,n,!0):ie.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Z.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?ie.getTokenAmountBFromLiquidity(t,e,n,!1):ie.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(dt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Z.getNextSqrtPriceX64FromOutput(e,n,i.mul(dt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=ie.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=ie.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:ie.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:ie.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(dt))&&(s.amountOut=i.mul(dt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=$.mulDivCeil(s.amountIn,new J(o),$n.sub(new J(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Se=60,Wt=512,V=class{static getTickArrayAddressByTick(e,t,n,i){let o=V.getTickArrayStartIndexByTick(n,i),{publicKey:s}=se(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=V.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Se)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=re.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*re.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Se,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*Se,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Se:e+t*Se}static mergeTickArrayBitmap(e){let t=new bu(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*Se));return[...V.searchLowBitFromStart(e,t,s-1,o,n),...V.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return V.searchHightBitFromStart(e,t,0,Wt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=V.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=se(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>V.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=re.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>V.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=re.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ee||e>_e}static nextInitTick(e,t,n,i,o){if(re.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Se;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Se-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Se;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=Z.getSqrtPriceX64FromTick(t),o=Z.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new N(1).div(t),o=Ft.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Z.getSqrtPriceX64FromTick(o),a=Z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=Z.getSqrtPriceX64FromTick(t),o=Z.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new N(1).div(t),o=Ft.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Z.getSqrtPriceX64FromTick(o),a=Z.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};var $f=R([Ae(8),O("bump"),Et("index"),K(""),Me("protocolFeeRate"),Me("tradeFeeRate"),Et("tickSpacing"),X(y(),8,"")]),yu=R([Me("blockTimestamp"),en("tickCumulative"),X(y(),4)]),No=R([Ae(8),xe("initialized"),y("recentEpoch"),Et("observationIndex"),K("poolId"),X(yu,100,"observations"),X(y(),4)]),gu=R([O("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),U("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),K("tokenMint"),K("tokenVault"),K("creator"),U("rewardGrowthGlobalX64")]),Io=R([Ae(8),O("bump"),K("ammConfig"),K("creator"),K("mintA"),K("mintB"),K("vaultA"),K("vaultB"),K("observationId"),O("mintDecimalsA"),O("mintDecimalsB"),Et("tickSpacing"),U("liquidity"),U("sqrtPriceX64"),me("tickCurrent"),Me(),U("feeGrowthGlobalX64A"),U("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),U("swapInAmountTokenA"),U("swapOutAmountTokenB"),U("swapInAmountTokenB"),U("swapOutAmountTokenA"),O("status"),X(O(),7,""),X(gu,3,"rewardInfos"),X(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),X(y(),15*4-3,"padding")]),wu=R([U("growthInsideLastX64"),y("rewardAmountOwed")]),Ko=R([Ae(8),O("bump"),K("nftMint"),K("poolId"),me("tickLower"),me("tickUpper"),U("liquidity"),U("feeGrowthInsideLastX64A"),U("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),X(wu,3,"rewardInfos"),X(y(),8,"")]),Jf=R([Ae(8),O("bump"),K("poolId"),me("tickLowerIndex"),me("tickUpperIndex"),U("liquidity"),U("feeGrowthInsideLastX64A"),U("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),X(U(),3,"rewardGrowthInside"),X(y(),8,"")]),ku=R([me("tick"),mo("liquidityNet"),U("liquidityGross"),U("feeGrowthOutsideX64A"),U("feeGrowthOutsideX64B"),X(U(),3,"rewardGrowthsOutsideX64"),X(Me(),13,"")]),xn=R([Ae(8),K("poolId"),me("startTickIndex"),X(ku,Se,"ticks"),O("initializedTickCount"),X(O(),115,"")]),eb=R([Ae(329),X(K(),100,"whitelistMints")]),Lo=R([Ae(8),K("poolId"),X(X(y(),8),qr,"positiveTickArrayBitmap"),X(X(y(),8),qr,"negativeTickArrayBitmap")]),tb=R([y(),O("bump"),K("owner"),K("poolId"),K("positionId"),K("nftAccount"),X(y(),8)]),nb=R([Ae(8),O("bump"),K("lockOwner"),K("poolId"),K("positionId"),K("nftAccount"),K("lockNftMint"),y("recentEpoch"),X(y(),8)]);No.span;var Co=ae("CobaltX_Clmm"),qe={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Ro=[188,37,179,131,82,150,84,73],Mo=[16,72,250,198,14,162,212,19],tn=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b){let f=R([U("sqrtPriceX64"),y("startTime")]),w=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:b},g);let h=Buffer.from([...qe.createPool,...g]);return new Ne({keys:w,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new L(i.address),new L(o.address)],{publicKey:m}=Ao(t,s,c,l),{publicKey:d}=To(t,m),{publicKey:p}=Vr(t,m,c),{publicKey:b}=Vr(t,m,l),f=Le(t,m).publicKey,w=[this.createPoolInstruction(t,m,n,s,d,c,p,new L(i.programId||ue),l,b,new L(o.programId||ue),f,a,u)];return{signers:[],instructions:w,instructionTypes:[Q.CreateAccount,Q.ClmmCreatePool],address:{poolId:m,observationId:d,exBitmapAccount:f,mintAVault:p,mintBVault:b},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h,A,P,x,k,B,T,C,_){let M=R([me("tickLowerIndex"),me("tickUpperIndex"),me("tickArrayLowerStartIndex"),me("tickArrayUpperStartIndex"),U("liquidity"),y("amountMaxA"),y("amountMaxB"),xe("withMetadata"),O("optionBaseFlag"),xe("baseFlag")]),G=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...G],H=Buffer.alloc(M.span);M.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:x,liquidity:k,amountMaxA:B,amountMaxB:T,withMetadata:C==="create",baseFlag:!1,optionBaseFlag:0},H);let ee=Buffer.from([...qe.openPosition,...H]);return new Ne({keys:W,programId:e,data:ee})}static openPositionFromLiquidityInstruction22(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h,A,P,x,k,B,T,C){let _=R([me("tickLowerIndex"),me("tickUpperIndex"),me("tickArrayLowerStartIndex"),me("tickArrayUpperStartIndex"),U("liquidity"),y("amountMaxA"),y("amountMaxB"),xe("withMetadata"),O("optionBaseFlag"),xe("baseFlag")]),M=[...C?[{pubkey:C,isSigner:!1,isWritable:!0}]:[]],G=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...M],W=Buffer.alloc(_.span);_.encode({tickLowerIndex:g,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:x,amountMaxA:k,amountMaxB:B,withMetadata:T==="create",baseFlag:!1,optionBaseFlag:0},W);let H=Buffer.from([...qe.openPositionWithTokenEx,...W]);return new Ne({keys:G,programId:e,data:H})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[p,b]=[new L(e.programId),new L(e.id)],f;if(l)f=new L((await l(1))[0]);else{let C=er.generate();d.push(C),f=C.publicKey}let w=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=se(p,b,w),{publicKey:A}=se(p,b,g),{publicKey:P}=m?le(n.wallet,f,fe):le(n.wallet,f,ue),{publicKey:x}=Pn(f),{publicKey:k}=Fe(p,f),{publicKey:B}=Tt(p,b,i,o),T=m?this.openPositionFromLiquidityInstruction22(p,n.feePayer,b,n.wallet,f,P,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,w,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(p,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(p,n.feePayer,b,n.wallet,f,P,x,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,w,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(p,b).publicKey:void 0);return{signers:d,instructions:[T],instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:P,metadataAccount:x,personalPosition:k,protocolPosition:B}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[p,b]=[new L(e.programId),new L(e.id)],f;if(l)f=new L((await l(1))[0]);else{let C=er.generate();d.push(C),f=C.publicKey}let w=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=se(p,b,w),{publicKey:A}=se(p,b,g),{publicKey:P}=m?le(n.wallet,f,fe):le(n.wallet,f,ue),{publicKey:x}=Pn(f),{publicKey:k}=Fe(p,f),{publicKey:B}=Tt(p,b,i,o),T=m?this.openPositionFromBaseInstruction22(p,n.feePayer,b,n.wallet,f,P,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,w,g,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(p,b).publicKey:void 0):this.openPositionFromBaseInstruction(p,n.feePayer,b,n.wallet,f,P,x,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),i,o,w,g,c,s,a,u,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(p,b).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:P,metadataAccount:x,personalPosition:k,protocolPosition:B},instructions:[T],signers:d,instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount&&t.lookupTableAccount!=""?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h,A,P,x,k,B,T,C,_){let M=R([me("tickLowerIndex"),me("tickUpperIndex"),me("tickArrayLowerStartIndex"),me("tickArrayUpperStartIndex"),U("liquidity"),y("amountMaxA"),y("amountMaxB"),xe("withMetadata"),O("optionBaseFlag"),xe("baseFlag")]),G=[..._?[{pubkey:_,isSigner:!1,isWritable:!0}]:[]],W=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...G],H=Buffer.alloc(M.span);M.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:x,liquidity:new Ur(0),amountMaxA:B==="MintA"?T:C,amountMaxB:B==="MintA"?C:T,withMetadata:k==="create",baseFlag:B==="MintA",optionBaseFlag:1},H);let ee=Buffer.from([...qe.openPosition,...H]);return new Ne({keys:W,programId:e,data:ee})}static openPositionFromBaseInstruction22(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h,A,P,x,k,B,T,C){let _=R([me("tickLowerIndex"),me("tickUpperIndex"),me("tickArrayLowerStartIndex"),me("tickArrayUpperStartIndex"),U("liquidity"),y("amountMaxA"),y("amountMaxB"),xe("withMetadata"),O("optionBaseFlag"),xe("baseFlag")]),M=[...C?[{pubkey:C,isSigner:!1,isWritable:!0}]:[]],G=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...M],W=Buffer.alloc(_.span);_.encode({tickLowerIndex:g,tickUpperIndex:h,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:P,liquidity:new Ur(0),amountMaxA:k==="MintA"?B:T,amountMaxB:k==="MintA"?T:B,withMetadata:x==="create",baseFlag:k==="MintA",optionBaseFlag:1},W);let H=Buffer.from([...qe.openPositionWithTokenEx,...W]);return new Ne({keys:G,programId:e,data:H})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d,p=[];if(l)d=new L((await l(1))[0]);else{let C=er.generate();p.push(C),d=C.publicKey}let[b,f]=[new L(e.programId),new L(e.id)],w=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=se(b,f,w),{publicKey:A}=se(b,f,g),{publicKey:P}=m?le(n.wallet,d,fe):le(n.wallet,d,ue),{publicKey:x}=Pn(d),{publicKey:k}=Fe(b,d),{publicKey:B}=Tt(b,f,i,o),T=m?this.openPositionFromLiquidityInstruction22(b,n.wallet,f,n.wallet,d,P,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(t.mintA.address),new L(t.mintB.address),i,o,w,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(b,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(b,n.wallet,f,n.wallet,d,P,x,B,h,A,k,n.tokenAccountA,n.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(t.mintA.address),new L(t.mintB.address),i,o,w,g,s,a,u,c,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[w,g])?Le(b,f).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:h,tickArrayUpper:A,positionNftAccount:P,metadataAccount:x,personalPosition:k,protocolPosition:B},instructions:[T],signers:p,instructionTypes:[Q.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o,s){let a=R([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:s?fe:ue,isSigner:!1,isWritable:!1}],c=Buffer.alloc(a.span);a.encode({},c);let l=Buffer.from([...qe.closePosition,...c]);return new Ne({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:o}){let s=new L(e.programId),a=o?le(n.wallet,i.nftMint,fe).publicKey:le(n.wallet,i.nftMint,ue).publicKey,{publicKey:u}=Fe(s,i.nftMint),c=[];return c.push(this.closePositionInstruction(s,n.wallet,i.nftMint,a,u,o)),{address:{positionNftAccount:a,personalPosition:u},signers:[],instructions:c,instructionTypes:[Q.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h){let A=R([U("liquidity"),y("amountMaxA"),y("amountMaxB"),O("optionBaseFlag"),xe("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:w,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let B=Buffer.from([...qe.increaseLiquidity,...k]);return new Ne({keys:x,programId:e,data:B})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:u}){let[c,l]=[new L(e.programId),new L(e.id)],m=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=se(c,l,m),{publicKey:b}=se(c,l,d),{publicKey:f}=u?le(i.wallet,n.nftMint,fe):le(i.wallet,n.nftMint,ue),{publicKey:w}=Fe(c,n.nftMint),{publicKey:g}=Tt(c,l,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(c,i.wallet,f,w,l,g,p,b,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Le(c,l).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:f,personalPosition:w,protocolPosition:g},signers:[],instructions:[h],instructionTypes:[Q.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a,nft2022:u}){let[c,l]=[new L(e.programId),new L(e.id)],m=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=se(c,l,m),{publicKey:b}=se(c,l,d),{publicKey:f}=u?le(i.wallet,n.nftMint,fe):le(i.wallet,n.nftMint,ue),{publicKey:w}=Fe(c,n.nftMint),{publicKey:g}=Tt(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:f,personalPosition:w,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(c,i.wallet,f,w,l,g,p,b,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Le(c,l).publicKey:void 0)],signers:[],instructionTypes:[Q.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h){let A=R([U("liquidity"),y("amountMaxA"),y("amountMaxB"),O("optionBaseFlag"),xe("baseFlag")]),P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...P],k=Buffer.alloc(A.span);A.encode({liquidity:new Ur(0),amountMaxA:f==="MintA"?w:g,amountMaxB:f==="MintA"?g:w,baseFlag:f==="MintA",optionBaseFlag:1},k);let B=Buffer.from([...qe.increaseLiquidity,...k]);return new Ne({keys:x,programId:e,data:B})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g,h,A){let P=R([U("liquidity"),y("amountMinA"),y("amountMinB")]),x=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(C=>[{pubkey:C.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:C.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...x],B=Buffer.alloc(P.span);P.encode({liquidity:w,amountMinA:g,amountMinB:h},B);let T=Buffer.from([...qe.decreaseLiquidity,...B]);return new Ne({keys:k,programId:e,data:T})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u,nft2022:c}){let[l,m]=[new L(e.programId),new L(e.id)],d=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:b}=se(l,m,d),{publicKey:f}=se(l,m,p),{publicKey:w}=c?le(i.wallet,n.nftMint,fe):le(i.wallet,n.nftMint,u),{publicKey:g}=Fe(l,n.nftMint),{publicKey:h}=Tt(l,m,n.tickLower,n.tickUpper),A=[];for(let k=0;k<e.rewardDefaultInfos.length;k++)A.push({poolRewardVault:new L(t.rewardInfos[k].vault),ownerRewardVault:i.rewardAccounts[k],rewardMint:new L(e.rewardDefaultInfos[k].mint.address)});let P=[],x=this.decreaseLiquidityInstruction(l,i.wallet,w,g,m,h,b,f,i.tokenAccountA,i.tokenAccountB,new L(t.vault.A),new L(t.vault.B),new L(e.mintA.address),new L(e.mintB.address),A,o,s,a,ke.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,p])?Le(l,m).publicKey:void 0);return P.push(x),{address:{tickArrayLower:b,tickArrayUpper:f,positionNftAccount:w,personalPosition:g,protocolPosition:h},signers:[],instructions:P,instructionTypes:[Q.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,b,f,w,g){let h=R([y("amount"),y("otherAmountThreshold"),U("sqrtPriceLimitX64"),xe("isBaseInput")]),A=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(B=>({pubkey:B,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],x=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:b,sqrtPriceLimitX64:f,isBaseInput:w},x);let k=Buffer.from([...qe.swap,...x]);return new Ne({keys:P,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new L(e.programId),new L(e.id)],[d,p]=[new L(t.vault.A),new L(t.vault.B)],[b,f]=[new L(e.mintA.address),new L(e.mintB.address)],w=e.mintA.address===o.toString(),g=[this.swapInstruction(l,i.wallet,m,new L(e.config.id),w?i.tokenAccountA:i.tokenAccountB,w?i.tokenAccountB:i.tokenAccountA,w?d:p,w?p:d,w?b:f,w?f:b,c,n,s,a,u,!0,Le(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[Q.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new L(e.programId),new L(e.id)],[d,p]=[new L(t.vault.A),new L(t.vault.B)],[b,f]=[new L(e.mintA.address),new L(e.mintB.address)],w=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,i.wallet,m,new L(e.config.id),w?i.tokenAccountB:i.tokenAccountA,w?i.tokenAccountA:i.tokenAccountB,w?p:d,w?d:p,w?f:b,w?b:f,c,n,s,a,u,!1,Le(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[Q.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([y("openTime"),y("endTime"),U("emissionsPerSecondX64")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ne(l),endTime:ne(m),emissionsPerSecondX64:d},f);let w=Buffer.from([...qe.initReward,...f]);return new Ne({keys:b,programId:e,data:w})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a=Po(o,s,i.mint).publicKey,u=Fr(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new L(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[Q.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([O("rewardIndex"),U("emissionsPerSecondX64"),y("openTime"),y("endTime")]),b=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ne(l),endTime:ne(m)},f);let w=Buffer.from([...qe.setRewardEmissions,...f]);return new Ne({keys:b,programId:e,data:w})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new L(t.rewardInfos[d].vault),c=new L(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Co.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Fr(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new L(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[Q.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=R([O("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...qe.collectReward,...l]);return new Ne({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new L(e.programId),new L(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new L(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Co.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[Q.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:u}){let c=[],l;if(u)l=new L((await u(1))[0]);else{let g=er.generate();c.push(g),l=g.publicKey}let m=a?le(o,s,fe).publicKey:le(o,s,ue).publicKey,{publicKey:d}=Fe(n,s),p=So(e,l).publicKey,b=le(o,l,ue).publicKey,f=Pn(l).publicKey,w=tn.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:d,lockPositionId:p,lockNftMint:l,lockNftAccount:b,metadataAccount:f,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:le(t,s,a?fe:ue).publicKey,positionNftProgram:a?fe:ue});return{address:{positionId:d,lockPositionId:p,lockNftAccount:b,lockNftMint:l,positionNftAccount:m,metadataAccount:f},instructions:[w],signers:c,instructionTypes:[Q.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:m,lockNftMint:d,lockNftAccount:p,metadataAccount:b,withMetadata:f}){let w=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!0,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Nt,isSigner:!1,isWritable:!1},{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1}],g=R([xe("withMetadata")]),h=Buffer.alloc(g.span);g.encode({withMetadata:f},h);let A=Buffer.from([...Ro,...h]);return new Ne({keys:w,programId:e,data:A})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=le(i,o,ue),{publicKey:a}=Fe(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Dr(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1}];return new Ne({keys:u,programId:e,data:Buffer.from(Ro)})}static harvestLockPositionInstruction(e){let[t,n]=[new L(e.poolKeys.programId),new L(e.poolKeys.id)],i=V.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=V.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=se(t,n,i),{publicKey:a}=se(t,n,o),{publicKey:u}=le(e.owner,e.ownerPosition.nftMint,ue),{publicKey:c}=Fe(t,e.ownerPosition.nftMint),{publicKey:l}=Tt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let b=0;b<e.poolKeys.rewardInfos.length;b++)m.push({poolRewardVault:new L(e.poolKeys.rewardInfos[b].vault),ownerRewardVault:e.ownerRewardAccounts[b],rewardMint:new L(e.poolKeys.rewardInfos[b].mint.address)});let d=[...m.map(b=>[{pubkey:b.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:b.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Dr(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new L(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new L(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Tr,isSigner:!1,isWritable:!1},{pubkey:new L(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new L(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ne({keys:p,programId:e.programId,data:Buffer.from(Mo)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:b,tickArrayUpper:f,userVaultA:w,userVaultB:g,mintA:h,mintB:A,rewardAccounts:P,exTickArrayBitmap:x}){let k=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[],...P.map(T=>[{pubkey:T.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:T.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ue,isSigner:!1,isWritable:!1},{pubkey:fe,isSigner:!1,isWritable:!1},{pubkey:Tr,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...k];return new Ne({keys:B,programId:e,data:Buffer.from(Mo)})}};import{PublicKey as Eo}from"@solana/web3.js";var Tb=ae("CobaltX_farm_config"),xb=new Eo("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Sb=new Eo("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var vo={3:zr,5:_o,6:Oo};var tr={"Standard SPL":0,"Option tokens":1},Xr={[Zi.toString()]:3,[Yi.toString()]:4,[$i.toString()]:5,[Ji.toString()]:6};var Qr=R([O("instruction")]),Tu=R([O("instruction")]),xu=R([y("rewardState"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardLastUpdateTime"),y("totalReward"),y("totalRewardEmissioned"),y("rewardClaimed"),y("rewardPerSecond"),U("accRewardPerShare"),K("rewardVault"),K("rewardMint"),K("rewardSender"),y("rewardType"),X(y(),15,"padding")]),Su=R([y("state"),y("nonce"),K("lpVault"),K("rewardVault"),K(),K(),y(),y(),y("totalReward"),U("perShareReward"),y("lastSlot"),y("perSlotReward")]),Bu=R([y("state"),y("nonce"),K("lpVault"),K("rewardVaultA"),y("totalRewardA"),U("perShareRewardA"),y("perSlotRewardA"),O("option"),K("rewardVaultB"),Ae(7),y("totalRewardB"),U("perShareRewardB"),y("perSlotRewardB"),y("lastSlot"),K()]),Iu=R([y(),y("state"),y("nonce"),y("validRewardTokenNum"),U("rewardMultiplier"),y("rewardPeriodMax"),y("rewardPeriodMin"),y("rewardPeriodExtend"),K("lpMint"),K("lpVault"),X(xu,5,"rewardInfos"),K("creator"),K(),X(y(),32,"padding")]),hu=new Proxy(Su,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return te(q({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(r,e,t)}}),Au=new Proxy(Bu,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return te(q({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(r,e,t)}}),Pu=new Proxy(Iu,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return te(q({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return te(q({},o),{rewardType:((s=Object.entries(tr).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),Ku=R([y("isSet"),y("rewardPerSecond"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardType")]),Lu=R([O("instruction"),y("nonce"),X(Ku,5,"rewardTimeInfo")]),Nu=R([O("instruction"),y("rewardReopenTime"),y("rewardEndTime"),y("rewardPerSecond")]),Cu=R([O("instruction"),y("isSet"),y("rewardPerSecond"),y("rewardOpenTime"),y("rewardEndTime"),y("rewardType")]),Rb=R([y("state"),K("id"),K("owner"),y("deposited"),X(y(),1,"rewardDebts")]),zr=R([y("state"),K("id"),K("owner"),y("deposited"),X(U(),1,"rewardDebts"),y(""),y("voteLockedBalance"),X(y(),15)]),Mb=R([y("state"),K("id"),K("owner"),y("deposited"),X(y(),2,"rewardDebts")]),_o=R([y("state"),K("id"),K("owner"),y("deposited"),X(U(),2,"rewardDebts"),X(y(),17)]),Oo=R([y(),y("state"),K("id"),K("owner"),y("deposited"),X(U(),5,"rewardDebts"),X(y(),16)]),Dt=R([O("instruction"),y("amount")]),Ru=R([K("mint"),K("grantAuthority"),y("baselineVoteWeightScaledFactor"),y("maxExtraLockupVoteWeightScaledFactor"),y("lockupSaturationSecs"),lo("digitShift"),X(O(),7,"reserved1"),X(y(),7,"reserved2")]),Mu=R([Ae(8),K("governanceProgramId"),K("realm"),K("realmGoverningTokenMint"),K("realmAuthority"),X(O(),32,"reserved1"),X(Ru,4,"votingMints"),en("timeOffset"),O("bump"),X(O(),7,"reserved2"),X(y(),11,"reserved3")]),Eu=R([en("startTime"),en("endTime"),O("kind"),X(O(),15,"reserved")]),vu=R([X(Eu,1,"lockup"),y("amountDeposited_native"),y("amountInitiallyLockedNative"),xe("isUsed"),xe("allowClawback"),O("votingMintConfigIdx"),X(O(),29,"reserved")]),_u=R([Ae(8),K("voterAuthority"),K("registrar"),X(vu,32,"deposits"),O("voterBump"),O("voterWweightRecordBump"),X(O(),94,"reserved")]);import Db from"bn.js";var Hr=R([K("mint"),K("owner"),y("amount"),Me("delegateOption"),K("delegate"),O("state"),Me("isNativeOption"),y("isNative"),y("delegatedAmount"),Me("closeAuthorityOption"),K("closeAuthority")]);var Ou=ae("CobaltX.farm.util");function nn({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=pe([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}function Wo(r){let e=vo[r];return e||Ou.logWithError("invalid version",r),e}import{ASSOCIATED_TOKEN_PROGRAM_ID as my,createAssociatedTokenAccountInstruction as dy,TOKEN_PROGRAM_ID as jr}from"@solana/spl-token";import{PublicKey as ve,SystemProgram as Wu,SYSVAR_CLOCK_PUBKEY as Vo,SYSVAR_RENT_PUBKEY as Vu,TransactionInstruction as nr}from"@solana/web3.js";import yy from"bn.js";var Fu=ae("CobaltX_farm_instruction"),Iy={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function Fo(r){let{version:e,id:t,ledger:n,programId:i,owner:o}=r,s={3:9,5:10}[e];s||Fu.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(Qr.span);Qr.encode({instruction:s},a);let u=[S({pubkey:t}),S({pubkey:n}),S({pubkey:o,isWritable:!1}),S({pubkey:Wu.programId,isWritable:!1}),S({pubkey:Vu,isWritable:!1})];return{instruction:new nr({programId:i,keys:u,data:a}),instructionType:Q.FarmV3CreateLedger}}function Do(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new ve(e.programId),new ve(e.id)],c=nn({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(Dt.span);Dt.encode({instruction:2,amount:ne(s)},l);let m=[S({pubkey:jr,isWritable:!1}),S({pubkey:u}),S({pubkey:new ve(t.authority),isWritable:!1}),S({pubkey:new ve(t.lpVault)}),S({pubkey:c}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(S({pubkey:new ve(t.rewardInfos[d].vault)})),m.push(S({pubkey:i[d]}));return new nr({programId:a,keys:m,data:l})}function qo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ve(e.programId),new ve(e.id)],l=nn({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(Dt.span);Dt.encode({instruction:12,amount:ne(s)},m);let d=[S({pubkey:c}),S({pubkey:new ve(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new ve(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new ve(t.rewardInfos[0].vault)}),S({pubkey:Vo,isWritable:!1}),S({pubkey:jr,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(S({pubkey:i[p]})),d.push(S({pubkey:new ve(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(S({pubkey:p}));return new nr({programId:u,keys:d,data:m})}function Go(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new ve(e.programId),new ve(e.id)],l=nn({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(Dt.span);Dt.encode({instruction:11,amount:ne(s)},m);let d=[S({pubkey:c}),S({pubkey:new ve(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new ve(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new ve(t.rewardInfos[0].vault)}),S({pubkey:Vo,isWritable:!1}),S({pubkey:jr,isWritable:!1})];if(a)for(let p of a)d.push(S({pubkey:p}));return new nr({programId:u,keys:d,data:m})}var Zr=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),rn=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new Qn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Zr(e))}logInfo(...e){this.logger.info(Zr(e))}logAndCreateError(...e){let t=Zr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Dy=R([Me("mintAuthorityOption"),K("mintAuthority"),y("supply"),O("decimals"),O("isInitialized"),Me("freezeAuthorityOption"),K("freezeAuthority")]);import{PublicKey as Xy}from"@solana/web3.js";import{MintLayout as Qy,TOKEN_PROGRAM_ID as jy}from"@solana/spl-token";var Uo=r=>new Re({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name});var rr=i=>{var o=i,{address:r,programId:e,decimals:t}=o,n=Xe(o,["address","programId","decimals"]);return q({chainId:101,address:$t(r).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};import Xo from"bn.js";var Yr=new Xo(25),ir=new Xo(1e4);import{ASSOCIATED_TOKEN_PROGRAM_ID as ec,TOKEN_PROGRAM_ID as Kn}from"@solana/spl-token";import{PublicKey as ot,SystemProgram as tc,SYSVAR_RENT_PUBKEY as kg,TransactionInstruction as sn}from"@solana/web3.js";var $r=R([O("instruction"),y("amountIn"),y("minAmountOut")]),Jr=R([O("instruction"),y("maxAmountIn"),y("amountOut")]),lg=R([O("instruction"),O("nonce")]),Du=R([O("instruction"),O("nonce"),y("startTime")]),zo=R([y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalValue"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),U("swapBaseInAmount"),U("swapQuoteOutAmount"),y("swapBase2QuoteFee"),U("swapQuoteInAmount"),U("swapBaseOutAmount"),y("swapQuote2BaseFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("withdrawQueue"),K("lpVault"),K("owner"),y("lpReserve"),X(y(),3,"padding")]),mg=R([y("accountType"),y("status"),y("nonce"),y("maxOrder"),y("depth"),y("baseDecimal"),y("quoteDecimal"),y("state"),y("resetFlag"),y("minSize"),y("volMaxCutRatio"),y("amountWaveRatio"),y("baseLotSize"),y("quoteLotSize"),y("minPriceMultiplier"),y("maxPriceMultiplier"),y("systemDecimalsValue"),y("abortTradeFactor"),y("priceTickMultiplier"),y("priceTick"),y("minSeparateNumerator"),y("minSeparateDenominator"),y("tradeFeeNumerator"),y("tradeFeeDenominator"),y("pnlNumerator"),y("pnlDenominator"),y("swapFeeNumerator"),y("swapFeeDenominator"),y("baseNeedTakePnl"),y("quoteNeedTakePnl"),y("quoteTotalPnl"),y("baseTotalPnl"),y("poolOpenTime"),y("punishPcAmount"),y("punishCoinAmount"),y("orderbookToInitTime"),U("swapBaseInAmount"),U("swapQuoteOutAmount"),U("swapQuoteInAmount"),U("swapBaseOutAmount"),y("swapQuote2BaseFee"),y("swapBase2QuoteFee"),K("baseVault"),K("quoteVault"),K("baseMint"),K("quoteMint"),K("lpMint"),K("modelDataAccount"),K("openOrders"),K("marketId"),K("marketProgramId"),K("targetOrders"),K("owner"),X(y(),64,"padding")]),ei=R([O("instruction"),y("baseAmountIn"),y("quoteAmountIn"),y("fixedSide"),y("otherAmountMin")]),ti=R([O("instruction"),y("lpAmount"),y("baseAmountMin"),y("quoteAmountMin")]);var Qo=R([y("fee")]);import{PublicKey as qu}from"@solana/web3.js";var on=new qu("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Gt=5e4,Gu=R([y("x"),y("y"),y("price")]),Uu=R([y("accountType"),y("status"),y("multiplier"),y("validDataCount"),X(Gu,Gt,"DataElement")]);function Xu(r,e){return[0,Gt-2]}function zu(r){return[0,Gt-2]}function Qu(r){return[0,Gt-2]}function Hu(r,e,t){let[n,i]=Xu(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=Gt-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function ni(r,e,t){let[n,i,o]=Hu(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,d=(u-s)*(e*a-s*t)*c,p=m+d;return e*r.multiplier*l/p}}function qt(r,e,t){return e*r.multiplier/t}function Ho(r,e,t){return e*t/r.multiplier}function ju(r,e){let[t,n]=zu(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>Gt-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function Zu(r,e){let[t,n]=Qu(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=Gt-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function jo(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=ju(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,p,!0,a]:[l,d,!0,a];{let b,f;return n?(b=l+(m-l)*(e-u)/(c-u),f=d-(i-u)*r.multiplier/m):(b=l+(m-l)*(e-u)/(c-u),f=p+(c-i)*r.multiplier/l),[b,f,!1,a]}}}function Yu(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=Zu(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=p&&e<=d)return n?[m,c,!0,a]:[l,u,!0,a];{let b,f;return n?(b=l+(m-l)*(d-e)/(d-p),f=u+m*(d-i)/r.multiplier):(b=l+(m-l)*(d-e)/(d-p),f=c-l*(i-p)/r.multiplier),[b,f,!1,a]}}}function $u(r,e){let t=jo(r,e,0,!1);return t[3]?t[0]:0}function Zo(r,e,t,n){let i=ni(r,e,t),o=qt(r,e,i),s=qt(r,t,i),a=qt(r,n,i),u=!0,[c,l,m,d]=jo(r,o,a,u);if(!d)return 0;if(m)return n*r.multiplier/c;{let p=s-l;return Ho(r,p,i)}}function Yo(r,e,t,n){let i=ni(r,e,t),o=qt(r,e,i),s=qt(r,t,i),a=qt(r,n,i),u=!1,[c,l,m,d]=Yu(r,s,a,u);if(!d)return 0;if(m)return n*c/r.multiplier;{let p=o-l;return Ho(r,p,i)}}function Ju(r){let e=Uu.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function $o(r,e,t,n){let i=$u(r,qt(r,e,ni(r,e,t)))/r.multiplier;return n?i:1/i}var In=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(on);e&&(this._layoutData=Ju(e==null?void 0:e.data))}}};var Jo=ae("CobaltX_liquidity_instruction");function es(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s,otherAmountMin:a}=r,u=Buffer.alloc(ei.span);ei.encode({instruction:3,baseAmountIn:ne(i),quoteAmountIn:ne(o),otherAmountMin:ne(a),fixedSide:s==="base"?At:Gi},u);let c=[S({pubkey:Kn,isWritable:!1}),S({pubkey:new ot(e.id)}),S({pubkey:new ot(t.authority),isWritable:!1}),S({pubkey:new ot(t.openOrders),isWritable:!1}),S({pubkey:new ot(t.targetOrders)}),S({pubkey:new ot(e.lpMint.address)}),S({pubkey:new ot(t.vault.A)}),S({pubkey:new ot(t.vault.B)})];return e.pooltype.includes("StablePool")&&c.push(S({pubkey:on})),c.push(S({pubkey:new ot(e.marketId),isWritable:!1}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:new ot(t.marketEventQueue),isWritable:!1})),new sn({programId:new ot(e.programId),keys:c,data:u})}function ri(r){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:i,baseAmountMin:o,quoteAmountMin:s}=r,a=Ct(t),u=4;if(e.pooltype.includes("StablePool")&&(u=5),u===4||u===5){let c=Buffer.alloc(ti.span);ti.encode({instruction:4,lpAmount:ne(i),baseAmountMin:ne(o),quoteAmountMin:ne(s)},c);let l=[S({pubkey:Kn,isWritable:!1}),S({pubkey:a.id}),S({pubkey:a.authority,isWritable:!1}),S({pubkey:a.openOrders}),S({pubkey:a.targetOrders}),S({pubkey:a.mintLp.address}),S({pubkey:a.vault.A}),S({pubkey:a.vault.B})];return u===5?l.push(S({pubkey:on})):(l.push(S({pubkey:a.id})),l.push(S({pubkey:a.id}))),l.push(S({pubkey:a.marketProgramId,isWritable:!1}),S({pubkey:a.marketId}),S({pubkey:a.marketBaseVault}),S({pubkey:a.marketQuoteVault}),S({pubkey:a.marketAuthority,isWritable:!1}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:a.marketEventQueue}),S({pubkey:a.marketBids}),S({pubkey:a.marketAsks})),new sn({programId:a.programId,keys:l,data:c})}return new sn({programId:a.programId,keys:[]})}function ii({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:b,userCoinVault:f,userPcVault:w,userLpVault:g,nonce:h,openTime:A,coinAmount:P,pcAmount:x,ammConfigId:k,feeDestinationId:B}){let T=R([O("instruction"),O("nonce"),y("openTime"),y("pcAmount"),y("coinAmount")]),C=[{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:ec,isSigner:!1,isWritable:!1},{pubkey:tc.programId,isSigner:!1,isWritable:!1},{pubkey:$e,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:B,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],_=Buffer.alloc(T.span);return T.encode({instruction:1,nonce:h,openTime:A,coinAmount:P,pcAmount:x},_),{instruction:new sn({keys:C,programId:r,data:_}),instructionType:Q.AmmV4CreatePool}}function nc({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=Ct(r),s=Buffer.alloc($r.span);$r.encode({instruction:9,amountIn:ne(t),minAmountOut:ne(n)},s);let a=[S({pubkey:Kn,isWritable:!1}),S({pubkey:o.id}),S({pubkey:o.authority,isWritable:!1}),S({pubkey:o.openOrders})];return i===4&&a.push(S({pubkey:o.targetOrders})),a.push(S({pubkey:o.vault.A}),S({pubkey:o.vault.B})),i===5&&a.push(S({pubkey:on})),a.push(S({pubkey:o.marketProgramId,isWritable:!1}),S({pubkey:o.marketId}),S({pubkey:o.marketBids}),S({pubkey:o.marketAsks}),S({pubkey:o.marketEventQueue}),S({pubkey:o.marketBaseVault}),S({pubkey:o.marketQuoteVault}),S({pubkey:o.marketAuthority,isWritable:!1}),S({pubkey:e.tokenAccountIn}),S({pubkey:e.tokenAccountOut}),S({pubkey:e.owner,isWritable:!1})),new sn({programId:o.programId,keys:a,data:s})}function rc({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=Ct(r),s=Buffer.alloc(Jr.span);Jr.encode({instruction:11,maxAmountIn:ne(t),amountOut:ne(n)},s);let a=[S({pubkey:Kn,isWritable:!1}),S({pubkey:o.id}),S({pubkey:o.authority,isWritable:!1}),S({pubkey:o.openOrders}),S({pubkey:o.targetOrders}),S({pubkey:o.vault.A}),S({pubkey:o.vault.B})];return i===5&&a.push(S({pubkey:on})),a.push(S({pubkey:o.marketProgramId,isWritable:!1}),S({pubkey:o.marketId}),S({pubkey:o.marketBids}),S({pubkey:o.marketAsks}),S({pubkey:o.marketEventQueue}),S({pubkey:o.marketBaseVault}),S({pubkey:o.marketQuoteVault}),S({pubkey:o.marketAuthority,isWritable:!1}),S({pubkey:e.tokenAccountIn}),S({pubkey:e.tokenAccountOut}),S({pubkey:e.owner,isWritable:!1,isSigner:!0})),new sn({programId:o.programId,keys:a,data:s})}function ts(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return nc(te(q({},a),{amountIn:i,minAmountOut:o}),t);if(s==="out")return rc(te(q({},a),{maxAmountIn:i,amountOut:o}),t);Jo.logWithError("invalid params","params",r)}throw Jo.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{TOKEN_PROGRAM_ID as sc}from"@solana/spl-token";import{PublicKey as ac}from"@solana/web3.js";import Gg from"bn.js";import{PublicKey as ic}from"@solana/web3.js";var oc=ae("CobaltX_liquidity_serum");function ns({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=ic.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw oc.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}function or({programId:r}){let{publicKey:e}=pe([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function Ut({name:r,programId:e,marketId:t}){let{publicKey:n}=pe([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function uc({programId:r,marketId:e}){let{publicKey:t}=pe([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function cc({programId:r}){return pe([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function si({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=Ut({name:"amm_associated_seed",programId:a,marketId:t}),l=Ut({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=cc({programId:a}),p=Ut({name:"coin_vault_associated_seed",programId:a,marketId:t}),b=Ut({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=Ut({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),w=uc({programId:a,marketId:t}),g=Ut({name:"target_associated_seed",programId:a,marketId:t}),h=Ut({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:A}=ns({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:b,lpVault:f,openOrders:w,targetOrders:g,withdrawQueue:h,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:A,lookupTableAccount:ac.default,configId:or({programId:a})}}var oi={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},rs=r=>{let e={},t=sc.toBase58();return Object.keys(r).map(n=>{let i=r[n],[o,s]=[i.baseMint.toBase58(),i.quoteMint.toBase58()];e[n]={id:n,version:4,status:i.status.toNumber(),programId:i.programId.toBase58(),mintA:rr({address:o,programId:t,decimals:i.baseDecimal.toNumber()}),mintB:rr({address:s,programId:t,decimals:i.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:i.poolPrice.toNumber(),mintAmountA:new N(i.mintAAmount.toString()).div(10**i.baseDecimal.toNumber()).toNumber(),mintAmountB:new N(i.mintBAmount.toString()).div(10**i.quoteDecimal.toNumber()).toNumber(),baseReserve:i.baseReserve,quoteReserve:i.quoteReserve,feeRate:new N(i.tradeFeeNumerator.toString()).div(i.tradeFeeDenominator.toString()).toNumber(),openTime:i.poolOpenTime.toString(),tvl:0,day:oi,week:oi,month:oi,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:i.marketId.toBase58(),configId:or({programId:i.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:rr({address:i.lpMint.toBase58(),programId:t,decimals:Math.min(i.baseDecimal.toNumber(),i.quoteDecimal.toNumber())}),burnPercent:0}}),e};import be from"bn.js";function lc(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function ai(r,...e){if(!lc(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function ui(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function is(r,e){ai(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var ar=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),et=(r,e)=>r<<32-e|r>>>e;var $g=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function mc(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ci(r){return typeof r=="string"&&(r=mc(r)),ai(r),r}var sr=class{clone(){return this._cloneInto()}},Jg={}.toString;function os(r){let e=n=>r().update(ci(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function dc(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var ss=(r,e,t)=>r&e^~r&t,as=(r,e,t)=>r&e^r&t^e&t,ur=class extends sr{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ar(this.buffer)}update(e){ui(this);let{view:t,buffer:n,blockLen:i}=this;e=ci(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=ar(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ui(this),is(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;dc(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=ar(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var pc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),St=new Uint32Array(64),li=class extends ur{constructor(){super(64,32,8,!1),this.A=xt[0]|0,this.B=xt[1]|0,this.C=xt[2]|0,this.D=xt[3]|0,this.E=xt[4]|0,this.F=xt[5]|0,this.G=xt[6]|0,this.H=xt[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)St[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=St[m-15],p=St[m-2],b=et(d,7)^et(d,18)^d>>>3,f=et(p,17)^et(p,19)^p>>>10;St[m]=f+St[m-7]+b+St[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=et(a,6)^et(a,11)^et(a,25),p=l+d+ss(a,u,c)+pc[m]+St[m]|0,f=(et(n,2)^et(n,13)^et(n,22))+as(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){St.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var us=os(()=>new li);import{TOKEN_PROGRAM_ID as fc}from"@solana/spl-token";import{Keypair as bc,PublicKey as yc}from"@solana/web3.js";import fw from"bn.js";var gw=ae("CobaltX_Util");function st({fromPublicKey:r,programId:e=fc,assignSeed:t}){let n=t?btoa(t).slice(0,32):bc.generate().publicKey.toBase58().slice(0,32);return{publicKey:gc(r,n,e),seed:n}}function gc(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=us(n);return new yc(i)}import{PublicKey as Pw,SystemProgram as xw}from"@solana/web3.js";import Iw from"bn.js";import{createCloseAccountInstruction as Cw,createInitializeAccountInstruction as Rw,createTransferInstruction as Mw,TOKEN_PROGRAM_ID as Ew}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as ok}from"@solana/spl-token";import{PublicKey as ak}from"@solana/web3.js";import ck from"bn.js";import{SystemProgram as Xt,SYSVAR_RENT_PUBKEY as kc,Transaction as cs,TransactionInstruction as hc}from"@solana/web3.js";import{createInitializeAccountInstruction as ls,TOKEN_PROGRAM_ID as ms}from"@solana/spl-token";function wc(r="accountFlags"){let e=new jn(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var mi=R([Ae(5),wc("accountFlags"),K("ownAddress"),y("vaultSignerNonce"),K("baseMint"),K("quoteMint"),K("baseVault"),y("baseDepositsTotal"),y("baseFeesAccrued"),K("quoteVault"),y("quoteDepositsTotal"),y("quoteFeesAccrued"),y("quoteDustThreshold"),K("requestQueue"),K("eventQueue"),K("bids"),K("asks"),y("baseLotSize"),y("quoteLotSize"),y("feeRateBps"),y("referrerRebatesAccrued"),Ae(7)]);function Ac({programId:r,marketInfo:e}){let t=R([O("version"),Me("instruction"),y("baseLotSize"),y("quoteLotSize"),Et("feeRateBps"),y("vaultSignerNonce"),y("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:kc,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),i=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},i),new hc({keys:n,programId:r,data:i})}async function di({connection:r,wallet:e,marketInfo:t}){var s,a,u,c,l,m,d,p;let n=new cs,i=await r.getMinimumBalanceForRentExemption(165);n.add(Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:i,space:165,programId:ms}),Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:i,space:165,programId:ms}),ls(t.baseVault.publicKey,t.baseMint,t.vaultOwner),ls(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(mi.span),space:mi.span,programId:t.programId}));let o=new cs;return o.add(Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await r.getMinimumBalanceForRentExemption((s=t.requestQueueSpace)!=null?s:5120+12),space:t.lowestFeeMarket?764:(a=t.requestQueueSpace)!=null?a:5120+12,programId:t.programId}),Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await r.getMinimumBalanceForRentExemption((u=t.eventQueueSpace)!=null?u:262144+12),space:t.lowestFeeMarket?11308:(c=t.eventQueueSpace)!=null?c:262144+12,programId:t.programId}),Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((l=t.orderbookQueueSpace)!=null?l:65536+12),space:t.lowestFeeMarket?14524:(m=t.orderbookQueueSpace)!=null?m:65536+12,programId:t.programId}),Xt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((d=t.orderbookQueueSpace)!=null?d:65536+12),space:t.lowestFeeMarket?14524:(p=t.orderbookQueueSpace)!=null?p:65536+12,programId:t.programId}),Ac({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[Q.CreateAccount,Q.CreateAccount,Q.InitAccount,Q.InitAccount]},{transaction:o,signer:[],instructionTypes:[Q.CreateAccount,Q.CreateAccount,Q.CreateAccount,Q.CreateAccount,Q.CreateAccount,Q.InitMarket]}]}var pi=class extends rn{constructor(t){super(t);this.stableLayout=new In({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:i,baseIn:o}){let s=new be(new N(n).mul(10**t[o?"mintA":"mintB"].decimals).toFixed(0)),a=Uo(t[o?"mintB":"mintA"]),[u,c]=[new be(new N(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new be(new N(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new be(new N(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,N.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",c.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${i.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",c.toString());let m=o?"base":"quote";this.logDebug("input side:",m);let d=At;s.isZero()||(d=m==="base"?qn(s.mul(c),u):qn(s.mul(u),c)),this.logDebug("amountRaw:",d.toString(),"lpAmount:",l.toString());let p=qn(s.mul(l),m==="base"?u:c);this.logDebug("liquidity:",p.toString());let b=new ze(new be(1)).add(i),f=new ze(new be(1)).sub(i),w=b.mul(d).quotient,g=f.mul(d).quotient,h=new ye(a,d),A=new ye(a,w),P=new ye(a,g);return this.logDebug("anotherAmount:",h.toFixed(),"maxAnotherAmount:",A.toFixed()),{anotherAmount:h,maxAnotherAmount:A,minAnotherAmount:P,liquidity:p}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:i,amountInA:o,amountInB:s,otherAmountMin:a,fixedSide:u,config:c,txVersion:l,computeBudgetConfig:m}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",o,"amountInB:",s),(o.isZero()||s.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:o.toFixed(),amountInB:s.toFixed()});let{account:d}=this.scope,{bypassAssociatedCheck:p,checkCreateATAOwner:b}=q({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),[f,w]=[o.token,s.token],g=await d.getCreatedTokenAccount({mint:f.mint,associatedOnly:!1}),h=await d.getCreatedTokenAccount({mint:w.mint,associatedOnly:!1});!g&&!h&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let A=await d.getCreatedTokenAccount({mint:new he(n.lpMint.address)}),P=[f,w],x=[g,h],k=[o.raw,s.raw],B=o.token.mint.toBase58()===n.mintA.address?"base":"quote",T="base";["quote","base"].includes(B)||this.logAndCreateError("invalid fixedSide","fixedSide",u),B==="quote"?(P.reverse(),x.reverse(),k.reverse(),T=u==="a"?"quote":"base"):B==="base"&&(T=u==="a"?"base":"quote");let[C,_]=P,[M,G]=x,[W,H]=k,ee=i!=null?i:await this.getAmmPoolKeys(n.id),D=this.createTxBuilder(),je=await d.handleTokenAccount({side:"in",amount:W,mint:C.mint,tokenAccount:M,bypassAssociatedCheck:p,checkCreateATAOwner:b}),{tokenAccount:Ge}=je,at=Xe(je,["tokenAccount"]);D.addInstruction(at);let Ue=await d.handleTokenAccount({side:"in",amount:H,mint:_.mint,tokenAccount:G,bypassAssociatedCheck:p,checkCreateATAOwner:b}),{tokenAccount:bt}=Ue,It=Xe(Ue,["tokenAccount"]);D.addInstruction(It);let Kt=await d.handleTokenAccount({side:"out",amount:0,mint:new he(n.lpMint.address),tokenAccount:A,bypassAssociatedCheck:p,checkCreateATAOwner:b}),{tokenAccount:zt}=Kt,yt=Xe(Kt,["tokenAccount"]);return D.addInstruction(yt),D.addInstruction({instructions:[es({poolInfo:n,poolKeys:ee,userKeys:{baseTokenAccount:Ge,quoteTokenAccount:bt,lpTokenAccount:zt,owner:this.scope.ownerPubKey},baseAmountIn:W,quoteAmountIn:H,otherAmountMin:a.raw,fixedSide:T})],instructionTypes:[n.pooltype.includes("StablePool")?Q.AmmV5AddLiquidity:Q.AmmV4AddLiquidity],lookupTableAddress:ee.lookupTableAccount?[ee.lookupTableAccount]:[]}),D.addCustomComputeBudget(m),l===0&&await D.buildV0(),D.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:i,lpAmount:o,baseAmountMin:s,quoteAmountMin:a,config:u,txVersion:c,computeBudgetConfig:l}=t,m=i!=null?i:await this.getAmmPoolKeys(n.id),[d,p,b]=[new he(n.mintA.address),new he(n.mintB.address),new he(n.lpMint.address)];this.logDebug("lpAmount:",o),this.logDebug("baseAmountMin:",s),this.logDebug("quoteAmountMin:",a),o.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",o.toString());let{account:f}=this.scope,w=await f.getCreatedTokenAccount({mint:b,associatedOnly:!1});w||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let g=await f.getCreatedTokenAccount({mint:d}),h=await f.getCreatedTokenAccount({mint:p}),A=this.createTxBuilder(),{bypassAssociatedCheck:P,checkCreateATAOwner:x}=q({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),_=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:g,bypassAssociatedCheck:P,checkCreateATAOwner:x}),{tokenAccount:k}=_,B=Xe(_,["tokenAccount"]);A.addInstruction(B);let M=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:h,bypassAssociatedCheck:P,checkCreateATAOwner:x}),{tokenAccount:T}=M,C=Xe(M,["tokenAccount"]);return A.addInstruction(C),A.addInstruction({instructions:[ri({poolInfo:n,poolKeys:m,userKeys:{lpTokenAccount:w,baseTokenAccount:k,quoteTokenAccount:T,owner:this.scope.ownerPubKey},lpAmount:o,baseAmountMin:s,quoteAmountMin:a})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?Q.AmmV5RemoveLiquidity:Q.AmmV4RemoveLiquidity]}),A.addCustomComputeBudget(l),c===0?await A.buildV0():A.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:i,createPositionInfo:o,farmInfo:s,userFarmLpAmount:a,base:u,computeBudgetConfig:c,payer:l,userAuxiliaryLedgers:m,tokenProgram:d=Bt,checkCreateATAOwner:p=!0,getEphemeralSigners:b,txVersion:f}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let w=this.createTxBuilder();w.addCustomComputeBudget(c);let g={};for(let D of this.scope.account.tokenAccountRawInfos)(g[D.accountInfo.mint.toString()]===void 0||le(this.scope.ownerPubKey,D.accountInfo.mint,Bt).publicKey.equals(D.pubkey))&&(g[D.accountInfo.mint.toString()]=D.pubkey);let h=g[t.lpMint.address];if(h===void 0)throw Error("find lp account error in trade accounts");let A=i.add(a!=null?a:new be(0)),P=t.mintA.address===Re.WSOL.mint.toString(),x=t.mintB.address===Re.WSOL.mint.toString(),{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Bt,mint:new he(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:P?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(B||{}),k===void 0)throw new Error("base token account not found");let{account:T,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Bt,mint:new he(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:x?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!x,notUseTokenAccount:x,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(C||{}),T===void 0)throw new Error("quote token account not found");if(g[t.mintA.address]=k,g[t.mintB.address]=T,s!==void 0&&!(a!=null&&a.isZero())){let D=Xr[s.programId],Ge=nn({programId:new he(s.programId),poolId:new he(s.id),owner:this.scope.ownerPubKey,version:D}),at,bt=await this.scope.connection.getAccountInfo(Ge);if(bt&&(at=Wo(D).decode(bt.data)),D!==6&&!at){let{instruction:We,instructionType:Qt}=Fo({id:new he(s.id),programId:new he(s.programId),version:D,ledger:Ge,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[We],instructionTypes:[Qt]})}let It=[];for(let We of s.rewardInfos){let Qt=We.mint.address===Re.WSOL.mint.toString();if(g[We.mint.address])It.push(g[We.mint.address]);else{let{account:Lt,instructionParams:Pe}=await this.scope.account.getOrCreateTokenAccount({mint:new he(We.mint.address),tokenProgram:d,owner:this.scope.ownerPubKey,skipCloseAccount:!Qt,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:p});Lt||this.logAndCreateError("farm reward account not found:",We.mint.address),Pe&&w.addInstruction(Pe),It.push(Lt)}}let zt=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],yt={userAuxiliaryLedgers:m,amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:zt,lpAccount:h,rewardAccounts:It},je=Xr[s.programId],Ue=je===6?Do(yt):je===5?qo(yt):Go(yt),Kt={3:Q.FarmV3Withdraw,5:Q.FarmV5Withdraw,6:Q.FarmV6Withdraw};w.addInstruction({instructions:[Ue],instructionTypes:[Kt[je]]})}let _=await this.getAmmPoolKeys(t.id),M=ri({poolInfo:t,poolKeys:_,userKeys:{lpTokenAccount:h,baseTokenAccount:k,quoteTokenAccount:T,owner:this.scope.ownerPubKey},lpAmount:A,baseAmountMin:0,quoteAmountMin:0});w.addInstruction({instructions:[M],instructionTypes:[t.pooltype.includes("StablePool")?Q.AmmV5RemoveLiquidity:Q.AmmV4RemoveLiquidity],lookupTableAddress:_.lookupTableAccount?[_.lookupTableAccount]:[]});let[G,W]=t.mintA.address===n.mintA.address?[k,T]:[T,k],H=await this.scope.clmm.getClmmPoolKeys(n.id),ee=await tn.openPositionFromBaseInstructions(te(q({poolInfo:n,poolKeys:H,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:G,tokenAccountB:W},withMetadata:"create"},o),{base:u,getEphemeralSigners:b}));return w.addInstruction({instructions:[...ee.instructions],signers:ee.signers,instructionTypes:[...ee.instructionTypes],lookupTableAddress:H.lookupTableAccount?[H.lookupTableAccount]:[]}),f===0?w.sizeCheckBuildV0():w.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:o,baseAmount:s,quoteAmount:a,startTime:u,ownerInfo:c,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:d,txVersion:p,feeDestinationId:b,computeBudgetConfig:f}){var G;let w=c.feePayer||((G=this.scope.owner)==null?void 0:G.publicKey),g=c.useSOLBalance&&i.mint.equals(cr),h=c.useSOLBalance&&o.mint.equals(cr),A=this.createTxBuilder(),{account:P,instructionParams:x}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:w,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:l,checkCreateATAOwner:m});A.addInstruction(x||{});let{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:h?{payer:w,amount:a}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:h?!1:l,checkCreateATAOwner:m});if(A.addInstruction(B||{}),P===void 0||k===void 0)throw Error("you don't has some token account");let T=si({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),C={programId:t,ammId:T.id,ammAuthority:T.authority,ammOpenOrders:T.openOrders,lpMint:T.lpMint,coinMint:T.baseMint,pcMint:T.quoteMint,coinVault:T.baseVault,pcVault:T.quoteVault,withdrawQueue:T.withdrawQueue,ammTargetOrders:T.targetOrders,poolTempLp:T.lpVault,marketProgramId:T.marketProgramId,marketId:T.marketId,ammConfigId:T.configId,feeDestinationId:b},{instruction:_,instructionType:M}=ii(te(q({},C),{userWallet:this.scope.ownerPubKey,userCoinVault:P,userPcVault:k,userLpVault:le(this.scope.ownerPubKey,T.lpMint,d).publicKey,nonce:T.nonce,openTime:u,coinAmount:s,pcAmount:a}));return A.addInstruction({instructions:[_],instructionTypes:[M]}),A.addCustomComputeBudget(f),A.versionBuild({txVersion:p,extInfo:{address:C}})}async createMarketAndPoolV4({programId:t=to,marketProgram:n=eo,feeDestinationId:i=no,tokenProgram:o,baseMintInfo:s,quoteMintInfo:a,baseAmount:u,quoteAmount:c,startTime:l,ownerInfo:m,lowestFeeMarket:d,assignSeed:p,associatedOnly:b=!1,checkCreateATAOwner:f=!1,lotSize:w=1,tickSize:g=.01,txVersion:h,computeBudgetConfig:A}){var bi,yi,gi;let P=this.scope.ownerPubKey,x=m.feePayer||((bi=this.scope.owner)==null?void 0:bi.publicKey),k=m.useSOLBalance&&s.mint.equals(cr),B=m.useSOLBalance&&a.mint.equals(cr),T=p?`${s.mint.toBase58().slice(0,7)}-${a.mint.toBase58().slice(0,7)}-${p}`:void 0,C=st({fromPublicKey:P,programId:n,assignSeed:T&&`${T}-market`}),_=st({fromPublicKey:P,programId:n,assignSeed:T&&`${T}-request`}),M=st({fromPublicKey:P,programId:n,assignSeed:T&&`${T}-event`}),G=st({fromPublicKey:P,programId:n,assignSeed:T&&`${T}-bids`}),W=st({fromPublicKey:P,programId:n,assignSeed:T&&`${T}-asks`}),H=st({fromPublicKey:P,programId:Bt,assignSeed:T&&`${T}-baseVault`}),ee=st({fromPublicKey:P,programId:Bt,assignSeed:T&&`${T}-quoteVault`}),D=0,Ge=new be(100);function at(){let tt=new be(0);for(;;)try{return{vaultOwner:he.createProgramAddressSync([C.publicKey.toBuffer(),tt.toArrayLike(Buffer,"le",8)],n),vaultSignerNonce:tt}}catch{if(tt.iaddn(1),tt.gt(new be(25555)))throw Error("find vault owner error")}}let{vaultOwner:bt,vaultSignerNonce:It}=at(),zt=new be(Math.round(10**s.decimals*w)),yt=new be(Math.round(w*10**a.decimals*g));if(zt.eq(At))throw Error("lot size is too small");if(yt.eq(At))throw Error("tick size or lot size is too small");let je=await di({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:n,vaultOwner:bt,baseMint:s.mint,quoteMint:a.mint,id:C,baseVault:H,quoteVault:ee,requestQueue:_,eventQueue:M,bids:G,asks:W,feeRateBps:D,quoteDustThreshold:Ge,vaultSignerNonce:It,baseLotSize:zt,quoteLotSize:yt,lowestFeeMarket:d}}),Ue=this.createTxBuilder();Ue.addInstruction({instructions:je[0].transaction.instructions,signers:je[0].signer});for await(let tt of je.slice(1,je.length))Ue.addInstruction({instructions:tt.transaction.instructions,signers:tt.signer,instructionTypes:tt.instructionTypes});let{account:Kt,instructionParams:We}=await this.scope.account.getOrCreateTokenAccount({mint:s.mint,owner:this.scope.ownerPubKey,createInfo:k?{payer:x,amount:u}:void 0,notUseTokenAccount:k,skipCloseAccount:!k,associatedOnly:k?!1:b,checkCreateATAOwner:f,assignSeed:k&&T?`${T}-wsol`:void 0});Ue.addInstruction(We||{});let{account:Qt,instructionParams:Lt}=await this.scope.account.getOrCreateTokenAccount({mint:a.mint,owner:this.scope.ownerPubKey,createInfo:B?{payer:x,amount:c}:void 0,notUseTokenAccount:B,skipCloseAccount:!B,associatedOnly:B?!1:b,checkCreateATAOwner:f,assignSeed:B&&T?`${T}-wsol`:void 0});if(Ue.addInstruction(Lt||{}),Kt===void 0)throw Error("you don't has base token account");if(Qt===void 0)throw Error("you don't has quote token account");let Pe=si({version:4,marketVersion:3,marketId:C.publicKey,baseMint:s.mint,quoteMint:a.mint,baseDecimals:s.decimals,quoteDecimals:a.decimals,programId:t,marketProgramId:n}),lr={programId:t,ammId:Pe.id,ammAuthority:Pe.authority,ammOpenOrders:Pe.openOrders,lpMint:Pe.lpMint,coinMint:Pe.baseMint,pcMint:Pe.quoteMint,coinVault:Pe.baseVault,pcVault:Pe.quoteVault,withdrawQueue:Pe.withdrawQueue,ammTargetOrders:Pe.targetOrders,poolTempLp:Pe.lpVault,marketProgramId:Pe.marketProgramId,marketId:Pe.marketId,ammConfigId:Pe.configId,feeDestinationId:i},{instruction:ds,instructionType:ps}=ii(te(q({},lr),{userWallet:this.scope.ownerPubKey,userCoinVault:Kt,userPcVault:Qt,userLpVault:le(this.scope.ownerPubKey,Pe.lpMint,o).publicKey,nonce:Pe.nonce,openTime:l,coinAmount:u,pcAmount:c}));Ue.addInstruction({instructions:[ds],instructionTypes:[ps]});let fi=k||B?[((yi=We==null?void 0:We.instructions)==null?void 0:yi[0])||((gi=Lt==null?void 0:Lt.instructions)==null?void 0:gi[0])].filter(tt=>!!tt):void 0;return h===0?Ue.sizeCheckBuildV0({computeBudgetConfig:A,splitIns:fi,address:q({requestQueue:_.publicKey,eventQueue:M.publicKey,bids:G.publicKey,asks:W.publicKey,baseVault:H.publicKey,quoteVault:ee.publicKey,baseMint:new he(s.mint),quoteMin:new he(a.mint)},lr)}):Ue.sizeCheckBuild({computeBudgetConfig:A,splitIns:fi,address:q({requestQueue:_.publicKey,eventQueue:M.publicKey,bids:G.publicKey,asks:W.publicKey,baseVault:H.publicKey,quoteVault:ee.publicKey,baseMint:new he(s.mint),quoteMin:new he(a.mint)},lr)})}async getCreatePoolFee({programId:t}){let n=or({programId:t}),i=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(i===null)throw Error("get config account error");return Qo.decode(i.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:i,mintOut:o,slippage:s}){let[a,u]=[i.toString(),o.toString()];if(a!==t.mintA.address&&a!==t.mintB.address)throw new Error("toke not match");if(u!==t.mintA.address&&u!==t.mintB.address)throw new Error("toke not match");let{baseReserve:c,quoteReserve:l}=t,m=[c,l],d=[t.mintA.decimals,t.mintB.decimals],p=a==t.mintA.address?"base":"quote";p==="quote"&&(m.reverse(),d.reverse());let[b,f]=m,[w,g]=d,h=t.version===4,A;if(h)A=new N(f.toString()).div(10**g).div(new N(b.toString()).div(10**w));else{let W=$o(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),!1);p==="quote"?A=new N(1e6).div(W*1e6):A=new N(W*1e6).div(1e6)}let P=n,x=new be(0),k=new be(0);if(!P.isZero())if(h){k=bn(P.mul(Yr),ir);let W=P.sub(k),H=b.add(W);x=f.mul(W).div(H)}else{k=P.mul(new be(2)).div(new be(1e4));let W=P.sub(k);p==="quote"?x=new be(Zo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),W.toNumber())):x=new be(Yo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),W.toNumber()))}let B=new be(new N(x.toString()).mul(1-s).toFixed(0)),T=x,C=B,_=new N(x.toString()).div(new N(P.sub(k).toString()).toFixed(0));!P.isZero()&&!x.isZero()&&(_=new N(x.toString()).div(10**g).div(new N(P.sub(k).toString()).div(10**w)));let M=A.sub(_).div(A).mul(100);return{amountOut:T,minAmountOut:C,currentPrice:A,executionPrice:_,priceImpact:M,fee:k}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:i,mintOut:o,slippage:s}){let{baseReserve:a,quoteReserve:u}=t;i.toString()!==t.mintA.address&&i.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),o.toString()!==t.mintA.address&&o.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",a.toString()),this.logDebug("quoteReserve:",u.toString());let c=i.toString()===t.mintA.address,[l,m]=c?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new N(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),l.symbol||l.address),this.logDebug("slippage:",`${s*100}%`);let d=[a,u],p=c?"quote":"base";p==="base"&&d.reverse(),this.logDebug("output side:",p);let[b,f]=d,w=new N(f.toString()).div(10**t[c?"mintB":"mintA"].decimals).div(new N(b.toString()).div(10**t[c?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${l.symbol||l.address} \u2248 ${w.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new N(1).div(w).toString()} ${l.symbol||l.address}`);let g=new be(0),h=n;if(!h.isZero()){h.gt(f)&&(h=f.sub(new be(1)));let C=f.sub(h);g=b.mul(h).div(C).mul(ir).div(ir.sub(Yr))}let A=new be(new N(g.toString()).mul(1+s).toFixed(0)),P=g,x=A;this.logDebug("amountIn:",new N(P.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString()),this.logDebug("maxAmountIn:",new N(x.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString());let k=null;!g.isZero()&&!h.isZero()&&(k=new N(h.toString()).div(10**m.decimals).div(new N(g.toString()).div(10**l.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${k.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new N(1).div(k).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`));let B=w.mul(P.toString()),T=B.sub(n.toString()).abs().div(B);return this.logDebug("priceImpact:",`${T.toString()}%`),{amountIn:P,maxAmountIn:x,currentPrice:w,executionPrice:k,priceImpact:T}}async swap({poolInfo:t,poolKeys:n,amountIn:i,amountOut:o,inputMint:s,fixedSide:a,txVersion:u,config:c,computeBudgetConfig:l}){let m=this.createTxBuilder(),{associatedOnly:d=!0,inputUseSolBalance:p=!0,outputUseSolBalance:b=!0}=c||{},[f,w]=s===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],g=p&&f.address===Zt.toBase58(),h=b&&w.address===Zt.toBase58(),{account:A,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Bt,mint:new he(f.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:d});m.addInstruction(P||{}),A||this.logAndCreateError("input token account not found",{token:f.symbol||f.address,tokenAccountIn:A,inputTokenUseSolBalance:g,associatedOnly:d});let{account:x,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Bt,mint:new he(w.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:h?!1:d});m.addInstruction(k||{}),x===void 0&&this.logAndCreateError("output token account not found",{token:w.symbol||w.address,tokenAccountOut:x,outputTokenUseSolBalance:h,associatedOnly:d});let B=n||await this.getAmmPoolKeys(t.id),T=4;return t.pooltype.includes("StablePool")&&(T=5),m.addInstruction({instructions:[ts({version:T,poolKeys:B,userKeys:{tokenAccountIn:A,tokenAccountOut:x,owner:this.scope.ownerPubKey},amountIn:i,amountOut:o,fixedSide:a})],instructionTypes:[T===4?Q.AmmV4SwapBaseIn:Q.AmmV5SwapBaseIn]}),m.addCustomComputeBudget(l),m.versionBuild({txVersion:u})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let i=await Mt(this.scope.connection,t.map(l=>({pubkey:new he(l)})),n),o={},s=[];for(let l=0;l<t.length;l++){let m=i[l];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[l]));let d=zo.decode(m.accountInfo.data);o[String(t[l])]=te(q({},d),{programId:m.accountInfo.owner}),s.push(d.baseVault,d.quoteVault)}let a={},u=await Mt(this.scope.connection,s.map(l=>({pubkey:new he(l)})),n);for(let l=0;l<s.length;l++){let m=u[l].accountInfo;if(m===null)throw Error("fetch vault info error: "+s[l]);a[String(s[l])]=new be(Pc.decode(m.data).amount.toString())}let c={};for(let[l,m]of Object.entries(o)){let d=a[m.baseVault.toString()].sub(m.baseNeedTakePnl),p=a[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);c[l]=te(q({},m),{baseReserve:d,mintAAmount:a[m.baseVault.toString()],mintBAmount:a[m.quoteVault.toString()],quoteReserve:p,poolPrice:new N(p.toString()).div(new N(10).pow(m.quoteDecimal.toString())).div(new N(d.toString()).div(new N(10).pow(m.baseDecimal.toString())))})}return c}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),i=rs({[t]:n}),o=i[t],s=await this.scope.tradeV2.computePoolToPoolKeys({pools:[i[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:o,poolKeys:s[0]}}};export{pi as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.mjs.map
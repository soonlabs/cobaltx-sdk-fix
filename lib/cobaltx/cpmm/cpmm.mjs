var Zi=Object.defineProperty,ji=Object.defineProperties;var Yi=Object.getOwnPropertyDescriptors;var yt=Object.getOwnPropertySymbols;var Mn=Object.prototype.hasOwnProperty,On=Object.prototype.propertyIsEnumerable;var Rn=(n,e,t)=>e in n?Zi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,W=(n,e)=>{for(var t in e||(e={}))Mn.call(e,t)&&Rn(n,t,e[t]);if(yt)for(var t of yt(e))On.call(e,t)&&Rn(n,t,e[t]);return n},Z=(n,e)=>ji(n,Yi(e));var Ae=(n,e)=>{var t={};for(var i in n)Mn.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&yt)for(var i of yt(n))e.indexOf(i)<0&&On.call(n,i)&&(t[i]=n[i]);return t};import ke from"bn.js";var De=9e15,Se=1e9,Zt="0123456789abcdef",wt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",At="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",jt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-De,maxE:De,crypto:!1},Dn,Pe,R=!0,kt="[DecimalError] ",Ie=kt+"Invalid argument: ",_n=kt+"Precision limit exceeded",Wn=kt+"crypto unavailable",Vn="[object Decimal]",ie=Math.floor,J=Math.pow,Qi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ji=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,$i=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,qn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,me=1e7,L=7,er=9007199254740991,tr=wt.length-1,Yt=At.length-1,g={toStringTag:Vn};g.absoluteValue=g.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),S(n)};g.ceil=function(){return S(new this.constructor(this),this.e+1,2)};g.clampedTo=g.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ie+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};g.comparedTo=g.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};g.cosine=g.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+L,i.rounding=1,t=nr(i,Hn(i,t)),i.precision=n,i.rounding=e,S(Pe==2||Pe==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};g.cubeRoot=g.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(R=!1,o=m.s*J(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=te(m.d),n=m.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=J(t,1/3),n=ie((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new l(t),i.s=m.s):i=new l(o.toString()),s=(n=l.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(m),i=X(u.plus(m).times(a),u.plus(c),s+2,1),te(a.d).slice(0,s)===(t=te(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(S(a,n+1,0),a.times(a).times(a).eq(m))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(S(i,n+1,1),e=!i.times(i).times(i).eq(m));break}return R=!0,S(i,n,l.rounding,e)};g.decimalPlaces=g.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-ie(this.e/L))*L,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};g.dividedBy=g.div=function(n){return X(this,new this.constructor(n))};g.dividedToIntegerBy=g.divToInt=function(n){var e=this,t=e.constructor;return S(X(e,new t(n),0,1,1),t.precision,t.rounding)};g.equals=g.eq=function(n){return this.cmp(n)===0};g.floor=function(){return S(new this.constructor(this),this.e+1,3)};g.greaterThan=g.gt=function(n){return this.cmp(n)>0};g.greaterThanOrEqualTo=g.gte=function(n){var e=this.cmp(n);return e==1||e===0};g.hyperbolicCosine=g.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/Tt(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=_e(s,1,o.times(e),new s(1),!0);for(var c,u=n,m=new s(8);u--;)c=o.times(o),o=a.minus(c.times(m.minus(c.times(m))));return S(o,s.precision=t,s.rounding=i,!0)};g.hyperbolicSine=g.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=_e(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/Tt(5,n)),r=_e(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,S(r,e,t,!0)};g.hyperbolicTangent=g.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,X(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};g.inverseCosine=g.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?le(t,r,o):new t(0):new t(NaN):e.isZero()?le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};g.inverseHyperbolicCosine=g.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,R=!1,t=t.times(t).minus(1).sqrt().plus(t),R=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};g.inverseHyperbolicSine=g.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,R=!1,t=t.times(t).plus(1).sqrt().plus(t),R=!0,i.precision=n,i.rounding=e,t.ln())};g.inverseHyperbolicTangent=g.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?S(new o(r),n,e,!0):(o.precision=t=i-r.e,r=X(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};g.inverseSine=g.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=le(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};g.inverseTangent=g.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding;if(u.isFinite()){if(u.isZero())return new m(u);if(u.abs().eq(1)&&l+4<=Yt)return s=le(m,l+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new m(NaN);if(l+4<=Yt)return s=le(m,l+4,d).times(.5),s.s=u.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/L+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(R=!1,e=Math.ceil(a/L),i=1,c=u.times(u),s=new m(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),R=!0,S(s,m.precision=l,m.rounding=d,!0)};g.isFinite=function(){return!!this.d};g.isInteger=g.isInt=function(){return!!this.d&&ie(this.e/L)>this.d.length-2};g.isNaN=function(){return!this.s};g.isNegative=g.isNeg=function(){return this.s<0};g.isPositive=g.isPos=function(){return this.s>0};g.isZero=function(){return!!this.d&&this.d[0]===0};g.lessThan=g.lt=function(n){return this.cmp(n)<0};g.lessThanOrEqualTo=g.lte=function(n){return this.cmp(n)<1};g.logarithm=g.log=function(n){var e,t,i,r,o,s,a,c,u=this,m=u.constructor,l=m.precision,d=m.rounding,p=5;if(n==null)n=new m(10),e=!0;else{if(n=new m(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new m(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new m(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(R=!1,a=l+p,s=xe(u,a),i=e?Pt(m,a+10):xe(n,a),c=X(s,i,a,1),je(c.d,r=l,d))do if(a+=10,s=xe(u,a),i=e?Pt(m,a+10):xe(n,a),c=X(s,i,a,1),!o){+te(c.d).slice(r+1,r+15)+1==1e14&&(c=S(c,l+1,0));break}while(je(c.d,r+=10,d));return R=!0,S(c,l,d)};g.minus=g.sub=function(n){var e,t,i,r,o,s,a,c,u,m,l,d,p=this,b=p.constructor;if(n=new b(n),!p.d||!n.d)return!p.s||!n.s?n=new b(NaN):p.d?n.s=-n.s:n=new b(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=b.precision,c=b.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new b(p);else return new b(c===3?-0:0);return R?S(n,a,c):n}if(t=ie(n.e/L),m=ie(p.e/L),u=u.slice(),o=m-t,o){for(l=o<0,l?(e=u,o=-o,s=d.length):(e=d,t=m,s=u.length),i=Math.max(Math.ceil(a/L),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,l=i<s,l&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){l=u[i]<d[i];break}o=0}for(l&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=me-1;--u[r],u[i]+=me}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=ht(u,t),R?S(n,a,c):n):new b(c===3?-0:0)};g.modulo=g.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?S(new i(t),i.precision,i.rounding):(R=!1,i.modulo==9?(e=X(t,n.abs(),0,3,1),e.s*=n.s):e=X(t,n,0,i.modulo,1),e=e.times(n),R=!0,t.minus(e))};g.naturalExponential=g.exp=function(){return Qt(this)};g.naturalLogarithm=g.ln=function(){return xe(this)};g.negated=g.neg=function(){var n=new this.constructor(this);return n.s=-n.s,S(n)};g.plus=g.add=function(n){var e,t,i,r,o,s,a,c,u,m,l=this,d=l.constructor;if(n=new d(n),!l.d||!n.d)return!l.s||!n.s?n=new d(NaN):l.d||(n=new d(n.d||l.s===n.s?l:NaN)),n;if(l.s!=n.s)return n.s=-n.s,l.minus(n);if(u=l.d,m=n.d,a=d.precision,c=d.rounding,!u[0]||!m[0])return m[0]||(n=new d(l)),R?S(n,a,c):n;if(o=ie(l.e/L),i=ie(n.e/L),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=m.length):(t=m,i=o,s=u.length),o=Math.ceil(a/L),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=m.length,s-r<0&&(r=s,t=m,m=u,u=t),e=0;r;)e=(u[--r]=u[r]+m[r]+e)/me|0,u[r]%=me;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=ht(u,i),R?S(n,a,c):n};g.precision=g.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ie+n);return t.d?(e=Gn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};g.round=function(){var n=this,e=n.constructor;return S(new e(n),n.e+1,e.rounding)};g.sine=g.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+L,i.rounding=1,t=rr(i,Hn(i,t)),i.precision=n,i.rounding=e,S(Pe>2?t.neg():t,n,e,!0)):new i(NaN)};g.squareRoot=g.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,m=s.constructor;if(u!==1||!a||!a[0])return new m(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(R=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=te(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=ie((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new m(e)):i=new m(u.toString()),t=(c=m.precision)+3;;)if(o=i,i=o.plus(X(s,o,t+2,1)).times(.5),te(o.d).slice(0,t)===(e=te(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(S(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(S(i,c+1,1),n=!i.times(i).eq(s));break}return R=!0,S(i,c,m.rounding,n)};g.tangent=g.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=X(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,S(Pe==2||Pe==4?t.neg():t,n,e,!0)):new i(NaN)};g.times=g.mul=function(n){var e,t,i,r,o,s,a,c,u,m=this,l=m.constructor,d=m.d,p=(n=new l(n)).d;if(n.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=ie(m.e/L)+ie(n.e/L),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%me|0,e=a/me|0;o[r]=(o[r]+e)%me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=ht(o,t),R?S(n,l.precision,l.rounding):n};g.toBinary=function(n,e){return $t(this,2,n,e)};g.toDecimalPlaces=g.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(oe(n,0,Se),e===void 0?e=i.rounding:oe(e,0,8),S(t,n+t.e+1,e))};g.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=be(i,!0):(oe(n,0,Se),e===void 0?e=r.rounding:oe(e,0,8),i=S(new r(i),n+1,e),t=be(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};g.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=be(r):(oe(n,0,Se),e===void 0?e=o.rounding:oe(e,0,8),i=S(new o(r),n+r.e+1,e),t=be(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};g.toFraction=function(n){var e,t,i,r,o,s,a,c,u,m,l,d,p=this,b=p.d,f=p.constructor;if(!b)return new f(p);if(u=t=new f(1),i=c=new f(0),e=new f(i),o=e.e=Gn(b)-p.e-1,s=o%L,e.d[0]=J(10,s<0?L+s:s),n==null)n=o>0?e:u;else{if(a=new f(n),!a.isInt()||a.lt(u))throw Error(Ie+a);n=a.gt(e)?o>0?e:u:a}for(R=!1,a=new f(te(b)),m=f.precision,f.precision=o=b.length*L*2;l=X(a,e,0,1,1),r=t.plus(l.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(l.times(r)),c=r,r=e,e=a.minus(l.times(r)),a=r;return r=X(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=X(u,i,o,1).minus(p).abs().cmp(X(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],f.precision=m,R=!0,d};g.toHexadecimal=g.toHex=function(n,e){return $t(this,16,n,e)};g.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:oe(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(R=!1,t=X(t,n,0,e,1).times(n),R=!0,S(t)):(n.s=t.s,t=n),t};g.toNumber=function(){return+this};g.toOctal=function(n,e){return $t(this,8,n,e)};g.toPower=g.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(J(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return S(a,i,o);if(e=ie(n.e/L),e>=n.d.length-1&&(t=u<0?-u:u)<=er)return r=Un(c,a,t,i),n.s<0?new c(1).div(r):S(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=J(+a,u),e=t==0||!isFinite(t)?ie(u*(Math.log("0."+te(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(R=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Qt(n.times(xe(a,i+t)),i),r.d&&(r=S(r,i+5,1),je(r.d,i,o)&&(e=i+10,r=S(Qt(n.times(xe(a,e+t)),e),e+5,1),+te(r.d).slice(i+1,i+15)+1==1e14&&(r=S(r,i+1,0)))),r.s=s,R=!0,c.rounding=o,S(r,i,o))};g.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=be(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(oe(n,1,Se),e===void 0?e=r.rounding:oe(e,0,8),i=S(new r(i),n,e),t=be(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};g.toSignificantDigits=g.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(oe(n,1,Se),e===void 0?e=i.rounding:oe(e,0,8)),S(new i(t),n,e)};g.toString=function(){var n=this,e=n.constructor,t=be(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};g.truncated=g.trunc=function(){return S(new this.constructor(this),this.e+1,1)};g.valueOf=g.toJSON=function(){var n=this,e=n.constructor,t=be(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function te(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=L-i.length,t&&(o+=Be(t)),o+=i;s=n[e],i=s+"",t=L-i.length,t&&(o+=Be(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function oe(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ie+n)}function je(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=L,r=0):(r=Math.ceil((e+1)/L),e%=L),o=J(10,L-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==J(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==J(10,e-3)-1,s}function gt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Zt.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function nr(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/Tt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=_e(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var X=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,m,l,d,p,b,f,y,w,P,k,A,T,h,N,I,F,V,v,D,E=i.constructor,G=i.s==r.s?1:-1,q=i.d,_=r.d;if(!q||!q[0]||!_||!_[0])return new E(!i.s||!r.s||(q?_&&q[0]==_[0]:!_)?NaN:q&&q[0]==0||!_?G*0:G/0);for(c?(p=1,m=i.e-r.e):(c=me,p=L,m=ie(i.e/p)-ie(r.e/p)),v=_.length,F=q.length,w=new E(G),P=w.d=[],l=0;_[l]==(q[l]||0);l++);if(_[l]>(q[l]||0)&&m--,o==null?(h=o=E.precision,s=E.rounding):a?h=o+(i.e-r.e)+1:h=o,h<0)P.push(1),b=!0;else{if(h=h/p+2|0,l=0,v==1){for(d=0,_=_[0],h++;(l<F||d)&&h--;l++)N=d*c+(q[l]||0),P[l]=N/_|0,d=N%_|0;b=d||l<F}else{for(d=c/(_[0]+1)|0,d>1&&(_=n(_,d,c),q=n(q,d,c),v=_.length,F=q.length),I=v,k=q.slice(0,v),A=k.length;A<v;)k[A++]=0;D=_.slice(),D.unshift(0),V=_[0],_[1]>=c/2&&++V;do d=0,u=e(_,k,v,A),u<0?(T=k[0],v!=A&&(T=T*c+(k[1]||0)),d=T/V|0,d>1?(d>=c&&(d=c-1),f=n(_,d,c),y=f.length,A=k.length,u=e(f,k,y,A),u==1&&(d--,t(f,v<y?D:_,y,c))):(d==0&&(u=d=1),f=_.slice()),y=f.length,y<A&&f.unshift(0),t(k,f,A,c),u==-1&&(A=k.length,u=e(_,k,v,A),u<1&&(d++,t(k,v<A?D:_,A,c))),A=k.length):u===0&&(d++,k=[0]),P[l++]=d,u&&k[0]?k[A++]=q[I]||0:(k=[q[I]],A=1);while((I++<F||k[0]!==void 0)&&h--);b=k[0]!==void 0}P[0]||P.shift()}if(p==1)w.e=m,Dn=b;else{for(l=1,d=P[0];d>=10;d/=10)l++;w.e=l+m*p-1,S(w,a?o+w.e+1:o,s,b)}return w}}();function S(n,e,t,i){var r,o,s,a,c,u,m,l,d,p=n.constructor;e:if(e!=null){if(l=n.d,!l)return n;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=L,s=e,m=l[d=0],c=m/J(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/L),a=l.length,d>=a)if(i){for(;a++<=d;)l.push(0);m=c=0,r=1,o%=L,s=o-L+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=L,s=o-L+r,c=s<0?0:m/J(10,r-s-1)%10|0}if(i=i||e<0||l[d+1]!==void 0||(s<0?m:m%J(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?m/J(10,r-s):0:l[d-1])%10&1||t==(n.s<0?8:7)),e<1||!l[0])return l.length=0,u?(e-=n.e+1,l[0]=J(10,(L-e%L)%L),n.e=-e||0):l[0]=n.e=0,n;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=J(10,L-o),l[d]=s>0?(m/J(10,r-s)%J(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,l[0]==me&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=me)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return R&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function be(n,e,t){if(!n.isFinite())return zn(n);var i,r=n.e,o=te(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Be(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Be(-r-1)+o,t&&(i=t-s)>0&&(o+=Be(i))):r>=s?(o+=Be(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Be(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Be(i))),o}function ht(n,e){var t=n[0];for(e*=L;t>=10;t/=10)e++;return e}function Pt(n,e,t){if(e>tr)throw R=!0,t&&(n.precision=t),Error(_n);return S(new n(wt),e,1,!0)}function le(n,e,t){if(e>Yt)throw Error(_n);return S(new n(At),e,t,!0)}function Gn(n){var e=n.length-1,t=e*L+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Be(n){for(var e="";n--;)e+="0";return e}function Un(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/L+4);for(R=!1;;){if(t%2&&(o=o.times(e),En(o.d,s)&&(r=!0)),t=ie(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),En(e.d,s)}return R=!0,o}function Fn(n){return n.d[n.d.length-1]&1}function Xn(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function Qt(n,e){var t,i,r,o,s,a,c,u=0,m=0,l=0,d=n.constructor,p=d.rounding,b=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(R=!1,c=b):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),l+=5;for(i=Math.log(J(2,l))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=S(o.times(n),c,1),t=t.times(++m),a=s.plus(X(o,t,c,1)),te(a.d).slice(0,c)===te(s.d).slice(0,c)){for(r=l;r--;)s=S(s.times(s),c,1);if(e==null)if(u<3&&je(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),m=0,u++;else return S(s,d.precision=b,p,R=!0);else return d.precision=b,s}s=a}}function xe(n,e){var t,i,r,o,s,a,c,u,m,l,d,p=1,b=10,f=n,y=f.d,w=f.constructor,P=w.rounding,k=w.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new w(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(R=!1,m=k):m=e,w.precision=m+=b,t=te(y),i=t.charAt(0),Math.abs(o=f.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(n),t=te(f.d),i=t.charAt(0),p++;o=f.e,i>1?(f=new w("0."+t),o++):f=new w(i+"."+t.slice(1))}else return u=Pt(w,m+2,k).times(o+""),f=xe(new w(i+"."+t.slice(1)),m-b).plus(u),w.precision=k,e==null?S(f,k,P,R=!0):f;for(l=f,c=s=f=X(f.minus(1),f.plus(1),m,1),d=S(f.times(f),m,1),r=3;;){if(s=S(s.times(d),m,1),u=c.plus(X(s,new w(r),m,1)),te(u.d).slice(0,m)===te(c.d).slice(0,m))if(c=c.times(2),o!==0&&(c=c.plus(Pt(w,m+2,k).times(o+""))),c=X(c,new w(p),m,1),e==null)if(je(c.d,m-b,P,a))w.precision=m+=b,u=s=f=X(l.minus(1),l.plus(1),m,1),d=S(f.times(f),m,1),r=a=1;else return S(c,w.precision=k,P,R=!0);else return w.precision=k,c;c=u,r+=2}}function zn(n){return String(n.s*n.s/0)}function Jt(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%L,t<0&&(i+=L),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=L;i<r;)n.d.push(+e.slice(i,i+=L));e=e.slice(i),i=L-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),R&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function ir(n,e){var t,i,r,o,s,a,c,u,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),qn.test(e))return Jt(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(Ji.test(e))t=16,e=e.toLowerCase();else if(Qi.test(e))t=2;else if($i.test(e))t=8;else throw Error(Ie+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Un(i,new i(t),o,o*2)),u=gt(e,t,me),m=u.length-1,o=m;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=ht(u,m),n.d=u,R=!1,s&&(n=X(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?J(2,c):Ye.pow(2,c))),R=!0,n)}function rr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:_e(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/Tt(5,t)),e=_e(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function _e(n,e,t,i,r){var o,s,a,c,u=1,m=n.precision,l=Math.ceil(m/L);for(R=!1,c=t.times(t),a=new n(i);;){if(s=X(a.times(c),new n(e++*e++),m,1),a=r?i.plus(s):i.minus(s),i=X(s.times(c),new n(e++*e++),m,1),s=a.plus(i),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return R=!0,s.d.length=l+1,s}function Tt(n,e){for(var t=n;--e;)t*=n;return t}function Hn(n,e){var t,i=e.s<0,r=le(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Pe=i?4:1,e;if(t=e.divToInt(r),t.isZero())Pe=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Pe=Fn(t)?i?2:3:i?4:1,e;Pe=Fn(t)?i?1:4:i?3:2}return e.minus(r).abs()}function $t(n,e,t,i){var r,o,s,a,c,u,m,l,d,p=n.constructor,b=t!==void 0;if(b?(oe(t,1,Se),i===void 0?i=p.rounding:oe(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())m=zn(n);else{for(m=be(n),s=m.indexOf("."),b?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=gt(be(d),10,r),d.e=d.d.length),l=gt(m,10,r),o=c=l.length;l[--c]==0;)l.pop();if(!l[0])m=b?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=l,n.e=o,n=X(n,d,t,i,0,r),l=n.d,o=n.e,u=Dn),s=l[t],a=r/2,u=u||l[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&l[t-1]&1||i===(n.s<0?8:7)),l.length=t,u)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(c=l.length;!l[c-1];--c);for(s=0,m="";s<c;s++)m+=Zt.charAt(l[s]);if(b){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)m+="0";for(l=gt(m,r,e),c=l.length;!l[c-1];--c);for(s=1,m="1.";s<c;s++)m+=Zt.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>c)for(o-=c;o--;)m+="0";else o<c&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return n.s<0?"-"+m:m}function En(n,e){if(n.length>e)return n.length=e,!0}function or(n){return new this(n).abs()}function sr(n){return new this(n).acos()}function ar(n){return new this(n).acosh()}function ur(n,e){return new this(n).plus(e)}function cr(n){return new this(n).asin()}function lr(n){return new this(n).asinh()}function mr(n){return new this(n).atan()}function dr(n){return new this(n).atanh()}function pr(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=le(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?le(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=le(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(X(n,e,o,1)),e=le(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(X(n,e,o,1)),t}function fr(n){return new this(n).cbrt()}function br(n){return S(n=new this(n),n.e+1,2)}function yr(n,e,t){return new this(n).clamp(e,t)}function gr(n){if(!n||typeof n!="object")throw Error(kt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Se,"rounding",0,8,"toExpNeg",-De,0,"toExpPos",0,De,"maxE",0,De,"minE",-De,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=jt[t]),(i=n[t])!==void 0)if(ie(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ie+t+": "+i);if(t="crypto",r&&(this[t]=jt[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Wn);else this[t]=!1;else throw Error(Ie+t+": "+i);return this}function wr(n){return new this(n).cos()}function Ar(n){return new this(n).cosh()}function Zn(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,vn(o)){u.s=o.s,R?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;R?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Jt(u,o.toString())}else if(c!=="string")throw Error(Ie+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),qn.test(o)?Jt(u,o):ir(u,o)}if(r.prototype=g,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=gr,r.clone=Zn,r.isDecimal=vn,r.abs=or,r.acos=sr,r.acosh=ar,r.add=ur,r.asin=cr,r.asinh=lr,r.atan=mr,r.atanh=dr,r.atan2=pr,r.cbrt=fr,r.ceil=br,r.clamp=yr,r.cos=wr,r.cosh=Ar,r.div=Pr,r.exp=kr,r.floor=hr,r.hypot=Tr,r.ln=Br,r.log=xr,r.log10=Sr,r.log2=Ir,r.max=Cr,r.min=Kr,r.mod=Nr,r.mul=Lr,r.pow=Rr,r.random=Mr,r.round=Or,r.sign=Fr,r.sin=Er,r.sinh=vr,r.sqrt=Dr,r.sub=_r,r.sum=Wr,r.tan=Vr,r.tanh=qr,r.trunc=Gr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function Pr(n,e){return new this(n).div(e)}function kr(n){return new this(n).exp()}function hr(n){return S(n=new this(n),n.e+1,3)}function Tr(){var n,e,t=new this(0);for(R=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return R=!0,new this(1/0);t=e}return R=!0,t.sqrt()}function vn(n){return n instanceof Ye||n&&n.toStringTag===Vn||!1}function Br(n){return new this(n).ln()}function xr(n,e){return new this(n).log(e)}function Ir(n){return new this(n).log(2)}function Sr(n){return new this(n).log(10)}function Cr(){return Xn(this,arguments,"lt")}function Kr(){return Xn(this,arguments,"gt")}function Nr(n,e){return new this(n).mod(e)}function Lr(n,e){return new this(n).mul(e)}function Rr(n,e){return new this(n).pow(e)}function Mr(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:oe(n,1,Se),i=Math.ceil(n/L),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Wn);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=L,i&&n&&(r=J(10,L-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=L)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<L&&(t-=L-i)}return s.e=t,s.d=a,s}function Or(n){return S(n=new this(n),n.e+1,this.rounding)}function Fr(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Er(n){return new this(n).sin()}function vr(n){return new this(n).sinh()}function Dr(n){return new this(n).sqrt()}function _r(n,e){return new this(n).sub(e)}function Wr(){var n=0,e=arguments,t=new this(e[n]);for(R=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return R=!0,S(t,this.precision,this.rounding)}function Vr(n){return new this(n).tan()}function qr(n){return new this(n).tanh()}function Gr(n){return S(n=new this(n),n.e+1,1)}g[Symbol.for("nodejs.util.inspect.custom")]=g.toString;g[Symbol.toStringTag]="Decimal";var Ye=g.constructor=Zn(jt);wt=new Ye(wt);At=new Ye(At);var $=Ye;import So from"big.js";import sc from"bn.js";import{get as jn,set as Ur}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Yn={},Xr={};function ee(n){let e=jn(Yn,n);if(!e){let t=jn(Xr,n);e=new en({name:n,logLevel:t}),Ur(Yn,n,e)}return e}import{MINT_SIZE as zr,TOKEN_PROGRAM_ID as Hr,getTransferFeeConfig as Zr,unpackMint as jr}from"@solana/spl-token";import{PublicKey as Qn}from"@solana/web3.js";var tn=ee("CobaltX_accountInfo_util");async function Qe(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=W({batchRequest:!1},t),s=nn(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(l=>{let d=n._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=nn(c,10);a=(await(await Promise.all(u.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&tn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:b,lamports:f,owner:y,rentEpoch:w}=d;return p.length!==2&&p[1]!=="base64"&&tn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:b,lamports:f,owner:new Qn(y),rentEpoch:w}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&tn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Le(n,e,t){let i=await Qe(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Z(W({},r),{accountInfo:i[o]}))}async function rn({connection:n,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let i=await Le(n,e.map(c=>({pubkey:Je(c)})),t),r={};for(let c of i){if(!c.accountInfo||c.accountInfo.data.length<zr){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=jr(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=Z(W({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Hr,feeConfig:(a=Zr(u))!=null?a:void 0})}return r[Qn.default.toBase58()]=r[ae.toBase58()],r}import $e from"bn.js";var Jn=9007199254740991;function ye(n){let e=ee("CobaltX_parseBigNumberish");if(n instanceof $e)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new $e(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Jn||n<=-Jn)&&e.logWithError(`BigNumberish number overflow: ${n}`),new $e(String(n))):typeof n=="bigint"?new $e(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new $e(0))}import{TOKEN_PROGRAM_ID as $n}from"@solana/spl-token";import{PublicKey as Yr}from"@solana/web3.js";var on={chainId:101,address:Yr.default.toBase58(),programId:$n.toBase58(),decimals:9,symbol:"ETH",name:"Ethereum",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}},Ce={chainId:101,address:"So11111111111111111111111111111111111111112",programId:$n.toBase58(),decimals:9,symbol:"WETH",name:"Wrapped ETH",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}};import{PublicKey as un}from"@solana/web3.js";import{PublicKey as ne,SystemProgram as ei,SYSVAR_RENT_PUBKEY as Qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jr}from"@solana/spl-token";function sn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Ds=[sn({pubkey:Jr,isWritable:!1}),sn({pubkey:ei.programId,isWritable:!1}),sn({pubkey:Qr,isWritable:!1})];function an({publicKey:n,transformSol:e}){let t=ti(n.toString());if(t instanceof ne)return e&&t.equals(et)?ae:t;if(e&&t.toString()===et.toBase58())return ae;if(typeof t=="string"){if(t===ne.default.toBase58())return ne.default;try{return new ne(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ti(n){try{return new ne(n)}catch{return n}}var $r=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Bt=new ne("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),xt=new ne("SysvarRent111111111111111111111111111111111"),_s=new ne("SysvarC1ock11111111111111111111111111111111"),We=new ne("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ws=new ne("Sysvar1nstructions1111111111111111111111111"),ni=ei.programId,Vs=new ne("a2Gt18uJC8puJT9JRYQLU6rPi6okxQb4WqCjwtYshZB"),qs=new ne("bXSKiFqYrALF9gJy1KqHm8tv4QXk8nCgbLN8WRsGEbh"),ae=new ne("So11111111111111111111111111111111111111112"),et=ne.default,Gs=new ne("71kRXzJMvSeArtXYNEWa8KAjpRJosdMQ7Dpgy5Jt5zfd"),Us=new ne("ERFzpDteGNo8LTDKW1WwVGrkRMmA2y9WZHXNHxMA6BSV");function Je(n){return an({publicKey:n,transformSol:!0})}var cn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===et.toBase58()||e instanceof un&&et.equals(e)){this.decimals=Ce.decimals,this.symbol=Ce.symbol,this.name=Ce.name,this.mint=new un(Ce.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?un.default:an({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ke=cn;Ke.WSOL=new cn(Z(W({},Ce),{mint:Ce.address}));var ln=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},It=ln;It.SOL=new ln(on);import eo from"toformat";var to=eo,tt=to;import Ct from"big.js";import io from"bn.js";import ro from"decimal.js-light";var St=ee("module/fraction"),mn=tt(Ct),nt=tt(ro),oo={[0]:nt.ROUND_DOWN,[1]:nt.ROUND_HALF_UP,[2]:nt.ROUND_UP},so={[0]:Ct.roundDown,[1]:Ct.roundHalfUp,[2]:Ct.roundUp},H=class{constructor(e,t=new io(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new H(this.denominator,this.numerator)}add(e){let t=e instanceof H?e:new H(ye(e));return this.denominator.eq(t.denominator)?new H(this.numerator.add(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof H?e:new H(ye(e));return this.denominator.eq(t.denominator)?new H(this.numerator.sub(t.numerator),this.denominator):new H(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof H?e:new H(ye(e));return new H(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof H?e:new H(ye(e));return new H(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||St.logWithError(`${e} is not an integer.`),e<=0&&St.logWithError(`${e} is not positive.`),nt.set({precision:e+1,rounding:oo[i]});let r=new nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||St.logWithError(`${e} is not an integer.`),e<0&&St.logWithError(`${e} is negative.`),mn.DP=e,mn.RM=so[i]||1,new mn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import ao from"bn.js";var ii=new H(new ao(100)),ue=class extends H{toSignificant(e=5,t,i){return this.mul(ii).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(ii).toFixed(e,t,i)}};var ga=ee("CobaltX_price");function nn(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yo}from"@solana/spl-token";import{ComputeBudgetProgram as ri,Keypair as si,PublicKey as uo,Transaction as ai,TransactionMessage as co,VersionedTransaction as ui}from"@solana/web3.js";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as lo}from"@solana/spl-token";var oi=ee("CobaltX_txUtil"),ci=1644;function Nt(n){let e=[],t=[];return n.microLamports&&(e.push(ri.setComputeUnitPrice({microLamports:n.microLamports})),t.push(se.SetComputeUnitPrice)),n.units&&(e.push(ri.setComputeUnitLimit({units:n.units})),t.push(se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Ve(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function Lt(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(o.err.toString())},"confirmed")})}function mo(n,e){n.length<1&&oi.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&oi.logWithError(`no signers provided:, ${e.toString()}`);let t=new ai;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ci}catch{return!1}}function de(n,e){let[t,i]=uo.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function it({instructions:n,payer:e,signers:t}){return mo(n,[e,...t])}function rt({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=si.generate().publicKey.toString()}){let o=new co({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new ui(o).serialize()).toString("base64").length<ci}catch{return!1}}var po=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),fo=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof ui&&(e=po(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Re(n){let e=[];return n.forEach(t=>{t instanceof ai&&(t.recentBlockhash||(t.recentBlockhash=lo.toBase58()),t.feePayer||(t.feePayer=si.generate().publicKey)),e.push(fo(t))}),console.log("simulate tx string:",e),e}function ge(n,e,t){return de([n.toBuffer(),(t!=null?t:yo).toBuffer(),e.toBuffer()],new bo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var Qa=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ja=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),$a=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),eu=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),tu=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),nu=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),iu=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ru=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ou=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),su=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),go=new O("2TnjBuwqyBB9to5jURagDT7jLmBPefGRiKL2yh1zPZ4V"),wo=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ao=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),au=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),uu=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),cu=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),lu=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),mu=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),du=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),li=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),mi=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),pu=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Po=new O("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ko=new O("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ho=new O("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Rt=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),To=new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Mt=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Bo=new O("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var fu={SERUM_MARKET:O.default,OPENBOOK_MARKET:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:O.default,FarmV3:new O("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new O("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new O("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new O("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new O("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new O("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new O("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new O("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Po,CREATE_CPMM_POOL_AUTH:ko,CREATE_CPMM_POOL_FEE_ACC:ho,FEE_DESTINATION_ID:new O("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:To,LCOK_CPMM_AUTH:Bo};import pe from"bn.js";var ot=1e4;function we(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let r=Z(W({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new pe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===ot){let c=new pe(o.maximumFee.toString());return{amount:n.add(c),fee:c,expirationTime:a}}else{let c=qe(n.mul(new pe(ot)),new pe(ot-o.transferFeeBasisPoints)),u=new pe(o.maximumFee.toString()),m=c.sub(n).gt(u)?n.add(u):c,l=qe(m.mul(new pe(o.transferFeeBasisPoints)),new pe(ot)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let c=qe(n.mul(new pe(o.transferFeeBasisPoints)),new pe(ot)),u=c.gt(s)?s:c;return{amount:n,fee:u,expirationTime:a}}}function qe(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new pe(0))?t.add(new pe(1)):t}import{PublicKey as di,AddressLookupTableAccount as Ot}from"@solana/web3.js";async function fn({connection:n,address:e}){let t=await Qe(n,[...new Set(e.map(r=>r.toString()))].map(r=>new di(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Ot({key:s,state:Ot.deserialize(o.data)});i[s.toString()]=a,Ft[s.toString()]=a}return i}var Ft={AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM:new Ot({key:new di("AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM"),state:Ot.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as st,sendAndConfirmTransaction as bn,Transaction as at,TransactionMessage as ut,VersionedTransaction as ct}from"@solana/web3.js";import Io from"axios";var Et=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Io.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Nt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==st.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(W({},t||{})):this.build(t)}build(e){var i;let t=new at;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await Ve(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),Re([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await bn(this.connection,t,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(m=>m.transaction.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],c=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async m=>{var w;let{sequentially:l,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:b,skipPreflight:f=!0}=m||{},y=b!=null?b:await Ve(this.connection,this.blockhashCommitment);if((w=this.owner)!=null&&w.isKeyPair){if(l){let P=[],k=0;for(let A of s){if(++k,k<=p)continue;let T=await bn(this.connection,A,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});P.push(T)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=y,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((A,T)=>(A.recentBlockhash=y,a[T].length&&A.sign(...a[T]),A));Re(P);let k=await this.signAllTransactions(P);if(l){let A=0,T=[],h=async()=>{if(!k[A])return;let N=await this.connection.sendRawTransaction(k[A].serialize(),{skipPreflight:f});T.push({txId:N,status:"sent",signedTx:k[A]}),d==null||d([...T]),A++,this.connection.onSignature(N,I=>{let F=T.findIndex(V=>V.txId===N);F>-1&&(T[F].status=I.err?"error":"success"),d==null||d([...T]),I.err||h()},"processed"),this.connection.getSignatureStatus(N)};return await h(),{txIds:T.map(N=>N.txId),signedTxs:k}}else{let A=[];for(let T=0;T<k.length;T+=1){let h=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:f});A.push(h)}return{txIds:A,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var f;let b=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=b,s=Ae(b,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=W(W({},this.cluster==="devnet"?{}:Ft),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new st(y));let m=await fn({connection:this.connection,address:u});for(let[y,w]of Object.entries(m))a[y]=w;let l=r?st.default.toBase58():o!=null?o:await Ve(this.connection,this.blockhashCommitment),d=new ut({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message();((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new ct(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var k;let{skipPreflight:w=!0,sendAndConfirm:P}=y||{};if(Re([p]),(k=this.owner)!=null&&k.isKeyPair){let A=await this.connection.sendTransaction(p,{skipPreflight:w});return P&&await Lt(this.connection,A),{txId:A,signedTx:p}}if(this.signAllTransactions){let A=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(A[0],{skipPreflight:w}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(m=>m.builder.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],c=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(m,l)=>{m.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async m=>{var f;let{sequentially:l,onTxUpdate:d,recentBlockHash:p,skipPreflight:b=!0}=m||{};if(p&&s.forEach(y=>y.message.recentBlockhash=p),Re(s),(f=this.owner)!=null&&f.isKeyPair){if(l){let y=[];for(let w of s){let P=await this.connection.sendTransaction(w,{skipPreflight:b});await Lt(this.connection,P),y.push(P)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(l){let w=0,P=[],k=async()=>{if(!y[w])return;let A=await this.connection.sendTransaction(y[w],{skipPreflight:b});P.push({txId:A,status:"sent",signedTx:y[w]}),d==null||d([...P]),w++,this.connection.onSignature(A,T=>{let h=P.findIndex(N=>N.txId===A);h>-1&&(P[h].status=T.err?"error":"success"),d==null||d([...P]),T.err||k()},"processed"),this.connection.getSignatureStatus(A)};return k(),{txIds:[],signedTxs:y}}else{let w=[];for(let P=0;P<y.length;P+=1){let k=await this.connection.sendTransaction(y[P],{skipPreflight:b});w.push(k)}return{txIds:w,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let l=e||{},{splitIns:t=[],computeBudgetConfig:i}=l,r=Ae(l,["splitIns","computeBudgetConfig"]),o=i?Nt(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,b)=>Z(W({},p),{[b.publicKey.toBase58()]:b}),{}),a=[],c=[],u=[],m=0;if(this.allInstructions.forEach(p=>{let b=[...u,p],f=i?[...o.instructions,...b]:b,w=[...new Set(b.map(P=>P.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(P=>new st(P));if(p!==t[m]&&u.length<12&&(it({instructions:f,payer:this.feePayer,signers:w})||it({instructions:b,payer:this.feePayer,signers:w})))u.push(p);else{if(u.length===0)throw Error("item ins too big");m+=p===t[m]?1:0,it({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:w})?a.push(new at().add(...o.instructions,...u)):a.push(new at().add(...u)),c.push(Array.from(new Set(u.map(P=>P.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(P=>s[P]).filter(P=>P!==void 0)),u=[p]}}),u.length>0){let b=[...new Set(u.map(f=>f.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);it({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:b.map(f=>f.publicKey)})?a.push(new at().add(...o.instructions,...u)):a.push(new at().add(...u)),c.push(b)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(b=>b.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var A;let{sequentially:b,onTxUpdate:f,skipTxCount:y=0,recentBlockHash:w,skipPreflight:P=!0}=p||{},k=w!=null?w:await Ve(this.connection,this.blockhashCommitment);if(a.forEach(async(T,h)=>{T.recentBlockhash=k,c[h].length&&T.sign(...c[h])}),Re(a),(A=this.owner)!=null&&A.isKeyPair){if(b){let T=0,h=[];for(let N of a){if(++T,T<=y){h.push("tx skipped");continue}let I=await bn(this.connection,N,this.signers.find(F=>F.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:P});h.push(I)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async T=>await this.connection.sendRawTransaction(T.serialize(),{skipPreflight:P}))),signedTxs:a}}if(this.signAllTransactions){let T=await this.signAllTransactions(a.slice(y,a.length)),h=[...a.slice(0,y),...T];if(b){let N=0,I=[],F=async()=>{if(!h[N])return;N<y&&(I.push({txId:"",status:"success",signedTx:h[N]}),f==null||f([...I]),N++,F());let V=await this.connection.sendRawTransaction(h[N].serialize(),{skipPreflight:P});I.push({txId:V,status:"sent",signedTx:h[N]}),f==null||f([...I]),N++,this.connection.onSignature(V,v=>{let D=I.findIndex(E=>E.txId===V);D>-1&&(I[D].status=v.err?"error":"success"),f==null||f([...I]),v.err||F()},"processed"),this.connection.getSignatureStatus(V)};return await F(),{txIds:I.map(V=>V.txId),signedTxs:h}}else{let N=[];for(let I=0;I<h.length;I+=1){let F=await this.connection.sendRawTransaction(h[I].serialize(),{skipPreflight:P});N.push(F)}return{txIds:N,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var k;let P=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=P,s=Ae(P,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=W(W({},this.cluster==="devnet"?{}:Ft),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let A of c)a[A]===void 0&&u.push(new st(A));let m=await fn({connection:this.connection,address:u});for(let[A,T]of Object.entries(m))a[A]=T;let l=t?Nt(t):{instructions:[],instructionTypes:[]},d=await Ve(this.connection,this.blockhashCommitment),p=this.signers.reduce((A,T)=>Z(W({},A),{[T.publicKey.toBase58()]:T}),{}),b=[],f=[],y=[],w=0;if(this.allInstructions.forEach(A=>{let T=[...y,A],h=t?[...l.instructions,...T]:T;if(A!==i[w]&&y.length<12&&(rt({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})||rt({instructions:T,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(A);else{if(y.length===0)throw Error("item ins too big");w+=A===i[w]?1:0;let N={};for(let I of[...new Set(c)])a[I]!==void 0&&(N[I]=a[I]);if(t&&rt({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let I=new ut({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));b.push(new ct(I))}else{let I=new ut({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));b.push(new ct(I))}f.push(Array.from(new Set(y.map(I=>I.keys.filter(F=>F.isSigner).map(F=>F.pubkey.toString())).flat())).map(I=>p[I]).filter(I=>I!==void 0)),y=[A]}}),y.length>0){let T=[...new Set(y.map(h=>h.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat()).values()].map(h=>p[h]).filter(h=>h!==void 0);if(t&&rt({instructions:[...l.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let h=new ut({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...y]}).compileToV0Message(Object.values(a));b.push(new ct(h))}else{let h=new ut({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));b.push(new ct(h))}f.push(T)}return(k=this.owner)!=null&&k.signer&&f.forEach(A=>{A.some(T=>T.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:b,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async A=>{var V;let{sequentially:T,onTxUpdate:h,skipTxCount:N=0,recentBlockHash:I,skipPreflight:F=!0}=A||{};if(b.map(async(v,D)=>{f[D].length&&v.sign(f[D]),I&&(v.message.recentBlockhash=I)}),Re(b),(V=this.owner)!=null&&V.isKeyPair){if(T){let v=0,D=[];for(let E of b){if(++v,v<=N){console.log("skip tx: ",v),D.push("tx skipped");continue}let G=await this.connection.sendTransaction(E,{skipPreflight:F});await Lt(this.connection,G),D.push(G)}return{txIds:D,signedTxs:b}}return{txIds:await Promise.all(b.map(async v=>await this.connection.sendTransaction(v,{skipPreflight:F}))),signedTxs:b}}if(this.signAllTransactions){let v=await this.signAllTransactions(b.slice(N,b.length)),D=[...b.slice(0,N),...v];if(T){let E=0,G=[],q=async()=>{if(!D[E])return;if(E<N){G.push({txId:"",status:"success",signedTx:D[E]}),h==null||h([...G]),E++,q();return}let _=await this.connection.sendTransaction(D[E],{skipPreflight:F});G.push({txId:_,status:"sent",signedTx:D[E]}),h==null||h([...G]),E++,this.connection.onSignature(_,Ze=>{let Ln=G.findIndex(Hi=>Hi.txId===_);Ln>-1&&(G[Ln].status=Ze.err?"error":"success"),h==null||h([...G]),Ze.err||q()},"processed"),this.connection.getSignatureStatus(_)};return q(),{txIds:[],signedTxs:D}}else{let E=[];for(let G=0;G<D.length;G+=1){let q=await this.connection.sendTransaction(D[G],{skipPreflight:F});E.push(q)}return{txIds:E,signedTxs:D}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{PublicKey as Ou}from"@solana/web3.js";import Eu from"bn.js";var bc=ee("CobaltX_amount"),yc=tt(So);var pn=new ke(0),Rc=new ke(1),Mc=new ke(2),Oc=new ke(3),Fc=new ke(5),Co=new ke(10),Ec=new ke(100),vc=new ke(1e3),Dc=new ke(1e4);import{AccountLayout as fs,NATIVE_MINT as Ht,TOKEN_PROGRAM_ID as fe}from"@solana/spl-token";import{PublicKey as B}from"@solana/web3.js";import gn from"bn.js";import Wt from"decimal.js-light";import lt from"bn.js";function vt(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function Ko(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);if(t.isZero())throw Error("quotient is zero");let i=vt(n,e);return i.gt(Ge)&&(t=t.add(new lt(1)),e=n.div(t),i=vt(n,t),i.gt(Ge)&&(e=e.add(new lt(1)))),[t,e]}var Ge=new lt(0),Dt=class{static swapWithoutFees(e,t,i){let r=t.mul(i),o=t.add(e),[s,a]=Ko(r,o),c=a.sub(t),u=i.sub(s);if(u.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:c,destinationAmountSwapped:u}}static lpTokensToTradingTokens(e,t,i,r,o){let s=e.mul(i).div(t),a=e.mul(r).div(t);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return vt(e.mul(i),t).gt(Ge)&&s.gt(Ge)&&(s=s.add(new lt(1))),vt(e.mul(r),t).gt(Ge)&&a.gt(Ge)&&(a=a.add(new lt(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};import fi from"bn.js";var yn=new fi(1e6);function No(n,e,t){return n.mul(e).add(t).sub(new fi(1)).div(t)}function pi(n,e,t){return n.mul(e).div(t)}var _t=class{static tradingFee(e,t){return No(e,t,yn)}static protocolFee(e,t){return pi(e,t,yn)}static fundFee(e,t){return pi(e,t,yn)}};var Vt=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,i,r){let o=_t.tradingFee(e,r),s=e.sub(o),{sourceAmountSwapped:a,destinationAmountSwapped:c}=Dt.swapWithoutFees(s,t,i),u=a.add(o);return{newSwapSourceAmount:t.add(u),newSwapDestinationAmount:i.sub(c),sourceAmountSwapped:u,destinationAmountSwapped:c,tradeFee:o}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:i,baseReserve:r,quoteReserve:o,outputMint:s,outputAmount:a}){let[c,u,m,l,d]=t.address===s.toString()?[r,o,e.decimals,t.decimals,e.address]:[o,r,t.decimals,e.decimals,t.address],p=new Wt(u.toString()).div(10**l).div(new Wt(c.toString()).div(10**m)),b=a.gte(u)?u.sub(new gn(1)):a,f=u.sub(b),y=qe(c.mul(b),f),w=qe(y.mul(new gn(1e6)),new gn(1e6).sub(i)),P=w.sub(y),k=new Wt(b.toString()).div(10**l).div(new Wt(w.toString()).div(10**m)),A=p.isZero()?0:k.sub(p).div(p).abs().toNumber();return{amountRealOut:b,amountIn:w,amountInWithoutFee:y,tradeFee:P,priceImpact:A}}};import Q from"bn.js";var wn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ue=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ee(t)}createTxBuilder(e){return this.scope.checkOwner(),new Et({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(wn(e))}logInfo(...e){this.logger.info(wn(e))}logAndCreateError(...e){let t=wn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as _o}from"@solana/web3.js";import wi,{isBN as Ai}from"bn.js";import{bits as ol,BitStructure as sl,blob as Lo,Blob as al,cstr as ul,f32 as cl,f32be as ll,f64 as ml,f64be as dl,greedy as pl,Layout as Ro,ns64 as fl,ns64be as bl,nu64 as yl,nu64be as gl,offset as wl,s16 as Al,s16be as Pl,s24 as kl,s24be as hl,s32 as Mo,s32be as Tl,s40 as Bl,s40be as xl,s48 as Il,s48be as Sl,s8 as Cl,seq as Oo,struct as Kl,Structure as Fo,u16 as Eo,u16be as Nl,u24 as Ll,u24be as Rl,u32 as Ml,u32be as Ol,u40 as Fl,u40be as El,u48 as vl,u48be as Dl,u8 as vo,UInt as Do,union as _l,Union as Wl,unionLayoutDiscriminator as Vl,utf8 as ql}from"@solana/buffer-layout";var An=Ro,bi=Fo;var Pn=Do;var yi=vo,Me=Eo;var he=Mo;var gi=Oo;var re=Lo;var Xe=class extends An{constructor(t,i,r){super(t,r);this.blob=re(t),this.signed=i}decode(t,i=0){let r=new wi(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new wi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function j(n){return new Pn(1,n)}function Te(n){return new Pn(4,n)}function x(n){return new Xe(8,!1,n)}function Y(n){return new Xe(16,!1,n)}function Pi(n){return new Xe(8,!0,n)}function ki(n){return new Xe(16,!0,n)}var qt=class extends An{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function M(n){return new qt(re(32),e=>new _o(e),e=>e.toBuffer(),n)}function Oe(n){return new qt(yi(),Wo,Vo,n)}function Wo(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function Vo(n){return n?1:0}var kn=class extends bi{decode(e,t){return super.decode(e,t)}};function U(n,e,t){return new kn(n,e,t)}function z(n,e,t){let i,r=typeof e=="number"?e:Ai(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Ai(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return gi(n,r,t)}var nm=U([Te("mintAuthorityOption"),M("mintAuthority"),x("supply"),j("decimals"),j("isInitialized"),Te("freezeAuthorityOption"),M("freezeAuthority")]);import{PublicKey as sm}from"@solana/web3.js";import{MintLayout as um,TOKEN_PROGRAM_ID as lm}from"@solana/spl-token";var Fe=r=>{var o=r,{address:n,programId:e,decimals:t}=o,i=Ae(o,["address","programId","decimals"]);return W({chainId:101,address:Je(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{}},i)},ze=n=>n?Z(W({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:Z(W({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:Z(W({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{ASSOCIATED_TOKEN_PROGRAM_ID as vi,TOKEN_2022_PROGRAM_ID as Kn,TOKEN_PROGRAM_ID as Ne}from"@solana/spl-token";import{Keypair as ls,PublicKey as bt,SystemProgram as ms,TransactionInstruction as Ee}from"@solana/web3.js";var qo=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),hm=Buffer.from("amm_config","utf8"),Go=Buffer.from("pool","utf8"),Uo=Buffer.from("pool_lp_mint","utf8"),Xo=Buffer.from("pool_vault","utf8"),zo=Buffer.from("observation","utf8");function Gt(n){return de([qo],n)}function hn(n,e,t,i){return de([Go,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function Ho(n,e){return de([Uo,e.toBuffer()],n)}function hi(n,e,t){return de([Xo,e.toBuffer(),t.toBuffer()],n)}function mt(n,e){return de([zo,e.toBuffer()],n)}function Ti({poolId:n,programId:e,configId:t,mintA:i,mintB:r}){let o=Gt(e).publicKey,s=n||hn(e,t,i,r).publicKey,a=Ho(e,s).publicKey,c=hi(e,s,i).publicKey,u=hi(e,s,r).publicKey,m=mt(e,s).publicKey;return{poolId:s,configId:t,authority:o,lpMint:a,vaultA:c,vaultB:u,observationId:m}}var Zo=Buffer.from("locked_liquidity","utf8");function Ut(n,e){return de([Zo,e.toBuffer()],n)}import{AccountLayout as tf,TOKEN_2022_PROGRAM_ID as nf,TOKEN_PROGRAM_ID as rf}from"@solana/spl-token";import{PublicKey as sf}from"@solana/web3.js";import uf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Np,TOKEN_2022_PROGRAM_ID as Lp,TOKEN_PROGRAM_ID as Rp}from"@solana/spl-token";import{Keypair as Fp,PublicKey as Ep,SystemProgram as Dp,TransactionInstruction as _p}from"@solana/web3.js";import Vp from"bn.js";import up from"bn.js";import ce from"bn.js";var Bi=new ce(0),xi=new ce(1),Ii=new ce(-1),Xt=new ce(1).shln(64),Si=new ce(1).shln(128),jo=Xt.sub(xi);var Yo=Si.subn(1),He=-443636,dt=-He,Tn=new ce("4295048016"),Bn=new ce("79226673521066979257578248091"),xm=new ce("4295048017"),Im=new ce("79226673521066979257578248090");var Qo=new ce(10).pow(new ce(6));var Sm=new ce("18446744073700000000");import Zd from"bn.js";var Om=Buffer.from("amm_config","utf8"),Fm=Buffer.from("pool","utf8"),Em=Buffer.from("pool_vault","utf8"),vm=Buffer.from("pool_reward_vault","utf8"),Dm=Buffer.from("position","utf8"),_m=Buffer.from("tick_array","utf8"),Wm=Buffer.from("operation","utf8"),Vm=Buffer.from("pool_tick_array_bitmap_extension","utf8"),qm=Buffer.from("observation","utf8");function xn(n){return de([Buffer.from("metadata","utf8"),We.toBuffer(),n.toBuffer()],We)}var Gm=Buffer.from("locked_position","utf8");import{TOKEN_2022_PROGRAM_ID as Pd}from"@solana/spl-token";import{PublicKey as Bd}from"@solana/web3.js";import Id from"bn.js";import zm from"bn.js";var Cn=14;var zt=60;var ts=U([re(8),j("bump"),Me("index"),M(""),Te("protocolFeeRate"),Te("tradeFeeRate"),Me("tickSpacing"),z(x(),8,"")]),ns=U([Te("blockTimestamp"),Pi("tickCumulative"),z(x(),4)]),Ei=U([re(8),Oe("initialized"),x("recentEpoch"),Me("observationIndex"),M("poolId"),z(ns,100,"observations"),z(x(),4)]),is=U([j("rewardState"),x("openTime"),x("endTime"),x("lastUpdateTime"),Y("emissionsPerSecondX64"),x("rewardTotalEmissioned"),x("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),Y("rewardGrowthGlobalX64")]),Mi=U([re(8),j("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),j("mintDecimalsA"),j("mintDecimalsB"),Me("tickSpacing"),Y("liquidity"),Y("sqrtPriceX64"),he("tickCurrent"),Te(),Y("feeGrowthGlobalX64A"),Y("feeGrowthGlobalX64B"),x("protocolFeesTokenA"),x("protocolFeesTokenB"),Y("swapInAmountTokenA"),Y("swapOutAmountTokenB"),Y("swapInAmountTokenB"),Y("swapOutAmountTokenA"),j("status"),z(j(),7,""),z(is,3,"rewardInfos"),z(x(),16,"tickArrayBitmap"),x("totalFeesTokenA"),x("totalFeesClaimedTokenA"),x("totalFeesTokenB"),x("totalFeesClaimedTokenB"),x("fundFeesTokenA"),x("fundFeesTokenB"),x("startTime"),z(x(),15*4-3,"padding")]),rs=U([Y("growthInsideLastX64"),x("rewardAmountOwed")]),Oi=U([re(8),j("bump"),M("nftMint"),M("poolId"),he("tickLower"),he("tickUpper"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),x("tokenFeesOwedA"),x("tokenFeesOwedB"),z(rs,3,"rewardInfos"),z(x(),8,"")]),wp=U([re(8),j("bump"),M("poolId"),he("tickLowerIndex"),he("tickUpperIndex"),Y("liquidity"),Y("feeGrowthInsideLastX64A"),Y("feeGrowthInsideLastX64B"),x("tokenFeesOwedA"),x("tokenFeesOwedB"),z(Y(),3,"rewardGrowthInside"),z(x(),8,"")]),os=U([he("tick"),ki("liquidityNet"),Y("liquidityGross"),Y("feeGrowthOutsideX64A"),Y("feeGrowthOutsideX64B"),z(Y(),3,"rewardGrowthsOutsideX64"),z(Te(),13,"")]),Ni=U([re(8),M("poolId"),he("startTickIndex"),z(os,zt,"ticks"),j("initializedTickCount"),z(j(),115,"")]),ss=U([re(329),z(M(),100,"whitelistMints")]),es=U([re(8),M("poolId"),z(z(x(),8),Cn,"positiveTickArrayBitmap"),z(z(x(),8),Cn,"negativeTickArrayBitmap")]),Ap=U([x(),j("bump"),M("owner"),M("poolId"),M("positionId"),M("nftAccount"),z(x(),8)]),Pp=U([re(8),j("bump"),M("lockOwner"),M("poolId"),M("positionId"),M("nftAccount"),M("lockNftMint"),x("recentEpoch"),z(x(),8)]);Ei.span;var Hp=ee("CobaltX_Clmm");var ds=ee("CobaltX_cpmm"),ve={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Di(n,e,t,i,r,o,s,a,c,u,m,l,d,p,b,f,y,w,P,k){let A=U([x("amountMaxA"),x("amountMaxB"),x("openTime")]),T=hn(n,t,o,s).publicKey,h=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(T),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:vi,isSigner:!1,isWritable:!1},{pubkey:ni,isSigner:!1,isWritable:!1},{pubkey:xt,isSigner:!1,isWritable:!1}],N=Buffer.alloc(A.span);return A.encode({amountMaxA:w,amountMaxB:P,openTime:k},N),new Ee({keys:h,programId:n,data:Buffer.from([...ve.initialize,...N])})}function _i(n,e,t,i,r,o,s,a,c,u,m,l,d,p,b){let f=U([x("lpAmount"),x("amountMaxA"),x("amountMaxB")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0}],w=Buffer.alloc(f.span);return ds.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:b.toString()}),f.encode({lpAmount:d,amountMaxA:p,amountMaxB:b},w),new Ee({keys:y,programId:n,data:Buffer.from([...ve.deposit,...w])})}function Wi(n,e,t,i,r,o,s,a,c,u,m,l,d,p,b){let f=U([x("lpAmount"),x("amountMinA"),x("amountMinB")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Bt,isSigner:!1,isWritable:!1}],w=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:p,amountMinB:b},w),new Ee({keys:y,programId:n,data:Buffer.from([...ve.withdraw,...w])})}function Vi(n,e,t,i,r,o,s,a,c,u,m,l,d,p,b,f){let y=U([x("amountIn"),x("amounOutMin")]),w=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],P=Buffer.alloc(y.span);return y.encode({amountIn:b,amounOutMin:f},P),new Ee({keys:w,programId:n,data:Buffer.from([...ve.swapBaseInput,...P])})}function qi(n,e,t,i,r,o,s,a,c,u,m,l,d,p,b,f){let y=U([x("amountInMax"),x("amountOut")]),w=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],P=Buffer.alloc(y.span);return y.encode({amountInMax:b,amountOut:f},P),new Ee({keys:w,programId:n,data:Buffer.from([...ve.swapBaseOutput,...P])})}async function Gi(n){var f;let{ownerInfo:e,poolInfo:t,poolKeys:i,getEphemeralSigners:r}=n,o=[],[s,a]=[new bt(t.id),new bt(t.lpMint.address)],c;if(r)c=new bt((await r(1))[0]);else{let y=ls.generate();o.push(y),c=y.publicKey}let{publicKey:u}=ge(e.feePayer,c,Ne),{publicKey:m}=xn(c),{publicKey:l}=Ut(n.lockProgram,c),{publicKey:d}=ge(e.feePayer,a,Ne),{publicKey:p}=ge(n.lockAuthProgram,a,Ne),b=ps({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,nftOwner:e.feePayer,liquidityOwner:e.feePayer,nftMint:c,nftAccount:u,poolId:s,lockPda:l,mintLp:a,userLpVault:d,lockLpVault:p,poolVaultA:new bt(i.vault.A),poolVaultB:new bt(i.vault.B),metadataAccount:m,lpAmount:n.lpAmount,withMetadata:(f=n.withMetadata)!=null?f:!0});return{address:{nftMint:c,nftAccount:u,metadataAccount:m,lockPda:l,userLpVault:d,lockLpVault:p},instructions:[b],signers:o,instructionTypes:[se.CpmmLockLp],lookupTableAddress:[]}}function ps({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:r,nftMint:o,nftAccount:s,poolId:a,lockPda:c,mintLp:u,userLpVault:m,lockLpVault:l,poolVaultA:d,poolVaultB:p,metadataAccount:b,lpAmount:f,withMetadata:y}){let w=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:xt,isSigner:!1,isWritable:!1},{pubkey:ms.programId,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:vi,isSigner:!1,isWritable:!1},{pubkey:We,isSigner:!1,isWritable:!1}],P=U([x("lpAmount"),Oe("withMetadata")]),k=Buffer.alloc(P.span);P.encode({lpAmount:f,withMetadata:y},k);let A=Buffer.from([...ve.lockCpLiquidity,...k]);return new Ee({keys:w,programId:n,data:A})}function Ui({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:r,poolId:o,mintLp:s,userVaultA:a,userVaultB:c,poolVaultA:u,poolVaultB:m,mintA:l,mintB:d,lockLpVault:p,lpFeeAmount:b,cpmmProgram:f,cpmmAuthProgram:y}){let w=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:li,isSigner:!1,isWritable:!1},{pubkey:y!=null?y:mi,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1}],P=U([x("lpFeeAmount")]),k=Buffer.alloc(P.span);P.encode({lpFeeAmount:b},k);let A=Buffer.from([...ve.collectCpFee,...k]);return new Ee({keys:w,programId:n,data:A})}var Xi=U([re(8),j("bump"),Oe("disableCreatePool"),Me("index"),x("tradeFeeRate"),x("protocolFeeRate"),x("fundFeeRate"),x("createPoolFee"),M("protocolOwner"),M("fundOwner"),z(x(),16)]),zi=U([re(8),M("configId"),M("poolCreator"),M("vaultA"),M("vaultB"),M("mintLp"),M("mintA"),M("mintB"),M("mintProgramA"),M("mintProgramB"),M("observationId"),j("bump"),j("status"),j("lpDecimals"),j("mintDecimalA"),j("mintDecimalB"),x("lpAmount"),x("protocolFeesMintA"),x("protocolFeesMintB"),x("fundFeesMintA"),x("fundFeesMintB"),x("openTime"),z(x(),32)]);var Nn=class extends Ue{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let i=await Le(this.scope.connection,e.map(l=>({pubkey:new B(l)}))),r={},o=new Set,s=[];for(let l=0;l<e.length;l++){let d=i[l];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[l]));let p=zi.decode(d.accountInfo.data);r[String(e[l])]=Z(W({},p),{programId:d.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let l=[...o],d=await Le(this.scope.connection,l.map(p=>({pubkey:new B(p)})));for(let p=0;p<l.length;p++){let b=d[p].accountInfo;if(b===null)throw Error("fetch pool config error: "+l[p]);a[l[p]]=Xi.decode(b.data)}}let c={},u=await Le(this.scope.connection,s.map(l=>({pubkey:new B(l)})));for(let l=0;l<s.length;l++){let d=u[l].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[l]);c[String(s[l])]=new Q(fs.decode(d.data).amount.toString())}let m={};for(let[l,d]of Object.entries(r)){let p=c[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),b=c[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);m[l]=Z(W({},d),{baseReserve:p,quoteReserve:b,vaultAAmount:c[d.vaultA.toString()],vaultBAmount:c[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new $(b.toString()).div(new $(10).pow(d.mintDecimalB)).div(new $(p.toString()).div(new $(10).pow(d.mintDecimalA)))})}return m}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,r)=>{var c,u,m,l;let o=e[r],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return Z(W({},i),{[r]:Z(W({},o),{id:new B(r),configInfo:o.configInfo,version:7,authority:Gt(o.programId).publicKey,mintA:Fe({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(c=t[s])!=null&&c.feeConfig?ze((u=t[s])==null?void 0:u.feeConfig):void 0}}),mintB:Fe({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(m=t[a])!=null&&m.feeConfig?ze((l=t[a])==null?void 0:l.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),i=await rn({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),r=Fe({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?ze(i[t.mintA.toBase58()].feeConfig):void 0}}),o=Fe({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?ze(i[t.mintB.toBase58()].feeConfig):void 0}}),s=Fe({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:fe.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},c={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:r,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new $(t.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new $(t.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:c,week:c,month:c,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:r,mintB:o,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:Gt(t.programId).publicKey.toBase58(),mintLp:s,config:a,observationId:mt(t.programId,new B(e)).publicKey.toBase58()},rpcData:t}}async createPool(d){var p=d,{poolId:e,programId:t,poolFeeAccount:i,startTime:r,ownerInfo:o,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:c,feeConfig:u,computeBudgetConfig:m}=p,l=Ae(p,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig"]);var G,q,_;let b=o.feePayer||((G=this.scope.owner)==null?void 0:G.publicKey),f=new Q(new B(l.mintA.address).toBuffer()).lte(new Q(new B(l.mintB.address).toBuffer())),[y,w]=f?[l.mintA,l.mintB]:[l.mintB,l.mintA],[P,k]=f?[l.mintAAmount,l.mintBAmount]:[l.mintBAmount,l.mintAAmount],A=o.useSOLBalance&&y.address===Ht.toBase58(),T=o.useSOLBalance&&w.address===Ht.toBase58(),[h,N]=[new B(y.address),new B(w.address)],I=this.createTxBuilder(),{account:F,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({mint:h,tokenProgram:y.programId,owner:this.scope.ownerPubKey,createInfo:A?{payer:b,amount:P}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:s,checkCreateATAOwner:a});I.addInstruction(V||{});let{account:v,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({mint:new B(w.address),tokenProgram:w.programId,owner:this.scope.ownerPubKey,createInfo:T?{payer:b,amount:k}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:s,checkCreateATAOwner:a});if(I.addInstruction(D||{}),F===void 0||v===void 0)throw Error("you don't has some token account");let E=Ti({poolId:e,programId:t,configId:new B(u.id),mintA:h,mintB:N});return I.addInstruction({instructions:[Di(t,this.scope.ownerPubKey,new B(u.id),E.authority,E.poolId,h,N,E.lpMint,F,v,ge(this.scope.ownerPubKey,E.lpMint).publicKey,E.vaultA,E.vaultB,i,new B((q=y.programId)!=null?q:fe),new B((_=w.programId)!=null?_:fe),E.observationId,P,k,r)],instructionTypes:[se.CpmmCreatePool]}),I.addCustomComputeBudget(m),I.versionBuild({txVersion:c,extInfo:{address:Z(W({},E),{mintA:y,mintB:w,programId:t,poolFeeAccount:i,feeConfig:u})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:r,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:c,config:u,txVersion:m}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:l}=this.scope,{bypassAssociatedCheck:d,checkCreateATAOwner:p}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),b=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:f,inputAmountFee:y,anotherAmount:w}=a||this.computePairAmount({poolInfo:Z(W({},t),{lpAmount:new $(b.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:b.baseReserve,quoteReserve:b.quoteReserve,slippage:new ue(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new $(r.toString()).div(10**(o?t.mintA.decimals:t.mintB.decimals))}),P=w.amount,k=t.mintA.address===Ht.toString(),A=t.mintB.address===Ht.toString(),T=this.createTxBuilder(),[h,N]=[new B(t.mintA.address),new B(t.mintB.address)],{account:I,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:k||(o?r:P).isZero()?{payer:this.scope.ownerPubKey,amount:o?r:P}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!1,checkCreateATAOwner:p});T.addInstruction(F||{});let{account:V,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:A||(o?P:r).isZero()?{payer:this.scope.ownerPubKey,amount:o?P:r}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!1,checkCreateATAOwner:p});T.addInstruction(v||{}),!I&&!V&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let D=await l.getCreatedTokenAccount({mint:new B(t.lpMint.address)}),Ze=await l.handleTokenAccount({side:"out",amount:0,mint:new B(t.lpMint.address),tokenAccount:D,bypassAssociatedCheck:d,checkCreateATAOwner:p}),{tokenAccount:E}=Ze,G=Ae(Ze,["tokenAccount"]);T.addInstruction(G);let q=i!=null?i:await this.getCpmmPoolKeys(t.id),_=new ue(new Q(1)).sub(s);return T.addInstruction({instructions:[_i(new B(t.programId),this.scope.ownerPubKey,new B(q.authority),new B(t.id),E,I,V,new B(q.vault.A),new B(q.vault.B),h,N,new B(t.lpMint.address),a?a==null?void 0:a.liquidity:_.mul(f).quotient,o?y.amount:P,o?P:y.amount)],instructionTypes:[se.CpmmAddLiquidity],lookupTableAddress:q.lookupTableAccount?[q.lookupTableAccount]:[]}),T.addCustomComputeBudget(c),T.versionBuild({txVersion:m})}async withdrawLiquidity(e){var E,G;let{poolInfo:t,poolKeys:i,lpAmount:r,slippage:o,computeBudgetConfig:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let c=new ue(new Q(1)).sub(o),u=await this.getRpcPoolInfo(t.id),[m,l]=[c.mul(r.mul(u.baseReserve).div(u.lpAmount)).quotient,c.mul(r.mul(u.quoteReserve).div(u.lpAmount)).quotient],d=await this.scope.fetchEpochInfo(),[p,b]=[we(m,t.mintA.extensions.feeConfig,d,!1),we(l,t.mintB.extensions.feeConfig,d,!1)],{account:f}=this.scope,y=this.createTxBuilder(),[w,P]=[new B(t.mintA.address),new B(t.mintB.address)],k=w.equals(ae),A=P.equals(ae),T,h,{account:N,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!k,associatedOnly:!k,checkCreateATAOwner:!1});T=N,I&&y.addInstruction(I);let{account:F,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,associatedOnly:!A,checkCreateATAOwner:!1});h=F,V&&y.addInstruction(V),(!T||!h)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",f.tokenAccounts);let v=await f.getCreatedTokenAccount({mint:new B(t.lpMint.address)});v||this.logAndCreateError("cannot found lp token account","tokenAccounts",f.tokenAccounts);let D=i!=null?i:await this.getCpmmPoolKeys(t.id);return y.addInstruction({instructions:[Wi(new B(t.programId),this.scope.ownerPubKey,new B(D.authority),new B(t.id),v,T,h,new B(D.vault.A),new B(D.vault.B),w,P,new B(t.lpMint.address),r,m.sub((E=p.fee)!=null?E:new Q(0)),l.sub((G=b.fee)!=null?G:new Q(0)))],instructionTypes:[se.CpmmWithdrawLiquidity],lookupTableAddress:D.lookupTableAccount?[D.lookupTableAccount]:[]}),y.addCustomComputeBudget(s),y.versionBuild({txVersion:a})}async swap(e){var F,V,v,D,E,G;let{poolInfo:t,poolKeys:i,baseIn:r,fixedOut:o,inputAmount:s,swapResult:a,slippage:c=0,config:u,computeBudgetConfig:m,txVersion:l}=e,{bypassAssociatedCheck:d,checkCreateATAOwner:p,associatedOnly:b}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},u),f=this.createTxBuilder(),[y,w]=[new B(t.mintA.address),new B(t.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new Q((1+c)*1e4)).div(new Q(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new Q((1-c)*1e4)).div(new Q(1e4));let P=t.mintA.address===ae.toBase58(),k=t.mintB.address===ae.toBase58(),{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({mint:y,tokenProgram:new B((F=t.mintA.programId)!=null?F:fe),owner:this.scope.ownerPubKey,createInfo:P||!r?{payer:this.scope.ownerPubKey,amount:r?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:P,skipCloseAccount:!P,associatedOnly:P?!1:b,checkCreateATAOwner:p});T&&f.addInstruction(T);let{account:h,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:w,tokenProgram:new B((V=t.mintB.programId)!=null?V:fe),owner:this.scope.ownerPubKey,createInfo:k||r?{payer:this.scope.ownerPubKey,amount:r?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:k,skipCloseAccount:!k,associatedOnly:k?!1:b,checkCreateATAOwner:p});N&&f.addInstruction(N),(!A||!h)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:A,mintBTokenAcc:h,mintAUseSOLBalance:P,mintBUseSOLBalance:k,associatedOnly:b});let I=i!=null?i:await this.getCpmmPoolKeys(t.id);return f.addInstruction({instructions:[o?qi(new B(t.programId),this.scope.ownerPubKey,new B(I.authority),new B(I.config.id),new B(t.id),r?A:h,r?h:A,new B(I.vault[r?"A":"B"]),new B(I.vault[r?"B":"A"]),new B((E=t[r?"mintA":"mintB"].programId)!=null?E:fe),new B((G=t[r?"mintB":"mintA"].programId)!=null?G:fe),r?y:w,r?w:y,mt(new B(t.programId),new B(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):Vi(new B(t.programId),this.scope.ownerPubKey,new B(I.authority),new B(I.config.id),new B(t.id),r?A:h,r?h:A,new B(I.vault[r?"A":"B"]),new B(I.vault[r?"B":"A"]),new B((v=t[r?"mintA":"mintB"].programId)!=null?v:fe),new B((D=t[r?"mintB":"mintA"].programId)!=null?D:fe),r?y:w,r?w:y,mt(new B(t.programId),new B(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?se.CpmmSwapBaseOut:se.ClmmSwapBaseIn]}),f.addCustomComputeBudget(m),f.versionBuild({txVersion:l})}async lockLp(e){var u,m,l,d,p;let{poolInfo:t,lpAmount:i,computeBudgetConfig:r,txVersion:o}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let s=this.createTxBuilder(),a=(u=e.poolKeys)!=null?u:await this.getCpmmPoolKeys(t.id),c=await Gi({poolInfo:t,poolKeys:a,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(m=e.feePayer)!=null?m:this.scope.ownerPubKey},lockProgram:(l=e.programId)!=null?l:Rt,lockAuthProgram:(d=e.authProgram)!=null?d:Mt,lpAmount:i,withMetadata:(p=e.withMetadata)!=null?p:!0,getEphemeralSigners:e.getEphemeralSigners});return s.addInstruction(c),s.addCustomComputeBudget(r),s.versionBuild({txVersion:o,extInfo:c.address})}async harvestLockLp(e){var V;let{poolInfo:t,lpFeeAmount:i,nftMint:r,programId:o=Rt,authProgram:s=Mt,cpmmProgram:a,computeBudgetConfig:c,txVersion:u}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let m=e.feePayer||this.scope.ownerPubKey,l=this.createTxBuilder(),[d,p]=[new B(t.mintA.address),new B(t.mintB.address)],b=d.equals(ae),f=p.equals(ae),y,w,{account:P,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:!b,checkCreateATAOwner:!1});y=P,k&&l.addInstruction(k);let{account:A,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:!f,checkCreateATAOwner:!1});w=A,T&&l.addInstruction(T),(!y||!w)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:y,tokenAccountB:w});let h=(V=e.poolKeys)!=null?V:await this.getCpmmPoolKeys(t.id),{publicKey:N}=ge(m,r,fe),{publicKey:I}=Ut(o,r),{publicKey:F}=ge(s,new B(t.lpMint.address),fe);return l.addInstruction({instructions:[Ui({programId:o!=null?o:Rt,nftOwner:this.scope.ownerPubKey,auth:s!=null?s:Mt,nftMint:r,nftAccount:N,lockPda:I,poolId:new B(t.id),mintLp:new B(h.mintLp.address),userVaultA:y,userVaultB:w,poolVaultA:new B(h.vault.A),poolVaultB:new B(h.vault.B),mintA:d,mintB:p,lockLpVault:F,lpFeeAmount:i,cpmmProgram:a==null?void 0:a.programId,cpmmAuthProgram:a==null?void 0:a.authProgram})],instructionTypes:[se.CpmmCollectLockFee]}),l.addCustomComputeBudget(c),l.versionBuild({txVersion:u})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:r}){let o=i.toString()===e.mintB.address,s=Vt.swap(t,o?e.baseReserve:e.quoteReserve,o?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new $(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),c=s.destinationAmountSwapped.mul(new Q((1-r)*1e4)).div(new Q(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:c,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:r,slippage:o,epochInfo:s,baseIn:a}){var A,T,h,N,I,F,V,v,D;let c=1-Number(o.toSignificant())/100,u=new Q(new $(r).mul(10**e[a?"mintA":"mintB"].decimals).mul(c).toFixed(0)),m=we(u,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),l=u.sub((A=m.fee)!=null?A:new Q(0)),d=new Q(new $(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,$.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",u.toString(),"amountInFee:",(h=(T=m.fee)==null?void 0:T.toString())!=null?h:0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let b=l.mul(d).div(p==="base"?t:i),f={amount:pn,fee:void 0,expirationTime:void 0};if(!l.isZero()){let E=bs(b,t,i,d);this.logDebug("lpAmountData:",{amountA:E.amountA.toString(),amountB:E.amountB.toString()}),f=we(E[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let y=new ue(new Q(1)).add(o),w=new ue(new Q(1)).sub(o),P=we(y.mul(f.amount.sub((N=f.fee)!=null?N:new Q(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),k=we(w.mul(f.amount.sub((I=f.fee)!=null?I:new Q(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(V=(F=f.fee)==null?void 0:F.toString())!=null?V:0,"maxAnotherAmount:",P.amount.toString(),"maxAnotherAmountFee:",(D=(v=P.fee)==null?void 0:v.toString())!=null?D:0),{inputAmountFee:m,anotherAmount:f,maxAnotherAmount:P,minAnotherAmount:k,liquidity:b}}};function bs(n,e,t,i){let r=n.mul(e).div(i);!r.isZero()&&!n.mul(e).mod(i).isZero()&&(r=r.add(new Q(1)));let o=n.mul(t).div(i);return!o.isZero()&&!n.mul(t).mod(i).isZero()&&(o=o.add(new Q(1))),{amountA:r,amountB:o}}export{Nn as default};
//# sourceMappingURL=cpmm.mjs.map
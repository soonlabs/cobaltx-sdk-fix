var Ir=Object.defineProperty,Sr=Object.defineProperties;var Cr=Object.getOwnPropertyDescriptors;var rn=Object.getOwnPropertySymbols;var bi=Object.prototype.hasOwnProperty,gi=Object.prototype.propertyIsEnumerable;var pi=(r,e,t)=>e in r?Ir(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E=(r,e)=>{for(var t in e||(e={}))bi.call(e,t)&&pi(r,t,e[t]);if(rn)for(var t of rn(e))gi.call(e,t)&&pi(r,t,e[t]);return r},j=(r,e)=>Sr(r,Cr(e));var Pt=(r,e)=>{var t={};for(var n in r)bi.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&rn)for(var n of rn(r))e.indexOf(n)<0&&gi.call(r,n)&&(t[n]=r[n]);return t};import{MINT_SIZE as Lr,TOKEN_PROGRAM_ID as Rr,getTransferFeeConfig as Mr,unpackMint as Or}from"@solana/spl-token";import{PublicKey as hi}from"@solana/web3.js";import{get as yi,set as Kr}from"lodash";var Ln=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},wi={},Nr={};function Ae(r){let e=yi(wi,r);if(!e){let t=yi(Nr,r);e=new Ln({name:r,logLevel:t}),Kr(wi,r,e)}return e}var Rn=Ae("CobaltX_accountInfo_util");async function $e(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=E({batchRequest:!1},t),s=Mn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=r._buildArgs([m.map(f=>f.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Mn(c,10);a=(await(await Promise.all(u.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Rn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:b,owner:y,rentEpoch:g}=d;return f.length!==2&&f[1]!=="base64"&&Rn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:b,owner:new hi(y),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>r.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&Rn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function et(r,e,t){let n=await $e(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>j(E({},i),{accountInfo:n[o]}))}async function ki({connection:r,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await et(r,e.map(c=>({pubkey:pt(c)})),t),i={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Lr){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Or(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);i[c.pubkey.toString()]=j(E({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Rr,feeConfig:(a=Mr(u))!=null?a:void 0})}return i[hi.default.toBase58()]=i[ee.toBase58()],i}import nt from"bn.js";var At=9e15,ut=1e9,On="0123456789abcdef",sn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",an="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",En={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-At,maxE:At,crypto:!1},Bi,tt,q=!0,un="[DecimalError] ",ct=un+"Invalid argument: ",xi=un+"Precision limit exceeded",Ii=un+"crypto unavailable",Si="[object Decimal]",Se=Math.floor,we=Math.pow,Er=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Fr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Dr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ci=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ue=1e7,_=7,_r=9007199254740991,vr=sn.length-1,Fn=an.length-1,x={toStringTag:Si};x.absoluteValue=x.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),F(r)};x.ceil=function(){return F(new this.constructor(this),this.e+1,2)};x.clampedTo=x.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(ct+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};x.comparedTo=x.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,c=o.s,u=r.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==r.e)return o.e>r.e^c<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===i?0:n>i^c<0?1:-1};x.cosine=x.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+_,n.rounding=1,t=Wr(n,Mi(n,t)),n.precision=r,n.rounding=e,F(tt==2||tt==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};x.cubeRoot=x.cbrt=function(){var r,e,t,n,i,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(q=!1,o=l.s*we(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Te(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=we(t,1/3),r=Se((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=oe(u.plus(l).times(a),u.plus(c),s+2,1),Te(a.d).slice(0,s)===(t=Te(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(F(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return q=!0,F(n,r,m.rounding,e)};x.decimalPlaces=x.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Se(this.e/_))*_,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};x.dividedBy=x.div=function(r){return oe(this,new this.constructor(r))};x.dividedToIntegerBy=x.divToInt=function(r){var e=this,t=e.constructor;return F(oe(e,new t(r),0,1,1),t.precision,t.rounding)};x.equals=x.eq=function(r){return this.cmp(r)===0};x.floor=function(){return F(new this.constructor(this),this.e+1,3)};x.greaterThan=x.gt=function(r){return this.cmp(r)>0};x.greaterThanOrEqualTo=x.gte=function(r){var e=this.cmp(r);return e==1||e===0};x.hyperbolicCosine=x.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/mn(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Tt(s,1,o.times(e),new s(1),!0);for(var c,u=r,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};x.hyperbolicSine=x.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Tt(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/mn(5,r)),i=Tt(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,F(i,e,t,!0)};x.hyperbolicTangent=x.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,oe(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};x.inverseCosine=x.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ve(t,i,o):new t(0):new t(NaN):e.isZero()?Ve(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=Ve(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};x.inverseHyperbolicCosine=x.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,q=!1,t=t.times(t).minus(1).sqrt().plus(t),q=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};x.inverseHyperbolicSine=x.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,q=!1,t=t.times(t).plus(1).sqrt().plus(t),q=!0,n.precision=r,n.rounding=e,t.ln())};x.inverseHyperbolicTangent=x.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?F(new o(i),r,e,!0):(o.precision=t=n-i.e,i=oe(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};x.inverseSine=x.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=Ve(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};x.inverseTangent=x.atan=function(){var r,e,t,n,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Fn)return s=Ve(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Fn)return s=Ve(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/_+2|0),r=t;r;--r)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(q=!1,e=Math.ceil(a/_),n=1,c=u.times(u),s=new l(u),i=u;r!==-1;)if(i=i.times(c),o=s.minus(i.div(n+=2)),i=i.times(c),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),q=!0,F(s,l.precision=m,l.rounding=d,!0)};x.isFinite=function(){return!!this.d};x.isInteger=x.isInt=function(){return!!this.d&&Se(this.e/_)>this.d.length-2};x.isNaN=function(){return!this.s};x.isNegative=x.isNeg=function(){return this.s<0};x.isPositive=x.isPos=function(){return this.s>0};x.isZero=function(){return!!this.d&&this.d[0]===0};x.lessThan=x.lt=function(r){return this.cmp(r)<0};x.lessThanOrEqualTo=x.lte=function(r){return this.cmp(r)<1};x.logarithm=x.log=function(r){var e,t,n,i,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,f=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(q=!1,a=m+f,s=at(u,a),n=e?cn(l,a+10):at(r,a),c=oe(s,n,a,1),Ct(c.d,i=m,d))do if(a+=10,s=at(u,a),n=e?cn(l,a+10):at(r,a),c=oe(s,n,a,1),!o){+Te(c.d).slice(i+1,i+15)+1==1e14&&(c=F(c,m+1,0));break}while(Ct(c.d,i+=10,d));return q=!0,F(c,m,d)};x.minus=x.sub=function(r){var e,t,n,i,o,s,a,c,u,l,m,d,f=this,p=f.constructor;if(r=new p(r),!f.d||!r.d)return!f.s||!r.s?r=new p(NaN):f.d?r.s=-r.s:r=new p(r.d||f.s!==r.s?f:NaN),r;if(f.s!=r.s)return r.s=-r.s,f.plus(r);if(u=f.d,d=r.d,a=p.precision,c=p.rounding,!u[0]||!d[0]){if(d[0])r.s=-r.s;else if(u[0])r=new p(f);else return new p(c===3?-0:0);return q?F(r,a,c):r}if(t=Se(r.e/_),l=Se(f.e/_),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/_),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,r.s=-r.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(i=n;i&&u[--i]===0;)u[i]=Ue-1;--u[i],u[n]+=Ue}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(r.d=u,r.e=ln(u,t),q?F(r,a,c):r):new p(c===3?-0:0)};x.modulo=x.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(q=!1,n.modulo==9?(e=oe(t,r.abs(),0,3,1),e.s*=r.s):e=oe(t,r,0,n.modulo,1),e=e.times(r),q=!0,t.minus(e))};x.naturalExponential=x.exp=function(){return Dn(this)};x.naturalLogarithm=x.ln=function(){return at(this)};x.negated=x.neg=function(){var r=new this.constructor(this);return r.s=-r.s,F(r)};x.plus=x.add=function(r){var e,t,n,i,o,s,a,c,u,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(u=m.d,l=r.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(r=new d(m)),q?F(r,a,c):r;if(o=Se(m.e/_),n=Se(r.e/_),u=u.slice(),i=o-n,i){for(i<0?(t=u,i=-i,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/_),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,t=l,l=u,u=t),e=0;i;)e=(u[--i]=u[i]+l[i]+e)/Ue|0,u[i]%=Ue;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return r.d=u,r.e=ln(u,n),q?F(r,a,c):r};x.precision=x.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(ct+r);return t.d?(e=Ki(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};x.round=function(){var r=this,e=r.constructor;return F(new e(r),r.e+1,e.rounding)};x.sine=x.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+_,n.rounding=1,t=Vr(n,Mi(n,t)),n.precision=r,n.rounding=e,F(tt>2?t.neg():t,r,e,!0)):new n(NaN)};x.squareRoot=x.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(q=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Te(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Se((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(oe(s,o,t+2,1)).times(.5),Te(o.d).slice(0,t)===(e=Te(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(F(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,c+1,1),r=!n.times(n).eq(s));break}return q=!0,F(n,c,l.rounding,r)};x.tangent=x.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=oe(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,F(tt==2||tt==4?t.neg():t,r,e,!0)):new n(NaN)};x.times=x.mul=function(r){var e,t,n,i,o,s,a,c,u,l=this,m=l.constructor,d=l.d,f=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!r.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?r.s/0:r.s*0);for(t=Se(l.e/_)+Se(r.e/_),c=d.length,u=f.length,c<u&&(o=d,d=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,i=c+n;i>n;)a=o[i]+f[n]*d[i-n-1]+e,o[i--]=a%Ue|0,e=a/Ue|0;o[i]=(o[i]+e)%Ue|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=ln(o,t),q?F(r,m.precision,m.rounding):r};x.toBinary=function(r,e){return vn(this,2,r,e)};x.toDecimalPlaces=x.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(Oe(r,0,ut),e===void 0?e=n.rounding:Oe(e,0,8),F(t,r+t.e+1,e))};x.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=ze(n,!0):(Oe(r,0,ut),e===void 0?e=i.rounding:Oe(e,0,8),n=F(new i(n),r+1,e),t=ze(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=ze(i):(Oe(r,0,ut),e===void 0?e=o.rounding:Oe(e,0,8),n=F(new o(i),r+i.e+1,e),t=ze(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};x.toFraction=function(r){var e,t,n,i,o,s,a,c,u,l,m,d,f=this,p=f.d,b=f.constructor;if(!p)return new b(f);if(u=t=new b(1),n=c=new b(0),e=new b(n),o=e.e=Ki(p)-f.e-1,s=o%_,e.d[0]=we(10,s<0?_+s:s),r==null)r=o>0?e:u;else{if(a=new b(r),!a.isInt()||a.lt(u))throw Error(ct+a);r=a.gt(e)?o>0?e:u:a}for(q=!1,a=new b(Te(p)),l=b.precision,b.precision=o=p.length*_*2;m=oe(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=u,u=c.plus(m.times(i)),c=i,i=e,e=a.minus(m.times(i)),a=i;return i=oe(r.minus(t),n,0,1,1),c=c.plus(i.times(u)),t=t.plus(i.times(n)),c.s=u.s=f.s,d=oe(u,n,o,1).minus(f).abs().cmp(oe(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],b.precision=l,q=!0,d};x.toHexadecimal=x.toHex=function(r,e){return vn(this,16,r,e)};x.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:Oe(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(q=!1,t=oe(t,r,0,e,1).times(r),q=!0,F(t)):(r.s=t.s,t=r),t};x.toNumber=function(){return+this};x.toOctal=function(r,e){return vn(this,8,r,e)};x.toPower=x.pow=function(r){var e,t,n,i,o,s,a=this,c=a.constructor,u=+(r=new c(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new c(we(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,r.eq(1))return F(a,n,o);if(e=Se(r.e/_),e>=r.d.length-1&&(t=u<0?-u:u)<=_r)return i=Ni(c,a,t,n),r.s<0?new c(1).div(i):F(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new c(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=we(+a,u),e=t==0||!isFinite(t)?Se(u*(Math.log("0."+Te(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(q=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),i=Dn(r.times(at(a,n+t)),n),i.d&&(i=F(i,n+5,1),Ct(i.d,n,o)&&(e=n+10,i=F(Dn(r.times(at(a,e+t)),e),e+5,1),+Te(i.d).slice(n+1,n+15)+1==1e14&&(i=F(i,n+1,0)))),i.s=s,q=!0,c.rounding=o,F(i,n,o))};x.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=ze(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(Oe(r,1,ut),e===void 0?e=i.rounding:Oe(e,0,8),n=F(new i(n),r,e),t=ze(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toSignificantDigits=x.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(Oe(r,1,ut),e===void 0?e=n.rounding:Oe(e,0,8)),F(new n(t),r,e)};x.toString=function(){var r=this,e=r.constructor,t=ze(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};x.truncated=x.trunc=function(){return F(new this.constructor(this),this.e+1,1)};x.valueOf=x.toJSON=function(){var r=this,e=r.constructor,t=ze(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function Te(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=_-n.length,t&&(o+=st(t)),o+=n;s=r[e],n=s+"",t=_-n.length,t&&(o+=st(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Oe(r,e,t){if(r!==~~r||r<e||r>t)throw Error(ct+r)}function Ct(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=_,i=0):(i=Math.ceil((e+1)/_),e%=_),o=we(10,_-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==we(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==we(10,e-3)-1,s}function on(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=On.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function Wr(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/mn(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Tt(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var oe=function(){function r(n,i,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*i+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=i[a]){c=n[a]>i[a]?1:-1;break}return c}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,c){var u,l,m,d,f,p,b,y,g,w,k,P,A,h,T,B,K,C,S,M,O=n.constructor,V=n.s==i.s?1:-1,Z=n.d,z=i.d;if(!Z||!Z[0]||!z||!z[0])return new O(!n.s||!i.s||(Z?z&&Z[0]==z[0]:!z)?NaN:Z&&Z[0]==0||!z?V*0:V/0);for(c?(f=1,l=n.e-i.e):(c=Ue,f=_,l=Se(n.e/f)-Se(i.e/f)),S=z.length,K=Z.length,g=new O(V),w=g.d=[],m=0;z[m]==(Z[m]||0);m++);if(z[m]>(Z[m]||0)&&l--,o==null?(h=o=O.precision,s=O.rounding):a?h=o+(n.e-i.e)+1:h=o,h<0)w.push(1),p=!0;else{if(h=h/f+2|0,m=0,S==1){for(d=0,z=z[0],h++;(m<K||d)&&h--;m++)T=d*c+(Z[m]||0),w[m]=T/z|0,d=T%z|0;p=d||m<K}else{for(d=c/(z[0]+1)|0,d>1&&(z=r(z,d,c),Z=r(Z,d,c),S=z.length,K=Z.length),B=S,k=Z.slice(0,S),P=k.length;P<S;)k[P++]=0;M=z.slice(),M.unshift(0),C=z[0],z[1]>=c/2&&++C;do d=0,u=e(z,k,S,P),u<0?(A=k[0],S!=P&&(A=A*c+(k[1]||0)),d=A/C|0,d>1?(d>=c&&(d=c-1),b=r(z,d,c),y=b.length,P=k.length,u=e(b,k,y,P),u==1&&(d--,t(b,S<y?M:z,y,c))):(d==0&&(u=d=1),b=z.slice()),y=b.length,y<P&&b.unshift(0),t(k,b,P,c),u==-1&&(P=k.length,u=e(z,k,S,P),u<1&&(d++,t(k,S<P?M:z,P,c))),P=k.length):u===0&&(d++,k=[0]),w[m++]=d,u&&k[0]?k[P++]=Z[B]||0:(k=[Z[B]],P=1);while((B++<K||k[0]!==void 0)&&h--);p=k[0]!==void 0}w[0]||w.shift()}if(f==1)g.e=l,Bi=p;else{for(m=1,d=w[0];d>=10;d/=10)m++;g.e=m+l*f-1,F(g,a?o+g.e+1:o,s,p)}return g}}();function F(r,e,t,n){var i,o,s,a,c,u,l,m,d,f=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=_,s=e,l=m[d=0],c=l/we(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/_),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,i=1,o%=_,s=o-_+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=_,s=o-_+i,c=s<0?0:l/we(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%we(10,i-s-1)),u=t<4?(c||n)&&(t==0||t==(r.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/we(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=r.e+1,m[0]=we(10,(_-e%_)%_),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=we(10,_-o),m[d]=s>0?(l/we(10,i-s)%we(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Ue&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ue)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return q&&(r.e>f.maxE?(r.d=null,r.e=NaN):r.e<f.minE&&(r.e=0,r.d=[0])),r}function ze(r,e,t){if(!r.isFinite())return Ri(r);var n,i=r.e,o=Te(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+st(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+st(-i-1)+o,t&&(n=t-s)>0&&(o+=st(n))):i>=s?(o+=st(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+st(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=st(n))),o}function ln(r,e){var t=r[0];for(e*=_;t>=10;t/=10)e++;return e}function cn(r,e,t){if(e>vr)throw q=!0,t&&(r.precision=t),Error(xi);return F(new r(sn),e,1,!0)}function Ve(r,e,t){if(e>Fn)throw Error(xi);return F(new r(an),e,t,!0)}function Ki(r){var e=r.length-1,t=e*_+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function st(r){for(var e="";r--;)e+="0";return e}function Ni(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/_+4);for(q=!1;;){if(t%2&&(o=o.times(e),Ai(o.d,s)&&(i=!0)),t=Se(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Ai(e.d,s)}return q=!0,o}function Pi(r){return r.d[r.d.length-1]&1}function Li(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function Dn(r,e){var t,n,i,o,s,a,c,u=0,l=0,m=0,d=r.constructor,f=d.rounding,p=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(q=!1,c=p):c=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(we(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=F(o.times(r),c,1),t=t.times(++l),a=s.plus(oe(o,t,c,1)),Te(a.d).slice(0,c)===Te(s.d).slice(0,c)){for(i=m;i--;)s=F(s.times(s),c,1);if(e==null)if(u<3&&Ct(s.d,c-n,f,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return F(s,d.precision=p,f,q=!0);else return d.precision=p,s}s=a}}function at(r,e){var t,n,i,o,s,a,c,u,l,m,d,f=1,p=10,b=r,y=b.d,g=b.constructor,w=g.rounding,k=g.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(q=!1,l=k):l=e,g.precision=l+=p,t=Te(y),n=t.charAt(0),Math.abs(o=b.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)b=b.times(r),t=Te(b.d),n=t.charAt(0),f++;o=b.e,n>1?(b=new g("0."+t),o++):b=new g(n+"."+t.slice(1))}else return u=cn(g,l+2,k).times(o+""),b=at(new g(n+"."+t.slice(1)),l-p).plus(u),g.precision=k,e==null?F(b,k,w,q=!0):b;for(m=b,c=s=b=oe(b.minus(1),b.plus(1),l,1),d=F(b.times(b),l,1),i=3;;){if(s=F(s.times(d),l,1),u=c.plus(oe(s,new g(i),l,1)),Te(u.d).slice(0,l)===Te(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(cn(g,l+2,k).times(o+""))),c=oe(c,new g(f),l,1),e==null)if(Ct(c.d,l-p,w,a))g.precision=l+=p,u=s=b=oe(m.minus(1),m.plus(1),l,1),d=F(b.times(b),l,1),i=a=1;else return F(c,g.precision=k,w,q=!0);else return g.precision=k,c;c=u,i+=2}}function Ri(r){return String(r.s*r.s/0)}function _n(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%_,t<0&&(n+=_),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=_;n<i;)r.d.push(+e.slice(n,n+=_));e=e.slice(n),n=_-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),q&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function qr(r,e){var t,n,i,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Ci.test(e))return _n(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(Fr.test(e))t=16,e=e.toLowerCase();else if(Er.test(e))t=2;else if(Dr.test(e))t=8;else throw Error(ct+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Ni(n,new n(t),o,o*2)),u=on(e,t,Ue),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(r.s*0):(r.e=ln(u,l),r.d=u,q=!1,s&&(r=oe(r,i,a*4)),c&&(r=r.times(Math.abs(c)<54?we(2,c):Kt.pow(2,c))),q=!0,r)}function Vr(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Tt(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/mn(5,t)),e=Tt(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Tt(r,e,t,n,i){var o,s,a,c,u=1,l=r.precision,m=Math.ceil(l/_);for(q=!1,c=t.times(t),a=new r(n);;){if(s=oe(a.times(c),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=oe(s.times(c),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return q=!0,s.d.length=m+1,s}function mn(r,e){for(var t=r;--e;)t*=r;return t}function Mi(r,e){var t,n=e.s<0,i=Ve(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return tt=n?4:1,e;if(t=e.divToInt(i),t.isZero())tt=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return tt=Pi(t)?n?2:3:n?4:1,e;tt=Pi(t)?n?1:4:n?3:2}return e.minus(i).abs()}function vn(r,e,t,n){var i,o,s,a,c,u,l,m,d,f=r.constructor,p=t!==void 0;if(p?(Oe(t,1,ut),n===void 0?n=f.rounding:Oe(n,0,8)):(t=f.precision,n=f.rounding),!r.isFinite())l=Ri(r);else{for(l=ze(r),s=l.indexOf("."),p?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=on(ze(d),10,i),d.e=d.d.length),m=on(l,10,i),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=p?"0p+0":"0";else{if(s<0?o--:(r=new f(r),r.d=m,r.e=o,r=oe(r,d,t,n,0,i),m=r.d,o=r.e,u=Bi),s=m[t],a=i/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,u)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=On.charAt(m[s]);if(p){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=on(l,i,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=On.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function Ai(r,e){if(r.length>e)return r.length=e,!0}function Ur(r){return new this(r).abs()}function Gr(r){return new this(r).acos()}function Xr(r){return new this(r).acosh()}function Hr(r,e){return new this(r).plus(e)}function zr(r){return new this(r).asin()}function Zr(r){return new this(r).asinh()}function jr(r){return new this(r).atan()}function Qr(r){return new this(r).atanh()}function Yr(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=Ve(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?Ve(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=Ve(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(oe(r,e,o,1)),e=Ve(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(oe(r,e,o,1)),t}function Jr(r){return new this(r).cbrt()}function $r(r){return F(r=new this(r),r.e+1,2)}function eo(r,e,t){return new this(r).clamp(e,t)}function to(r){if(!r||typeof r!="object")throw Error(un+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,ut,"rounding",0,8,"toExpNeg",-At,0,"toExpPos",0,At,"maxE",0,At,"minE",-At,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=En[t]),(n=r[t])!==void 0)if(Se(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ct+t+": "+n);if(t="crypto",i&&(this[t]=En[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Ii);else this[t]=!1;else throw Error(ct+t+": "+n);return this}function no(r){return new this(r).cos()}function io(r){return new this(r).cosh()}function Oi(r){var e,t,n;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Ti(o)){u.s=o.s,q?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;q?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return _n(u,o.toString())}else if(c!=="string")throw Error(ct+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Ci.test(o)?_n(u,o):qr(u,o)}if(i.prototype=x,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=to,i.clone=Oi,i.isDecimal=Ti,i.abs=Ur,i.acos=Gr,i.acosh=Xr,i.add=Hr,i.asin=zr,i.asinh=Zr,i.atan=jr,i.atanh=Qr,i.atan2=Yr,i.cbrt=Jr,i.ceil=$r,i.clamp=eo,i.cos=no,i.cosh=io,i.div=ro,i.exp=oo,i.floor=so,i.hypot=ao,i.ln=co,i.log=uo,i.log10=mo,i.log2=lo,i.max=fo,i.min=po,i.mod=bo,i.mul=go,i.pow=yo,i.random=wo,i.round=ho,i.sign=ko,i.sin=Po,i.sinh=Ao,i.sqrt=To,i.sub=Bo,i.sum=xo,i.tan=Io,i.tanh=So,i.trunc=Co,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function ro(r,e){return new this(r).div(e)}function oo(r){return new this(r).exp()}function so(r){return F(r=new this(r),r.e+1,3)}function ao(){var r,e,t=new this(0);for(q=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return q=!0,new this(1/0);t=e}return q=!0,t.sqrt()}function Ti(r){return r instanceof Kt||r&&r.toStringTag===Si||!1}function co(r){return new this(r).ln()}function uo(r,e){return new this(r).log(e)}function lo(r){return new this(r).log(2)}function mo(r){return new this(r).log(10)}function fo(){return Li(this,arguments,"lt")}function po(){return Li(this,arguments,"gt")}function bo(r,e){return new this(r).mod(e)}function go(r,e){return new this(r).mul(e)}function yo(r,e){return new this(r).pow(e)}function wo(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:Oe(r,1,ut),n=Math.ceil(r/_),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Ii);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=_,n&&r&&(i=we(10,_-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=_)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<_&&(t-=_-n)}return s.e=t,s.d=a,s}function ho(r){return F(r=new this(r),r.e+1,this.rounding)}function ko(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function Po(r){return new this(r).sin()}function Ao(r){return new this(r).sinh()}function To(r){return new this(r).sqrt()}function Bo(r,e){return new this(r).sub(e)}function xo(){var r=0,e=arguments,t=new this(e[r]);for(q=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return q=!0,F(t,this.precision,this.rounding)}function Io(r){return new this(r).tan()}function So(r){return new this(r).tanh()}function Co(r){return F(r=new this(r),r.e+1,1)}x[Symbol.for("nodejs.util.inspect.custom")]=x.toString;x[Symbol.toStringTag]="Decimal";var Kt=x.constructor=Oi(En);sn=new Kt(sn);an=new Kt(an);var N=Kt;import Fo from"big.js";import pn from"bn.js";import Ko from"toformat";var No=Ko,Nt=No;import fn from"big.js";import Ro from"bn.js";import Mo from"decimal.js-light";import Lt from"bn.js";var Ei=9007199254740991;function ke(r){let e=Ae("CobaltX_parseBigNumberish");if(r instanceof Lt)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new Lt(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Ei||r<=-Ei)&&e.logWithError(`BigNumberish number overflow: ${r}`),new Lt(String(r))):typeof r=="bigint"?new Lt(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new Lt(0))}var dn=Ae("module/fraction"),Wn=Nt(fn),Rt=Nt(Mo),Oo={[0]:Rt.ROUND_DOWN,[1]:Rt.ROUND_HALF_UP,[2]:Rt.ROUND_UP},Eo={[0]:fn.roundDown,[1]:fn.roundHalfUp,[2]:fn.roundUp},te=class{constructor(e,t=new Ro(1)){this.numerator=ke(e),this.denominator=ke(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new te(this.denominator,this.numerator)}add(e){let t=e instanceof te?e:new te(ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.add(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof te?e:new te(ke(e));return this.denominator.eq(t.denominator)?new te(this.numerator.sub(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof te?e:new te(ke(e));return new te(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof te?e:new te(ke(e));return new te(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||dn.logWithError(`${e} is not an integer.`),e<=0&&dn.logWithError(`${e} is not positive.`),Rt.set({precision:e+1,rounding:Oo[n]});let i=new Rt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||dn.logWithError(`${e} is not an integer.`),e<0&&dn.logWithError(`${e} is negative.`),Wn.DP=e,Wn.RM=Eo[n]||1,new Wn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Do=Ae("CobaltX_amount"),Fi=Nt(Fo);function _o(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):Do.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var Be=class extends te{constructor(t,n,i=!0,o){let s=new pn(0),a=qn.pow(new pn(t.decimals));if(i)s=ke(n);else{let c=new pn(0),u=new pn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=_o(n.toString(),t.decimals);c=ke(l),u=ke(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Fi.DP=this.token.decimals,new Fi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{TOKEN_PROGRAM_ID as Di}from"@solana/spl-token";import{PublicKey as vo}from"@solana/web3.js";var Vn={chainId:101,address:vo.default.toBase58(),programId:Di.toBase58(),decimals:9,symbol:"ETH",name:"Ethereum",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}},lt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Di.toBase58(),decimals:9,symbol:"WETH",name:"Wrapped ETH",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}};import{PublicKey as Hn}from"@solana/web3.js";import{PublicKey as xe,SystemProgram as _i,SYSVAR_RENT_PUBKEY as Wo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qo}from"@solana/spl-token";function Un({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var ha=[Un({pubkey:qo,isWritable:!1}),Un({pubkey:_i.programId,isWritable:!1}),Un({pubkey:Wo,isWritable:!1})];function Gn({publicKey:r,transformSol:e}){let t=vi(r.toString());if(t instanceof xe)return e&&t.equals(Mt)?ee:t;if(e&&t.toString()===Mt.toBase58())return ee;if(typeof t=="string"){if(t===xe.default.toBase58())return xe.default;try{return new xe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function vi(r){try{return new xe(r)}catch{return r}}var bn=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Xn=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),mt=new xe("SysvarRent111111111111111111111111111111111"),ka=new xe("SysvarC1ock11111111111111111111111111111111"),bt=new xe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Pa=new xe("Sysvar1nstructions1111111111111111111111111"),Aa=_i.programId,Ta=new xe("a2Gt18uJC8puJT9JRYQLU6rPi6okxQb4WqCjwtYshZB"),Ba=new xe("bXSKiFqYrALF9gJy1KqHm8tv4QXk8nCgbLN8WRsGEbh"),ee=new xe("So11111111111111111111111111111111111111112"),Mt=xe.default,xa=new xe("71kRXzJMvSeArtXYNEWa8KAjpRJosdMQ7Dpgy5Jt5zfd"),Ia=new xe("ERFzpDteGNo8LTDKW1WwVGrkRMmA2y9WZHXNHxMA6BSV");function pt(r){return Gn({publicKey:r,transformSol:!0})}var zn=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===Mt.toBase58()||e instanceof Hn&&Mt.equals(e)){this.decimals=lt.decimals,this.symbol=lt.symbol,this.name=lt.name,this.mint=new Hn(lt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Hn.default:Gn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ze=zn;Ze.WSOL=new zn(j(E({},lt),{mint:lt.address}));var Zn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},gn=Zn;gn.SOL=new Zn(Vn);import Vo from"bn.js";var Wi=new te(new Vo(100)),dt=class extends te{toSignificant(e=5,t,n){return this.mul(Wi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Wi).toFixed(e,t,n)}};var Uo=Ae("CobaltX_price"),Ge=class extends te{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new te(jn(n.decimals),jn(i.decimals))}get raw(){return new te(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ge({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Uo.logWithError("mul token not equals");let n=super.mul(t);return new Ge({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as rc}from"@solana/web3.js";import sc from"bn.js";var Go=new nt(0),Bc=new nt(1),xc=new nt(2),Ic=new nt(3),Sc=new nt(5),qn=new nt(10),Cc=new nt(100),Kc=new nt(1e3),Nc=new nt(1e4);function jn(r){return qn.pow(ke(r))}function Mn(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jo}from"@solana/spl-token";import{ComputeBudgetProgram as qi,Keypair as Ui,PublicKey as Xo,Transaction as Gi,TransactionMessage as Ho,VersionedTransaction as Xi}from"@solana/web3.js";var de={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as zo}from"@solana/spl-token";var Vi=Ae("CobaltX_txUtil"),Hi=1644;function yn(r){let e=[],t=[];return r.microLamports&&(e.push(qi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(de.SetComputeUnitPrice)),r.units&&(e.push(qi.setComputeUnitLimit({units:r.units})),t.push(de.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Bt(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function wn(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Zo(r,e){r.length<1&&Vi.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Vi.logWithError(`no signers provided:, ${e.toString()}`);let t=new Gi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Hi}catch{return!1}}function Ne(r,e){let[t,n]=Xo.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function Ot({instructions:r,payer:e,signers:t}){return Zo(r,[e,...t])}function Et({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Ui.generate().publicKey.toString()}){let o=new Ho({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Xi(o).serialize()).toString("base64").length<Hi}catch{return!1}}var jo=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Qo=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Xi&&(e=jo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function gt(r){let e=[];return r.forEach(t=>{t instanceof Gi&&(t.recentBlockhash||(t.recentBlockhash=zo.toBase58()),t.feePayer||(t.feePayer=Ui.generate().publicKey)),e.push(Qo(t))}),console.log("simulate tx string:",e),e}function se(r,e,t){return Ne([r.toBuffer(),(t!=null?t:Jo).toBuffer(),e.toBuffer()],new Yo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as X}from"@solana/web3.js";var Yc=new X("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Jc=new X("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),$c=new X("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),eu=new X("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),tu=new X("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),nu=new X("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),iu=new X("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ru=new X("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),ou=new X("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),su=new X("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ft=new X("2TnjBuwqyBB9to5jURagDT7jLmBPefGRiKL2yh1zPZ4V"),Dt=new X("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),hn=new X("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),au=new X("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),cu=new X("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),uu=new X("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),lu=new X("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),mu=new X("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),du=new X("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),fu=new X("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),pu=new X("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),bu=new X("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$o=new X("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),es=new X("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ts=new X("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),gu=new X("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ns=new X("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),yu=new X("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),is=new X("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var wu={SERUM_MARKET:X.default,OPENBOOK_MARKET:new X("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:X.default,FarmV3:new X("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new X("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new X("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new X("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new X("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new X("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new X("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new X("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new X("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:$o,CREATE_CPMM_POOL_AUTH:es,CREATE_CPMM_POOL_FEE_ACC:ts,FEE_DESTINATION_ID:new X("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ns,LCOK_CPMM_AUTH:is};import Xe from"bn.js";var _t=1e4;function be(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=j(E({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new Xe(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===_t){let c=new Xe(o.maximumFee.toString());return{amount:r.add(c),fee:c,expirationTime:a}}else{let c=Qn(r.mul(new Xe(_t)),new Xe(_t-o.transferFeeBasisPoints)),u=new Xe(o.maximumFee.toString()),l=c.sub(r).gt(u)?r.add(u):c,m=Qn(l.mul(new Xe(o.transferFeeBasisPoints)),new Xe(_t)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Qn(r.mul(new Xe(o.transferFeeBasisPoints)),new Xe(_t)),u=c.gt(s)?s:c;return{amount:r,fee:u,expirationTime:a}}}function ft(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function Qn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new Xe(0))?t.add(new Xe(1)):t}import{PublicKey as zi,AddressLookupTableAccount as kn}from"@solana/web3.js";async function Yn({connection:r,address:e}){let t=await $e(r,[...new Set(e.map(i=>i.toString()))].map(i=>new zi(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new kn({key:s,state:kn.deserialize(o.data)});n[s.toString()]=a,Pn[s.toString()]=a}return n}var Pn={AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM:new kn({key:new zi("AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM"),state:kn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as vt,sendAndConfirmTransaction as Jn,Transaction as Wt,TransactionMessage as qt,VersionedTransaction as Vt}from"@solana/web3.js";import os from"axios";var An=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await os.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=yn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==vt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(E({},t||{})):this.build(t)}build(e){var n;let t=new Wt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},c=o!=null?o:await Bt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),gt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await Jn(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var g;let{sequentially:m,onTxUpdate:d,skipTxCount:f=0,recentBlockHash:p,skipPreflight:b=!0}=l||{},y=p!=null?p:await Bt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(m){let w=[],k=0;for(let P of s){if(++k,k<=f)continue;let A=await Jn(this.connection,P,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});w.push(A)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=y,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((P,A)=>(P.recentBlockhash=y,a[A].length&&P.sign(...a[A]),P));gt(w);let k=await this.signAllTransactions(w);if(m){let P=0,A=[],h=async()=>{if(!k[P])return;let T=await this.connection.sendRawTransaction(k[P].serialize(),{skipPreflight:b});A.push({txId:T,status:"sent",signedTx:k[P]}),d==null||d([...A]),P++,this.connection.onSignature(T,B=>{let K=A.findIndex(C=>C.txId===T);K>-1&&(A[K].status=B.err?"error":"success"),d==null||d([...A]),B.err||h()},"processed"),this.connection.getSignatureStatus(T)};return await h(),{txIds:A.map(T=>T.txId),signedTxs:k}}else{let P=[];for(let A=0;A<k.length;A+=1){let h=await this.connection.sendRawTransaction(k[A].serialize(),{skipPreflight:b});P.push(h)}return{txIds:P,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var b;let p=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=p,s=Pt(p,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=E(E({},this.cluster==="devnet"?{}:Pn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new vt(y));let l=await Yn({connection:this.connection,address:u});for(let[y,g]of Object.entries(l))a[y]=g;let m=i?vt.default.toBase58():o!=null?o:await Bt(this.connection,this.blockhashCommitment),d=new qt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message();((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let f=new Vt(d);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var k;let{skipPreflight:g=!0,sendAndConfirm:w}=y||{};if(gt([f]),(k=this.owner)!=null&&k.isKeyPair){let P=await this.connection.sendTransaction(f,{skipPreflight:g});return w&&await wn(this.connection,P),{txId:P,signedTx:f}}if(this.signAllTransactions){let P=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(P[0],{skipPreflight:g}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:p=!0}=l||{};if(f&&s.forEach(y=>y.message.recentBlockhash=f),gt(s),(b=this.owner)!=null&&b.isKeyPair){if(m){let y=[];for(let g of s){let w=await this.connection.sendTransaction(g,{skipPreflight:p});await wn(this.connection,w),y.push(w)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let g=0,w=[],k=async()=>{if(!y[g])return;let P=await this.connection.sendTransaction(y[g],{skipPreflight:p});w.push({txId:P,status:"sent",signedTx:y[g]}),d==null||d([...w]),g++,this.connection.onSignature(P,A=>{let h=w.findIndex(T=>T.txId===P);h>-1&&(w[h].status=A.err?"error":"success"),d==null||d([...w]),A.err||k()},"processed"),this.connection.getSignatureStatus(P)};return k(),{txIds:[],signedTxs:y}}else{let g=[];for(let w=0;w<y.length;w+=1){let k=await this.connection.sendTransaction(y[w],{skipPreflight:p});g.push(k)}return{txIds:g,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:n}=m,i=Pt(m,["splitIns","computeBudgetConfig"]),o=n?yn(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((f,p)=>j(E({},f),{[p.publicKey.toBase58()]:p}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(f=>{let p=[...u,f],b=n?[...o.instructions,...p]:p,g=[...new Set(p.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat()).values()].map(w=>new vt(w));if(f!==t[l]&&u.length<12&&(Ot({instructions:b,payer:this.feePayer,signers:g})||Ot({instructions:p,payer:this.feePayer,signers:g})))u.push(f);else{if(u.length===0)throw Error("item ins too big");l+=f===t[l]?1:0,Ot({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:g})?a.push(new Wt().add(...o.instructions,...u)):a.push(new Wt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[f]}}),u.length>0){let p=[...new Set(u.map(b=>b.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(b=>s[b]).filter(b=>b!==void 0);Ot({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:p.map(b=>b.publicKey)})?a.push(new Wt().add(...o.instructions,...u)):a.push(new Wt().add(...u)),c.push(p)}return a.forEach(f=>f.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(f=>{f.some(p=>p.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async f=>{var P;let{sequentially:p,onTxUpdate:b,skipTxCount:y=0,recentBlockHash:g,skipPreflight:w=!0}=f||{},k=g!=null?g:await Bt(this.connection,this.blockhashCommitment);if(a.forEach(async(A,h)=>{A.recentBlockhash=k,c[h].length&&A.sign(...c[h])}),gt(a),(P=this.owner)!=null&&P.isKeyPair){if(p){let A=0,h=[];for(let T of a){if(++A,A<=y){h.push("tx skipped");continue}let B=await Jn(this.connection,T,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});h.push(B)}return{txIds:h,signedTxs:a}}return{txIds:await Promise.all(a.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let A=await this.signAllTransactions(a.slice(y,a.length)),h=[...a.slice(0,y),...A];if(p){let T=0,B=[],K=async()=>{if(!h[T])return;T<y&&(B.push({txId:"",status:"success",signedTx:h[T]}),b==null||b([...B]),T++,K());let C=await this.connection.sendRawTransaction(h[T].serialize(),{skipPreflight:w});B.push({txId:C,status:"sent",signedTx:h[T]}),b==null||b([...B]),T++,this.connection.onSignature(C,S=>{let M=B.findIndex(O=>O.txId===C);M>-1&&(B[M].status=S.err?"error":"success"),b==null||b([...B]),S.err||K()},"processed"),this.connection.getSignatureStatus(C)};return await K(),{txIds:B.map(C=>C.txId),signedTxs:h}}else{let T=[];for(let B=0;B<h.length;B+=1){let K=await this.connection.sendRawTransaction(h[B].serialize(),{skipPreflight:w});T.push(K)}return{txIds:T,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var k;let w=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:i={},lookupTableAddress:o=[]}=w,s=Pt(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=E(E({},this.cluster==="devnet"?{}:Pn),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let P of c)a[P]===void 0&&u.push(new vt(P));let l=await Yn({connection:this.connection,address:u});for(let[P,A]of Object.entries(l))a[P]=A;let m=t?yn(t):{instructions:[],instructionTypes:[]},d=await Bt(this.connection,this.blockhashCommitment),f=this.signers.reduce((P,A)=>j(E({},P),{[A.publicKey.toBase58()]:A}),{}),p=[],b=[],y=[],g=0;if(this.allInstructions.forEach(P=>{let A=[...y,P],h=t?[...m.instructions,...A]:A;if(P!==n[g]&&y.length<12&&(Et({instructions:h,payer:this.feePayer,lookupTableAddressAccount:a})||Et({instructions:A,payer:this.feePayer,lookupTableAddressAccount:a})))y.push(P);else{if(y.length===0)throw Error("item ins too big");g+=P===n[g]?1:0;let T={};for(let B of[...new Set(c)])a[B]!==void 0&&(T[B]=a[B]);if(t&&Et({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let B=new qt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));p.push(new Vt(B))}else{let B=new qt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));p.push(new Vt(B))}b.push(Array.from(new Set(y.map(B=>B.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(B=>f[B]).filter(B=>B!==void 0)),y=[P]}}),y.length>0){let A=[...new Set(y.map(h=>h.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(h=>f[h]).filter(h=>h!==void 0);if(t&&Et({instructions:[...m.instructions,...y],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let h=new qt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...y]}).compileToV0Message(Object.values(a));p.push(new Vt(h))}else{let h=new qt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...y]}).compileToV0Message(Object.values(a));p.push(new Vt(h))}b.push(A)}return(k=this.owner)!=null&&k.signer&&b.forEach(P=>{P.some(A=>A.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async P=>{var C;let{sequentially:A,onTxUpdate:h,skipTxCount:T=0,recentBlockHash:B,skipPreflight:K=!0}=P||{};if(p.map(async(S,M)=>{b[M].length&&S.sign(b[M]),B&&(S.message.recentBlockhash=B)}),gt(p),(C=this.owner)!=null&&C.isKeyPair){if(A){let S=0,M=[];for(let O of p){if(++S,S<=T){console.log("skip tx: ",S),M.push("tx skipped");continue}let V=await this.connection.sendTransaction(O,{skipPreflight:K});await wn(this.connection,V),M.push(V)}return{txIds:M,signedTxs:p}}return{txIds:await Promise.all(p.map(async S=>await this.connection.sendTransaction(S,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let S=await this.signAllTransactions(p.slice(T,p.length)),M=[...p.slice(0,T),...S];if(A){let O=0,V=[],Z=async()=>{if(!M[O])return;if(O<T){V.push({txId:"",status:"success",signedTx:M[O]}),h==null||h([...V]),O++,Z();return}let z=await this.connection.sendTransaction(M[O],{skipPreflight:K});V.push({txId:z,status:"sent",signedTx:M[O]}),h==null||h([...V]),O++,this.connection.onSignature(z,Fe=>{let kt=V.findIndex(Ke=>Ke.txId===z);kt>-1&&(V[kt].status=Fe.err?"error":"success"),h==null||h([...V]),Fe.err||Z()},"processed"),this.connection.getSignatureStatus(z)};return Z(),{txIds:[],signedTxs:M}}else{let O=[];for(let V=0;V<M.length;V+=1){let Z=await this.connection.sendTransaction(M[V],{skipPreflight:K});O.push(Z)}return{txIds:O,signedTxs:M}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{AccountLayout as Tr,TOKEN_2022_PROGRAM_ID as St,TOKEN_PROGRAM_ID as tn}from"@solana/spl-token";import{PublicKey as L}from"@solana/web3.js";import Ee from"bn.js";var $n=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ut=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new An({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug($n(e))}logInfo(...e){this.logger.info($n(e))}logAndCreateError(...e){let t=$n(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as al}from"@solana/web3.js";import{MintLayout as ul,TOKEN_PROGRAM_ID as ml}from"@solana/spl-token";var Tn=i=>{var o=i,{address:r,programId:e,decimals:t}=o,n=Pt(o,["address","programId","decimals"]);return E({chainId:101,address:pt(r).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},ei=r=>r?j(E({},r),{transferFeeConfigAuthority:r.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:r.withdrawWithheldAuthority.toBase58(),withheldAmount:r.withheldAmount.toString(),olderTransferFee:j(E({},r.olderTransferFee),{epoch:r.olderTransferFee.epoch.toString(),maximumFee:r.olderTransferFee.maximumFee.toString()}),newerTransferFee:j(E({},r.newerTransferFee),{epoch:r.newerTransferFee.epoch.toString(),maximumFee:r.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as ps}from"@solana/web3.js";import Yi,{isBN as Ji}from"bn.js";import{bits as wl,BitStructure as hl,blob as ss,Blob as kl,cstr as Pl,f32 as Al,f32be as Tl,f64 as Bl,f64be as xl,greedy as Il,Layout as as,ns64 as Sl,ns64be as Cl,nu64 as Kl,nu64be as Nl,offset as Ll,s16 as Rl,s16be as Ml,s24 as Ol,s24be as El,s32 as cs,s32be as Fl,s40 as Dl,s40be as _l,s48 as vl,s48be as Wl,s8 as ql,seq as us,struct as Vl,Structure as ls,u16 as ms,u16be as Ul,u24 as Gl,u24be as Xl,u32 as Hl,u32be as zl,u40 as Zl,u40be as jl,u48 as Ql,u48be as Yl,u8 as ds,UInt as fs,union as Jl,Union as $l,unionLayoutDiscriminator as em,utf8 as tm}from"@solana/buffer-layout";var ti=as,Zi=ls;var ni=fs;var ji=ds,Gt=ms;var ae=cs;var Qi=us;var De=ss;var xt=class extends ti{constructor(t,n,i){super(t,i);this.blob=De(t),this.signed=n}decode(t,n=0){let i=new Yi(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new Yi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}};function fe(r){return new ni(1,r)}function It(r){return new ni(4,r)}function D(r){return new xt(8,!1,r)}function Q(r){return new xt(16,!1,r)}function $i(r){return new xt(8,!0,r)}function er(r){return new xt(16,!0,r)}var Bn=class extends ti{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function re(r){return new Bn(De(32),e=>new ps(e),e=>e.toBuffer(),r)}function Le(r){return new Bn(ji(),bs,gs,r)}function bs(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function gs(r){return r?1:0}var ii=class extends Zi{decode(e,t){return super.decode(e,t)}};function ne(r,e,t){return new ii(r,e,t)}function le(r,e,t){let n,i=typeof e=="number"?e:Ji(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ji(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Qi(r,i,t)}import{ASSOCIATED_TOKEN_PROGRAM_ID as en,TOKEN_2022_PROGRAM_ID as pe,TOKEN_PROGRAM_ID as ie}from"@solana/spl-token";import{Keypair as Kn,PublicKey as I,SystemProgram as ot,TransactionInstruction as Ie}from"@solana/web3.js";import di from"bn.js";import Is from"bn.js";import qe from"bn.js";var ge=new qe(0),je=new qe(1),it=new qe(-1),_e=new qe(1).shln(64),xn=new qe(1).shln(128),ri=_e.sub(je),Xt=64,tr=xn.subn(1),Ce=-443636,Re=-Ce,Qe=new qe("4295048016"),Ye=new qe("79226673521066979257578248091"),bm=new qe("4295048017"),gm=new qe("79226673521066979257578248090"),nr=16,ir="59543866431248",rr="184467440737095516",or="15793534762490258745",In=new qe(10).pow(new qe(6));var sr={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},ym=new qe("18446744073700000000");import H from"bn.js";function Sn(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function oi(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function si(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function Ht(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function ar(r,e){return Ht(r,e)?null:oi(r,e)}function cr(r,e){return Ht(r,e)?null:si(r,e)}var Tm=Buffer.from("amm_config","utf8"),ys=Buffer.from("pool","utf8"),ws=Buffer.from("pool_vault","utf8"),hs=Buffer.from("pool_reward_vault","utf8"),ur=Buffer.from("position","utf8"),ks=Buffer.from("tick_array","utf8"),Ps=Buffer.from("operation","utf8"),As=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ts=Buffer.from("observation","utf8");function lr(r,e,t,n){return Ne([ys,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function ai(r,e,t){return Ne([ws,e.toBuffer(),t.toBuffer()],r)}function mr(r,e,t){return Ne([hs,e.toBuffer(),t.toBuffer()],r)}function Y(r,e,t){return Ne([ks,e.toBuffer(),Sn(t)],r)}function He(r,e,t,n){return Ne([ur,e.toBuffer(),Sn(t),Sn(n)],r)}function Me(r,e){return Ne([ur,e.toBuffer()],r)}function zt(r){return Ne([Buffer.from("metadata","utf8"),bt.toBuffer(),r.toBuffer()],bt)}function Zt(r){return Ne([Ps],r)}function ye(r,e){return Ne([As,e.toBuffer()],r)}function dr(r,e){return Ne([Ts,e.toBuffer()],r)}var fr=Buffer.from("locked_position","utf8");function ci(r,e){return Ne([fr,e.toBuffer()],r)}function jt(r,e){return Ne([fr,e.toBuffer()],r)}import{TOKEN_2022_PROGRAM_ID as pr}from"@solana/spl-token";import{PublicKey as ve}from"@solana/web3.js";import ce from"bn.js";import Je from"bn.js";var Qt=class{static getfeeGrowthInside(e,t,n){let i=new Je(0),o=new Je(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Je(0),a=new Je(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=W.wrappingSubU128(W.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),u=W.wrappingSubU128(W.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=W.mulDivFloor(W.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),c=t.tokenFeesOwedA.add(a),u=W.mulDivFloor(W.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=W.mulDivFloor(W.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),c=t.tokenFeesOwedA.add(a),u=W.mulDivFloor(W.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=W.wrappingSubU128(c,u.growthInsideLastX64),m=W.mulDivFloor(l,t.liquidity,_e),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=W.wrappingSubU128(c,u.growthInsideLastX64),m=W.mulDivFloor(l,t.liquidity,_e),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Je(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(W.wrappingSubU128(W.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new Je(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(W.wrappingSubU128(W.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var y,g,w,k;let a=v.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),c=v.getSqrtPriceX64FromTick(t.tickLower),u=v.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=$.getAmountsFromLiquidity(a,c,u,n,o),[d,f]=[be(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),be(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[p,b]=[be(new Je(new N(m.amountA.toString()).mul(l).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),be(new Je(new N(m.amountB.toString()).mul(l).toFixed(0)),(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:ft(d.expirationTime,f.expirationTime)}}};var Bs=15,J=class{static async getTickArrays(e,t,n,i,o,s,a){let c=[],u=R.getTickArrayStartIndexByTick(i,o),l=R.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Bs/2));for(let f=0;f<l.length;f++){let{publicKey:p}=Y(t,n,l[f]);c.push(p)}let m=(await $e(e,c)).map(f=>f!==null?Yt.decode(f.data):null),d={};for(let f=0;f<c.length;f++){let p=m[f];p!==null&&(d[p.startTickIndex]=j(E({},p),{address:c[f]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=R.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/J.tickCount(t)),a=n?R.searchLowBitFromStart(i,o,s-1,1,t):R.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=he-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<he;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=Y(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=R.getTickArrayStartIndexByTick(i,o),c=Math.floor((i-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<he;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=Y(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(R.checkIsOutOfBoundary(e)){if(e>Re)return!1;let n=R.getTickArrayStartIndexByTick(Ce,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return he*e}};var ui=14,rt=class{static maxTickInTickarrayBitmap(e){return e*he*yt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!J.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-J.tickCount(n):t+J.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*he,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(i){let l=e.shln(1024-u-1),m=ar(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=cr(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-J.tickCount(n)}}}},Jt=class{static getBitmapOffset(e,t){if(!J.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=rt.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=rt.maxTickInTickarrayBitmap(e),n=-t;if(Re<=t)throw Error(`extensionTickBoundary check error: ${Re}, ${t}`);if(n<=Ce)throw Error(`extensionTickBoundary check error: ${n}, ${Ce}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:R.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=J.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=rt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let c=R.mergeTickArrayBitmap(e).shln(yt-1-a),u=Ht(512,c)?null:oi(512,c);if(u!==null){let l=t-u*J.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=R.mergeTickArrayBitmap(e).shrn(a),u=Ht(512,c)?null:si(512,c);if(u!==null){let l=t+u*J.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-J.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%rt.maxTickInTickarrayBitmap(t),i=Math.floor(n/J.tickCount(t));return e<0&&n!=0&&(i=yt-i),i}};var me=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:b,feeAmount:y}=wt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,o,s);return c.push(...p),{allTrade:d,expectedAmountOut:f.mul(it),remainingAccounts:c,executionPrice:b,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let b=this.preInitializedTickArrayStartIndex(e,s);if(b.isExist){let{publicKey:y}=Y(e.programId,e.id,b.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:p}=wt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(it),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=me.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Jt.checkTickArrayIsInit(J.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):R.checkTickArrayIsInitialized(R.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=Y(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,J.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=Y(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/J.tickCount(e.tickSpacing)),i=t?R.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):R.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=J.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=rt.nextInitializedTickArrayStartIndex(R.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Jt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ce||t>Re)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let f=j(E({},m),{perSecond:W.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new ve(d)});if(f.tokenMint.equals(ve.default))continue;if(n<=f.openTime.toNumber()||i.eq(ge)){s.push(f);continue}let p=new ce(Math.min(f.endTime.toNumber(),n)),b=p.sub(f.lastUpdateTime),y=W.mulDivFloor(b,f.emissionsPerSecondX64,i),g=f.rewardGrowthGlobalX64.add(y),w=W.mulDivFloor(b,f.emissionsPerSecondX64,_e),k=f.rewardTotalEmissioned.add(w);s.push(j(E({},f),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:k,lastUpdateTime:p}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=R.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=rt.maxTickInTickarrayBitmap(e),n=-t;return t>Re&&(t=J.getArrayStartIndex(Re,e)+J.tickCount(e)),n<Ce&&(n=J.getArrayStartIndex(Ce,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!J.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/J.tickCount(t)*yt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await et(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=gr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let c of t){let u=R.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=R.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=Y(c.programId,c.id,m);o.push({pubkey:d}),i[d.toString()]=c.id}}let s=await et(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=i[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Yt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=j(E({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let f of s)u.push(Me(f,d).publicKey);let l=await $e(t,u,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let f=$t.decode(d.data),p=f.poolId.toString(),b=e.find(B=>B.state.id.toBase58()===p);if(b===void 0)continue;let y=b.state,g=R._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),w=R._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:k,amountB:P}=$.getAmountsFromLiquidity(y.sqrtPriceX64,g.tickSqrtPriceX64,w.tickSqrtPriceX64,f.liquidity,!1),A=1/(1-Math.sqrt(Math.sqrt(g.price.div(w.price).toNumber())));b.positionAccount=[...(a=b.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:g.price,priceUpper:w.price,amountA:k,amountB:P,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(B=>j(E({},B),{pendingReward:new ce(0)})),leverage:A,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let h=await R.getTickArrayAddressByTick(b.state.programId,f.poolId,f.tickLower,b.state.tickSpacing),T=await R.getTickArrayAddressByTick(b.state.programId,f.poolId,f.tickUpper,b.state.tickSpacing);m[`${b.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=h,m[`${b.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=T}if(o){let d=Object.values(m),f=await $e(t,d,{batchRequest:i}),p={};for(let b=0;b<d.length;b++){let y=f[b];if(y===null)continue;let g=d[b].toString();p[g]=Yt.decode(y.data)}for(let{state:b,positionAccount:y}of e)if(!!y)for(let g of y){let w=`${b.programId.toString()}-${b.id.toString()}-${g.tickLower}`,k=`${b.programId.toString()}-${b.id.toString()}-${g.tickUpper}`,P=p[m[w].toString()],A=p[m[k].toString()],h=P.ticks[R.getTickOffsetInArray(g.tickLower,b.tickSpacing)],T=A.ticks[R.getTickOffsetInArray(g.tickUpper,b.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:K}=await Qt.GetPositionFees(b,g,h,T),C=await Qt.GetPositionRewards(b,g,h,T);g.tokenFeeAmountA=B.gte(new ce(0))?B:new ce(0),g.tokenFeeAmountB=K.gte(new ce(0))?K:new ce(0);for(let S=0;S<C.length;S++)g.rewardInfos[S].pendingReward=C[S].gte(new ce(0))?C[S]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new N(0),catchLiquidityInsufficient:c=!1}){var M;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?u=l?Qe.add(new ce(1)):Ye.sub(new ce(1)):u=v.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=be(o,m,i,!1),{allTrade:p,expectedAmountOut:b,remainingAccounts:y,executionPrice:g,feeAmount:w}=me.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((M=f.fee)!=null?M:ge),u,c),k=be(b,d,i,!1),P=v.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),A=l?P:new N(1).div(P),h=b.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),T=be(h,d,i,!1),B=l?e.currentPrice:new N(1).div(e.currentPrice),K=new N(A).sub(B).abs(),C=B,S=new dt(new N(K).mul(10**15).toFixed(0),new N(C).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:k,minAmountOut:T,expirationTime:ft(f.expirationTime,k.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:S,fee:w,remainingAccounts:y,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=i.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ze(j(E({},u),{mint:u.address,isToken2022:u.programId===pr.toBase58()})),new Ze(j(E({},l),{mint:l.address,isToken2022:l.programId===pr.toBase58()}))],{allTrade:f,realAmountIn:p,amountOut:b,minAmountOut:y,expirationTime:g,currentPrice:w,executionPrice:k,priceImpact:P,fee:A,remainingAccounts:h,executionPriceX64:T}=me.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new ve(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=j(E({},p),{amount:new Be(m,p.amount),fee:p.fee===void 0?void 0:new Be(m,p.fee)}),K=j(E({},b),{amount:new Be(d,b.amount),fee:b.fee===void 0?void 0:new Be(d,b.fee)}),C=j(E({},y),{amount:new Be(d,y.amount),fee:y.fee===void 0?void 0:new Be(d,y.fee)}),S=new Ge({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:w.mul(new N(10**(20+d.decimals))).toFixed(0)}),M=new Ge({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:k.mul(new N(10**(20+d.decimals))).toFixed(0)}),O=new Be(m,A);return{allTrade:f,realAmountIn:B,amountOut:K,minAmountOut:C,expirationTime:g,currentPrice:S,executionPrice:M,priceImpact:P,fee:O,remainingAccounts:h,executionPriceX64:T}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new N(0)}){var C;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new N(0))?l=c?Ye.sub(new ce(1)):Qe.add(new ce(1)):l=v.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=be(o,u[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:b}=me.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((C=m.fee)!=null?C:ge),l),y=c?e.mintB.address:e.mintA.address,g=be(d,u[y],i,!1),w=v.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),k=c?w:new N(1).div(w),P=d.mul(new ce(Math.floor((1+s)*1e10))).div(new ce(1e10)),A=be(P,u[y],i,!0),h=c?e.currentPrice:new N(1).div(e.currentPrice),T=new N(k).sub(h).abs(),B=h,K=new dt(new N(T).mul(10**15).toFixed(0),new N(B).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:A,realAmountOut:m,expirationTime:ft(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:k,priceImpact:K,fee:b,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var p,b,y;let o=e[t],s=R.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=R.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((p=o.rewardApr[0])!=null?p:0)*f,((b=o.rewardApr[1])!=null?b:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[pt(e.mintA.address).toString()],d=i[pt(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let b=v.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),y=v.getSqrtPriceX64FromTick(s),g=v.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:k}=$.getAmountsFromLiquidityWithSlippage(b,y,g,t,!1,!1,0),{amountSlippageA:P,amountSlippageB:A}=$.getAmountsFromLiquidityWithSlippage(b,y,g,o,!1,!1,0),h=new N(w.toString()).div(new N(10).pow(f)).mul(m.value).add(new N(k.toString()).div(new N(10).pow(p)).mul(d.value)),T=new N(P.toString()).div(new N(10).pow(f)).mul(m.value).add(new N(A.toString()).div(new N(10).pow(p)).mul(d.value)),B=new N(1).div(h.add(T)),C=new N(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),S=3600*24*365,M=e.rewardDefaultInfos.map(O=>{var z,Fe;let V=O.mint.decimals,Z=i[O.mint.address];return c<((z=O.startTime)!=null?z:0)||c>((Fe=O.endTime)!=null?Fe:0)||!O.perSecond||!Z||V===void 0?0:new N(Z.value).mul(new N(O.perSecond).mul(S)).div(new N(10).pow(V)).mul(B).mul(100).toNumber()});return{feeApr:C,rewardsApr:M,apr:C+M.reduce((O,V)=>O+V,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var g,w;let l=v.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=v.getSqrtPriceX64FromTick(n),d=v.getSqrtPriceX64FromTick(i),f=a?1-s:1+s,p=be(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,c,!u),b=new ce(new N(p.amount.sub((w=p.fee)!=null?w:ge).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?$.getLiquidityFromTokenAmountA(m,d,b,!a):new ce(0);else if(l.lte(d)){let k=$.getLiquidityFromTokenAmountA(l,d,b,!a),P=$.getLiquidityFromTokenAmountB(m,l,b);y=t?k:P}else y=t?new ce(0):$.getLiquidityFromTokenAmountB(m,d,b);return me.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:i,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var y,g,w,k;let c=v.getSqrtPriceX64FromTick(n),u=v.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=$.getAmountsFromLiquidity(v.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,f]=[be(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),be(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[p,b]=[be(m.amountA.muln(l),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),be(m.amountB.muln(l),(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:ft(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(c=>!n[c.id]).map(c=>new ve(c.id));(await $e(e,i)).forEach((c,u)=>{!c||(n[i[u].toBase58()]=Cn.decode(c.data))});let s=t.map(c=>ye(new ve(c.programId),new ve(c.id)).publicKey),a=await me.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>j(E({},c),{[u.id]:j(E({},n[u.id]),{id:new ve(u.id),version:6,programId:new ve(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:j(E({},u.config),{id:new ve(u.config.id),fundOwner:""}),currentPrice:new N(u.price),exBitmapAccount:ye(new ve(u.programId),new ve(u.id)).publicKey,exBitmapInfo:a[ye(new ve(u.programId),new ve(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var li={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function br(r){return j(E({},r),{type:"Concentrated",programId:r.programId.toString(),id:r.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:r.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:r.ammConfig.tradeFeeRate,openTime:r.startTime.toString(),tvl:0,day:li,week:li,month:li,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:j(E({},r.ammConfig),{id:r.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var W=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(ge)||(o=o.add(je)),o}static mulDivFloor(e,t,n){if(n.eq(ge))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ge))throw new Error("division by 0");return e.mul(t).add(n.sub(je)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new H(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(xn).sub(t).mod(xn)}};function Pe(r,e){return mi(r.mul(e),64,256)}function xs(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function mi(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var v=class{static sqrtPriceX64ToPrice(e,t,n){return W.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return W.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(ge))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ge))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(ge))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ge))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(ge))return e;let o=t.shln(Xt);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?W.mulDivCeil(s,e,a):W.mulDivRoundingUp(s,je,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return W.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(Xt);if(i)return e.add(o.div(t));{let s=W.mulDivRoundingUp(o,je,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ce||e>Re)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new H("18445821805675395072"):new H("18446744073709551616");return(t&2)!=0&&(n=Pe(n,new H("18444899583751176192"))),(t&4)!=0&&(n=Pe(n,new H("18443055278223355904"))),(t&8)!=0&&(n=Pe(n,new H("18439367220385607680"))),(t&16)!=0&&(n=Pe(n,new H("18431993317065453568"))),(t&32)!=0&&(n=Pe(n,new H("18417254355718170624"))),(t&64)!=0&&(n=Pe(n,new H("18387811781193609216"))),(t&128)!=0&&(n=Pe(n,new H("18329067761203558400"))),(t&256)!=0&&(n=Pe(n,new H("18212142134806163456"))),(t&512)!=0&&(n=Pe(n,new H("17980523815641700352"))),(t&1024)!=0&&(n=Pe(n,new H("17526086738831433728"))),(t&2048)!=0&&(n=Pe(n,new H("16651378430235570176"))),(t&4096)!=0&&(n=Pe(n,new H("15030750278694412288"))),(t&8192)!=0&&(n=Pe(n,new H("12247334978884435968"))),(t&16384)!=0&&(n=Pe(n,new H("8131365268886854656"))),(t&32768)!=0&&(n=Pe(n,new H("3584323654725218816"))),(t&65536)!=0&&(n=Pe(n,new H("696457651848324352"))),(t&131072)!=0&&(n=Pe(n,new H("26294789957507116"))),(t&262144)!=0&&(n=Pe(n,new H("37481735321082"))),e>0&&(n=tr.div(n)),n}static getTickFromPrice(e,t,n){return v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ye)||e.lt(Qe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new H(t-64),i=xs(n,32,128),o=new H("8000000000000000","hex"),s=0,a=new H(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new H(0))&&s<nr;){c=c.mul(c);let p=c.shrn(127);c=c.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=i.add(u).mul(new H(ir)),d=mi(m.sub(new H(rr)),64,128).toNumber(),f=mi(m.add(new H(or)),64,128).toNumber();return d==f?d:v.getSqrtPriceX64FromTick(f).lte(e)?f:d}},ht=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=v.getTickFromSqrtPriceX64(v.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=ht.getTickWithPriceAndTickspacing(e,t,n,i),s=v.getSqrtPriceX64FromTick(o);return v.sqrtPriceX64ToPrice(s,n,i)}},$=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ge))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Xt),s=t.sub(e);return i?W.mulDivRoundingUp(W.mulDivCeil(o,s,t),je,e):W.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ge))throw new Error("sqrtPriceX64A must greater than 0");return i?W.mulDivCeil(n,t.sub(e),_e):W.mulDivFloor(n,t.sub(e),_e)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?W.mulDivRoundingUp(a,je,ri):a.shrn(Xt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),W.mulDivFloor(n,ri,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return $.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=$.getLiquidityFromTokenAmountA(e,n,i,!1),a=$.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return $.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:$.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new H(0)};if(e.lt(n)){let s=$.getTokenAmountAFromLiquidity(e,n,i,o),a=$.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new H(0),amountB:$.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:c,amountB:u}=$.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new H(new N(c.toString()).mul(l).toFixed(0)),d=new H(new N(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,k,P,A;let u=v.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=v.getSqrtPriceX64FromTick(t),m=v.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=$.getAmountsFromLiquidity(u,l,m,i,s),[p,b]=[be(f.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),be(f.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,a,c)],[y,g]=[be(new H(new N(f.amountA.toString()).mul(d).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,c),be(new H(new N(f.amountB.toString()).mul(d).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,c)];return{liquidity:i,amountA:p,amountB:b,amountSlippageA:y,amountSlippageB:g,expirationTime:ft(p.expirationTime,b.expirationTime)}}},wt=class{static swapCompute(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b=!1){if(d.eq(ge))throw new Error("amountSpecified must not be 0");if(p||(p=s?Qe.add(je):Ye.sub(je)),s){if(p.lt(Qe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(Ye))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(ge),g={amountSpecifiedRemaining:d,amountCalculated:ge,sqrtPriceX64:m,tick:u>f?Math.min(f+J.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new H(0)},w=f,k=n[f],P=0,A=!s&&k.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ge)&&!g.sqrtPriceX64.eq(p);){P>10;let h={};h.sqrtPriceStartX64=g.sqrtPriceX64;let T=R.nextInitTick(k,g.tick,l,s,A),B=T||null,K=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let S=me.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},w,s);if(!S.isExist){if(b)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}w=S.nextStartIndex;let{publicKey:M}=Y(e,t,w);K=M,k=n[w];try{B=R.firstInitializedTick(k,s)}catch{throw Error("not found next tick info")}}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),f!==w&&K&&(g.accounts.push(K),f=w),h.tickNext<Ce?h.tickNext=Ce:h.tickNext>Re&&(h.tickNext=Re),h.sqrtPriceNextX64=v.getSqrtPriceX64FromTick(h.tickNext);let C;if(s&&h.sqrtPriceNextX64.lt(p)||!s&&h.sqrtPriceNextX64.gt(p)?C=p:C=h.sqrtPriceNextX64,[g.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=wt.swapStepCompute(g.sqrtPriceX64,C,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(h.feeAmount),y?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),g.amountCalculated=g.amountCalculated.sub(h.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(h.amountOut),g.amountCalculated=g.amountCalculated.add(h.amountIn.add(h.feeAmount))),g.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let S=B.liquidityNet;s&&(S=S.mul(it)),g.liquidity=$.addDelta(g.liquidity,S)}A=h.tickNext!=g.tick&&!s&&k.startTickIndex===h.tickNext,g.tick=s?h.tickNext-1:h.tickNext}else if(g.sqrtPriceX64!=h.sqrtPriceStartX64){let S=v.getTickFromSqrtPriceX64(g.sqrtPriceX64);A=S!=g.tick&&!s&&k.startTickIndex===S,g.tick=S}++P}try{let{nextStartIndex:h,isExist:T}=J.nextInitializedTickArray(g.tick,l,s,i,o);T&&f!==h&&(g.accounts.push(Y(e,t,h).publicKey),f=h)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ge,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new H(0),amountIn:new H(0),amountOut:new H(0),feeAmount:new H(0)},a=e.gte(t),c=i.gte(ge);if(c){let l=W.mulDivFloor(i,In.sub(new H(o.toString())),In);s.amountIn=a?$.getTokenAmountAFromLiquidity(t,e,n,!0):$.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=v.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?$.getTokenAmountBFromLiquidity(t,e,n,!1):$.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(it).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=v.getNextSqrtPriceX64FromOutput(e,n,i.mul(it),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=$.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=$.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:$.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:$.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(i.mul(it))&&(s.amountOut=i.mul(it)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=W.mulDivCeil(s.amountIn,new H(o),In.sub(new H(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var he=60,yt=512,R=class{static getTickArrayAddressByTick(e,t,n,i){let o=R.getTickArrayStartIndexByTick(n,i),{publicKey:s}=Y(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=R.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=he)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=J.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*J.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*he,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*he,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*he:e+t*he}static mergeTickArrayBitmap(e){let t=new Is(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*he));return[...R.searchLowBitFromStart(e,t,s-1,o,n),...R.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return R.searchHightBitFromStart(e,t,0,yt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=R.getAllInitializedTickArrayStartIndex(n,i,o);for(let c of a){let{publicKey:u}=Y(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>R.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===i)break}let c=J.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>R.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===i)break}let c=J.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ce||e>Re}static nextInitTick(e,t,n,i,o){if(J.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<he;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=he-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<he;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),o=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new N(1).div(t),o=ht.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=v.getSqrtPriceX64FromTick(o),a=v.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=v.getSqrtPriceX64FromTick(t),o=v.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new N(1).div(t),o=ht.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=v.getSqrtPriceX64FromTick(o),a=v.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};var yr=ne([De(8),fe("bump"),Gt("index"),re(""),It("protocolFeeRate"),It("tradeFeeRate"),Gt("tickSpacing"),le(D(),8,"")]),Ss=ne([It("blockTimestamp"),$i("tickCumulative"),le(D(),4)]),wr=ne([De(8),Le("initialized"),D("recentEpoch"),Gt("observationIndex"),re("poolId"),le(Ss,100,"observations"),le(D(),4)]),Cs=ne([fe("rewardState"),D("openTime"),D("endTime"),D("lastUpdateTime"),Q("emissionsPerSecondX64"),D("rewardTotalEmissioned"),D("rewardClaimed"),re("tokenMint"),re("tokenVault"),re("creator"),Q("rewardGrowthGlobalX64")]),Cn=ne([De(8),fe("bump"),re("ammConfig"),re("creator"),re("mintA"),re("mintB"),re("vaultA"),re("vaultB"),re("observationId"),fe("mintDecimalsA"),fe("mintDecimalsB"),Gt("tickSpacing"),Q("liquidity"),Q("sqrtPriceX64"),ae("tickCurrent"),It(),Q("feeGrowthGlobalX64A"),Q("feeGrowthGlobalX64B"),D("protocolFeesTokenA"),D("protocolFeesTokenB"),Q("swapInAmountTokenA"),Q("swapOutAmountTokenB"),Q("swapInAmountTokenB"),Q("swapOutAmountTokenA"),fe("status"),le(fe(),7,""),le(Cs,3,"rewardInfos"),le(D(),16,"tickArrayBitmap"),D("totalFeesTokenA"),D("totalFeesClaimedTokenA"),D("totalFeesTokenB"),D("totalFeesClaimedTokenB"),D("fundFeesTokenA"),D("fundFeesTokenB"),D("startTime"),le(D(),15*4-3,"padding")]),Ks=ne([Q("growthInsideLastX64"),D("rewardAmountOwed")]),$t=ne([De(8),fe("bump"),re("nftMint"),re("poolId"),ae("tickLower"),ae("tickUpper"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),D("tokenFeesOwedA"),D("tokenFeesOwedB"),le(Ks,3,"rewardInfos"),le(D(),8,"")]),Ld=ne([De(8),fe("bump"),re("poolId"),ae("tickLowerIndex"),ae("tickUpperIndex"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),D("tokenFeesOwedA"),D("tokenFeesOwedB"),le(Q(),3,"rewardGrowthInside"),le(D(),8,"")]),Ns=ne([ae("tick"),er("liquidityNet"),Q("liquidityGross"),Q("feeGrowthOutsideX64A"),Q("feeGrowthOutsideX64B"),le(Q(),3,"rewardGrowthsOutsideX64"),le(It(),13,"")]),Yt=ne([De(8),re("poolId"),ae("startTickIndex"),le(Ns,he,"ticks"),fe("initializedTickCount"),le(fe(),115,"")]),hr=ne([De(329),le(re(),100,"whitelistMints")]),gr=ne([De(8),re("poolId"),le(le(D(),8),ui,"positiveTickArrayBitmap"),le(le(D(),8),ui,"negativeTickArrayBitmap")]),Rd=ne([D(),fe("bump"),re("owner"),re("poolId"),re("positionId"),re("nftAccount"),le(D(),8)]),Md=ne([De(8),fe("bump"),re("lockOwner"),re("poolId"),re("positionId"),re("nftAccount"),re("lockNftMint"),D("recentEpoch"),le(D(),8)]);wr.span;var kr=Ae("CobaltX_Clmm"),We={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Pr=[188,37,179,131,82,150,84,73],Ar=[16,72,250,198,14,162,212,19],ue=class{static createPoolInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p){let b=ne([Q("sqrtPriceX64"),D("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1}],g=Buffer.alloc(b.span);b.encode({sqrtPriceX64:f,startTime:p},g);let w=Buffer.from([...We.createPool,...g]);return new Ie({keys:y,programId:e,data:w})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(i.address),new I(o.address)],{publicKey:m}=lr(t,s,u,l),{publicKey:d}=dr(t,m),{publicKey:f}=ai(t,m,u),{publicKey:p}=ai(t,m,l),b=ye(t,m).publicKey,y=[this.createPoolInstruction(t,m,n,s,d,u,f,new I(i.programId||ie),l,p,new I(o.programId||ie),b,a,c)];return{signers:[],instructions:y,instructionTypes:[de.CreateAccount,de.ClmmCreatePool],address:{poolId:m,observationId:d,exBitmapAccount:b,mintAVault:f,mintBVault:p},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w,k,P,A,h,T,B,K,C){let S=ne([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),Q("liquidity"),D("amountMaxA"),D("amountMaxB"),Le("withMetadata"),fe("optionBaseFlag"),Le("baseFlag")]),M=[...C?[{pubkey:C,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...M],V=Buffer.alloc(S.span);S.encode({tickLowerIndex:w,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:h,amountMaxA:T,amountMaxB:B,withMetadata:K==="create",baseFlag:!1,optionBaseFlag:0},V);let Z=Buffer.from([...We.openPosition,...V]);return new Ie({keys:O,programId:e,data:Z})}static openPositionFromLiquidityInstruction22(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w,k,P,A,h,T,B,K){let C=ne([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),Q("liquidity"),D("amountMaxA"),D("amountMaxB"),Le("withMetadata"),fe("optionBaseFlag"),Le("baseFlag")]),S=[...K?[{pubkey:K,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...S],O=Buffer.alloc(C.span);C.encode({tickLowerIndex:g,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:P,liquidity:A,amountMaxA:h,amountMaxB:T,withMetadata:B==="create",baseFlag:!1,optionBaseFlag:0},O);let V=Buffer.from([...We.openPositionWithTokenEx,...O]);return new Ie({keys:M,programId:e,data:V})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let d=[],[f,p]=[new I(e.programId),new I(e.id)],b;if(l)b=new I((await l(1))[0]);else{let K=Kn.generate();d.push(K),b=K.publicKey}let y=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(f,p,y),{publicKey:k}=Y(f,p,g),{publicKey:P}=m?se(n.wallet,b,pe):se(n.wallet,b,ie),{publicKey:A}=zt(b),{publicKey:h}=Me(f,b),{publicKey:T}=He(f,p,i,o),B=m?this.openPositionFromLiquidityInstruction22(f,n.feePayer,p,n.wallet,b,P,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),i,o,y,g,s,a,c,u,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(f,p).publicKey:void 0):this.openPositionFromLiquidityInstruction(f,n.feePayer,p,n.wallet,b,P,A,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),i,o,y,g,s,a,c,u,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(f,p).publicKey:void 0);return{signers:d,instructions:[B],instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:b,tickArrayLower:w,tickArrayUpper:k,positionNftAccount:P,metadataAccount:A,personalPosition:h,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let d=[],[f,p]=[new I(e.programId),new I(e.id)],b;if(l)b=new I((await l(1))[0]);else{let K=Kn.generate();d.push(K),b=K.publicKey}let y=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(f,p,y),{publicKey:k}=Y(f,p,g),{publicKey:P}=m?se(n.wallet,b,pe):se(n.wallet,b,ie),{publicKey:A}=zt(b),{publicKey:h}=Me(f,b),{publicKey:T}=He(f,p,i,o),B=m?this.openPositionFromBaseInstruction22(f,n.feePayer,p,n.wallet,b,P,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),i,o,y,g,u,s,a,c,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(f,p).publicKey:void 0):this.openPositionFromBaseInstruction(f,n.feePayer,p,n.wallet,b,P,A,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),i,o,y,g,u,s,a,c,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(f,p).publicKey:void 0);return{address:{nftMint:b,tickArrayLower:w,tickArrayUpper:k,positionNftAccount:P,metadataAccount:A,personalPosition:h,protocolPosition:T},instructions:[B],signers:d,instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount&&t.lookupTableAccount!=""?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w,k,P,A,h,T,B,K,C){let S=ne([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),Q("liquidity"),D("amountMaxA"),D("amountMaxB"),Le("withMetadata"),fe("optionBaseFlag"),Le("baseFlag")]),M=[...C?[{pubkey:C,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...M],V=Buffer.alloc(S.span);S.encode({tickLowerIndex:w,tickUpperIndex:k,tickArrayLowerStartIndex:P,tickArrayUpperStartIndex:A,liquidity:new di(0),amountMaxA:T==="MintA"?B:K,amountMaxB:T==="MintA"?K:B,withMetadata:h==="create",baseFlag:T==="MintA",optionBaseFlag:1},V);let Z=Buffer.from([...We.openPosition,...V]);return new Ie({keys:O,programId:e,data:Z})}static openPositionFromBaseInstruction22(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w,k,P,A,h,T,B,K){let C=ne([ae("tickLowerIndex"),ae("tickUpperIndex"),ae("tickArrayLowerStartIndex"),ae("tickArrayUpperStartIndex"),Q("liquidity"),D("amountMaxA"),D("amountMaxB"),Le("withMetadata"),fe("optionBaseFlag"),Le("baseFlag")]),S=[...K?[{pubkey:K,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...S],O=Buffer.alloc(C.span);C.encode({tickLowerIndex:g,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:P,liquidity:new di(0),amountMaxA:h==="MintA"?T:B,amountMaxB:h==="MintA"?B:T,withMetadata:A==="create",baseFlag:h==="MintA",optionBaseFlag:1},O);let V=Buffer.from([...We.openPositionWithTokenEx,...O]);return new Ie({keys:M,programId:e,data:V})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:m}){let d,f=[];if(l)d=new I((await l(1))[0]);else{let K=Kn.generate();f.push(K),d=K.publicKey}let[p,b]=[new I(e.programId),new I(e.id)],y=R.getTickArrayStartIndexByTick(i,e.config.tickSpacing),g=R.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:w}=Y(p,b,y),{publicKey:k}=Y(p,b,g),{publicKey:P}=m?se(n.wallet,d,pe):se(n.wallet,d,ie),{publicKey:A}=zt(d),{publicKey:h}=Me(p,d),{publicKey:T}=He(p,b,i,o),B=m?this.openPositionFromLiquidityInstruction22(p,n.wallet,b,n.wallet,d,P,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),i,o,y,g,s,a,c,u,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(p,b).publicKey:void 0):this.openPositionFromLiquidityInstruction(p,n.wallet,b,n.wallet,d,P,A,T,w,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),i,o,y,g,s,a,c,u,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[y,g])?ye(p,b).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:w,tickArrayUpper:k,positionNftAccount:P,metadataAccount:A,personalPosition:h,protocolPosition:T},instructions:[B],signers:f,instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o,s){let a=ne([]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:s?pe:ie,isSigner:!1,isWritable:!1}],u=Buffer.alloc(a.span);a.encode({},u);let l=Buffer.from([...We.closePosition,...u]);return new Ie({keys:c,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i,nft2022:o}){let s=new I(e.programId),a=o?se(n.wallet,i.nftMint,pe).publicKey:se(n.wallet,i.nftMint,ie).publicKey,{publicKey:c}=Me(s,i.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,i.nftMint,a,c,o)),{address:{positionNftAccount:a,personalPosition:c},signers:[],instructions:u,instructionTypes:[de.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w){let k=ne([Q("liquidity"),D("amountMaxA"),D("amountMaxB"),fe("optionBaseFlag"),Le("baseFlag")]),P=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...P],h=Buffer.alloc(k.span);k.encode({liquidity:b,amountMaxA:y,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},h);let T=Buffer.from([...We.increaseLiquidity,...h]);return new Ie({keys:A,programId:e,data:T})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=Y(u,l,m),{publicKey:p}=Y(u,l,d),{publicKey:b}=c?se(i.wallet,n.nftMint,pe):se(i.wallet,n.nftMint,ie),{publicKey:y}=Me(u,n.nftMint),{publicKey:g}=He(u,l,n.tickLower,n.tickUpper),w=this.increasePositionFromLiquidityInstruction(u,i.wallet,b,y,l,g,f,p,i.tokenAccountA,i.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ye(u,l).publicKey:void 0);return{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:b,personalPosition:y,protocolPosition:g},signers:[],instructions:[w],instructionTypes:[de.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a,nft2022:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=Y(u,l,m),{publicKey:p}=Y(u,l,d),{publicKey:b}=c?se(i.wallet,n.nftMint,pe):se(i.wallet,n.nftMint,ie),{publicKey:y}=Me(u,n.nftMint),{publicKey:g}=He(u,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:b,personalPosition:y,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,b,y,l,g,f,p,i.tokenAccountA,i.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ye(u,l).publicKey:void 0)],signers:[],instructionTypes:[de.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w){let k=ne([Q("liquidity"),D("amountMaxA"),D("amountMaxB"),fe("optionBaseFlag"),Le("baseFlag")]),P=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...P],h=Buffer.alloc(k.span);k.encode({liquidity:new di(0),amountMaxA:b==="MintA"?y:g,amountMaxB:b==="MintA"?g:y,baseFlag:b==="MintA",optionBaseFlag:1},h);let T=Buffer.from([...We.increaseLiquidity,...h]);return new Ie({keys:A,programId:e,data:T})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g,w,k){let P=ne([Q("liquidity"),D("amountMinA"),D("amountMinB")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...b.map(K=>[{pubkey:K.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.rewardMint,isSigner:!1,isWritable:!1}]).flat()],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(P.span);P.encode({liquidity:y,amountMinA:g,amountMinB:w},T);let B=Buffer.from([...We.decreaseLiquidity,...T]);return new Ie({keys:h,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:c,nft2022:u}){let[l,m]=[new I(e.programId),new I(e.id)],d=R.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),f=R.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=Y(l,m,d),{publicKey:b}=Y(l,m,f),{publicKey:y}=u?se(i.wallet,n.nftMint,pe):se(i.wallet,n.nftMint,c),{publicKey:g}=Me(l,n.nftMint),{publicKey:w}=He(l,m,n.tickLower,n.tickUpper),k=[];for(let h=0;h<e.rewardDefaultInfos.length;h++)k.push({poolRewardVault:new I(t.rewardInfos[h].vault),ownerRewardVault:i.rewardAccounts[h],rewardMint:new I(e.rewardDefaultInfos[h].mint.address)});let P=[],A=this.decreaseLiquidityInstruction(l,i.wallet,y,g,m,w,p,b,i.tokenAccountA,i.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),k,o,s,a,me.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,f])?ye(l,m).publicKey:void 0);return P.push(A),{address:{tickArrayLower:p,tickArrayUpper:b,positionNftAccount:y,personalPosition:g,protocolPosition:w},signers:[],instructions:P,instructionTypes:[de.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,c,u,l,m,d,f,p,b,y,g){let w=ne([D("amount"),D("otherAmountThreshold"),Q("sqrtPriceLimitX64"),Le("isBaseInput")]),k=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(T=>({pubkey:T,isSigner:!1,isWritable:!0}))],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...k],A=Buffer.alloc(w.span);w.encode({amount:f,otherAmountThreshold:p,sqrtPriceLimitX64:b,isBaseInput:y},A);let h=Buffer.from([...We.swap,...A]);return new Ie({keys:P,programId:e,data:h})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[p,b]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),g=[this.swapInstruction(l,i.wallet,m,new I(e.config.id),y?i.tokenAccountA:i.tokenAccountB,y?i.tokenAccountB:i.tokenAccountA,y?d:f,y?f:d,y?p:b,y?b:p,u,n,s,a,c,!0,ye(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[de.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[p,b]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,i.wallet,m,new I(e.config.id),y?i.tokenAccountB:i.tokenAccountA,y?i.tokenAccountA:i.tokenAccountB,y?f:d,y?d:f,y?b:p,y?p:b,u,n,s,a,c,!1,ye(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[de.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,c,u,l,m,d){let f=ne([D("openTime"),D("endTime"),Q("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(f.span);f.encode({openTime:ke(l),endTime:ke(m),emissionsPerSecondX64:d},b);let y=Buffer.from([...We.initReward,...b]);return new Ie({keys:p,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new I(e.programId),new I(e.id)],a=mr(o,s,i.mint).publicKey,c=Zt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[de.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,c,u,l,m,d){let f=ne([fe("rewardIndex"),Q("emissionsPerSecondX64"),D("openTime"),D("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],b=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:ke(l),endTime:ke(m)},b);let y=Buffer.from([...We.setRewardEmissions,...b]);return new Ie({keys:p,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&kr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Zt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[de.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let c=ne([fe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:bn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...We.collectReward,...l]);return new Ie({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&kr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,i,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[de.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:c}){let u=[],l;if(c)l=new I((await c(1))[0]);else{let g=Kn.generate();u.push(g),l=g.publicKey}let m=a?se(o,s,pe).publicKey:se(o,s,ie).publicKey,{publicKey:d}=Me(n,s),f=jt(e,l).publicKey,p=se(o,l,ie).publicKey,b=zt(l).publicKey,y=ue.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:d,lockPositionId:f,lockNftMint:l,lockNftAccount:p,metadataAccount:b,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:se(t,s,a?pe:ie).publicKey,positionNftProgram:a?pe:ie});return{address:{positionId:d,lockPositionId:f,lockNftAccount:p,lockNftMint:l,positionNftAccount:m,metadataAccount:b},instructions:[y],signers:u,instructionTypes:[de.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:c,authPositionNftAccount:u,positionNftProgram:l,lockPositionId:m,lockNftMint:d,lockNftAccount:f,metadataAccount:p,withMetadata:b}){let y=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:mt,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1}],g=ne([Le("withMetadata")]),w=Buffer.alloc(g.span);g.encode({withMetadata:b},w);let k=Buffer.from([...Pr,...w]);return new Ie({keys:y,programId:e,data:k})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=se(i,o,ie),{publicKey:a}=Me(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ci(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:ot.programId,isSigner:!1,isWritable:!1}];return new Ie({keys:c,programId:e,data:Buffer.from(Pr)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],i=R.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=R.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=Y(t,n,i),{publicKey:a}=Y(t,n,o),{publicKey:c}=se(e.owner,e.ownerPosition.nftMint,ie),{publicKey:u}=Me(t,e.ownerPosition.nftMint),{publicKey:l}=He(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let p=0;p<e.poolKeys.rewardInfos.length;p++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[p].vault),ownerRewardVault:e.ownerRewardAccounts[p],rewardMint:new I(e.poolKeys.rewardInfos[p].mint.address)});let d=[...m.map(p=>[{pubkey:p.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:ci(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:Xn,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ie({keys:f,programId:e.programId,data:Buffer.from(Ar)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:m,vaultA:d,vaultB:f,tickArrayLower:p,tickArrayUpper:b,userVaultA:y,userVaultB:g,mintA:w,mintB:k,rewardAccounts:P,exTickArrayBitmap:A}){let h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...P.map(B=>[{pubkey:B.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:pe,isSigner:!1,isWritable:!1},{pubkey:Xn,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...h];return new Ie({keys:T,programId:e,data:Buffer.from(Ar)})}};var Br=class extends Ut{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var k;let{programId:t,owner:n=((k=this.scope.owner)==null?void 0:k.publicKey)||L.default,mint1:i,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,f=this.createTxBuilder(),[p,b,y]=new Ee(new L(i.address).toBuffer()).gt(new Ee(new L(o.address).toBuffer()))?[o,i,new N(1).div(a)]:[i,o,a],g=v.priceToSqrtPriceX64(y,p.decimals,b.decimals),w=await ue.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:b,ammConfigId:s.id,initialPriceX64:g,startTime:c,forerunCreate:!m&&l});return f.addInstruction(w),f.addCustomComputeBudget(u),f.versionBuild({txVersion:d,extInfo:{address:j(E({},w.address),{observationId:w.address.observationId.toBase58(),exBitmapAccount:w.address.exBitmapAccount.toBase58(),programId:t.toString(),id:w.address.poolId.toString(),mintA:p,mintB:b,openTime:c.toString(),vault:{A:w.address.mintAVault.toString(),B:w.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:E({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:w.address.poolId.toString(),mintA:p,mintB:b,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},sr),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,nft2022:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,withMetadata:d="create",getEphemeralSigners:f,computeBudgetConfig:p,txVersion:b}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let y=this.createTxBuilder(),g=null,w=null,k=n.useSOLBalance&&e.mintA.address===ee.toString(),P=n.useSOLBalance&&e.mintB.address===ee.toString(),[A,h]=s==="MintA"?[a,c]:[c,a],{account:T,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new L(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:k||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:l,checkCreateATAOwner:m});T&&(g=T),y.addInstruction(B||{});let{account:K,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new L(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:P||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:P?!1:l,checkCreateATAOwner:m});K&&(w=K),y.addInstruction(C||{}),(!g||!w)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:g==null?void 0:g.toBase58(),ownerTokenAccountB:w==null?void 0:w.toBase58()});let S=t||await this.getClmmPoolKeys(e.id),M=await ue.openPositionFromBaseInstructions({poolInfo:e,poolKeys:S,ownerInfo:j(E({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:w}),tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:d,getEphemeralSigners:f,nft2022:u});return console.log("insInfo",M),y.addInstruction(M),y.addCustomComputeBudget(p),y.versionBuild({txVersion:b,extInfo:E({},M.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:f,getEphemeralSigners:p,nft2022:b}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let y=this.createTxBuilder(),g=null,w=null,k=n.useSOLBalance&&e.mintA.address===ee.toBase58(),P=n.useSOLBalance&&e.mintB.address===ee.toBase58(),{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new L(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:k||i.isZero()?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:u,checkCreateATAOwner:l});A&&(g=A),y.addInstruction(h||{});let{account:T,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new L(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:P||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:P?!1:u,checkCreateATAOwner:l});T&&(w=T),y.addInstruction(B||{}),(g===void 0||w===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let K=t||await this.getClmmPoolKeys(e.id),C=await ue.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:K,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:w},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:i,amountMaxB:o,withMetadata:m,getEphemeralSigners:p,nft2022:b});return y.addInstruction(C),y.addCustomComputeBudget(f),y.versionBuild({txVersion:d,extInfo:{address:C.address}})}async increasePositionFromLiquidity(e){var B;let{poolInfo:t,poolKeys:n,ownerPosition:i,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,f=this.createTxBuilder(),p,b,y=c.useSOLBalance&&t.mintA.address===ee.toString(),g=c.useSOLBalance&&t.mintB.address===ee.toString(),{account:w,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new L(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});w&&(p=w),f.addInstruction(k||{});let{account:P,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new L(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});P&&(b=P),f.addInstruction(A||{}),!p&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=n!=null?n:await this.getClmmPoolKeys(t.id),T=ue.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:b},liquidity:a,amountMaxA:o,amountMaxB:s,nft2022:(B=await this.scope.connection.getAccountInfo(i.nftMint))==null?void 0:B.owner.equals(St)});return f.addInstruction(T),f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromBase(e){var T;let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),f,p,b=a.useSOLBalance&&t.mintA.address===ee.toString(),y=a.useSOLBalance&&t.mintB.address===ee.toString(),{account:g,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new L(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:b||(i==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:i==="MintA"?o:s}:void 0,skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});g&&(f=g),d.addInstruction(w||{});let{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new L(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(i==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:i==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});k&&(p=k),d.addInstruction(P||{}),!f&&!p&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let A=await this.getClmmPoolKeys(t.id),h=ue.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:A,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:p},base:i,baseAmount:o,otherAmountMax:s,nft2022:(T=await this.scope.connection.getAccountInfo(n.nftMint))==null?void 0:T.owner.equals(St)});return d.addInstruction(h),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:h.address}})}async decreaseLiquidity(e){var M;let{poolInfo:t,poolKeys:n,ownerPosition:i,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d,nftAccount:f}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),b=o.useSOLBalance&&t.mintA.address===ee.toString(),y=o.useSOLBalance&&t.mintB.address===ee.toString(),g,w,{account:k,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new L(t.mintA.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});g=k,P&&p.addInstruction(P);let{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new L(t.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});w=A,h&&p.addInstruction(h);let T=[];for(let O of t.rewardDefaultInfos){let V=o.useSOLBalance&&O.mint.address===ee.toString(),Z;if(O.mint.address===t.mintA.address)Z=g;else if(O.mint.address===t.mintB.address)Z=w;else{let{account:z,instructionParams:Fe}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(O.mint.programId),mint:new L(O.mint.address),notUseTokenAccount:V,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!V,associatedOnly:V?!1:u,checkCreateATAOwner:l});Z=z,Fe&&p.addInstruction(Fe)}T.push(Z)}!g&&!w&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let B=n!=null?n:await this.getClmmPoolKeys(t.id),K=(M=await this.scope.connection.getAccountInfo(i.nftMint))==null?void 0:M.owner.equals(St),C=await ue.decreaseLiquidityInstructions({poolInfo:t,poolKeys:B,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:w,rewardAccounts:T},liquidity:c,amountMinA:s,amountMinB:a,nft2022:K});p.addInstruction({instructions:C.instructions,instructionTypes:[de.ClmmDecreasePosition]});let S=E({},C.address);if(o.closePosition){let O=await ue.closePositionInstructions({poolInfo:t,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:i,nft2022:K});p.addInstruction({endInstructions:O.instructions,endInstructionTypes:O.instructionTypes}),S=E(E({},S),O.address)}return p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:S}})}async lockPosition(e){var d;let{programId:t=Dt,authProgramId:n=hn,poolProgramId:i=Ft,ownerPosition:o,payer:s,computeBudgetConfig:a,txVersion:c,getEphemeralSigners:u}=e,l=this.createTxBuilder(),m=await ue.makeLockPositions({programId:t,authProgramId:n,poolProgramId:i,wallet:this.scope.ownerPubKey,payer:s!=null?s:this.scope.ownerPubKey,nftMint:o.nftMint,getEphemeralSigners:u,nft2022:(d=await this.scope.connection.getAccountInfo(o.nftMint))==null?void 0:d.owner.equals(St)});return l.addInstruction(m),l.addCustomComputeBudget(a),l.versionBuild({txVersion:c,extInfo:m.address})}async harvestLockPosition(e){let{programId:t=Dt,authProgramId:n=hn,clmmProgram:i=Ft,poolKeys:o,lockData:s,ownerInfo:a={useSOLBalance:!0},associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=o||await this.getClmmPoolKeys(s.poolId.toString()),f=this.createTxBuilder(),p=await this.scope.connection.getAccountInfo(s.positionId);p||this.logger.logWithError("position not found",s.positionId);let b=$t.decode(p.data),y=a.useSOLBalance&&d.mintA.address===ee.toString(),g=a.useSOLBalance&&d.mintB.address===ee.toString(),w,k,{account:P,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new L(d.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w=P,A&&f.addInstruction(A);let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new L(d.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});k=h,T&&f.addInstruction(T);let B={},K=[];for(let Ke of d.rewardInfos){let Nn=a.useSOLBalance&&Ke.mint.address===ee.toString(),nn=B[Ke.mint.address];if(!nn){let{account:xr,instructionParams:fi}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(Ke.mint.programId),mint:new L(Ke.mint.address),notUseTokenAccount:Nn,owner:this.scope.ownerPubKey,skipCloseAccount:!Nn,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:Nn?!1:c});nn=xr,fi&&f.addInstruction(fi)}B[Ke.mint.address]=nn,K.push(nn)}let C=jt(t,s.lockNftMint).publicKey,S=se(this.scope.ownerPubKey,s.lockNftMint,tn).publicKey,M=R.getTickArrayStartIndexByTick(b.tickLower,d.config.tickSpacing),O=R.getTickArrayStartIndexByTick(b.tickUpper,d.config.tickSpacing),{publicKey:V}=Y(new L(d.programId),s.poolId,M),{publicKey:Z}=Y(new L(d.programId),s.poolId,O),{publicKey:z}=He(new L(d.programId),s.poolId,b.tickLower,b.tickUpper),Fe=[];for(let Ke=0;Ke<d.rewardInfos.length;Ke++)Fe.push({poolRewardVault:new L(d.rewardInfos[Ke].vault),ownerRewardVault:K[Ke],rewardMint:new L(d.rewardInfos[Ke].mint.address)});let kt=await ue.harvestLockPositionInstructionV2({programId:t,auth:n,lockPositionId:C,clmmProgram:i,lockOwner:this.scope.ownerPubKey,lockNftMint:s.lockNftMint,lockNftAccount:S,positionNftAccount:s.nftAccount,positionId:s.positionId,poolId:s.poolId,protocolPosition:z,vaultA:new L(d.vault.A),vaultB:new L(d.vault.B),tickArrayLower:V,tickArrayUpper:Z,userVaultA:w,userVaultB:k,mintA:new L(d.mintA.address),mintB:new L(d.mintB.address),rewardAccounts:Fe,exTickArrayBitmap:ye(i,s.poolId).publicKey});return f.addInstruction({instructions:[kt],instructionTypes:[de.ClmmHarvestLockPosition]}),f.addCustomComputeBudget(l),f.versionBuild({txVersion:m})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:i}){var c;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=ue.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n,nft2022:(c=await this.scope.connection.getAccountInfo(n.nftMint))==null?void 0:c.owner.equals(St)});return o.addInstruction(a).versionBuild({txVersion:i,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===ee.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(n.mint.address),mint:new L(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ee(new N(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:i,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),p=ue.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new L(n.mint.programId),mint:new L(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:W.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of i)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of i){let d=n.useSOLBalance&&m.mint.address===ee.toString(),f=m.perSecond.mul(m.endTime-m.openTime),{account:p,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(m.mint.programId),mint:new L(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ee(new N(f.toFixed(0)).gte(f)?f.toFixed(0):f.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});b&&u.addInstruction(b),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),g=ue.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new L(m.mint.programId),mint:new L(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:W.decimalToX64(m.perSecond)}});l=E(E({},l),g.address),u.addInstruction(g)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(ee),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Ee(new N(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:i,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),f=ue.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:W.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of i){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===ee.toString(),{account:f,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(m.mint.programId),mint:new L(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Ee(new N(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});p&&u.addInstruction(p),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let b=t!=null?t:await this.getClmmPoolKeys(e.id),y=ue.setRewardInstructions({poolInfo:e,poolKeys:b,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:new L(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:W.decimalToX64(m.perSecond)}});u.addInstruction(y),l=E(E({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){let c=e.rewardDefaultInfos.find(b=>b.mint.address===n.toString());c||this.logAndCreateError("reward mint error","not found reward mint",n);let u=this.createTxBuilder(),l=t.useSOLBalance&&n.equals(ee),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(c.mint.programId),mint:n,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});d&&u.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),p=ue.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:n});return u.addInstruction(p),u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:p.address}})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(b=>b.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(ee),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:i,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let f=await this.getClmmPoolKeys(e.id),p=ue.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(p),a=E(E({},a),p.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:i,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let p=this.createTxBuilder(),b=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===ee.toBase58(),g=c.useSOLBalance&&e.mintB.address===ee.toBase58(),w;!s||s.equals(new N(0))?w=b?Qe.add(new Ee(1)):Ye.sub(new Ee(1)):w=v.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let k;if(!k){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new L(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?i:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});k=h,T&&p.addInstruction(T)}let P;if(!P){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new L(e.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:g||b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?0:i}:void 0,associatedOnly:g?!1:l,checkCreateATAOwner:m});P=h,T&&p.addInstruction(T)}(!k||!P)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:k,ownerTokenAccountB:P,mintAUseSOLBalance:y,mintBUseSOLBalance:g,associatedOnly:l});let A=t!=null?t:await this.getClmmPoolKeys(e.id);return p.addInstruction(ue.makeSwapBaseInInstructions({poolInfo:e,poolKeys:A,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:k,tokenAccountB:P},inputMint:new L(n),amountIn:i,amountOutMin:o,sqrtPriceLimitX64:w,remainingAccounts:u})),p.addCustomComputeBudget(f),p.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:i,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let p=this.createTxBuilder(),b=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===ee.toBase58(),g=c.useSOLBalance&&e.mintB.address===ee.toBase58(),w;!s||s.equals(new N(0))?w=n.toString()===e.mintB.address?Qe.add(new Ee(1)):Ye.sub(new Ee(1)):w=v.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let k;if(!k){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new L(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});k=h,T&&p.addInstruction(T)}let P;if(!P){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new L(e.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:g||b?{payer:c.feePayer||this.scope.ownerPubKey,amount:b?0:o}:void 0,associatedOnly:g?!1:l,checkCreateATAOwner:m});P=h,T&&p.addInstruction(T)}(!k||!P)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:k,ownerTokenAccountB:P,mintAUseSOLBalance:y,mintBUseSOLBalance:g,associatedOnly:l});let A=t!=null?t:await this.getClmmPoolKeys(e.id);return p.addInstruction(ue.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:A,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:k,tokenAccountB:P},outputMint:new L(n),amountOut:i,amountInMax:o,sqrtPriceLimitX64:w,remainingAccounts:u})),p.addCustomComputeBudget(f),p.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:i,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){var b,y;let l={};for(let g of this.scope.account.tokenAccountRawInfos)o?se(this.scope.ownerPubKey,g.accountInfo.mint,a).publicKey.equals(g.pubkey)&&(l[g.accountInfo.mint.toString()]=g.pubkey):l[g.accountInfo.mint.toString()]=g.pubkey;let m=Object.values(t).flat().map(g=>g.nftMint),d=await et(this.scope.connection,m.map(g=>({pubkey:g}))),f={};d.forEach(g=>{var w,k;f[g.pubkey.toBase58()]=(k=(w=g==null?void 0:g.accountInfo)==null?void 0:w.owner)!=null?k:null});let p=this.createTxBuilder();for(let g of Object.values(e)){if(t[g.id]===void 0||!t[g.id].find(C=>!C.liquidity.isZero()||C.rewardInfos.find(S=>!S.rewardAmountOwed.isZero())))continue;let w=g,k=i.useSOLBalance&&w.mintA.address===ee.toString(),P=i.useSOLBalance&&w.mintB.address===ee.toString(),A=l[w.mintA.address];if(!A){let{account:C,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.mintA.programId,mint:new L(w.mintA.address),notUseTokenAccount:k,owner:this.scope.ownerPubKey,skipCloseAccount:!k,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:k?!1:o,checkCreateATAOwner:s});A=C,S&&p.addInstruction(S)}let h=l[w.mintB.address];if(!h){let{account:C,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:w.mintB.programId,mint:new L(w.mintB.address),notUseTokenAccount:P,owner:this.scope.ownerPubKey,skipCloseAccount:!P,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:P?!1:o,checkCreateATAOwner:s});h=C,S&&p.addInstruction(S)}l[w.mintA.address]=A,l[w.mintB.address]=h;let T=[];for(let C of w.rewardDefaultInfos){let S=i.useSOLBalance&&C.mint.address===ee.toString(),M=l[C.mint.address];if(!M){let{account:O,instructionParams:V}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new L(C.mint.programId),mint:new L(C.mint.address),notUseTokenAccount:S,owner:this.scope.ownerPubKey,skipCloseAccount:!S,createInfo:{payer:i.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:S?!1:o});M=O,V&&p.addInstruction(V)}l[C.mint.address]=M,T.push(M)}let B=await this.getClmmPoolKeys(w.id),K=[];for(let C=0;C<B.rewardInfos.length;C++)K.push({poolRewardVault:new L(B.rewardInfos[C].vault),ownerRewardVault:T[C],rewardMint:new L(B.rewardInfos[C].mint.address)});for(let C of t[g.id]){let S=(b=n==null?void 0:n[g.id])==null?void 0:b[C.nftMint.toBase58()];if(S){let M=se(this.scope.ownerPubKey,S.lockNftMint,tn).publicKey,O=R.getTickArrayStartIndexByTick(C.tickLower,B.config.tickSpacing),V=R.getTickArrayStartIndexByTick(C.tickUpper,B.config.tickSpacing),{publicKey:Z}=Y(new L(B.programId),S.poolId,O),{publicKey:z}=Y(new L(B.programId),S.poolId,V),{publicKey:Fe}=He(new L(B.programId),S.poolId,C.tickLower,C.tickUpper),kt=jt(Dt,S.lockNftMint).publicKey,Ke=ue.harvestLockPositionInstructionV2({programId:Dt,auth:hn,lockPositionId:kt,clmmProgram:Ft,lockOwner:this.scope.ownerPubKey,lockNftMint:S.lockNftMint,lockNftAccount:M,positionNftAccount:S.nftAccount,positionId:S.positionId,poolId:S.poolId,protocolPosition:Fe,vaultA:new L(B.vault.A),vaultB:new L(B.vault.B),tickArrayLower:Z,tickArrayUpper:z,userVaultA:A,userVaultB:h,mintA:new L(B.mintA.address),mintB:new L(B.mintB.address),rewardAccounts:K,exTickArrayBitmap:ye(Ft,S.poolId).publicKey});p.addInstruction({instructions:[Ke],instructionTypes:[de.ClmmHarvestLockPosition],lookupTableAddress:B.lookupTableAccount?[B.lookupTableAccount]:[]})}else{let M=ue.decreaseLiquidityInstructions({poolInfo:w,poolKeys:B,ownerPosition:C,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:A,tokenAccountB:h,rewardAccounts:T},liquidity:new Ee(0),amountMinA:new Ee(0),amountMinB:new Ee(0),nft2022:(y=f[C.nftMint.toBase58()])==null?void 0:y.equals(St)});p.addInstruction(M)}}}return c===0?p.sizeCheckBuildV0({computeBudgetConfig:u}):p.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Zt(e).publicKey);return t?hr.decode(t.data).whitelistMints.filter(i=>!i.equals(L.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Ee(1))).map(s=>Me(new L(e),s.accountInfo.mint).publicKey),i=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return i.forEach(s=>{if(!s)return;let a=$t.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await et(this.scope.connection,e.map(o=>({pubkey:new L(o)})),t),i={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=Cn.decode(s.accountInfo.data),c=v.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();i[String(e[o])]=j(E({},a),{currentPrice:c,programId:s.accountInfo.owner})}return i}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),i=await et(this.scope.connection,Array.from(n).map(c=>({pubkey:new L(c)}))),o={};i.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=yr.decode(c.accountInfo.data))});let s=await me.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,f,p;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:Tn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||tn.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?ei((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:Tn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||tn.toBase58(),extensions:{feeConfig:(f=t[l])!=null&&f.feeConfig?ei((p=t[l])==null?void 0:p.feeConfig):void 0}}),price:e[c].currentPrice,config:j(E({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await me.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),i=await ki({connection:this.scope.connection,mints:Array.from(n).map(m=>new L(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:i}),a=await et(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=br(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(Tr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(Tr.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=j(E({},o[e]),{exBitmapAccount:o[e].exBitmapAccount.toBase58(),observationId:o[e].observationId.toBase58(),id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},config:c.config,rewardInfos:o[e].rewardInfos.filter(m=>!m.tokenVault.equals(L.default)).map(m=>({mint:Tn({address:m.tokenMint.toBase58(),programId:tn.toBase58(),decimals:10}),vault:m.tokenVault.toBase58()}))});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{Br as Clmm};
//# sourceMappingURL=clmm.mjs.map
var ho=Object.defineProperty,To=Object.defineProperties;var Bo=Object.getOwnPropertyDescriptors;var ln=Object.getOwnPropertySymbols;var Ui=Object.prototype.hasOwnProperty,Xi=Object.prototype.propertyIsEnumerable;var Gi=(i,e,t)=>e in i?ho(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,D=(i,e)=>{for(var t in e||(e={}))Ui.call(e,t)&&Gi(i,t,e[t]);if(ln)for(var t of ln(e))Xi.call(e,t)&&Gi(i,t,e[t]);return i},Y=(i,e)=>To(i,Bo(e));var Pt=(i,e)=>{var t={};for(var n in i)Ui.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&ln)for(var n of ln(i))e.indexOf(n)<0&&Xi.call(i,n)&&(t[n]=i[n]);return t};import{MINT_SIZE as So,TOKEN_PROGRAM_ID as Ko,getTransferFeeConfig as Co,unpackMint as No}from"@solana/spl-token";import{PublicKey as Qi}from"@solana/web3.js";import{get as zi,set as Io}from"lodash";var Xn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Hi={},xo={};function ue(i){let e=zi(Hi,i);if(!e){let t=zi(xo,i);e=new Xn({name:i,logLevel:t}),Io(Hi,i,e)}return e}var zn=ue("CobaltX_accountInfo_util");async function nt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=D({batchRequest:!1},t),s=Hn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(p=>{let m=i._buildArgs([p.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=Hn(c,10);a=(await(await Promise.all(u.map(async p=>await i._rpcBatchRequest(p)))).flat()).map(p=>(p.error&&zn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${p.error.message}`),p.result.value.map(m=>{if(m){let{data:d,executable:y,lamports:f,owner:b,rentEpoch:g}=m;return d.length!==2&&d[1]!=="base64"&&zn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:y,lamports:f,owner:new Qi(b),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&zn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function At(i,e,t){let n=await nt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>Y(D({},r),{accountInfo:n[o]}))}async function Qn({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await At(i,e.map(c=>({pubkey:Ye(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<So){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=No(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=Y(D({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Ko,feeConfig:(a=Co(u))!=null?a:void 0})}return r[Qi.default.toBase58()]=r[Ge.toBase58()],r}import ot from"bn.js";var Lt=9e15,ft=1e9,Yn="0123456789abcdef",pn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",dn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",jn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Lt,maxE:Lt,crypto:!1},Ji,it,X=!0,bn="[DecimalError] ",dt=bn+"Invalid argument: ",$i=bn+"Precision limit exceeded",er=bn+"crypto unavailable",tr="[object Decimal]",Ne=Math.floor,Te=Math.pow,Lo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ro=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Oo=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,nr=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Xe=1e7,q=7,Mo=9007199254740991,Eo=pn.length-1,Zn=dn.length-1,I={toStringTag:tr};I.absoluteValue=I.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),V(i)};I.ceil=function(){return V(new this.constructor(this),this.e+1,2)};I.clampedTo=I.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(dt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};I.comparedTo=I.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};I.cosine=I.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+q,n.rounding=1,t=_o(n,ar(n,t)),n.precision=i,n.rounding=e,V(it==2||it==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};I.cubeRoot=I.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,p=l.constructor;if(!l.isFinite()||l.isZero())return new p(l);for(X=!1,o=l.s*Te(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Se(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Te(t,1/3),i=Ne((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new p(t),n.s=l.s):n=new p(o.toString()),s=(i=p.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ce(u.plus(l).times(a),u.plus(c),s+2,1),Se(a.d).slice(0,s)===(t=Se(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(V(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(V(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return X=!0,V(n,i,p.rounding,e)};I.decimalPlaces=I.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ne(this.e/q))*q,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};I.dividedBy=I.div=function(i){return ce(this,new this.constructor(i))};I.dividedToIntegerBy=I.divToInt=function(i){var e=this,t=e.constructor;return V(ce(e,new t(i),0,1,1),t.precision,t.rounding)};I.equals=I.eq=function(i){return this.cmp(i)===0};I.floor=function(){return V(new this.constructor(this),this.e+1,3)};I.greaterThan=I.gt=function(i){return this.cmp(i)>0};I.greaterThanOrEqualTo=I.gte=function(i){var e=this.cmp(i);return e==1||e===0};I.hyperbolicCosine=I.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/gn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Rt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return V(o,s.precision=t,s.rounding=n,!0)};I.hyperbolicSine=I.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Rt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/gn(5,i)),r=Rt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,V(r,e,t,!0)};I.hyperbolicTangent=I.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ce(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};I.inverseCosine=I.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ue(t,r,o):new t(0):new t(NaN):e.isZero()?Ue(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ue(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};I.inverseHyperbolicCosine=I.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,X=!1,t=t.times(t).minus(1).sqrt().plus(t),X=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};I.inverseHyperbolicSine=I.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,X=!1,t=t.times(t).plus(1).sqrt().plus(t),X=!0,n.precision=i,n.rounding=e,t.ln())};I.inverseHyperbolicTangent=I.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?V(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ce(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};I.inverseSine=I.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ue(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};I.inverseTangent=I.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&p+4<=Zn)return s=Ue(l,p+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(p+4<=Zn)return s=Ue(l,p+4,m).times(.5),s.s=u.s,s}for(l.precision=a=p+10,l.rounding=1,t=Math.min(28,a/q+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(X=!1,e=Math.ceil(a/q),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),X=!0,V(s,l.precision=p,l.rounding=m,!0)};I.isFinite=function(){return!!this.d};I.isInteger=I.isInt=function(){return!!this.d&&Ne(this.e/q)>this.d.length-2};I.isNaN=function(){return!this.s};I.isNegative=I.isNeg=function(){return this.s<0};I.isPositive=I.isPos=function(){return this.s>0};I.isZero=function(){return!!this.d&&this.d[0]===0};I.lessThan=I.lt=function(i){return this.cmp(i)<0};I.lessThanOrEqualTo=I.lte=function(i){return this.cmp(i)<1};I.logarithm=I.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,p=l.precision,m=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(X=!1,a=p+d,s=pt(u,a),n=e?fn(l,a+10):pt(i,a),c=ce(s,n,a,1),Wt(c.d,r=p,m))do if(a+=10,s=pt(u,a),n=e?fn(l,a+10):pt(i,a),c=ce(s,n,a,1),!o){+Se(c.d).slice(r+1,r+15)+1==1e14&&(c=V(c,p+1,0));break}while(Wt(c.d,r+=10,m));return X=!0,V(c,p,m)};I.minus=I.sub=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,y=d.constructor;if(i=new y(i),!d.d||!i.d)return!d.s||!i.s?i=new y(NaN):d.d?i.s=-i.s:i=new y(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(u=d.d,m=i.d,a=y.precision,c=y.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new y(d);else return new y(c===3?-0:0);return X?V(i,a,c):i}if(t=Ne(i.e/q),l=Ne(d.e/q),u=u.slice(),o=l-t,o){for(p=o<0,p?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/q),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,p=n<s,p&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){p=u[n]<m[n];break}o=0}for(p&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=Xe-1;--u[r],u[n]+=Xe}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=yn(u,t),X?V(i,a,c):i):new y(c===3?-0:0)};I.modulo=I.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?V(new n(t),n.precision,n.rounding):(X=!1,n.modulo==9?(e=ce(t,i.abs(),0,3,1),e.s*=i.s):e=ce(t,i,0,n.modulo,1),e=e.times(i),X=!0,t.minus(e))};I.naturalExponential=I.exp=function(){return Jn(this)};I.naturalLogarithm=I.ln=function(){return pt(this)};I.negated=I.neg=function(){var i=new this.constructor(this);return i.s=-i.s,V(i)};I.plus=I.add=function(i){var e,t,n,r,o,s,a,c,u,l,p=this,m=p.constructor;if(i=new m(i),!p.d||!i.d)return!p.s||!i.s?i=new m(NaN):p.d||(i=new m(i.d||p.s===i.s?p:NaN)),i;if(p.s!=i.s)return i.s=-i.s,p.minus(i);if(u=p.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(p)),X?V(i,a,c):i;if(o=Ne(p.e/q),n=Ne(i.e/q),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/q),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Xe|0,u[r]%=Xe;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=yn(u,n),X?V(i,a,c):i};I.precision=I.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(dt+i);return t.d?(e=ir(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};I.round=function(){var i=this,e=i.constructor;return V(new e(i),i.e+1,e.rounding)};I.sine=I.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+q,n.rounding=1,t=Fo(n,ar(n,t)),n.precision=i,n.rounding=e,V(it>2?t.neg():t,i,e,!0)):new n(NaN)};I.squareRoot=I.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(X=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Se(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ne((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(ce(s,o,t+2,1)).times(.5),Se(o.d).slice(0,t)===(e=Se(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(V(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(V(n,c+1,1),i=!n.times(n).eq(s));break}return X=!0,V(n,c,l.rounding,i)};I.tangent=I.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ce(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,V(it==2||it==4?t.neg():t,i,e,!0)):new n(NaN)};I.times=I.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,p=l.constructor,m=l.d,d=(i=new p(i)).d;if(i.s*=l.s,!m||!m[0]||!d||!d[0])return new p(!i.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?i.s/0:i.s*0);for(t=Ne(l.e/q)+Ne(i.e/q),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+d[n]*m[r-n-1]+e,o[r--]=a%Xe|0,e=a/Xe|0;o[r]=(o[r]+e)%Xe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=yn(o,t),X?V(i,p.precision,p.rounding):i};I.toBinary=function(i,e){return ei(this,2,i,e)};I.toDecimalPlaces=I.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Oe(i,0,ft),e===void 0?e=n.rounding:Oe(e,0,8),V(t,i+t.e+1,e))};I.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=je(n,!0):(Oe(i,0,ft),e===void 0?e=r.rounding:Oe(e,0,8),n=V(new r(n),i+1,e),t=je(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=je(r):(Oe(i,0,ft),e===void 0?e=o.rounding:Oe(e,0,8),n=V(new o(r),i+r.e+1,e),t=je(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};I.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,p,m,d=this,y=d.d,f=d.constructor;if(!y)return new f(d);if(u=t=new f(1),n=c=new f(0),e=new f(n),o=e.e=ir(y)-d.e-1,s=o%q,e.d[0]=Te(10,s<0?q+s:s),i==null)i=o>0?e:u;else{if(a=new f(i),!a.isInt()||a.lt(u))throw Error(dt+a);i=a.gt(e)?o>0?e:u:a}for(X=!1,a=new f(Se(y)),l=f.precision,f.precision=o=y.length*q*2;p=ce(a,e,0,1,1),r=t.plus(p.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(p.times(r)),c=r,r=e,e=a.minus(p.times(r)),a=r;return r=ce(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=d.s,m=ce(u,n,o,1).minus(d).abs().cmp(ce(c,t,o,1).minus(d).abs())<1?[u,n]:[c,t],f.precision=l,X=!0,m};I.toHexadecimal=I.toHex=function(i,e){return ei(this,16,i,e)};I.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Oe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(X=!1,t=ce(t,i,0,e,1).times(i),X=!0,V(t)):(i.s=t.s,t=i),t};I.toNumber=function(){return+this};I.toOctal=function(i,e){return ei(this,8,i,e)};I.toPower=I.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(Te(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return V(a,n,o);if(e=Ne(i.e/q),e>=i.d.length-1&&(t=u<0?-u:u)<=Mo)return r=rr(c,a,t,n),i.s<0?new c(1).div(r):V(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=Te(+a,u),e=t==0||!isFinite(t)?Ne(u*(Math.log("0."+Se(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(X=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Jn(i.times(pt(a,n+t)),n),r.d&&(r=V(r,n+5,1),Wt(r.d,n,o)&&(e=n+10,r=V(Jn(i.times(pt(a,e+t)),e),e+5,1),+Se(r.d).slice(n+1,n+15)+1==1e14&&(r=V(r,n+1,0)))),r.s=s,X=!0,c.rounding=o,V(r,n,o))};I.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=je(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Oe(i,1,ft),e===void 0?e=r.rounding:Oe(e,0,8),n=V(new r(n),i,e),t=je(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toSignificantDigits=I.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Oe(i,1,ft),e===void 0?e=n.rounding:Oe(e,0,8)),V(new n(t),i,e)};I.toString=function(){var i=this,e=i.constructor,t=je(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};I.truncated=I.trunc=function(){return V(new this.constructor(this),this.e+1,1)};I.valueOf=I.toJSON=function(){var i=this,e=i.constructor,t=je(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Se(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=q-n.length,t&&(o+=mt(t)),o+=n;s=i[e],n=s+"",t=q-n.length,t&&(o+=mt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Oe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(dt+i)}function Wt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=q,r=0):(r=Math.ceil((e+1)/q),e%=q),o=Te(10,q-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==Te(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==Te(10,e-3)-1,s}function mn(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Yn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function _o(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/gn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Rt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ce=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,p,m,d,y,f,b,g,A,w,h,B,P,x,S,M,T,L,Q,F=n.constructor,te=n.s==r.s?1:-1,j=n.d,W=r.d;if(!j||!j[0]||!W||!W[0])return new F(!n.s||!r.s||(j?W&&j[0]==W[0]:!W)?NaN:j&&j[0]==0||!W?te*0:te/0);for(c?(d=1,l=n.e-r.e):(c=Xe,d=q,l=Ne(n.e/d)-Ne(r.e/d)),L=W.length,M=j.length,g=new F(te),A=g.d=[],p=0;W[p]==(j[p]||0);p++);if(W[p]>(j[p]||0)&&l--,o==null?(P=o=F.precision,s=F.rounding):a?P=o+(n.e-r.e)+1:P=o,P<0)A.push(1),y=!0;else{if(P=P/d+2|0,p=0,L==1){for(m=0,W=W[0],P++;(p<M||m)&&P--;p++)x=m*c+(j[p]||0),A[p]=x/W|0,m=x%W|0;y=m||p<M}else{for(m=c/(W[0]+1)|0,m>1&&(W=i(W,m,c),j=i(j,m,c),L=W.length,M=j.length),S=L,w=j.slice(0,L),h=w.length;h<L;)w[h++]=0;Q=W.slice(),Q.unshift(0),T=W[0],W[1]>=c/2&&++T;do m=0,u=e(W,w,L,h),u<0?(B=w[0],L!=h&&(B=B*c+(w[1]||0)),m=B/T|0,m>1?(m>=c&&(m=c-1),f=i(W,m,c),b=f.length,h=w.length,u=e(f,w,b,h),u==1&&(m--,t(f,L<b?Q:W,b,c))):(m==0&&(u=m=1),f=W.slice()),b=f.length,b<h&&f.unshift(0),t(w,f,h,c),u==-1&&(h=w.length,u=e(W,w,L,h),u<1&&(m++,t(w,L<h?Q:W,h,c))),h=w.length):u===0&&(m++,w=[0]),A[p++]=m,u&&w[0]?w[h++]=j[S]||0:(w=[j[S]],h=1);while((S++<M||w[0]!==void 0)&&P--);y=w[0]!==void 0}A[0]||A.shift()}if(d==1)g.e=l,Ji=y;else{for(p=1,m=A[0];m>=10;m/=10)p++;g.e=p+l*d-1,V(g,a?o+g.e+1:o,s,y)}return g}}();function V(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor;e:if(e!=null){if(p=i.d,!p)return i;for(r=1,a=p[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=q,s=e,l=p[m=0],c=l/Te(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/q),a=p.length,m>=a)if(n){for(;a++<=m;)p.push(0);l=c=0,r=1,o%=q,s=o-q+1}else break e;else{for(l=a=p[m],r=1;a>=10;a/=10)r++;o%=q,s=o-q+r,c=s<0?0:l/Te(10,r-s-1)%10|0}if(n=n||e<0||p[m+1]!==void 0||(s<0?l:l%Te(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/Te(10,r-s):0:p[m-1])%10&1||t==(i.s<0?8:7)),e<1||!p[0])return p.length=0,u?(e-=i.e+1,p[0]=Te(10,(q-e%q)%q),i.e=-e||0):p[0]=i.e=0,i;if(o==0?(p.length=m,a=1,m--):(p.length=m+1,a=Te(10,q-o),p[m]=s>0?(l/Te(10,r-s)%Te(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=p[0];s>=10;s/=10)o++;for(s=p[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,p[0]==Xe&&(p[0]=1));break}else{if(p[m]+=a,p[m]!=Xe)break;p[m--]=0,a=1}for(o=p.length;p[--o]===0;)p.pop()}return X&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function je(i,e,t){if(!i.isFinite())return sr(i);var n,r=i.e,o=Se(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+mt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+mt(-r-1)+o,t&&(n=t-s)>0&&(o+=mt(n))):r>=s?(o+=mt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+mt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=mt(n))),o}function yn(i,e){var t=i[0];for(e*=q;t>=10;t/=10)e++;return e}function fn(i,e,t){if(e>Eo)throw X=!0,t&&(i.precision=t),Error($i);return V(new i(pn),e,1,!0)}function Ue(i,e,t){if(e>Zn)throw Error($i);return V(new i(dn),e,t,!0)}function ir(i){var e=i.length-1,t=e*q+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function mt(i){for(var e="";i--;)e+="0";return e}function rr(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/q+4);for(X=!1;;){if(t%2&&(o=o.times(e),ji(o.d,s)&&(r=!0)),t=Ne(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ji(e.d,s)}return X=!0,o}function Yi(i){return i.d[i.d.length-1]&1}function or(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Jn(i,e){var t,n,r,o,s,a,c,u=0,l=0,p=0,m=i.constructor,d=m.rounding,y=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(X=!1,c=y):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),p+=5;for(n=Math.log(Te(2,p))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=V(o.times(i),c,1),t=t.times(++l),a=s.plus(ce(o,t,c,1)),Se(a.d).slice(0,c)===Se(s.d).slice(0,c)){for(r=p;r--;)s=V(s.times(s),c,1);if(e==null)if(u<3&&Wt(s.d,c-n,d,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return V(s,m.precision=y,d,X=!0);else return m.precision=y,s}s=a}}function pt(i,e){var t,n,r,o,s,a,c,u,l,p,m,d=1,y=10,f=i,b=f.d,g=f.constructor,A=g.rounding,w=g.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new g(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(X=!1,l=w):l=e,g.precision=l+=y,t=Se(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Se(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return u=fn(g,l+2,w).times(o+""),f=pt(new g(n+"."+t.slice(1)),l-y).plus(u),g.precision=w,e==null?V(f,w,A,X=!0):f;for(p=f,c=s=f=ce(f.minus(1),f.plus(1),l,1),m=V(f.times(f),l,1),r=3;;){if(s=V(s.times(m),l,1),u=c.plus(ce(s,new g(r),l,1)),Se(u.d).slice(0,l)===Se(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(fn(g,l+2,w).times(o+""))),c=ce(c,new g(d),l,1),e==null)if(Wt(c.d,l-y,A,a))g.precision=l+=y,u=s=f=ce(p.minus(1),p.plus(1),l,1),m=V(f.times(f),l,1),r=a=1;else return V(c,g.precision=w,A,X=!0);else return g.precision=w,c;c=u,r+=2}}function sr(i){return String(i.s*i.s/0)}function $n(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%q,t<0&&(n+=q),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=q;n<r;)i.d.push(+e.slice(n,n+=q));e=e.slice(n),n=q-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),X&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function vo(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),nr.test(e))return $n(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Ro.test(e))t=16,e=e.toLowerCase();else if(Lo.test(e))t=2;else if(Oo.test(e))t=8;else throw Error(dt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=rr(n,new n(t),o,o*2)),u=mn(e,t,Xe),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=yn(u,l),i.d=u,X=!1,s&&(i=ce(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?Te(2,c):Vt.pow(2,c))),X=!0,i)}function Fo(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Rt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/gn(5,t)),e=Rt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Rt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,p=Math.ceil(l/q);for(X=!1,c=t.times(t),a=new i(n);;){if(s=ce(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ce(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[p]!==void 0){for(o=p;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return X=!0,s.d.length=p+1,s}function gn(i,e){for(var t=i;--e;)t*=i;return t}function ar(i,e){var t,n=e.s<0,r=Ue(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return it=n?4:1,e;if(t=e.divToInt(r),t.isZero())it=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return it=Yi(t)?n?2:3:n?4:1,e;it=Yi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function ei(i,e,t,n){var r,o,s,a,c,u,l,p,m,d=i.constructor,y=t!==void 0;if(y?(Oe(t,1,ft),n===void 0?n=d.rounding:Oe(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=sr(i);else{for(l=je(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=mn(je(m),10,r),m.e=m.d.length),p=mn(l,10,r),o=c=p.length;p[--c]==0;)p.pop();if(!p[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=p,i.e=o,i=ce(i,m,t,n,0,r),p=i.d,o=i.e,u=Ji),s=p[t],a=r/2,u=u||p[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&p[t-1]&1||n===(i.s<0?8:7)),p.length=t,u)for(;++p[--t]>r-1;)p[t]=0,t||(++o,p.unshift(1));for(c=p.length;!p[c-1];--c);for(s=0,l="";s<c;s++)l+=Yn.charAt(p[s]);if(y){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(p=mn(l,r,e),c=p.length;!p[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Yn.charAt(p[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ji(i,e){if(i.length>e)return i.length=e,!0}function Wo(i){return new this(i).abs()}function Vo(i){return new this(i).acos()}function Do(i){return new this(i).acosh()}function qo(i,e){return new this(i).plus(e)}function Go(i){return new this(i).asin()}function Uo(i){return new this(i).asinh()}function Xo(i){return new this(i).atan()}function zo(i){return new this(i).atanh()}function Ho(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ue(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ue(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ue(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ce(i,e,o,1)),e=Ue(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ce(i,e,o,1)),t}function Qo(i){return new this(i).cbrt()}function Yo(i){return V(i=new this(i),i.e+1,2)}function jo(i,e,t){return new this(i).clamp(e,t)}function Zo(i){if(!i||typeof i!="object")throw Error(bn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ft,"rounding",0,8,"toExpNeg",-Lt,0,"toExpPos",0,Lt,"maxE",0,Lt,"minE",-Lt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(Ne(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(dt+t+": "+n);if(t="crypto",r&&(this[t]=jn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(er);else this[t]=!1;else throw Error(dt+t+": "+n);return this}function Jo(i){return new this(i).cos()}function $o(i){return new this(i).cosh()}function ur(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Zi(o)){u.s=o.s,X?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;X?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return $n(u,o.toString())}else if(c!=="string")throw Error(dt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),nr.test(o)?$n(u,o):vo(u,o)}if(r.prototype=I,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Zo,r.clone=ur,r.isDecimal=Zi,r.abs=Wo,r.acos=Vo,r.acosh=Do,r.add=qo,r.asin=Go,r.asinh=Uo,r.atan=Xo,r.atanh=zo,r.atan2=Ho,r.cbrt=Qo,r.ceil=Yo,r.clamp=jo,r.cos=Jo,r.cosh=$o,r.div=es,r.exp=ts,r.floor=ns,r.hypot=is,r.ln=rs,r.log=os,r.log10=as,r.log2=ss,r.max=us,r.min=cs,r.mod=ls,r.mul=ms,r.pow=ps,r.random=ds,r.round=fs,r.sign=bs,r.sin=ys,r.sinh=gs,r.sqrt=ks,r.sub=Ps,r.sum=As,r.tan=ws,r.tanh=hs,r.trunc=Ts,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function es(i,e){return new this(i).div(e)}function ts(i){return new this(i).exp()}function ns(i){return V(i=new this(i),i.e+1,3)}function is(){var i,e,t=new this(0);for(X=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return X=!0,new this(1/0);t=e}return X=!0,t.sqrt()}function Zi(i){return i instanceof Vt||i&&i.toStringTag===tr||!1}function rs(i){return new this(i).ln()}function os(i,e){return new this(i).log(e)}function ss(i){return new this(i).log(2)}function as(i){return new this(i).log(10)}function us(){return or(this,arguments,"lt")}function cs(){return or(this,arguments,"gt")}function ls(i,e){return new this(i).mod(e)}function ms(i,e){return new this(i).mul(e)}function ps(i,e){return new this(i).pow(e)}function ds(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Oe(i,1,ft),n=Math.ceil(i/q),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(er);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=q,n&&i&&(r=Te(10,q-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=q)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<q&&(t-=q-n)}return s.e=t,s.d=a,s}function fs(i){return V(i=new this(i),i.e+1,this.rounding)}function bs(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function ys(i){return new this(i).sin()}function gs(i){return new this(i).sinh()}function ks(i){return new this(i).sqrt()}function Ps(i,e){return new this(i).sub(e)}function As(){var i=0,e=arguments,t=new this(e[i]);for(X=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return X=!0,V(t,this.precision,this.rounding)}function ws(i){return new this(i).tan()}function hs(i){return new this(i).tanh()}function Ts(i){return V(i=new this(i),i.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString;I[Symbol.toStringTag]="Decimal";var Vt=I.constructor=ur(jn);pn=new Vt(pn);dn=new Vt(dn);var E=Vt;import Ls from"big.js";import An from"bn.js";import Bs from"toformat";var Is=Bs,Dt=Is;import Pn from"big.js";import Ss from"bn.js";import Ks from"decimal.js-light";import qt from"bn.js";var cr=9007199254740991;function le(i){let e=ue("CobaltX_parseBigNumberish");if(i instanceof qt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new qt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=cr||i<=-cr)&&e.logWithError(`BigNumberish number overflow: ${i}`),new qt(String(i))):typeof i=="bigint"?new qt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new qt(0))}var kn=ue("module/fraction"),ti=Dt(Pn),Gt=Dt(Ks),Cs={[0]:Gt.ROUND_DOWN,[1]:Gt.ROUND_HALF_UP,[2]:Gt.ROUND_UP},Ns={[0]:Pn.roundDown,[1]:Pn.roundHalfUp,[2]:Pn.roundUp},oe=class{constructor(e,t=new Ss(1)){this.numerator=le(e),this.denominator=le(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new oe(this.denominator,this.numerator)}add(e){let t=e instanceof oe?e:new oe(le(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.add(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof oe?e:new oe(le(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.sub(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof oe?e:new oe(le(e));return new oe(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof oe?e:new oe(le(e));return new oe(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||kn.logWithError(`${e} is not an integer.`),e<=0&&kn.logWithError(`${e} is not positive.`),Gt.set({precision:e+1,rounding:Cs[n]});let r=new Gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||kn.logWithError(`${e} is not an integer.`),e<0&&kn.logWithError(`${e} is negative.`),ti.DP=e,ti.RM=Ns[n]||1,new ti(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Rs=ue("CobaltX_amount"),lr=Dt(Ls);function Os(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Rs.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var me=class extends oe{constructor(t,n,r=!0,o){let s=new An(0),a=ni.pow(new An(t.decimals));if(r)s=le(n);else{let c=new An(0),u=new An(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,p]=Os(n.toString(),t.decimals);c=le(l),u=le(p)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ue(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new me(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new me(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return lr.DP=this.token.decimals,new lr(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{TOKEN_PROGRAM_ID as mr}from"@solana/spl-token";import{PublicKey as Ms}from"@solana/web3.js";var ii={chainId:101,address:Ms.default.toBase58(),programId:mr.toBase58(),decimals:9,symbol:"ETH",name:"Ethereum",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}},Ze={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mr.toBase58(),decimals:9,symbol:"WETH",name:"Wrapped ETH",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}};import{PublicKey as si}from"@solana/web3.js";import{PublicKey as Ke,SystemProgram as pr,SYSVAR_RENT_PUBKEY as Es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _s}from"@solana/spl-token";function K({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ic=[K({pubkey:_s,isWritable:!1}),K({pubkey:pr.programId,isWritable:!1}),K({pubkey:Es,isWritable:!1})];function ri({publicKey:i,transformSol:e}){let t=oi(i.toString());if(t instanceof Ke)return e&&t.equals(Ut)?Ge:t;if(e&&t.toString()===Ut.toBase58())return Ge;if(typeof t=="string"){if(t===Ke.default.toBase58())return Ke.default;try{return new Ke(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function oi(i){try{return new Ke(i)}catch{return i}}var wn=new Ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ot=new Ke("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Je=new Ke("SysvarRent111111111111111111111111111111111"),rc=new Ke("SysvarC1ock11111111111111111111111111111111"),bt=new Ke("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),oc=new Ke("Sysvar1nstructions1111111111111111111111111"),vs=pr.programId,sc=new Ke("a2Gt18uJC8puJT9JRYQLU6rPi6okxQb4WqCjwtYshZB"),ac=new Ke("bXSKiFqYrALF9gJy1KqHm8tv4QXk8nCgbLN8WRsGEbh"),Ge=new Ke("So11111111111111111111111111111111111111112"),Ut=Ke.default,uc=new Ke("71kRXzJMvSeArtXYNEWa8KAjpRJosdMQ7Dpgy5Jt5zfd"),cc=new Ke("ERFzpDteGNo8LTDKW1WwVGrkRMmA2y9WZHXNHxMA6BSV");function Ye(i){return ri({publicKey:i,transformSol:!0})}var ai=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ut.toBase58()||e instanceof si&&Ut.equals(e)){this.decimals=Ze.decimals,this.symbol=Ze.symbol,this.name=Ze.name,this.mint=new si(Ze.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?si.default:ri({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=ai;_e.WSOL=new ai(Y(D({},Ze),{mint:Ze.address}));var ui=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},hn=ui;hn.SOL=new ui(ii);import Fs from"bn.js";var dr=new oe(new Fs(100)),rt=class extends oe{toSignificant(e=5,t,n){return this.mul(dr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(dr).toFixed(e,t,n)}};var Ws=ue("CobaltX_price"),Me=class extends oe{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new oe(ci(n.decimals),ci(r.decimals))}get raw(){return new oe(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Me({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ws.logWithError("mul token not equals");let n=super.mul(t);return new Me({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as Vs}from"@solana/web3.js";import Ds from"bn.js";function br(i){return typeof i=="object"&&i!==null&&![_e,me,Vs,oe,Ds,Me,rt].some(e=>typeof e=="object"&&i instanceof e)}function wt(i){return typeof i=="string"?oi(i):Array.isArray(i)?i.map(e=>wt(e)):br(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,wt(t)])):i}var fr=new ot(0),qs=new ot(1),rl=new ot(2),ol=new ot(3),sl=new ot(5),ni=new ot(10),al=new ot(100),ul=new ot(1e3),cl=new ot(1e4);function ci(i){return ni.pow(le(i))}function Hn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ys}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as js}from"@solana/spl-token";import{ComputeBudgetProgram as yr,Keypair as kr,PublicKey as Gs,Transaction as Pr,TransactionMessage as Us,VersionedTransaction as Ar}from"@solana/web3.js";var ee={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Xs}from"@solana/spl-token";var gr=ue("CobaltX_txUtil"),wr=1644;function Tn(i){let e=[],t=[];return i.microLamports&&(e.push(yr.setComputeUnitPrice({microLamports:i.microLamports})),t.push(ee.SetComputeUnitPrice)),i.units&&(e.push(yr.setComputeUnitLimit({units:i.units})),t.push(ee.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Mt(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function Bn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function zs(i,e){i.length<1&&gr.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&gr.logWithError(`no signers provided:, ${e.toString()}`);let t=new Pr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<wr}catch{return!1}}function Ae(i,e){let[t,n]=Gs.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Xt({instructions:i,payer:e,signers:t}){return zs(i,[e,...t])}function zt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=kr.generate().publicKey.toString()}){let o=new Us({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ar(o).serialize()).toString("base64").length<wr}catch{return!1}}var Hs=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),Qs=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Ar&&(e=Hs(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ht(i){let e=[];return i.forEach(t=>{t instanceof Pr&&(t.recentBlockhash||(t.recentBlockhash=Xs.toBase58()),t.feePayer||(t.feePayer=kr.generate().publicKey)),e.push(Qs(t))}),console.log("simulate tx string:",e),e}function pe(i,e,t){return Ae([i.toBuffer(),(t!=null?t:js).toBuffer(),e.toBuffer()],new Ys("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as J}from"@solana/web3.js";var Nl=new J("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Ll=new J("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Rl=new J("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ol=new J("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ml=new J("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),El=new J("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),li=new J("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),hr=new J("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),_l=new J("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Tr=new J("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),mi=new J("2TnjBuwqyBB9to5jURagDT7jLmBPefGRiKL2yh1zPZ4V"),Zs=new J("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Js=new J("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),vl=new J("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Fl=new J("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Wl=new J("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Vl=new J("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Dl=new J("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ql=new J("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),pi=new J("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),$s=new J("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Gl=new J("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ea=new J("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ta=new J("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),na=new J("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Ul=new J("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ia=new J("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Xl=new J("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ra=new J("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var zl={SERUM_MARKET:J.default,OPENBOOK_MARKET:new J("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:J.default,FarmV3:new J("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new J("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new J("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new J("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new J("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new J("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new J("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new J("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new J("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ea,CREATE_CPMM_POOL_AUTH:ta,CREATE_CPMM_POOL_FEE_ACC:na,FEE_DESTINATION_ID:new J("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ia,LCOK_CPMM_AUTH:ra};import ze from"bn.js";var Ht=1e4;function ge(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=Y(D({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ze(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ht){let c=new ze(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=In(i.mul(new ze(Ht)),new ze(Ht-o.transferFeeBasisPoints)),u=new ze(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,p=In(l.mul(new ze(o.transferFeeBasisPoints)),new ze(Ht)),m=p.gt(s)?s:p;return{amount:l,fee:m,expirationTime:a}}else{let c=In(i.mul(new ze(o.transferFeeBasisPoints)),new ze(Ht)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function He(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function In(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ze(0))?t.add(new ze(1)):t}import{PublicKey as Br,AddressLookupTableAccount as xn}from"@solana/web3.js";async function di({connection:i,address:e}){let t=await nt(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Br(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new xn({key:s,state:xn.deserialize(o.data)});n[s.toString()]=a,Sn[s.toString()]=a}return n}var Sn={AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM:new xn({key:new Br("AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM"),state:xn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Qt,sendAndConfirmTransaction as fi,Transaction as Yt,TransactionMessage as jt,VersionedTransaction as Zt}from"@solana/web3.js";import oa from"axios";var Kn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await oa.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=Tn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Qt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(D({},t||{})):this.build(t)}build(e){var n;let t=new Yt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await Mt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),ht([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await fi(this.connection,t,this.signers.find(p=>p.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var g;let{sequentially:p,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:y,skipPreflight:f=!0}=l||{},b=y!=null?y:await Mt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(p){let A=[],w=0;for(let h of s){if(++w,w<=d)continue;let B=await fi(this.connection,h,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(B)}return{txIds:A,signedTxs:s}}return{txIds:await await Promise.all(s.map(async A=>(A.recentBlockhash=b,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let A=s.map((h,B)=>(h.recentBlockhash=b,a[B].length&&h.sign(...a[B]),h));ht(A);let w=await this.signAllTransactions(A);if(p){let h=0,B=[],P=async()=>{if(!w[h])return;let x=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:f});B.push({txId:x,status:"sent",signedTx:w[h]}),m==null||m([...B]),h++,this.connection.onSignature(x,S=>{let M=B.findIndex(T=>T.txId===x);M>-1&&(B[M].status=S.err?"error":"success"),m==null||m([...B]),S.err||P()},"processed"),this.connection.getSignatureStatus(x)};return await P(),{txIds:B.map(x=>x.txId),signedTxs:w}}else{let h=[];for(let B=0;B<w.length;B+=1){let P=await this.connection.sendRawTransaction(w[B].serialize(),{skipPreflight:f});h.push(P)}return{txIds:h,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=y,s=Pt(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=D(D({},this.cluster==="devnet"?{}:Sn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Qt(b));let l=await di({connection:this.connection,address:u});for(let[b,g]of Object.entries(l))a[b]=g;let p=r?Qt.default.toBase58():o!=null?o:await Mt(this.connection,this.blockhashCommitment),m=new jt({payerKey:this.feePayer,recentBlockhash:p,instructions:[...this.allInstructions]}).compileToV0Message();((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Zt(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:g=!0,sendAndConfirm:A}=b||{};if(ht([d]),(w=this.owner)!=null&&w.isKeyPair){let h=await this.connection.sendTransaction(d,{skipPreflight:g});return A&&await Bn(this.connection,h),{txId:h,signedTx:d}}if(this.signAllTransactions){let h=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(h[0],{skipPreflight:g}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(p=>p.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,p)=>{l.sign(a[p])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var f;let{sequentially:p,onTxUpdate:m,recentBlockHash:d,skipPreflight:y=!0}=l||{};if(d&&s.forEach(b=>b.message.recentBlockhash=d),ht(s),(f=this.owner)!=null&&f.isKeyPair){if(p){let b=[];for(let g of s){let A=await this.connection.sendTransaction(g,{skipPreflight:y});await Bn(this.connection,A),b.push(A)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(p){let g=0,A=[],w=async()=>{if(!b[g])return;let h=await this.connection.sendTransaction(b[g],{skipPreflight:y});A.push({txId:h,status:"sent",signedTx:b[g]}),m==null||m([...A]),g++,this.connection.onSignature(h,B=>{let P=A.findIndex(x=>x.txId===h);P>-1&&(A[P].status=B.err?"error":"success"),m==null||m([...A]),B.err||w()},"processed"),this.connection.getSignatureStatus(h)};return w(),{txIds:[],signedTxs:b}}else{let g=[];for(let A=0;A<b.length;A+=1){let w=await this.connection.sendTransaction(b[A],{skipPreflight:y});g.push(w)}return{txIds:g,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var m;let p=e||{},{splitIns:t=[],computeBudgetConfig:n}=p,r=Pt(p,["splitIns","computeBudgetConfig"]),o=n?Tn(n):{instructions:[],instructionTypes:[]},s=this.signers.reduce((d,y)=>Y(D({},d),{[y.publicKey.toBase58()]:y}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(d=>{let y=[...u,d],f=n?[...o.instructions,...y]:y,g=[...new Set(y.map(A=>A.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(A=>new Qt(A));if(d!==t[l]&&u.length<12&&(Xt({instructions:f,payer:this.feePayer,signers:g})||Xt({instructions:y,payer:this.feePayer,signers:g})))u.push(d);else{if(u.length===0)throw Error("item ins too big");l+=d===t[l]?1:0,Xt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:g})?a.push(new Yt().add(...o.instructions,...u)):a.push(new Yt().add(...u)),c.push(Array.from(new Set(u.map(A=>A.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat())).map(A=>s[A]).filter(A=>A!==void 0)),u=[d]}}),u.length>0){let y=[...new Set(u.map(f=>f.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(f=>s[f]).filter(f=>f!==void 0);Xt({instructions:n?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:y.map(f=>f.publicKey)})?a.push(new Yt().add(...o.instructions,...u)):a.push(new Yt().add(...u)),c.push(y)}return a.forEach(d=>d.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&c.forEach(d=>{d.some(y=>y.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async d=>{var h;let{sequentially:y,onTxUpdate:f,skipTxCount:b=0,recentBlockHash:g,skipPreflight:A=!0}=d||{},w=g!=null?g:await Mt(this.connection,this.blockhashCommitment);if(a.forEach(async(B,P)=>{B.recentBlockhash=w,c[P].length&&B.sign(...c[P])}),ht(a),(h=this.owner)!=null&&h.isKeyPair){if(y){let B=0,P=[];for(let x of a){if(++B,B<=b){P.push("tx skipped");continue}let S=await fi(this.connection,x,this.signers.find(M=>M.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:A});P.push(S)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async B=>await this.connection.sendRawTransaction(B.serialize(),{skipPreflight:A}))),signedTxs:a}}if(this.signAllTransactions){let B=await this.signAllTransactions(a.slice(b,a.length)),P=[...a.slice(0,b),...B];if(y){let x=0,S=[],M=async()=>{if(!P[x])return;x<b&&(S.push({txId:"",status:"success",signedTx:P[x]}),f==null||f([...S]),x++,M());let T=await this.connection.sendRawTransaction(P[x].serialize(),{skipPreflight:A});S.push({txId:T,status:"sent",signedTx:P[x]}),f==null||f([...S]),x++,this.connection.onSignature(T,L=>{let Q=S.findIndex(F=>F.txId===T);Q>-1&&(S[Q].status=L.err?"error":"success"),f==null||f([...S]),L.err||M()},"processed"),this.connection.getSignatureStatus(T)};return await M(),{txIds:S.map(T=>T.txId),signedTxs:P}}else{let x=[];for(let S=0;S<P.length;S+=1){let M=await this.connection.sendRawTransaction(P[S].serialize(),{skipPreflight:A});x.push(M)}return{txIds:x,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var w;let A=e||{},{computeBudgetConfig:t,splitIns:n=[],lookupTableCache:r={},lookupTableAddress:o=[]}=A,s=Pt(A,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=D(D({},this.cluster==="devnet"?{}:Sn),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let h of c)a[h]===void 0&&u.push(new Qt(h));let l=await di({connection:this.connection,address:u});for(let[h,B]of Object.entries(l))a[h]=B;let p=t?Tn(t):{instructions:[],instructionTypes:[]},m=await Mt(this.connection,this.blockhashCommitment),d=this.signers.reduce((h,B)=>Y(D({},h),{[B.publicKey.toBase58()]:B}),{}),y=[],f=[],b=[],g=0;if(this.allInstructions.forEach(h=>{let B=[...b,h],P=t?[...p.instructions,...B]:B;if(h!==n[g]&&b.length<12&&(zt({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||zt({instructions:B,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(h);else{if(b.length===0)throw Error("item ins too big");g+=h===n[g]?1:0;let x={};for(let S of[...new Set(c)])a[S]!==void 0&&(x[S]=a[S]);if(t&&zt({instructions:[...p.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let S=new jt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions,...b]}).compileToV0Message(Object.values(a));y.push(new Zt(S))}else{let S=new jt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));y.push(new Zt(S))}f.push(Array.from(new Set(b.map(S=>S.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat())).map(S=>d[S]).filter(S=>S!==void 0)),b=[h]}}),b.length>0){let B=[...new Set(b.map(P=>P.keys.filter(x=>x.isSigner).map(x=>x.pubkey.toString())).flat()).values()].map(P=>d[P]).filter(P=>P!==void 0);if(t&&zt({instructions:[...p.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let P=new jt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...p.instructions,...b]}).compileToV0Message(Object.values(a));y.push(new Zt(P))}else{let P=new jt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));y.push(new Zt(P))}f.push(B)}return(w=this.owner)!=null&&w.signer&&f.forEach(h=>{h.some(B=>B.publicKey.equals(this.owner.publicKey))||h.push(this.owner.signer)}),{builder:this,transactions:y,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async h=>{var T;let{sequentially:B,onTxUpdate:P,skipTxCount:x=0,recentBlockHash:S,skipPreflight:M=!0}=h||{};if(y.map(async(L,Q)=>{f[Q].length&&L.sign(f[Q]),S&&(L.message.recentBlockhash=S)}),ht(y),(T=this.owner)!=null&&T.isKeyPair){if(B){let L=0,Q=[];for(let F of y){if(++L,L<=x){console.log("skip tx: ",L),Q.push("tx skipped");continue}let te=await this.connection.sendTransaction(F,{skipPreflight:M});await Bn(this.connection,te),Q.push(te)}return{txIds:Q,signedTxs:y}}return{txIds:await Promise.all(y.map(async L=>await this.connection.sendTransaction(L,{skipPreflight:M}))),signedTxs:y}}if(this.signAllTransactions){let L=await this.signAllTransactions(y.slice(x,y.length)),Q=[...y.slice(0,x),...L];if(B){let F=0,te=[],j=async()=>{if(!Q[F])return;if(F<x){te.push({txId:"",status:"success",signedTx:Q[F]}),P==null||P([...te]),F++,j();return}let W=await this.connection.sendTransaction(Q[F],{skipPreflight:M});te.push({txId:W,status:"sent",signedTx:Q[F]}),P==null||P([...te]),F++,this.connection.onSignature(W,kt=>{let un=te.findIndex(cn=>cn.txId===W);un>-1&&(te[un].status=kt.err?"error":"success"),P==null||P([...te]),kt.err||j()},"processed"),this.connection.getSignatureStatus(W)};return j(),{txIds:[],signedTxs:Q}}else{let F=[];for(let te=0;te<Q.length;te+=1){let j=await this.connection.sendTransaction(Q[te],{skipPreflight:M});F.push(j)}return{txIds:F,signedTxs:Q}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{createTransferInstruction as wo,TOKEN_2022_PROGRAM_ID as Gn,TOKEN_PROGRAM_ID as Pe}from"@solana/spl-token";import{PublicKey as Nt}from"@solana/web3.js";import Un from"bn.js";import{PublicKey as fa}from"@solana/web3.js";import Cr,{isBN as Nr}from"bn.js";import{bits as Nm,BitStructure as Lm,blob as sa,Blob as Rm,cstr as Om,f32 as Mm,f32be as Em,f64 as _m,f64be as vm,greedy as Fm,Layout as aa,ns64 as Wm,ns64be as Vm,nu64 as Dm,nu64be as qm,offset as Gm,s16 as Um,s16be as Xm,s24 as zm,s24be as Hm,s32 as ua,s32be as Qm,s40 as Ym,s40be as jm,s48 as Zm,s48be as Jm,s8 as $m,seq as ca,struct as ep,Structure as la,u16 as ma,u16be as tp,u24 as np,u24be as ip,u32 as rp,u32be as op,u40 as sp,u40be as ap,u48 as up,u48be as cp,u8 as pa,UInt as da,union as lp,Union as mp,unionLayoutDiscriminator as pp,utf8 as dp}from"@solana/buffer-layout";var bi=aa,xr=la;var yi=da;var Sr=pa,Tt=ma;var de=ua;var Kr=ca;var we=sa;var Et=class extends bi{constructor(t,n,r){super(t,r);this.blob=we(t),this.signed=n}decode(t,n=0){let r=new Cr(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Cr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function U(i){return new yi(1,i)}function ve(i){return new yi(4,i)}function k(i){return new Et(8,!1,i)}function z(i){return new Et(16,!1,i)}function Lr(i){return new Et(8,!0,i)}function Rr(i){return new Et(16,!0,i)}var Cn=class extends bi{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function N(i){return new Cn(we(32),e=>new fa(e),e=>e.toBuffer(),i)}function Ie(i){return new Cn(Sr(),ba,ya,i)}function ba(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ya(i){return i?1:0}var gi=class extends xr{decode(e,t){return super.decode(e,t)}};function _(i,e,t){return new gi(i,e,t)}function ne(i,e,t){let n,r=typeof e=="number"?e:Nr(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Nr(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Kr(i,r,t)}import{PublicKey as Ia,SystemProgram as xa}from"@solana/web3.js";import Sa from"bn.js";import{createCloseAccountInstruction as Ka,createInitializeAccountInstruction as Ca,createTransferInstruction as sd,TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";function ga(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function ki(i,...e){if(!ga(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Pi(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function Or(i,e){ki(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var Ln=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),Qe=(i,e)=>i<<32-e|i>>>e;var Kp=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ka(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Ai(i){return typeof i=="string"&&(i=ka(i)),ki(i),i}var Nn=class{clone(){return this._cloneInto()}},Cp={}.toString;function Mr(i){let e=n=>i().update(Ai(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function Pa(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var Er=(i,e,t)=>i&e^~i&t,_r=(i,e,t)=>i&e^i&t^e&t,Rn=class extends Nn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ln(this.buffer)}update(e){Pi(this);let{view:t,buffer:n,blockLen:r}=this;e=Ai(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=Ln(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Pi(this),Or(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let p=s;p<r;p++)t[p]=0;Pa(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=Ln(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<u;p++)a.setUint32(4*p,l[p],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Aa=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gt=new Uint32Array(64),wi=class extends Rn{constructor(){super(64,32,8,!1),this.A=yt[0]|0,this.B=yt[1]|0,this.C=yt[2]|0,this.D=yt[3]|0,this.E=yt[4]|0,this.F=yt[5]|0,this.G=yt[6]|0,this.H=yt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let p=0;p<16;p++,t+=4)gt[p]=e.getUint32(t,!1);for(let p=16;p<64;p++){let m=gt[p-15],d=gt[p-2],y=Qe(m,7)^Qe(m,18)^m>>>3,f=Qe(d,17)^Qe(d,19)^d>>>10;gt[p]=f+gt[p-7]+y+gt[p-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let p=0;p<64;p++){let m=Qe(a,6)^Qe(a,11)^Qe(a,25),d=l+m+Er(a,c,u)+Aa[p]+gt[p]|0,f=(Qe(n,2)^Qe(n,13)^Qe(n,22))+_r(n,r,o)|0;l=u,u=c,c=a,a=s+d|0,s=o,o=r,r=n,n=d+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){gt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var vr=Mr(()=>new wi);import{TOKEN_PROGRAM_ID as wa}from"@solana/spl-token";import{Keypair as ha,PublicKey as Ta}from"@solana/web3.js";import zp from"bn.js";var On=_([N("mint"),N("owner"),k("amount"),ve("delegateOption"),N("delegate"),U("state"),ve("isNativeOption"),k("isNative"),k("delegatedAmount"),ve("closeAuthorityOption"),N("closeAuthority")]);var Yp=ue("CobaltX_Util");function Fr({fromPublicKey:i,programId:e=wa,assignSeed:t}){let n=t?btoa(t).slice(0,32):ha.generate().publicKey.toBase58().slice(0,32);return{publicKey:Ba(i,n,e),seed:n}}function Ba(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=vr(n);return new Ta(r)}function Na(i){let{mint:e,tokenAccount:t,owner:n,programId:r=Jt}=i;return Ca(t,e,n,r)}function $t(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=Jt}=i;return Ka(e,t,r,n,o)}async function hi(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(On.span,n),c=le(t).add(new Sa(a)),u=Fr({fromPublicKey:r,programId:Jt});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[xa.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:On.span,programId:Jt}),Na({mint:new Ia(Ze.address),tokenAccount:u.publicKey,owner:o,programId:Jt})],instructionTypes:[ee.CreateAccount,ee.InitAccount],endInstructionTypes:s?[]:[ee.CloseAccount],endInstructions:s?[]:[$t({tokenAccount:u.publicKey,payer:r,owner:o})]}}import{AccountLayout as db,TOKEN_2022_PROGRAM_ID as fb,TOKEN_PROGRAM_ID as bb}from"@solana/spl-token";import{PublicKey as gb}from"@solana/web3.js";import Pb from"bn.js";var Ti=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),_t=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ue(t)}createTxBuilder(e){return this.scope.checkOwner(),new Kn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Ti(e))}logInfo(...e){this.logger.info(Ti(e))}logAndCreateError(...e){let t=Ti(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as kd}from"@solana/web3.js";import{MintLayout as Ad,TOKEN_PROGRAM_ID as hd}from"@solana/spl-token";var Wr=i=>new _e({mint:i.address,decimals:i.decimals,symbol:i.symbol,name:i.name}),en=r=>{var o=r,{amount:i,isRaw:e,name:t}=o,n=Pt(o,["amount","isRaw","name"]);return new me(new _e({mint:Ye(n.address).toBase58(),decimals:n.decimals,symbol:n.symbol,name:t}),i,e,t)};var Bt=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=Pt(o,["address","programId","decimals"]);return D({chainId:101,address:Ye(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};import{ASSOCIATED_TOKEN_PROGRAM_ID as an,TOKEN_2022_PROGRAM_ID as ye,TOKEN_PROGRAM_ID as ae}from"@solana/spl-token";import{Keypair as Vn,PublicKey as C,SystemProgram as ct,TransactionInstruction as Ce}from"@solana/web3.js";import Oi from"bn.js";import Va from"bn.js";import qe from"bn.js";var ke=new qe(0),Fe=new qe(1),st=new qe(-1),We=new qe(1).shln(64),Mn=new qe(1).shln(128),Bi=We.sub(Fe),tn=64,Vr=Mn.subn(1),Le=-443636,Re=-Le,$e=new qe("4295048016"),et=new qe("79226673521066979257578248091"),En=new qe("4295048017"),_n=new qe("79226673521066979257578248090"),Dr=16,qr="59543866431248",Gr="184467440737095516",Ur="15793534762490258745",vn=new qe(10).pow(new qe(6));var Cd=new qe("18446744073700000000");import $ from"bn.js";function Fn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Ii(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function xi(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function nn(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Xr(i,e){return nn(i,e)?null:Ii(i,e)}function zr(i,e){return nn(i,e)?null:xi(i,e)}var Ed=Buffer.from("amm_config","utf8"),La=Buffer.from("pool","utf8"),Ra=Buffer.from("pool_vault","utf8"),Oa=Buffer.from("pool_reward_vault","utf8"),Hr=Buffer.from("position","utf8"),Ma=Buffer.from("tick_array","utf8"),Ea=Buffer.from("operation","utf8"),_a=Buffer.from("pool_tick_array_bitmap_extension","utf8"),va=Buffer.from("observation","utf8");function Qr(i,e,t,n){return Ae([La,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Si(i,e,t){return Ae([Ra,e.toBuffer(),t.toBuffer()],i)}function Yr(i,e,t){return Ae([Oa,e.toBuffer(),t.toBuffer()],i)}function se(i,e,t){return Ae([Ma,e.toBuffer(),Fn(t)],i)}function at(i,e,t,n){return Ae([Hr,e.toBuffer(),Fn(t),Fn(n)],i)}function Ee(i,e){return Ae([Hr,e.toBuffer()],i)}function vt(i){return Ae([Buffer.from("metadata","utf8"),bt.toBuffer(),i.toBuffer()],bt)}function Wn(i){return Ae([Ea],i)}function he(i,e){return Ae([_a,e.toBuffer()],i)}function jr(i,e){return Ae([va,e.toBuffer()],i)}var Zr=Buffer.from("locked_position","utf8");function Ki(i,e){return Ae([Zr,e.toBuffer()],i)}function Ci(i,e){return Ae([Zr,e.toBuffer()],i)}import{TOKEN_2022_PROGRAM_ID as Jr}from"@solana/spl-token";import{PublicKey as Ve}from"@solana/web3.js";import fe from"bn.js";import tt from"bn.js";var rn=class{static getfeeGrowthInside(e,t,n){let r=new tt(0),o=new tt(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new tt(0),a=new tt(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),c=t.tokenFeesOwedA.add(a),u=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=Z.wrappingSubU128(c,u.growthInsideLastX64),p=Z.mulDivFloor(l,t.liquidity,We),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=Z.wrappingSubU128(c,u.growthInsideLastX64),p=Z.mulDivFloor(l,t.liquidity,We),m=u.rewardAmountOwed.add(p);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new tt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new tt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new tt(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new tt(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,g,A,w;let a=H.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),c=H.getSqrtPriceX64FromTick(t.tickLower),u=H.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,p=re.getAmountsFromLiquidity(a,c,u,n,o),[m,d]=[ge(p.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ge(p.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[ge(new tt(new E(p.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),ge(new tt(new E(p.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:He(m.expirationTime,d.expirationTime)}}};var Fa=15,ie=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=v.getTickArrayStartIndexByTick(r,o),l=v.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Fa/2));for(let d=0;d<l.length;d++){let{publicKey:y}=se(t,n,l[d]);c.push(y)}let p=(await nt(e,c)).map(d=>d!==null?on.decode(d.data):null),m={};for(let d=0;d<c.length;d++){let y=p[d];y!==null&&(m[y.startTickIndex]=Y(D({},y),{address:c[d]}))}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=v.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:p,tickArrayAddress:m,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[p,m,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/ie.tickCount(t)),a=n?v.searchLowBitFromStart(r,o,s-1,1,t):v.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=Be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<Be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=se(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=v.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<Be;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:p}=se(e,t,a);return{initializedTick:l,tickArrayAddress:p,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(v.checkIsOutOfBoundary(e)){if(e>Re)return!1;let n=v.getTickArrayStartIndexByTick(Le,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Be*e}};var Ni=14,ut=class{static maxTickInTickarrayBitmap(e){return e*Be*It}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!ie.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-ie.tickCount(n):t+ie.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),p=Xr(1024,l);if(p!==null){let m=(u-p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),p=zr(1024,l);if(p!==null){let m=(u+p-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-ie.tickCount(n)}}}},sn=class{static getBitmapOffset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=ut.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=ut.maxTickInTickarrayBitmap(e),n=-t;if(Re<=t)throw Error(`extensionTickBoundary check error: ${Re}, ${t}`);if(n<=Le)throw Error(`extensionTickBoundary check error: ${n}, ${Le}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:v.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=ie.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=ut.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=v.mergeTickArrayBitmap(e).shln(It-1-a),u=nn(512,c)?null:Ii(512,c);if(u!==null){let l=t-u*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=v.mergeTickArrayBitmap(e).shrn(a),u=nn(512,c)?null:xi(512,c);if(u!==null){let l=t+u*ie.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ie.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%ut.maxTickInTickarrayBitmap(t),r=Math.floor(n/ie.tickCount(t));return e<0&&n!=0&&(r=It-r),r}};var be=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:p}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!p)throw new Error("Invalid tick array");c.push(p);let{allTrade:m,amountCalculated:d,accounts:y,sqrtPriceX64:f,feeAmount:b}=xt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...y),{allTrade:m,expectedAmountOut:d.mul(st),remainingAccounts:c,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=se(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:p,accounts:m,sqrtPriceX64:d,feeAmount:y}=xt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(st),u,o);return a.push(...m),{expectedAmountIn:p,remainingAccounts:a,executionPrice:d,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=be.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?sn.checkTickArrayIsInit(ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):v.checkTickArrayIsInitialized(v.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=se(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=se(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ie.tickCount(e.tickSpacing)),r=t?v.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):v.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ie.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=ut.nextInitializedTickArrayStartIndex(v.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=sn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Le||t>Re)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let p=o[l],m=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(p.tokenMint))==null?void 0:c.owner;if(m===void 0)throw Error("get new reward mint info error");let d=Y(D({},p),{perSecond:Z.x64ToDecimal(p.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(m)});if(d.tokenMint.equals(Ve.default))continue;if(n<=d.openTime.toNumber()||r.eq(ke)){s.push(d);continue}let y=new fe(Math.min(d.endTime.toNumber(),n)),f=y.sub(d.lastUpdateTime),b=Z.mulDivFloor(f,d.emissionsPerSecondX64,r),g=d.rewardGrowthGlobalX64.add(b),A=Z.mulDivFloor(f,d.emissionsPerSecondX64,We),w=d.rewardTotalEmissioned.add(A);s.push(Y(D({},d),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:w,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=v.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=ut.maxTickInTickarrayBitmap(e),n=-t;return t>Re&&(t=ie.getArrayStartIndex(Re,e)+ie.tickCount(e)),n<Le&&(n=ie.getArrayStartIndex(Le,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ie.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ie.tickCount(t)*It}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await At(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=$r.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=v.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=v.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let p of l){let{publicKey:m}=se(c.programId,c.id,p);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await At(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=on.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=Y(D({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of c)for(let d of s)u.push(Ee(d,m).publicKey);let l=await nt(t,u,{batchRequest:r}),p={};for(let m of l){if(m===null)continue;let d=Li.decode(m.data),y=d.poolId.toString(),f=e.find(S=>S.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,g=v._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),A=v._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:w,amountB:h}=re.getAmountsFromLiquidity(b.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,d.liquidity,!1),B=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:g.price,priceUpper:A.price,amountA:w,amountB:h,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(S=>Y(D({},S),{pendingReward:new fe(0)})),leverage:B,tokenFeeAmountA:new fe(0),tokenFeeAmountB:new fe(0)}];let P=await v.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),x=await v.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);p[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=P,p[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=x}if(o){let m=Object.values(p),d=await nt(t,m,{batchRequest:r}),y={};for(let f=0;f<m.length;f++){let b=d[f];if(b===null)continue;let g=m[f].toString();y[g]=on.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let g of b){let A=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,h=y[p[A].toString()],B=y[p[w].toString()],P=h.ticks[v.getTickOffsetInArray(g.tickLower,f.tickSpacing)],x=B.ticks[v.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:S,tokenFeeAmountB:M}=await rn.GetPositionFees(f,g,P,x),T=await rn.GetPositionRewards(f,g,P,x);g.tokenFeeAmountA=S.gte(new fe(0))?S:new fe(0),g.tokenFeeAmountB=M.gte(new fe(0))?M:new fe(0);for(let L=0;L<T.length;L++)g.rewardInfos[L].pendingReward=T[L].gte(new fe(0))?T[L]:new fe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new E(0),catchLiquidityInsufficient:c=!1}){var Q;let u,l=n.toBase58()===e.mintA.address,[p,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new E(0))?u=l?$e.add(new fe(1)):et.sub(new fe(1)):u=H.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=ge(o,p,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:g,feeAmount:A}=be.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((Q=d.fee)!=null?Q:ke),u,c),w=ge(f,m,r,!1),h=H.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),B=l?h:new E(1).div(h),P=f.mul(new fe(Math.floor((1-s)*1e10))).div(new fe(1e10)),x=ge(P,m,r,!1),S=l?e.currentPrice:new E(1).div(e.currentPrice),M=new E(B).sub(S).abs(),T=S,L=new rt(new E(M).mul(10**15).toFixed(0),new E(T).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:d,amountOut:w,minAmountOut:x,expirationTime:He(d.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:B,priceImpact:L,fee:A,remainingAccounts:b,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[p,m]=[new _e(Y(D({},u),{mint:u.address,isToken2022:u.programId===Jr.toBase58()})),new _e(Y(D({},l),{mint:l.address,isToken2022:l.programId===Jr.toBase58()}))],{allTrade:d,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:g,currentPrice:A,executionPrice:w,priceImpact:h,fee:B,remainingAccounts:P,executionPriceX64:x}=be.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),S=Y(D({},y),{amount:new me(p,y.amount),fee:y.fee===void 0?void 0:new me(p,y.fee)}),M=Y(D({},f),{amount:new me(m,f.amount),fee:f.fee===void 0?void 0:new me(m,f.fee)}),T=Y(D({},b),{amount:new me(m,b.amount),fee:b.fee===void 0?void 0:new me(m,b.fee)}),L=new Me({baseToken:p,denominator:new fe(10).pow(new fe(20+p.decimals)),quoteToken:m,numerator:A.mul(new E(10**(20+m.decimals))).toFixed(0)}),Q=new Me({baseToken:p,denominator:new fe(10).pow(new fe(20+p.decimals)),quoteToken:m,numerator:w.mul(new E(10**(20+m.decimals))).toFixed(0)}),F=new me(p,B);return{allTrade:d,realAmountIn:S,amountOut:M,minAmountOut:T,expirationTime:g,currentPrice:L,executionPrice:Q,priceImpact:h,fee:F,remainingAccounts:P,executionPriceX64:x}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new E(0)}){var T;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new E(0))?l=c?et.sub(new fe(1)):$e.add(new fe(1)):l=H.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ge(o,u[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:d,executionPrice:y,feeAmount:f}=be.getInputAmountAndRemainAccounts(e,t,n,p.amount.sub((T=p.fee)!=null?T:ke),l),b=c?e.mintB.address:e.mintA.address,g=ge(m,u[b],r,!1),A=H.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),w=c?A:new E(1).div(A),h=m.mul(new fe(Math.floor((1+s)*1e10))).div(new fe(1e10)),B=ge(h,u[b],r,!0),P=c?e.currentPrice:new E(1).div(e.currentPrice),x=new E(w).sub(P).abs(),S=P,M=new rt(new E(x).mul(10**15).toFixed(0),new E(S).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:B,realAmountOut:p,expirationTime:He(g.expirationTime,p.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:M,fee:f,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=v.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=v.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,p=a-s,m=o.priceMax-o.priceMin,d;return l<=0?d=0:p===l?d=m/l:m===l?d=l/p:d=l/m*(l/p),{feeApr:o.feeApr*d,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*d,((f=o.rewardApr[1])!=null?f:0)*d,((b=o.rewardApr[2])!=null?b:0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],p=r[Ye(e.mintA.address).toString()],m=r[Ye(e.mintB.address).toString()],d=e.mintA.decimals,y=e.mintB.decimals;if(!l||!p||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=H.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),b=H.getSqrtPriceX64FromTick(s),g=H.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=re.getAmountsFromLiquidityWithSlippage(f,b,g,t,!1,!1,0),{amountSlippageA:h,amountSlippageB:B}=re.getAmountsFromLiquidityWithSlippage(f,b,g,o,!1,!1,0),P=new E(A.toString()).div(new E(10).pow(d)).mul(p.value).add(new E(w.toString()).div(new E(10).pow(y)).mul(m.value)),x=new E(h.toString()).div(new E(10).pow(d)).mul(p.value).add(new E(B.toString()).div(new E(10).pow(y)).mul(m.value)),S=new E(1).div(P.add(x)),T=new E(l.volumeFee).mul(365).div(u).mul(S).mul(100).toNumber(),L=3600*24*365,Q=e.rewardDefaultInfos.map(F=>{var W,kt;let te=F.mint.decimals,j=r[F.mint.address];return c<((W=F.startTime)!=null?W:0)||c>((kt=F.endTime)!=null?kt:0)||!F.perSecond||!j||te===void 0?0:new E(j.value).mul(new E(F.perSecond).mul(L)).div(new E(10).pow(te)).mul(S).mul(100).toNumber()});return{feeApr:T,rewardsApr:Q,apr:T+Q.reduce((F,te)=>F+te,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var g,A;let l=H.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),p=H.getSqrtPriceX64FromTick(n),m=H.getSqrtPriceX64FromTick(r),d=a?1-s:1+s,y=ge(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,c,!u),f=new fe(new E(y.amount.sub((A=y.fee)!=null?A:ke).toString()).mul(d).toFixed(0)),b;if(l.lte(p))b=t?re.getLiquidityFromTokenAmountA(p,m,f,!a):new fe(0);else if(l.lte(m)){let w=re.getLiquidityFromTokenAmountA(l,m,f,!a),h=re.getLiquidityFromTokenAmountB(p,l,f);b=t?w:h}else b=t?new fe(0):re.getLiquidityFromTokenAmountB(p,m,f);return be.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,g,A,w;let c=H.getSqrtPriceX64FromTick(n),u=H.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,p=re.getAmountsFromLiquidity(H.priceToSqrtPriceX64(new E(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,d]=[ge(p.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ge(p.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[ge(p.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),ge(p.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:d,amountSlippageA:y,amountSlippageB:f,expirationTime:He(m.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ve(c.id));(await nt(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=Ft.decode(c.data))});let s=t.map(c=>he(new Ve(c.programId),new Ve(c.id)).publicKey),a=await be.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>Y(D({},c),{[u.id]:Y(D({},n[u.id]),{id:new Ve(u.id),version:6,programId:new Ve(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:Y(D({},u.config),{id:new Ve(u.config.id),fundOwner:""}),currentPrice:new E(u.price),exBitmapAccount:he(new Ve(u.programId),new Ve(u.id)).publicKey,exBitmapInfo:a[he(new Ve(u.programId),new Ve(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var Z=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ke)||(o=o.add(Fe)),o}static mulDivFloor(e,t,n){if(n.eq(ke))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ke))throw new Error("division by 0");return e.mul(t).add(n.sub(Fe)).div(n)}static x64ToDecimal(e,t){return new E(e.toString()).div(E.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new $(e.mul(E.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Mn).sub(t).mod(Mn)}};function xe(i,e){return Ri(i.mul(e),64,256)}function Wa(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Ri(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var H=class{static sqrtPriceX64ToPrice(e,t,n){return Z.x64ToDecimal(e).pow(2).mul(E.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return Z.decimalToX64(e.mul(E.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ke))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ke))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ke))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ke))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ke))return e;let o=t.shln(tn);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?Z.mulDivCeil(s,e,a):Z.mulDivRoundingUp(s,Fe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return Z.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(tn);if(r)return e.add(o.div(t));{let s=Z.mulDivRoundingUp(o,Fe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Le||e>Re)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new $("18445821805675395072"):new $("18446744073709551616");return(t&2)!=0&&(n=xe(n,new $("18444899583751176192"))),(t&4)!=0&&(n=xe(n,new $("18443055278223355904"))),(t&8)!=0&&(n=xe(n,new $("18439367220385607680"))),(t&16)!=0&&(n=xe(n,new $("18431993317065453568"))),(t&32)!=0&&(n=xe(n,new $("18417254355718170624"))),(t&64)!=0&&(n=xe(n,new $("18387811781193609216"))),(t&128)!=0&&(n=xe(n,new $("18329067761203558400"))),(t&256)!=0&&(n=xe(n,new $("18212142134806163456"))),(t&512)!=0&&(n=xe(n,new $("17980523815641700352"))),(t&1024)!=0&&(n=xe(n,new $("17526086738831433728"))),(t&2048)!=0&&(n=xe(n,new $("16651378430235570176"))),(t&4096)!=0&&(n=xe(n,new $("15030750278694412288"))),(t&8192)!=0&&(n=xe(n,new $("12247334978884435968"))),(t&16384)!=0&&(n=xe(n,new $("8131365268886854656"))),(t&32768)!=0&&(n=xe(n,new $("3584323654725218816"))),(t&65536)!=0&&(n=xe(n,new $("696457651848324352"))),(t&131072)!=0&&(n=xe(n,new $("26294789957507116"))),(t&262144)!=0&&(n=xe(n,new $("37481735321082"))),e>0&&(n=Vr.div(n)),n}static getTickFromPrice(e,t,n){return H.getTickFromSqrtPriceX64(H.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(et)||e.lt($e))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new $(t-64),r=Wa(n,32,128),o=new $("8000000000000000","hex"),s=0,a=new $(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new $(0))&&s<Dr;){c=c.mul(c);let y=c.shrn(127);c=c.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let u=a.shrn(32),p=r.add(u).mul(new $(qr)),m=Ri(p.sub(new $(Gr)),64,128).toNumber(),d=Ri(p.add(new $(Ur)),64,128).toNumber();return m==d?m:H.getSqrtPriceX64FromTick(d).lte(e)?d:m}},St=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=H.getTickFromSqrtPriceX64(H.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=St.getTickWithPriceAndTickspacing(e,t,n,r),s=H.getSqrtPriceX64FromTick(o);return H.sqrtPriceX64ToPrice(s,n,r)}},re=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ke))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(tn),s=t.sub(e);return r?Z.mulDivRoundingUp(Z.mulDivCeil(o,s,t),Fe,e):Z.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ke))throw new Error("sqrtPriceX64A must greater than 0");return r?Z.mulDivCeil(n,t.sub(e),We):Z.mulDivFloor(n,t.sub(e),We)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?Z.mulDivRoundingUp(a,Fe,Bi):a.shrn(tn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),Z.mulDivFloor(n,Bi,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return re.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=re.getLiquidityFromTokenAmountA(e,n,r,!1),a=re.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return re.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:re.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new $(0)};if(e.lt(n)){let s=re.getTokenAmountAFromLiquidity(e,n,r,o),a=re.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new $(0),amountB:re.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=re.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,p=new $(new E(c.toString()).mul(l).toFixed(0)),m=new $(new E(u.toString()).mul(l).toFixed(0));return{amountSlippageA:p,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var A,w,h,B;let u=H.priceToSqrtPriceX64(new E(e.price),e.mintA.decimals,e.mintB.decimals),l=H.getSqrtPriceX64FromTick(t),p=H.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,d=re.getAmountsFromLiquidity(u,l,p,r,s),[y,f]=[ge(d.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),ge(d.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[b,g]=[ge(new $(new E(d.amountA.toString()).mul(m).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,c),ge(new $(new E(d.amountB.toString()).mul(m).toFixed(0)),(B=e.mintB.extensions)==null?void 0:B.feeConfig,a,c)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:g,expirationTime:He(y.expirationTime,f.expirationTime)}}},xt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f=!1){if(m.eq(ke))throw new Error("amountSpecified must not be 0");if(y||(y=s?$e.add(Fe):et.sub(Fe)),s){if(y.lt($e))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(p))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(et))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(p))throw new Error("sqrtPriceX64 must greater than current")}let b=m.gt(ke),g={amountSpecifiedRemaining:m,amountCalculated:ke,sqrtPriceX64:p,tick:u>d?Math.min(d+ie.tickCount(l)-1,u):d,accounts:[],liquidity:c,feeAmount:new $(0)},A=d,w=n[d],h=0,B=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ke)&&!g.sqrtPriceX64.eq(y);){h>10;let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let x=v.nextInitTick(w,g.tick,l,s,B),S=x||null,M=null;if(!(S!=null&&S.liquidityGross.gtn(0))){let L=be.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!L.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=L.nextStartIndex;let{publicKey:Q}=se(e,t,A);M=Q,w=n[A];try{S=v.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}P.tickNext=S.tick,P.initialized=S.liquidityGross.gtn(0),d!==A&&M&&(g.accounts.push(M),d=A),P.tickNext<Le?P.tickNext=Le:P.tickNext>Re&&(P.tickNext=Re),P.sqrtPriceNextX64=H.getSqrtPriceX64FromTick(P.tickNext);let T;if(s&&P.sqrtPriceNextX64.lt(y)||!s&&P.sqrtPriceNextX64.gt(y)?T=y:T=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=xt.swapStepCompute(g.sqrtPriceX64,T,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),b?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let L=S.liquidityNet;s&&(L=L.mul(st)),g.liquidity=re.addDelta(g.liquidity,L)}B=P.tickNext!=g.tick&&!s&&w.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let L=H.getTickFromSqrtPriceX64(g.sqrtPriceX64);B=L!=g.tick&&!s&&w.startTickIndex===L,g.tick=L}++h}try{let{nextStartIndex:P,isExist:x}=ie.nextInitializedTickArray(g.tick,l,s,r,o);x&&d!==P&&(g.accounts.push(se(e,t,P).publicKey),d=P)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ke,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new $(0),amountIn:new $(0),amountOut:new $(0),feeAmount:new $(0)},a=e.gte(t),c=r.gte(ke);if(c){let l=Z.mulDivFloor(r,vn.sub(new $(o.toString())),vn);s.amountIn=a?re.getTokenAmountAFromLiquidity(t,e,n,!0):re.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=H.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?re.getTokenAmountBFromLiquidity(t,e,n,!1):re.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(st).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=H.getNextSqrtPriceX64FromOutput(e,n,r.mul(st),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=re.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=re.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:re.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:re.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(st))&&(s.amountOut=r.mul(st)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=Z.mulDivCeil(s.amountIn,new $(o),vn.sub(new $(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Be=60,It=512,v=class{static getTickArrayAddressByTick(e,t,n,r){let o=v.getTickArrayStartIndexByTick(n,r),{publicKey:s}=se(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=v.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=ie.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ie.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Be:e+t*Be}static mergeTickArrayBitmap(e){let t=new Va(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*Be));return[...v.searchLowBitFromStart(e,t,s-1,o,n),...v.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return v.searchHightBitFromStart(e,t,0,It,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=v.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=se(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>v.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=ie.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>v.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=ie.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Le||e>Re}static nextInitTick(e,t,n,r,o){if(ie.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=H.getSqrtPriceX64FromTick(t),o=H.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new E(1).div(t),o=St.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=H.getSqrtPriceX64FromTick(o),a=H.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=H.getSqrtPriceX64FromTick(t),o=H.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new E(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new E(1).div(t),o=St.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=H.getSqrtPriceX64FromTick(o),a=H.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new E(1).div(a)}}};var Da=_([we(8),U("bump"),Tt("index"),N(""),ve("protocolFeeRate"),ve("tradeFeeRate"),Tt("tickSpacing"),ne(k(),8,"")]),qa=_([ve("blockTimestamp"),Lr("tickCumulative"),ne(k(),4)]),eo=_([we(8),Ie("initialized"),k("recentEpoch"),Tt("observationIndex"),N("poolId"),ne(qa,100,"observations"),ne(k(),4)]),Ga=_([U("rewardState"),k("openTime"),k("endTime"),k("lastUpdateTime"),z("emissionsPerSecondX64"),k("rewardTotalEmissioned"),k("rewardClaimed"),N("tokenMint"),N("tokenVault"),N("creator"),z("rewardGrowthGlobalX64")]),Ft=_([we(8),U("bump"),N("ammConfig"),N("creator"),N("mintA"),N("mintB"),N("vaultA"),N("vaultB"),N("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),Tt("tickSpacing"),z("liquidity"),z("sqrtPriceX64"),de("tickCurrent"),ve(),z("feeGrowthGlobalX64A"),z("feeGrowthGlobalX64B"),k("protocolFeesTokenA"),k("protocolFeesTokenB"),z("swapInAmountTokenA"),z("swapOutAmountTokenB"),z("swapInAmountTokenB"),z("swapOutAmountTokenA"),U("status"),ne(U(),7,""),ne(Ga,3,"rewardInfos"),ne(k(),16,"tickArrayBitmap"),k("totalFeesTokenA"),k("totalFeesClaimedTokenA"),k("totalFeesTokenB"),k("totalFeesClaimedTokenB"),k("fundFeesTokenA"),k("fundFeesTokenB"),k("startTime"),ne(k(),15*4-3,"padding")]),Ua=_([z("growthInsideLastX64"),k("rewardAmountOwed")]),Li=_([we(8),U("bump"),N("nftMint"),N("poolId"),de("tickLower"),de("tickUpper"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),ne(Ua,3,"rewardInfos"),ne(k(),8,"")]),Uf=_([we(8),U("bump"),N("poolId"),de("tickLowerIndex"),de("tickUpperIndex"),z("liquidity"),z("feeGrowthInsideLastX64A"),z("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),ne(z(),3,"rewardGrowthInside"),ne(k(),8,"")]),Xa=_([de("tick"),Rr("liquidityNet"),z("liquidityGross"),z("feeGrowthOutsideX64A"),z("feeGrowthOutsideX64B"),ne(z(),3,"rewardGrowthsOutsideX64"),ne(ve(),13,"")]),on=_([we(8),N("poolId"),de("startTickIndex"),ne(Xa,Be,"ticks"),U("initializedTickCount"),ne(U(),115,"")]),za=_([we(329),ne(N(),100,"whitelistMints")]),$r=_([we(8),N("poolId"),ne(ne(k(),8),Ni,"positiveTickArrayBitmap"),ne(ne(k(),8),Ni,"negativeTickArrayBitmap")]),Xf=_([k(),U("bump"),N("owner"),N("poolId"),N("positionId"),N("nftAccount"),ne(k(),8)]),zf=_([we(8),U("bump"),N("lockOwner"),N("poolId"),N("positionId"),N("nftAccount"),N("lockNftMint"),k("recentEpoch"),ne(k(),8)]);eo.span;var to=ue("CobaltX_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},no=[188,37,179,131,82,150,84,73],io=[16,72,250,198,14,162,212,19],Kt=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y){let f=_([z("sqrtPriceX64"),k("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:y},g);let A=Buffer.from([...De.createPool,...g]);return new Ce({keys:b,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new C(r.address),new C(o.address)],{publicKey:p}=Qr(t,s,u,l),{publicKey:m}=jr(t,p),{publicKey:d}=Si(t,p,u),{publicKey:y}=Si(t,p,l),f=he(t,p).publicKey,b=[this.createPoolInstruction(t,p,n,s,m,u,d,new C(r.programId||ae),l,y,new C(o.programId||ae),f,a,c)];return{signers:[],instructions:b,instructionTypes:[ee.CreateAccount,ee.ClmmCreatePool],address:{poolId:p,observationId:m,exBitmapAccount:f,mintAVault:d,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,h,B,P,x,S,M,T){let L=_([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),z("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),Q=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Q],te=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:B,liquidity:P,amountMaxA:x,amountMaxB:S,withMetadata:M==="create",baseFlag:!1,optionBaseFlag:0},te);let j=Buffer.from([...De.openPosition,...te]);return new Ce({keys:F,programId:e,data:j})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,h,B,P,x,S,M){let T=_([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),z("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),L=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],Q=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...L],F=Buffer.alloc(T.span);T.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:h,liquidity:B,amountMaxA:P,amountMaxB:x,withMetadata:S==="create",baseFlag:!1,optionBaseFlag:0},F);let te=Buffer.from([...De.openPositionWithTokenEx,...F]);return new Ce({keys:Q,programId:e,data:te})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new C(e.programId),new C(e.id)],f;if(l)f=new C((await l(1))[0]);else{let M=Vn.generate();m.push(M),f=M.publicKey}let b=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(d,y,b),{publicKey:w}=se(d,y,g),{publicKey:h}=p?pe(n.wallet,f,ye):pe(n.wallet,f,ae),{publicKey:B}=vt(f),{publicKey:P}=Ee(d,f),{publicKey:x}=at(d,y,r,o),S=p?this.openPositionFromLiquidityInstruction22(d,n.feePayer,y,n.wallet,f,h,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,s,a,c,u,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(d,y).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,y,n.wallet,f,h,B,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,s,a,c,u,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(d,y).publicKey:void 0);return{signers:m,instructions:[S],instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:B,personalPosition:P,protocolPosition:x}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m=[],[d,y]=[new C(e.programId),new C(e.id)],f;if(l)f=new C((await l(1))[0]);else{let M=Vn.generate();m.push(M),f=M.publicKey}let b=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(d,y,b),{publicKey:w}=se(d,y,g),{publicKey:h}=p?pe(n.wallet,f,ye):pe(n.wallet,f,ae),{publicKey:B}=vt(f),{publicKey:P}=Ee(d,f),{publicKey:x}=at(d,y,r,o),S=p?this.openPositionFromBaseInstruction22(d,n.feePayer,y,n.wallet,f,h,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,u,s,a,c,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(d,y).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,y,n.wallet,f,h,B,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,b,g,u,s,a,c,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(d,y).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:B,personalPosition:P,protocolPosition:x},instructions:[S],signers:m,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount&&t.lookupTableAccount!=""?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,h,B,P,x,S,M,T){let L=_([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),z("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),Q=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],F=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Q],te=Buffer.alloc(L.span);L.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:B,liquidity:new Oi(0),amountMaxA:x==="MintA"?S:M,amountMaxB:x==="MintA"?M:S,withMetadata:P==="create",baseFlag:x==="MintA",optionBaseFlag:1},te);let j=Buffer.from([...De.openPosition,...te]);return new Ce({keys:F,programId:e,data:j})}static openPositionFromBaseInstruction22(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w,h,B,P,x,S,M){let T=_([de("tickLowerIndex"),de("tickUpperIndex"),de("tickArrayLowerStartIndex"),de("tickArrayUpperStartIndex"),z("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),U("optionBaseFlag"),Ie("baseFlag")]),L=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[]],Q=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...L],F=Buffer.alloc(T.span);T.encode({tickLowerIndex:g,tickUpperIndex:A,tickArrayLowerStartIndex:w,tickArrayUpperStartIndex:h,liquidity:new Oi(0),amountMaxA:P==="MintA"?x:S,amountMaxB:P==="MintA"?S:x,withMetadata:B==="create",baseFlag:P==="MintA",optionBaseFlag:1},F);let te=Buffer.from([...De.openPositionWithTokenEx,...F]);return new Ce({keys:Q,programId:e,data:te})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l,nft2022:p}){let m,d=[];if(l)m=new C((await l(1))[0]);else{let M=Vn.generate();d.push(M),m=M.publicKey}let[y,f]=[new C(e.programId),new C(e.id)],b=v.getTickArrayStartIndexByTick(r,e.config.tickSpacing),g=v.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:A}=se(y,f,b),{publicKey:w}=se(y,f,g),{publicKey:h}=p?pe(n.wallet,m,ye):pe(n.wallet,m,ae),{publicKey:B}=vt(m),{publicKey:P}=Ee(y,m),{publicKey:x}=at(y,f,r,o),S=p?this.openPositionFromLiquidityInstruction22(y,n.wallet,f,n.wallet,m,h,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),r,o,b,g,s,a,c,u,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(y,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(y,n.wallet,f,n.wallet,m,h,B,x,A,w,P,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),r,o,b,g,s,a,c,u,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,g])?he(y,f).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:A,tickArrayUpper:w,positionNftAccount:h,metadataAccount:B,personalPosition:P,protocolPosition:x},instructions:[S],signers:d,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,s){let a=_([]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:s?ye:ae,isSigner:!1,isWritable:!1}],u=Buffer.alloc(a.span);a.encode({},u);let l=Buffer.from([...De.closePosition,...u]);return new Ce({keys:c,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let s=new C(e.programId),a=o?pe(n.wallet,r.nftMint,ye).publicKey:pe(n.wallet,r.nftMint,ae).publicKey,{publicKey:c}=Ee(s,r.nftMint),u=[];return u.push(this.closePositionInstruction(s,n.wallet,r.nftMint,a,c,o)),{address:{positionNftAccount:a,personalPosition:c},signers:[],instructions:u,instructionTypes:[ee.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A){let w=_([z("liquidity"),k("amountMaxA"),k("amountMaxB"),U("optionBaseFlag"),Ie("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...h],P=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:b,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},P);let x=Buffer.from([...De.increaseLiquidity,...P]);return new Ce({keys:B,programId:e,data:x})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],p=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,l,p),{publicKey:y}=se(u,l,m),{publicKey:f}=c?pe(r.wallet,n.nftMint,ye):pe(r.wallet,n.nftMint,ae),{publicKey:b}=Ee(u,n.nftMint),{publicKey:g}=at(u,l,n.tickLower,n.tickUpper),A=this.increasePositionFromLiquidityInstruction(u,r.wallet,f,b,l,g,d,y,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?he(u,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},signers:[],instructions:[A],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a,nft2022:c}){let[u,l]=[new C(e.programId),new C(e.id)],p=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,l,p),{publicKey:y}=se(u,l,m),{publicKey:f}=c?pe(r.wallet,n.nftMint,ye):pe(r.wallet,n.nftMint,ae),{publicKey:b}=Ee(u,n.nftMint),{publicKey:g}=at(u,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,f,b,l,g,d,y,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,m])?he(u,l).publicKey:void 0)],signers:[],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A){let w=_([z("liquidity"),k("amountMaxA"),k("amountMaxB"),U("optionBaseFlag"),Ie("baseFlag")]),h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...h],P=Buffer.alloc(w.span);w.encode({liquidity:new Oi(0),amountMaxA:f==="MintA"?b:g,amountMaxB:f==="MintA"?g:b,baseFlag:f==="MintA",optionBaseFlag:1},P);let x=Buffer.from([...De.increaseLiquidity,...P]);return new Ce({keys:B,programId:e,data:x})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g,A,w){let h=_([z("liquidity"),k("amountMinA"),k("amountMinB")]),B=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(M=>[{pubkey:M.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:M.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...B],x=Buffer.alloc(h.span);h.encode({liquidity:b,amountMinA:g,amountMinB:A},x);let S=Buffer.from([...De.decreaseLiquidity,...x]);return new Ce({keys:P,programId:e,data:S})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c,nft2022:u}){let[l,p]=[new C(e.programId),new C(e.id)],m=v.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=v.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:y}=se(l,p,m),{publicKey:f}=se(l,p,d),{publicKey:b}=u?pe(r.wallet,n.nftMint,ye):pe(r.wallet,n.nftMint,c),{publicKey:g}=Ee(l,n.nftMint),{publicKey:A}=at(l,p,n.tickLower,n.tickUpper),w=[];for(let P=0;P<e.rewardDefaultInfos.length;P++)w.push({poolRewardVault:new C(t.rewardInfos[P].vault),ownerRewardVault:r.rewardAccounts[P],rewardMint:new C(e.rewardDefaultInfos[P].mint.address)});let h=[],B=this.decreaseLiquidityInstruction(l,r.wallet,b,g,p,A,y,f,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),w,o,s,a,be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?he(l,p).publicKey:void 0);return h.push(B),{address:{tickArrayLower:y,tickArrayUpper:f,positionNftAccount:b,personalPosition:g,protocolPosition:A},signers:[],instructions:h,instructionTypes:[ee.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,p,m,d,y,f,b,g){let A=_([k("amount"),k("otherAmountThreshold"),z("sqrtPriceLimitX64"),Ie("isBaseInput")]),w=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...p.map(x=>({pubkey:x,isSigner:!1,isWritable:!0}))],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],B=Buffer.alloc(A.span);A.encode({amount:d,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},B);let P=Buffer.from([...De.swap,...B]);return new Ce({keys:h,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new C(e.programId),new C(e.id)],[m,d]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,p,new C(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?m:d,b?d:m,b?y:f,b?f:y,u,n,s,a,c,!0,he(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[ee.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,p]=[new C(e.programId),new C(e.id)],[m,d]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,p,new C(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?d:m,b?m:d,b?f:y,b?y:f,u,n,s,a,c,!1,he(l,p).publicKey)];return{signers:[],instructions:g,instructionTypes:[ee.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=_([k("openTime"),k("endTime"),z("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:le(l),endTime:le(p),emissionsPerSecondX64:m},f);let b=Buffer.from([...De.initReward,...f]);return new Ce({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a=Yr(o,s,r.mint).publicKey,c=Wn(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new C(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[ee.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,p,m){let d=_([U("rewardIndex"),z("emissionsPerSecondX64"),k("openTime"),k("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:le(l),endTime:le(p)},f);let b=Buffer.from([...De.setRewardEmissions,...f]);return new Ce({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new C(t.rewardInfos[m].vault),u=new C(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&to.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Wn(o).publicKey,p=[this.setRewardInstruction(o,n.wallet,s,l,new C(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:p,instructionTypes:[ee.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=_([U("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:wn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let p=Buffer.from([...De.collectReward,...l]);return new Ce({keys:u,programId:e,data:p})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new C(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&to.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[ee.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:c}){let u=[],l;if(c)l=new C((await c(1))[0]);else{let g=Vn.generate();u.push(g),l=g.publicKey}let p=a?pe(o,s,ye).publicKey:pe(o,s,ae).publicKey,{publicKey:m}=Ee(n,s),d=Ci(e,l).publicKey,y=pe(o,l,ae).publicKey,f=vt(l).publicKey,b=Kt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:p,positionId:m,lockPositionId:d,lockNftMint:l,lockNftAccount:y,metadataAccount:f,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:pe(t,s,a?ye:ae).publicKey,positionNftProgram:a?ye:ae});return{address:{positionId:m,lockPositionId:d,lockNftAccount:y,lockNftMint:l,positionNftAccount:p,metadataAccount:f},instructions:[b],signers:u,instructionTypes:[ee.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:c,authPositionNftAccount:u,positionNftProgram:l,lockPositionId:p,lockNftMint:m,lockNftAccount:d,metadataAccount:y,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:an,isSigner:!1,isWritable:!1},{pubkey:Je,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}],g=_([Ie("withMetadata")]),A=Buffer.alloc(g.span);g.encode({withMetadata:f},A);let w=Buffer.from([...no,...A]);return new Ce({keys:b,programId:e,data:w})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=pe(r,o,ae),{publicKey:a}=Ee(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Ki(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}];return new Ce({keys:c,programId:e,data:Buffer.from(no)})}static harvestLockPositionInstruction(e){let[t,n]=[new C(e.poolKeys.programId),new C(e.poolKeys.id)],r=v.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=v.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=se(t,n,r),{publicKey:a}=se(t,n,o),{publicKey:c}=pe(e.owner,e.ownerPosition.nftMint,ae),{publicKey:u}=Ee(t,e.ownerPosition.nftMint),{publicKey:l}=at(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),p=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)p.push({poolRewardVault:new C(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new C(e.poolKeys.rewardInfos[y].mint.address)});let m=[...p.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Ki(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new Ce({keys:d,programId:e.programId,data:Buffer.from(io)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:p,vaultA:m,vaultB:d,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:g,mintA:A,mintB:w,rewardAccounts:h,exTickArrayBitmap:B}){let P=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[],...h.map(S=>[{pubkey:S.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:S.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:S.rewardMint,isSigner:!1,isWritable:!1}]).flat()],x=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ye,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...P];return new Ce({keys:x,programId:e,data:Buffer.from(io)})}};var ny=_([we(8),U("bump"),Ie("disableCreatePool"),Tt("index"),k("tradeFeeRate"),k("protocolFeeRate"),k("fundFeeRate"),k("createPoolFee"),N("protocolOwner"),N("fundOwner"),ne(k(),16)]),ro=_([we(8),N("configId"),N("poolCreator"),N("vaultA"),N("vaultB"),N("mintLp"),N("mintA"),N("mintB"),N("mintProgramA"),N("mintProgramB"),N("observationId"),U("bump"),U("status"),U("lpDecimals"),U("mintDecimalA"),U("mintDecimalB"),k("lpAmount"),k("protocolFeesMintA"),k("protocolFeesMintB"),k("fundFeesMintA"),k("fundFeesMintB"),k("openTime"),ne(k(),32)]);import{ASSOCIATED_TOKEN_PROGRAM_ID as yy,TOKEN_2022_PROGRAM_ID as gy,TOKEN_PROGRAM_ID as ky}from"@solana/spl-token";import{Keypair as wy,PublicKey as hy,SystemProgram as By,TransactionInstruction as Qa}from"@solana/web3.js";var Ha=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),oy=Buffer.from("amm_config","utf8"),sy=Buffer.from("pool","utf8"),ay=Buffer.from("pool_lp_mint","utf8"),uy=Buffer.from("pool_vault","utf8"),cy=Buffer.from("observation","utf8");function oo(i){return Ae([Ha],i)}var ly=Buffer.from("locked_liquidity","utf8");var Cy=ue("CobaltX_cpmm"),Ya={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function so(i,e,t,n,r,o,s,a,c,u,l,p,m,d,y,f){let b=_([k("amountIn"),k("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],A=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},A),new Qa({keys:g,programId:i,data:Buffer.from([...Ya.swapBaseInput,...A])})}import Uy from"bn.js";import zy from"decimal.js-light";import ja from"bn.js";var Ey=new ja(0);import Za from"bn.js";var Wy=new Za(1e6);import ao from"bn.js";var ag=new ao(25),ug=new ao(1e4);var Mi=_([U("instruction"),k("amountIn"),k("minAmountOut")]),Ei=_([U("instruction"),k("maxAmountIn"),k("amountOut")]),pg=_([U("instruction"),U("nonce")]),Ja=_([U("instruction"),U("nonce"),k("startTime")]),uo=_([k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalValue"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),k("swapBase2QuoteFee"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),k("swapQuote2BaseFee"),N("baseVault"),N("quoteVault"),N("baseMint"),N("quoteMint"),N("lpMint"),N("openOrders"),N("marketId"),N("marketProgramId"),N("targetOrders"),N("withdrawQueue"),N("lpVault"),N("owner"),k("lpReserve"),ne(k(),3,"padding")]),dg=_([k("accountType"),k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalsValue"),k("abortTradeFactor"),k("priceTickMultiplier"),k("priceTick"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),z("swapBaseInAmount"),z("swapQuoteOutAmount"),z("swapQuoteInAmount"),z("swapBaseOutAmount"),k("swapQuote2BaseFee"),k("swapBase2QuoteFee"),N("baseVault"),N("quoteVault"),N("baseMint"),N("quoteMint"),N("lpMint"),N("modelDataAccount"),N("openOrders"),N("marketId"),N("marketProgramId"),N("targetOrders"),N("owner"),ne(k(),64,"padding")]),$a=_([U("instruction"),k("baseAmountIn"),k("quoteAmountIn"),k("fixedSide"),k("otherAmountMin")]),eu=_([U("instruction"),k("lpAmount"),k("baseAmountMin"),k("quoteAmountMin")]);var fg=_([k("fee")]);import{TOKEN_PROGRAM_ID as su}from"@solana/spl-token";import{PublicKey as $g}from"@solana/web3.js";import tk from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as hg,TOKEN_PROGRAM_ID as lo}from"@solana/spl-token";import{PublicKey as Bg,SystemProgram as Ig,SYSVAR_RENT_PUBKEY as xg,TransactionInstruction as mo}from"@solana/web3.js";import{PublicKey as tu}from"@solana/web3.js";var _i=new tu("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),nu=5e4,iu=_([k("x"),k("y"),k("price")]),Pg=_([k("accountType"),k("status"),k("multiplier"),k("validDataCount"),ne(iu,nu,"DataElement")]);var co=ue("CobaltX_liquidity_instruction");function ru({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=wt(i),s=Buffer.alloc(Mi.span);Mi.encode({instruction:9,amountIn:le(t),minAmountOut:le(n)},s);let a=[K({pubkey:lo,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders})];return r===4&&a.push(K({pubkey:o.targetOrders})),a.push(K({pubkey:o.vault.A}),K({pubkey:o.vault.B})),r===5&&a.push(K({pubkey:_i})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1})),new mo({programId:o.programId,keys:a,data:s})}function ou({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=wt(i),s=Buffer.alloc(Ei.span);Ei.encode({instruction:11,maxAmountIn:le(t),amountOut:le(n)},s);let a=[K({pubkey:lo,isWritable:!1}),K({pubkey:o.id}),K({pubkey:o.authority,isWritable:!1}),K({pubkey:o.openOrders}),K({pubkey:o.targetOrders}),K({pubkey:o.vault.A}),K({pubkey:o.vault.B})];return r===5&&a.push(K({pubkey:_i})),a.push(K({pubkey:o.marketProgramId,isWritable:!1}),K({pubkey:o.marketId}),K({pubkey:o.marketBids}),K({pubkey:o.marketAsks}),K({pubkey:o.marketEventQueue}),K({pubkey:o.marketBaseVault}),K({pubkey:o.marketQuoteVault}),K({pubkey:o.marketAuthority,isWritable:!1}),K({pubkey:e.tokenAccountIn}),K({pubkey:e.tokenAccountOut}),K({pubkey:e.owner,isWritable:!1,isSigner:!0})),new mo({programId:o.programId,keys:a,data:s})}function po(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ru(Y(D({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return ou(Y(D({},a),{maxAmountIn:r,amountOut:o}),t);co.logWithError("invalid params","params",i)}throw co.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Fg}from"@solana/web3.js";var Dg=ue("CobaltX_liquidity_serum");function au({programId:i}){let{publicKey:e}=Ae([Buffer.from("amm_config_account_seed","utf-8")],i);return e}function fo({programId:i}){return Ae([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],i)}var vi={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},bo=i=>{let e={},t=su.toBase58();return Object.keys(i).map(n=>{let r=i[n],[o,s]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:Bt({address:o,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:Bt({address:s,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new E(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new E(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new E(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:vi,week:vi,month:vi,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:au({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:Bt({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};var yo={[li.toBase58()]:3},go={3:li};var Fi=_([we(5),we(8),N("ownAddress"),k("vaultSignerNonce"),N("baseMint"),N("quoteMint"),N("baseVault"),k("baseDepositsTotal"),k("baseFeesAccrued"),N("quoteVault"),k("quoteDepositsTotal"),k("quoteFeesAccrued"),k("quoteDustThreshold"),N("requestQueue"),N("eventQueue"),N("bids"),N("asks"),k("baseLotSize"),k("quoteLotSize"),k("feeRateBps"),k("referrerRebatesAccrued"),we(7)]),ko={3:Fi};import{PublicKey as Po}from"@solana/web3.js";var Dn=ue("Serum"),qn=class{static getProgramId(e){let t=go[e];return t||Dn.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=yo[t];return n||Dn.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=ko[e];return t||Dn.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,o;for(;r<100;){try{let s=n.concat(Buffer.from([r]),Buffer.alloc(7));o=Po.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;r++;continue}return{publicKey:o,nonce:r}}return Dn.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:Po.default,nonce:r}}};var Rk=_([ve("mintAuthorityOption"),N("mintAuthority"),k("supply"),U("decimals"),U("isInitialized"),ve("freezeAuthorityOption"),N("freezeAuthority")]);import{ASSOCIATED_TOKEN_PROGRAM_ID as uu,TOKEN_2022_PROGRAM_ID as cu,TOKEN_PROGRAM_ID as lu}from"@solana/spl-token";import{PublicKey as G,SystemProgram as mu,TransactionInstruction as pu}from"@solana/web3.js";import Ct from"bn.js";function du(i,e,t,n,r,o,s,a,c,u,l,p,m,d,y){var P;let f=[],b=[K({pubkey:lu,isWritable:!1}),K({pubkey:cu,isWritable:!1}),K({pubkey:uu,isWritable:!1}),K({pubkey:mu.programId,isWritable:!1}),K({pubkey:e,isSigner:!0})];b.push(K({pubkey:t})),b.push(K({pubkey:r}));let g=[c,u],A=[l,p],w=[o,s,a];for(let x=0;x<g.length;x++){let S=g[x],M=w[x]===S.mintA.address;if(b.push(K({pubkey:new G(S.programId),isWritable:!1})),x===g.length-1?b.push(K({pubkey:r})):b.push(K({pubkey:n})),b.push(K({pubkey:new G(w[x])})),b.push(K({pubkey:new G(w[x+1])})),S.version===6){let T=A[x];b.push(K({pubkey:new G(T.config.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(M?T.vault.A:T.vault.B)})),b.push(K({pubkey:new G(M?T.vault.B:T.vault.A)})),b.push(K({pubkey:new G(S.observationId)})),b.push(K({pubkey:Ot})),b.push(K({pubkey:he(new G(S.programId),new G(S.id)).publicKey})),f.push(fu(S.sqrtPriceX64.toString(),M));for(let L of(P=y[x])!=null?P:[])b.push(K({pubkey:new G(L)}))}else if(S.version===5){let T=A[x];b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.authority),isWritable:!1})),b.push(K({pubkey:new G(T.marketProgramId)})),b.push(K({pubkey:new G(T.marketAuthority)})),b.push(K({pubkey:Tr,isWritable:!1})),b.push(K({pubkey:new G(T.openOrders)})),b.push(K({pubkey:new G(T.vault.A)})),b.push(K({pubkey:new G(T.vault.B)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.marketId)})),b.push(K({pubkey:new G(T.marketBids)})),b.push(K({pubkey:new G(T.marketAsks)})),b.push(K({pubkey:new G(T.marketEventQueue)})),b.push(K({pubkey:new G(T.marketBaseVault)})),b.push(K({pubkey:new G(T.marketQuoteVault)}))}else if(S.version===4){let T=A[x],L=S.status!==1;b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(T.authority),isWritable:!1})),b.push(K({pubkey:new G(L?T.id:T.marketProgramId)})),b.push(K({pubkey:new G(L?T.id:T.marketAuthority)})),b.push(K({pubkey:new G(L?T.id:T.openOrders)})),b.push(K({pubkey:new G(T.vault.A)})),b.push(K({pubkey:new G(T.vault.B)})),b.push(K({pubkey:new G(L?T.id:T.marketId)})),b.push(K({pubkey:new G(L?T.id:T.marketBids)})),b.push(K({pubkey:new G(L?T.id:T.marketAsks)})),b.push(K({pubkey:new G(L?T.id:T.marketEventQueue)})),b.push(K({pubkey:new G(L?T.id:T.marketBaseVault)})),b.push(K({pubkey:new G(L?T.id:T.marketQuoteVault)}))}else if(S.version===7){let T=A[x];b.push(K({pubkey:new G(T.authority)})),b.push(K({pubkey:new G(T.config.id)})),b.push(K({pubkey:new G(T.id)})),b.push(K({pubkey:new G(M?T.vault.A:T.vault.B)})),b.push(K({pubkey:new G(M?T.vault.B:T.vault.A)})),b.push(K({pubkey:new G(S.observationId)}))}else throw Error("pool type error")}let h=_([U("insId"),k("amountIn"),k("amountOut"),ne(z(),f.length,"clmmPriceLimit")]),B=Buffer.alloc(h.span);return h.encode({insId:0,amountIn:m,amountOut:d,clmmPriceLimit:f},B),new pu({keys:b,programId:i,data:B})}function fu(i,e){if(i)if(e){let t=new Ct(i).div(new Ct(25));return t.gt(En)?t:En}else{let t=new Ct(i).mul(new Ct(25));return t.lt(_n)?t:_n}else return e?En:_n}function Ao({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,c,u,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let p=n.poolKey[0],m=wt(p),d=t.equals(m.mintA.address)?$e.add(Fe):et.sub(Fe);return Kt.makeSwapBaseInInstructions({poolInfo:p,poolKeys:p,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:m.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:m.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Ct(0)),sqrtPriceLimitX64:d,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let p=n.poolInfo[0],m=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[so(p.programId,e.wallet,p.authority,p.configId,p.id,e.sourceToken,e.destinationToken,m?p.vaultA:p.vaultB,m?p.vaultB:p.vaultA,m?p.mintProgramA:p.mintProgramB,m?p.mintProgramB:p.mintProgramA,new G(p[m?"mintA":"mintB"].address),new G(p[m?"mintB":"mintA"].address),p.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[m?ee.CpmmSwapBaseIn:ee.CpmmSwapBaseOut],address:{}}}else{let p=n.poolKey[0];return{signers:[],instructions:[po({poolKeys:p,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((c=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?c:new Ct(0)),fixedSide:"in"})],lookupTableAddress:p.lookupTableAccount?[p.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ee.AmmV5SwapBaseIn:ee.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let p=n.poolInfo[0],m=n.poolInfo[1],d=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[du(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),p,m,d,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?l:new Ct(0)),n.remainingAccounts)],instructionTypes:[ee.RouteSwap],lookupTableAddress:[d.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var lt=new Un(0),Wi=class extends _t{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(Ge));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:r=1}=e,o=await this.getWSolAccounts(),s=this.createTxBuilder();s.addCustomComputeBudget(e.computeBudgetConfig);let a=await hi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});s.addInstruction(a);let c=le(t);for(let u=0;u<o.length;u++)c.gte(o[u].amount)?(s.addInstruction({instructions:[$t({tokenAccount:o[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),c.sub(o[u].amount)):s.addInstruction({instructions:[$t({tokenAccount:o[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]});return s.versionBuild({txVersion:r})}async wrapWSol(e,t,n){let r=this.createTxBuilder(),o=await hi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(o),r.versionBuild({txVersion:n!=null?n:1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:r,routeProgram:o,txVersion:s}){let a=this.createTxBuilder(),c=e.amountIn,u=e.amountOut,l=c.amount.token.mint.equals(Ge),p=u.amount.token.mint.equals(Ge),m=c.amount.token.mint,d=u.amount.token.mint,{account:y,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.amount.token.isToken2022?Gn:Pe,mint:m,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:l?{payer:this.scope.ownerPubKey,amount:c.amount.raw}:void 0,associatedOnly:l?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(f&&a.addInstruction(f),y===void 0)throw Error("input account check error");let b;if(e.routeType==="route"&&!p)b=this.scope.account.getAssociatedTokenAccount(d,u.amount.token.isToken2022?Gn:Pe);else{let{account:h,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?Gn:Pe,mint:d,notUseTokenAccount:p,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:p?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});b=h,B&&a.addInstruction(B)}p&&a.addInstruction({endInstructions:[$t({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:b,programId:Pe})],endInstructionTypes:[ee.CloseAccount]});let g;if(e.routeType==="route"){let h=e.middleToken;g=this.scope.account.getAssociatedTokenAccount(h.mint,h.isToken2022?Gn:Pe)}let A=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),w=Ao({routeProgram:o,inputMint:m,swapInfo:Y(D({},e),{poolInfo:[...e.poolInfoList],poolKey:A,outputMint:d}),ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:y,routeToken:g,destinationToken:b}});if(e.feeConfig!==void 0){let h=this.createTxBuilder();h.addInstruction({instructions:[wo(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[ee.TransferAmount]}),h.addInstruction(w);let{transactions:B}=s===0?await h.sizeCheckBuildV0():await h.sizeCheckBuild();B.length<2&&a.addInstruction({instructions:[wo(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[ee.TransferAmount]})}return a.addInstruction(w),s===0?a.sizeCheckBuildV0({computeBudgetConfig:r,address:w.address}):a.sizeCheckBuild({computeBudgetConfig:r,address:w.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=hr,clmm:n=mi,cpmm:r=pi}=e||{},o=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:uo.offsetOf("baseMint"),length:64}}),s=_([N("baseMint"),N("quoteMint")]),a=o.map(d=>({id:d.pubkey,version:4,mintA:s.decode(d.account.data).baseMint,mintB:s.decode(d.account.data).quoteMint})),c=_([N("mintA"),N("mintB")]),l=(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:Ft.span}],dataSlice:{offset:Ft.offsetOf("mintA"),length:64}})).map(d=>{let y=c.decode(d.account.data);return{id:d.pubkey,version:6,mintA:y.mintA,mintB:y.mintB}}),m=(await this.scope.connection.getProgramAccounts(r,{dataSlice:{offset:ro.offsetOf("mintA"),length:64}})).map(d=>{let y=c.decode(d.account.data);return{id:d.pubkey,version:7,mintA:y.mintA,mintB:y.mintB}});return{clmmPools:l,ammPools:a,cpmmPools:m}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:r,cpmmPools:o}){e=e.toString()===Nt.default.toString()?Ge:e,t=t.toString()===Nt.default.toString()?Ge:t;let s={},a={},c={},u=[],l={};for(let m of n!=null?n:[]){if((m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),a[m.id.toString()]=m),m.mintA.equals(e)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintB.equals(e)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[d].in.push(m)}if(m.mintA.equals(t)){let d=m.mintB.toString();l[d]===void 0&&(l[d]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[d].out.push(m)}if(m.mintB.equals(t)){let d=m.mintA.toString();l[d]===void 0&&(l[d]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[d].out.push(m)}}let p=[];for(let m of r)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),s[m.id.toBase58()]=m,p.push(m)),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of o)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),c[m.id.toBase58()]=m),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:Pe,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of Object.keys(l)){if(l[m].in.length===1&&l[m].out.length===1&&l[m].in[0].id.equals(l[m].out[0].id)){delete l[m];continue}if(l[m].in.length===0||l[m].out.length===0){delete l[m];continue}let d=l[m];for(let y of d.in)for(let f of d.out)y.version===6&&a[y.id.toString()]===void 0?a[y.id.toString()]=y:y.version===7&&c[y.id.toString()]===void 0?c[y.id.toString()]=y:(y.version===4||y.version===5)&&s[y.id.toString()]===void 0&&(s[y.id.toString()]=y),f.version===6&&a[f.id.toString()]===void 0?a[f.id.toString()]=f:f.version===7&&c[f.id.toString()]===void 0?c[f.id.toString()]=f:(f.version===4||f.version===5)&&s[f.id.toString()]===void 0&&(s[f.id.toString()]=f)}return{directPath:u,addLiquidityPools:p,routePathDict:l,needSimulate:Object.values(s),needTickArray:Object.values(a),cpmmPoolList:Object.values(c)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let r=new Set([...e.needTickArray.map(f=>[f.mintA.toBase58(),f.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let o=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(f=>f.id)),s=bo(o),a={};Object.values(s).forEach(f=>{r.delete(f.mintA.address),a[f.mintA.address]={address:new Nt(f.mintA.address),programId:Pe,mintAuthority:null,supply:BigInt(0),decimals:f.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0},r.delete(f.mintB.address),a[f.mintB.address]={address:new Nt(f.mintB.address),programId:Pe,mintAuthority:null,supply:BigInt(0),decimals:f.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let c=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(f=>f.id.toBase58()),!0);Object.values(c).forEach(f=>{let[b,g]=[f.mintA.toBase58(),f.mintB.toBase58()];f.mintProgramA.equals(Pe)?(r.delete(b),a[b]={address:f.mintA,programId:f.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(b),f.mintProgramB.equals(Pe)?(r.delete(g),a[g]={address:f.mintB,programId:f.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(g)}),console.log("fetching mints info, total: ",r.size);let u=await Qn({connection:this.scope.connection,mints:Array.from(r).map(f=>new Nt(f))});a=D(D({},a),u);let l=this.scope.cpmm.toComputePoolInfos({pools:c,mintInfos:a});console.log("fetching clmm pools info, total:",e.needTickArray.length);let p=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(f=>f.id)}),{computeClmmPoolInfo:m,computePoolTickData:d}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:p,mintInfos:a}),y=Object.keys(e.routePathDict).reduce((f,b)=>Y(D({},f),{[b]:Y(D({},e.routePathDict[b]),{mintProgram:a[b].programId,mDecimals:a[b].decimals,in:e.routePathDict[b].in.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()]),out:e.routePathDict[b].out.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()])})}),{});return{mintInfos:a,ammPoolsRpcInfo:o,ammSimulateCache:s,clmmPoolsRpcInfo:p,computeClmmPoolInfo:m,computePoolTickData:d,computeCpmmData:l,routePathDict:y}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:r,simulateCache:o,tickCache:s,slippage:a,chainTime:c,epochInfo:u,feeConfig:l}){var g,A,w,h,B,P,x,S,M;let p=l===void 0?new Un(0):e.raw.mul(new Un(l.feeBps.toNumber())).div(new Un(1e4)),m=e.raw.sub(p),d=new me(e.token,m),y=l===void 0?void 0:{feeAmount:p,feeAccount:l.feeAccount},f=Y(D({},t),{address:Ye(t.address).toString()}),b=[];for(let T of n)try{b.push(Y(D({},this.computeAmountOut({itemPool:T,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:d})),{feeConfig:y}))}catch(L){this.logDebug("direct error",T.version,T.id.toString(),L.message)}this.logDebug("direct done");for(let[T,L]of Object.entries(r)){let Q={chainId:101,address:T,programId:L.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:L.mDecimals,tags:[],extensions:{}},F=L.in.map(j=>{try{return{pool:j,data:this.computeAmountOut({itemPool:j,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:Q,amountIn:d})}}catch(W){this.logDebug("route in error",j.version,j.id.toString(),W.message);return}}).sort((j,W)=>{var cn,Vi,Di,qi;let kt=j===void 0?lt:j.data.amountOut.amount.raw.sub((Vi=(cn=j.data.amountOut.fee)==null?void 0:cn.raw)!=null?Vi:lt),un=W===void 0?lt:W.data.amountOut.amount.raw.sub((qi=(Di=W.data.amountOut.fee)==null?void 0:Di.raw)!=null?qi:lt);return kt.lt(un)?1:-1})[0];if(F===void 0)continue;let te=new me(Wr(Q),F.data.amountOut.amount.raw.sub((A=(g=F.data.amountOut.fee)==null?void 0:g.raw)!=null?A:lt));for(let j of L.out)try{let W=this.computeAmountOut({itemPool:j,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:te});b.push(Y(D({},W),{allTrade:!!(F.data.allTrade&&W.allTrade),amountIn:F.data.amountIn,amountOut:W.amountOut,minAmountOut:W.minAmountOut,currentPrice:void 0,executionPrice:new E(new Me({baseToken:F.data.amountIn.amount.token,denominator:F.data.amountIn.amount.raw,quoteToken:W.amountOut.amount.token,numerator:W.amountOut.amount.raw.sub((h=(w=W.amountOut.fee)==null?void 0:w.raw)!=null?h:lt)}).toFixed()),priceImpact:new E(F.data.priceImpact.add(W.priceImpact).toFixed()),fee:[F.data.fee[0],W.fee[0]],routeType:"route",poolInfoList:[F.pool,j],remainingAccounts:[F.data.remainingAccounts[0],W.remainingAccounts[0]],minMiddleAmountFee:(B=W.amountOut.fee)!=null&&B.raw?new me(F.data.amountOut.amount.token,((x=(P=F.data.amountOut.fee)==null?void 0:P.raw)!=null?x:lt).add((M=(S=W.amountOut.fee)==null?void 0:S.raw)!=null?M:lt)):void 0,middleToken:F.data.amountOut.amount.token,poolReady:F.data.poolReady&&W.poolReady,poolType:[F.data.poolType,W.poolType],feeConfig:y,expirationTime:He(F.data.expirationTime,W.expirationTime)}))}catch(W){this.logDebug("route out error",j.version,j.id.toString(),W.message)}}return b.filter(T=>(T.allTrade||this.logDebug(`pool ${T.poolInfoList.map(L=>L.id.toString()).join(",")} filter out since not all trade`),T.allTrade)).sort((T,L)=>T.amountOut.amount.raw.sub(L.amountOut.amount.raw).gt(lt)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:r,epochInfo:o,slippage:s,outputToken:a,amountIn:c}){if(e.version===6){let{allTrade:u,realAmountIn:l,amountOut:p,minAmountOut:m,expirationTime:d,currentPrice:y,executionPrice:f,priceImpact:b,fee:g,remainingAccounts:A,executionPriceX64:w}=be.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:c.raw,tokenOut:a,slippage:s,epochInfo:o,catchLiquidityInsufficient:!0});return{allTrade:u,amountIn:l,amountOut:p,minAmountOut:m,currentPrice:new E(y.toFixed()),executionPrice:new E(f.toFixed()),priceImpact:new E(b.toFixed()),fee:[g],remainingAccounts:[A],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<r,poolType:"CLMM",slippage:s,clmmExPriceX64:[w],expirationTime:He(l.expirationTime,d)}}else if(e.version===7){let{allTrade:u,executionPrice:l,amountOut:p,minAmountOut:m,priceImpact:d,fee:y}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:a.address,amountIn:c.raw,slippage:s});return{allTrade:u,amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:en(Y(D({},a),{amount:p})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:en(Y(D({},a),{amount:m})),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:l,priceImpact:d,fee:[new me(c.token,y)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<r,poolType:"CPMM",slippage:s,clmmExPriceX64:[void 0],expirationTime:void 0}}else{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:u,minAmountOut:l,currentPrice:p,executionPrice:m,priceImpact:d,fee:y}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:c.raw,mintIn:c.token.mint,mintOut:a.address,slippage:s});return{amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:en(Y(D({},a),{amount:u})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:en(Y(D({},a),{amount:l})),fee:void 0,expirationTime:void 0},currentPrice:p,executionPrice:m,priceImpact:d,fee:[new me(c.token,y)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<r,poolType:e.version===5?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:s,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let r=new Set(e.filter(u=>u.version===6&&!t[u.id.toString()]).map(u=>u.id.toString()));if(r.size>0){let u=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(r)});Object.keys(u).forEach(l=>{t[l]=u[l]})}if(new Set(e.filter(u=>u.version===4&&!n[u.id.toString()]).map(u=>u.id.toString())).size>0){let u=await this.scope.liquidity.getRpcPoolInfos(Array.from(r));Object.keys(u).forEach(l=>{n[l]=u[l]})}let s=new Set(e.filter(u=>u.version===4).map(u=>u.marketId)),a={};s.size>0&&(await At(this.scope.connection,Array.from(s).map(l=>({pubkey:new Nt(l)})))).forEach(l=>{if(!l.accountInfo)return;let p=Fi.decode(l.accountInfo.data);a[l.pubkey.toBase58()]={marketId:l.pubkey.toString(),marketProgramId:l.accountInfo.owner.toString(),marketAuthority:qn.getAssociatedAuthority({programId:l.accountInfo.owner,marketId:l.pubkey}).publicKey.toString(),marketBaseVault:p.baseVault.toString(),marketQuoteVault:p.quoteVault.toString(),marketBids:p.bids.toString(),marketAsks:p.asks.toString(),marketEventQueue:p.eventQueue.toString()}});let c=[];return e.forEach(u=>{if(u.version===6){let l=t[u.id.toString()],p={programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.startTime),vault:{A:l.vaultA.toBase58(),B:l.vaultB.toBase58()},config:Y(D({},u.ammConfig),{id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]}),rewardInfos:[],observationId:u.observationId.toBase58(),exBitmapAccount:u.exBitmapAccount.toBase58()};c.push(p)}else if(u.version===4){let l=n[u.id.toString()],p=D({programId:u.programId,id:u.id,mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),vault:{A:l.baseVault.toBase58(),B:l.quoteVault.toBase58()},authority:fo({programId:new Nt(u.programId)}).publicKey.toString(),openOrders:l.openOrders.toBase58(),targetOrders:l.targetOrders.toBase58(),mintLp:u.lpMint},a[u.marketId]);c.push(p)}else u.version===7&&c.push({observationId:u.observationId.toBase58(),programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),authority:oo(u.programId).publicKey.toBase58(),vault:{A:u.vaultA.toBase58(),B:u.vaultB.toBase58()},mintLp:Bt({address:u.mintLp.toBase58(),programId:Pe.toBase58(),decimals:u.lpDecimals}),config:Y(D({id:u.configId.toBase58()},u.configInfo),{protocolFeeRate:u.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:u.configInfo.tradeFeeRate.toNumber(),fundFeeRate:u.configInfo.fundFeeRate.toNumber(),createPoolFee:u.configInfo.createPoolFee.toString()})})}),c}};export{Wi as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=trade.mjs.map
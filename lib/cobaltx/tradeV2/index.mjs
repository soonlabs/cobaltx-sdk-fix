var lr=Object.defineProperty,mr=Object.defineProperties;var pr=Object.getOwnPropertyDescriptors;var ei=Object.getOwnPropertySymbols;var dr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable;var ti=(i,e,t)=>e in i?lr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))dr.call(e,t)&&ti(i,t,e[t]);if(ei)for(var t of ei(e))fr.call(e,t)&&ti(i,t,e[t]);return i},te=(i,e)=>mr(i,pr(e));import{MINT_SIZE as Zs,TOKEN_PROGRAM_ID as js,getTransferFeeConfig as Js,unpackMint as $s}from"@solana/spl-token";import{PublicKey as gr}from"@solana/web3.js";import{get as ni,set as br}from"lodash";var dn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ii={},yr={};function ae(i){let e=ni(ii,i);if(!e){let t=ni(yr,i);e=new dn({name:i,logLevel:t}),br(ii,i,e)}return e}var fn=ae("CobaltX_accountInfo_util");async function ut(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=bn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let p=i._buildArgs([m.map(d=>d.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:p}}),c=bn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(p=>{if(p){let{data:d,executable:g,lamports:f,owner:b,rentEpoch:y}=p;return d.length!==2&&d[1]!=="base64"&&fn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:g,lamports:f,owner:new gr(b),rentEpoch:y}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function xt(i,e,t){let n=await ut(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>te(j({},r),{accountInfo:n[o]}))}import nt from"bn.js";var ht=9e15,pt=1e9,yn="0123456789abcdef",Ut="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Xt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",gn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-ht,maxE:ht,crypto:!1},ai,$e,G=!0,Qt="[DecimalError] ",mt=Qt+"Invalid argument: ",ui=Qt+"Precision limit exceeded",ci=Qt+"crypto unavailable",li="[object Decimal]",Ce=Math.floor,ke=Math.pow,Pr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,kr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ar=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,mi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ue=1e7,W=7,wr=9007199254740991,hr=Ut.length-1,Pn=Xt.length-1,w={toStringTag:li};w.absoluteValue=w.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),F(i)};w.ceil=function(){return F(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(mt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};w.comparedTo=w.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};w.cosine=w.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+W,n.rounding=1,t=Tr(n,yi(n,t)),n.precision=i,n.rounding=e,F($e==2||$e==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};w.cubeRoot=w.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(G=!1,o=l.s*ke(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Ie(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ke(t,1/3),i=Ce((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=oe(c.plus(l).times(a),c.plus(u),s+2,1),Ie(a.d).slice(0,s)===(t=Ie(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(F(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return G=!0,F(n,i,m.rounding,e)};w.decimalPlaces=w.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ce(this.e/W))*W,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(i){return oe(this,new this.constructor(i))};w.dividedToIntegerBy=w.divToInt=function(i){var e=this,t=e.constructor;return F(oe(e,new t(i),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(i){return this.cmp(i)===0};w.floor=function(){return F(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(i){return this.cmp(i)>0};w.greaterThanOrEqualTo=w.gte=function(i){var e=this.cmp(i);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Yt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Tt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};w.hyperbolicSine=w.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Tt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Yt(5,i)),r=Tt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,F(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,oe(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};w.inverseCosine=w.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ge(t,r,o):new t(0):new t(NaN):e.isZero()?Ge(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ge(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,G=!1,t=t.times(t).minus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};w.inverseHyperbolicSine=w.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,G=!1,t=t.times(t).plus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?F(new o(r),i,e,!0):(o.precision=t=n-r.e,r=oe(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ge(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};w.inverseTangent=w.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=Pn)return s=Ge(l,m+4,p).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=Pn)return s=Ge(l,m+4,p).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/W+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(G=!1,e=Math.ceil(a/W),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),G=!0,F(s,l.precision=m,l.rounding=p,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&Ce(this.e/W)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(i){return this.cmp(i)<0};w.lessThanOrEqualTo=w.lte=function(i){return this.cmp(i)<1};w.logarithm=w.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,p=l.rounding,d=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(G=!1,a=m+d,s=lt(c,a),n=e?zt(l,a+10):lt(i,a),u=oe(s,n,a,1),Kt(u.d,r=m,p))do if(a+=10,s=lt(c,a),n=e?zt(l,a+10):lt(i,a),u=oe(s,n,a,1),!o){+Ie(u.d).slice(r+1,r+15)+1==1e14&&(u=F(u,m+1,0));break}while(Kt(u.d,r+=10,p));return G=!0,F(u,m,p)};w.minus=w.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,g=d.constructor;if(i=new g(i),!d.d||!i.d)return!d.s||!i.s?i=new g(NaN):d.d?i.s=-i.s:i=new g(i.d||d.s!==i.s?d:NaN),i;if(d.s!=i.s)return i.s=-i.s,d.plus(i);if(c=d.d,p=i.d,a=g.precision,u=g.rounding,!c[0]||!p[0]){if(p[0])i.s=-i.s;else if(c[0])i=new g(d);else return new g(u===3?-0:0);return G?F(i,a,u):i}if(t=Ce(i.e/W),l=Ce(d.e/W),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=p.length):(e=p,t=l,s=c.length),n=Math.max(Math.ceil(a/W),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=p.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=p[n]){m=c[n]<p[n];break}o=0}for(m&&(e=c,c=p,p=e,i.s=-i.s),s=c.length,n=p.length-s;n>0;--n)c[s++]=0;for(n=p.length;n>o;){if(c[--n]<p[n]){for(r=n;r&&c[--r]===0;)c[r]=Ue-1;--c[r],c[n]+=Ue}c[n]-=p[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Ht(c,t),G?F(i,a,u):i):new g(u===3?-0:0)};w.modulo=w.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(G=!1,n.modulo==9?(e=oe(t,i.abs(),0,3,1),e.s*=i.s):e=oe(t,i,0,n.modulo,1),e=e.times(i),G=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return kn(this)};w.naturalLogarithm=w.ln=function(){return lt(this)};w.negated=w.neg=function(){var i=new this.constructor(this);return i.s=-i.s,F(i)};w.plus=w.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,p=m.constructor;if(i=new p(i),!m.d||!i.d)return!m.s||!i.s?i=new p(NaN):m.d||(i=new p(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=p.precision,u=p.rounding,!c[0]||!l[0])return l[0]||(i=new p(m)),G?F(i,a,u):i;if(o=Ce(m.e/W),n=Ce(i.e/W),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/W),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ue|0,c[r]%=Ue;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Ht(c,n),G?F(i,a,u):i};w.precision=w.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(mt+i);return t.d?(e=pi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var i=this,e=i.constructor;return F(new e(i),i.e+1,e.rounding)};w.sine=w.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+W,n.rounding=1,t=Ir(n,yi(n,t)),n.precision=i,n.rounding=e,F($e>2?t.neg():t,i,e,!0)):new n(NaN)};w.squareRoot=w.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(G=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Ie(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ce((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(oe(s,o,t+2,1)).times(.5),Ie(o.d).slice(0,t)===(e=Ie(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(F(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,u+1,1),i=!n.times(n).eq(s));break}return G=!0,F(n,u,l.rounding,i)};w.tangent=w.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=oe(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,F($e==2||$e==4?t.neg():t,i,e,!0)):new n(NaN)};w.times=w.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,p=l.d,d=(i=new m(i)).d;if(i.s*=l.s,!p||!p[0]||!d||!d[0])return new m(!i.s||p&&!p[0]&&!d||d&&!d[0]&&!p?NaN:!p||!d?i.s/0:i.s*0);for(t=Ce(l.e/W)+Ce(i.e/W),u=p.length,c=d.length,u<c&&(o=p,p=d,d=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+d[n]*p[r-n-1]+e,o[r--]=a%Ue|0,e=a/Ue|0;o[r]=(o[r]+e)%Ue|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Ht(o,t),G?F(i,m.precision,m.rounding):i};w.toBinary=function(i,e){return wn(this,2,i,e)};w.toDecimalPlaces=w.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Oe(i,0,pt),e===void 0?e=n.rounding:Oe(e,0,8),F(t,i+t.e+1,e))};w.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,!0):(Oe(i,0,pt),e===void 0?e=r.rounding:Oe(e,0,8),n=F(new r(n),i+1,e),t=Qe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Qe(r):(Oe(i,0,pt),e===void 0?e=o.rounding:Oe(e,0,8),n=F(new o(r),i+r.e+1,e),t=Qe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,p,d=this,g=d.d,f=d.constructor;if(!g)return new f(d);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=pi(g)-d.e-1,s=o%W,e.d[0]=ke(10,s<0?W+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(mt+a);i=a.gt(e)?o>0?e:c:a}for(G=!1,a=new f(Ie(g)),l=f.precision,f.precision=o=g.length*W*2;m=oe(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=oe(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=d.s,p=oe(c,n,o,1).minus(d).abs().cmp(oe(u,t,o,1).minus(d).abs())<1?[c,n]:[u,t],f.precision=l,G=!0,p};w.toHexadecimal=w.toHex=function(i,e){return wn(this,16,i,e)};w.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Oe(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(G=!1,t=oe(t,i,0,e,1).times(i),G=!0,F(t)):(i.s=t.s,t=i),t};w.toNumber=function(){return+this};w.toOctal=function(i,e){return wn(this,8,i,e)};w.toPower=w.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ke(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return F(a,n,o);if(e=Ce(i.e/W),e>=i.d.length-1&&(t=c<0?-c:c)<=wr)return r=di(u,a,t,n),i.s<0?new u(1).div(r):F(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ke(+a,c),e=t==0||!isFinite(t)?Ce(c*(Math.log("0."+Ie(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(G=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=kn(i.times(lt(a,n+t)),n),r.d&&(r=F(r,n+5,1),Kt(r.d,n,o)&&(e=n+10,r=F(kn(i.times(lt(a,e+t)),e),e+5,1),+Ie(r.d).slice(n+1,n+15)+1==1e14&&(r=F(r,n+1,0)))),r.s=s,G=!0,u.rounding=o,F(r,n,o))};w.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Oe(i,1,pt),e===void 0?e=r.rounding:Oe(e,0,8),n=F(new r(n),i,e),t=Qe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Oe(i,1,pt),e===void 0?e=n.rounding:Oe(e,0,8)),F(new n(t),i,e)};w.toString=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return F(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Ie(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=W-n.length,t&&(o+=ct(t)),o+=n;s=i[e],n=s+"",t=W-n.length,t&&(o+=ct(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Oe(i,e,t){if(i!==~~i||i<e||i>t)throw Error(mt+i)}function Kt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=W,r=0):(r=Math.ceil((e+1)/W),e%=W),o=ke(10,W-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ke(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ke(10,e-3)-1,s}function Gt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=yn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Tr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Yt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Tt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var oe=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,p,d,g,f,b,y,T,h,N,v,B,R,L,D,x,_,fe,se=n.constructor,he=n.s==r.s?1:-1,me=n.d,ee=r.d;if(!me||!me[0]||!ee||!ee[0])return new se(!n.s||!r.s||(me?ee&&me[0]==ee[0]:!ee)?NaN:me&&me[0]==0||!ee?he*0:he/0);for(u?(d=1,l=n.e-r.e):(u=Ue,d=W,l=Ce(n.e/d)-Ce(r.e/d)),_=ee.length,D=me.length,y=new se(he),T=y.d=[],m=0;ee[m]==(me[m]||0);m++);if(ee[m]>(me[m]||0)&&l--,o==null?(B=o=se.precision,s=se.rounding):a?B=o+(n.e-r.e)+1:B=o,B<0)T.push(1),g=!0;else{if(B=B/d+2|0,m=0,_==1){for(p=0,ee=ee[0],B++;(m<D||p)&&B--;m++)R=p*u+(me[m]||0),T[m]=R/ee|0,p=R%ee|0;g=p||m<D}else{for(p=u/(ee[0]+1)|0,p>1&&(ee=i(ee,p,u),me=i(me,p,u),_=ee.length,D=me.length),L=_,h=me.slice(0,_),N=h.length;N<_;)h[N++]=0;fe=ee.slice(),fe.unshift(0),x=ee[0],ee[1]>=u/2&&++x;do p=0,c=e(ee,h,_,N),c<0?(v=h[0],_!=N&&(v=v*u+(h[1]||0)),p=v/x|0,p>1?(p>=u&&(p=u-1),f=i(ee,p,u),b=f.length,N=h.length,c=e(f,h,b,N),c==1&&(p--,t(f,_<b?fe:ee,b,u))):(p==0&&(c=p=1),f=ee.slice()),b=f.length,b<N&&f.unshift(0),t(h,f,N,u),c==-1&&(N=h.length,c=e(ee,h,_,N),c<1&&(p++,t(h,_<N?fe:ee,N,u))),N=h.length):c===0&&(p++,h=[0]),T[m++]=p,c&&h[0]?h[N++]=me[L]||0:(h=[me[L]],N=1);while((L++<D||h[0]!==void 0)&&B--);g=h[0]!==void 0}T[0]||T.shift()}if(d==1)y.e=l,ai=g;else{for(m=1,p=T[0];p>=10;p/=10)m++;y.e=m+l*d-1,F(y,a?o+y.e+1:o,s,g)}return y}}();function F(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=W,s=e,l=m[p=0],u=l/ke(10,r-s-1)%10|0;else if(p=Math.ceil((o+1)/W),a=m.length,p>=a)if(n){for(;a++<=p;)m.push(0);l=u=0,r=1,o%=W,s=o-W+1}else break e;else{for(l=a=m[p],r=1;a>=10;a/=10)r++;o%=W,s=o-W+r,u=s<0?0:l/ke(10,r-s-1)%10|0}if(n=n||e<0||m[p+1]!==void 0||(s<0?l:l%ke(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ke(10,r-s):0:m[p-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ke(10,(W-e%W)%W),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=p,a=1,p--):(m.length=p+1,a=ke(10,W-o),m[p]=s>0?(l/ke(10,r-s)%ke(10,s)|0)*a:0),c)for(;;)if(p==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ue&&(m[0]=1));break}else{if(m[p]+=a,m[p]!=Ue)break;m[p--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return G&&(i.e>d.maxE?(i.d=null,i.e=NaN):i.e<d.minE&&(i.e=0,i.d=[0])),i}function Qe(i,e,t){if(!i.isFinite())return bi(i);var n,r=i.e,o=Ie(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ct(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+ct(-r-1)+o,t&&(n=t-s)>0&&(o+=ct(n))):r>=s?(o+=ct(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+ct(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=ct(n))),o}function Ht(i,e){var t=i[0];for(e*=W;t>=10;t/=10)e++;return e}function zt(i,e,t){if(e>hr)throw G=!0,t&&(i.precision=t),Error(ui);return F(new i(Ut),e,1,!0)}function Ge(i,e,t){if(e>Pn)throw Error(ui);return F(new i(Xt),e,t,!0)}function pi(i){var e=i.length-1,t=e*W+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function ct(i){for(var e="";i--;)e+="0";return e}function di(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/W+4);for(G=!1;;){if(t%2&&(o=o.times(e),oi(o.d,s)&&(r=!0)),t=Ce(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),oi(e.d,s)}return G=!0,o}function ri(i){return i.d[i.d.length-1]&1}function fi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function kn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,p=i.constructor,d=p.rounding,g=p.precision;if(!i.d||!i.d[0]||i.e>17)return new p(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(G=!1,u=g):u=e,a=new p(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ke(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new p(1),p.precision=u;;){if(o=F(o.times(i),u,1),t=t.times(++l),a=s.plus(oe(o,t,u,1)),Ie(a.d).slice(0,u)===Ie(s.d).slice(0,u)){for(r=m;r--;)s=F(s.times(s),u,1);if(e==null)if(c<3&&Kt(s.d,u-n,d,c))p.precision=u+=10,t=o=a=new p(1),l=0,c++;else return F(s,p.precision=g,d,G=!0);else return p.precision=g,s}s=a}}function lt(i,e){var t,n,r,o,s,a,u,c,l,m,p,d=1,g=10,f=i,b=f.d,y=f.constructor,T=y.rounding,h=y.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new y(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(G=!1,l=h):l=e,y.precision=l+=g,t=Ie(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Ie(f.d),n=t.charAt(0),d++;o=f.e,n>1?(f=new y("0."+t),o++):f=new y(n+"."+t.slice(1))}else return c=zt(y,l+2,h).times(o+""),f=lt(new y(n+"."+t.slice(1)),l-g).plus(c),y.precision=h,e==null?F(f,h,T,G=!0):f;for(m=f,u=s=f=oe(f.minus(1),f.plus(1),l,1),p=F(f.times(f),l,1),r=3;;){if(s=F(s.times(p),l,1),c=u.plus(oe(s,new y(r),l,1)),Ie(c.d).slice(0,l)===Ie(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(zt(y,l+2,h).times(o+""))),u=oe(u,new y(d),l,1),e==null)if(Kt(u.d,l-g,T,a))y.precision=l+=g,c=s=f=oe(m.minus(1),m.plus(1),l,1),p=F(f.times(f),l,1),r=a=1;else return F(u,y.precision=h,T,G=!0);else return y.precision=h,u;u=c,r+=2}}function bi(i){return String(i.s*i.s/0)}function An(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%W,t<0&&(n+=W),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=W;n<r;)i.d.push(+e.slice(n,n+=W));e=e.slice(n),n=W-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),G&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Br(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),mi.test(e))return An(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(kr.test(e))t=16,e=e.toLowerCase();else if(Pr.test(e))t=2;else if(Ar.test(e))t=8;else throw Error(mt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=di(n,new n(t),o,o*2)),c=Gt(e,t,Ue),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Ht(c,l),i.d=c,G=!1,s&&(i=oe(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ke(2,u):Ct.pow(2,u))),G=!0,i)}function Ir(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Tt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Yt(5,t)),e=Tt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Tt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/W);for(G=!1,u=t.times(t),a=new i(n);;){if(s=oe(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=oe(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return G=!0,s.d.length=m+1,s}function Yt(i,e){for(var t=i;--e;)t*=i;return t}function yi(i,e){var t,n=e.s<0,r=Ge(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return $e=n?4:1,e;if(t=e.divToInt(r),t.isZero())$e=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return $e=ri(t)?n?2:3:n?4:1,e;$e=ri(t)?n?1:4:n?3:2}return e.minus(r).abs()}function wn(i,e,t,n){var r,o,s,a,u,c,l,m,p,d=i.constructor,g=t!==void 0;if(g?(Oe(t,1,pt),n===void 0?n=d.rounding:Oe(n,0,8)):(t=d.precision,n=d.rounding),!i.isFinite())l=bi(i);else{for(l=Qe(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),p=new d(1),p.e=l.length-s,p.d=Gt(Qe(p),10,r),p.e=p.d.length),m=Gt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new d(i),i.d=m,i.e=o,i=oe(i,p,t,n,0,r),m=i.d,o=i.e,c=ai),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=yn.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Gt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=yn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function oi(i,e){if(i.length>e)return i.length=e,!0}function xr(i){return new this(i).abs()}function Sr(i){return new this(i).acos()}function Kr(i){return new this(i).acosh()}function Cr(i,e){return new this(i).plus(e)}function Nr(i){return new this(i).asin()}function Rr(i){return new this(i).asinh()}function Lr(i){return new this(i).atan()}function Or(i){return new this(i).atanh()}function Mr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ge(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ge(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ge(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(oe(i,e,o,1)),e=Ge(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(oe(i,e,o,1)),t}function Er(i){return new this(i).cbrt()}function vr(i){return F(i=new this(i),i.e+1,2)}function _r(i,e,t){return new this(i).clamp(e,t)}function Fr(i){if(!i||typeof i!="object")throw Error(Qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,pt,"rounding",0,8,"toExpNeg",-ht,0,"toExpPos",0,ht,"maxE",0,ht,"minE",-ht,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=gn[t]),(n=i[t])!==void 0)if(Ce(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(mt+t+": "+n);if(t="crypto",r&&(this[t]=gn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ci);else this[t]=!1;else throw Error(mt+t+": "+n);return this}function Wr(i){return new this(i).cos()}function Vr(i){return new this(i).cosh()}function gi(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,si(o)){c.s=o.s,G?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;G?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return An(c,o.toString())}else if(u!=="string")throw Error(mt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),mi.test(o)?An(c,o):Br(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Fr,r.clone=gi,r.isDecimal=si,r.abs=xr,r.acos=Sr,r.acosh=Kr,r.add=Cr,r.asin=Nr,r.asinh=Rr,r.atan=Lr,r.atanh=Or,r.atan2=Mr,r.cbrt=Er,r.ceil=vr,r.clamp=_r,r.cos=Wr,r.cosh=Vr,r.div=Dr,r.exp=qr,r.floor=Gr,r.hypot=Ur,r.ln=Xr,r.log=zr,r.log10=Hr,r.log2=Qr,r.max=Yr,r.min=Zr,r.mod=jr,r.mul=Jr,r.pow=$r,r.random=eo,r.round=to,r.sign=no,r.sin=io,r.sinh=ro,r.sqrt=oo,r.sub=so,r.sum=ao,r.tan=uo,r.tanh=co,r.trunc=lo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Dr(i,e){return new this(i).div(e)}function qr(i){return new this(i).exp()}function Gr(i){return F(i=new this(i),i.e+1,3)}function Ur(){var i,e,t=new this(0);for(G=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return G=!0,new this(1/0);t=e}return G=!0,t.sqrt()}function si(i){return i instanceof Ct||i&&i.toStringTag===li||!1}function Xr(i){return new this(i).ln()}function zr(i,e){return new this(i).log(e)}function Qr(i){return new this(i).log(2)}function Hr(i){return new this(i).log(10)}function Yr(){return fi(this,arguments,"lt")}function Zr(){return fi(this,arguments,"gt")}function jr(i,e){return new this(i).mod(e)}function Jr(i,e){return new this(i).mul(e)}function $r(i,e){return new this(i).pow(e)}function eo(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Oe(i,1,pt),n=Math.ceil(i/W),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(ci);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=W,n&&i&&(r=ke(10,W-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=W)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<W&&(t-=W-n)}return s.e=t,s.d=a,s}function to(i){return F(i=new this(i),i.e+1,this.rounding)}function no(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function io(i){return new this(i).sin()}function ro(i){return new this(i).sinh()}function oo(i){return new this(i).sqrt()}function so(i,e){return new this(i).sub(e)}function ao(){var i=0,e=arguments,t=new this(e[i]);for(G=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return G=!0,F(t,this.precision,this.rounding)}function uo(i){return new this(i).tan()}function co(i){return new this(i).tanh()}function lo(i){return F(i=new this(i),i.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var Ct=w.constructor=gi(gn);Ut=new Ct(Ut);Xt=new Ct(Xt);var M=Ct;import ko from"big.js";import Jt from"bn.js";import mo from"toformat";var po=mo,Nt=po;import jt from"big.js";import bo from"bn.js";import yo from"decimal.js-light";import Rt from"bn.js";var Pi=9007199254740991;function ue(i){let e=ae("CobaltX_parseBigNumberish");if(i instanceof Rt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Rt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Pi||i<=-Pi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Rt(String(i))):typeof i=="bigint"?new Rt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Rt(0))}var Zt=ae("module/fraction"),hn=Nt(jt),Lt=Nt(yo),go={[0]:Lt.ROUND_DOWN,[1]:Lt.ROUND_HALF_UP,[2]:Lt.ROUND_UP},Po={[0]:jt.roundDown,[1]:jt.roundHalfUp,[2]:jt.roundUp},J=class{constructor(e,t=new bo(1)){this.numerator=ue(e),this.denominator=ue(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(ue(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(ue(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(ue(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(ue(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<=0&&Zt.logWithError(`${e} is not positive.`),Lt.set({precision:e+1,rounding:go[n]});let r=new Lt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Zt.logWithError(`${e} is not an integer.`),e<0&&Zt.logWithError(`${e} is negative.`),hn.DP=e,hn.RM=Po[n]||1,new hn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Ao=ae("CobaltX_amount"),ki=Nt(ko);function wo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Ao.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Ae=class extends J{constructor(t,n,r=!0,o){let s=new Jt(0),a=Tn.pow(new Jt(t.decimals));if(r)s=ue(n);else{let u=new Jt(0),c=new Jt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=wo(n.toString(),t.decimals);u=ue(l),c=ue(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Ae(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Ae(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return ki.DP=this.token.decimals,new ki(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{TOKEN_PROGRAM_ID as Ai}from"@solana/spl-token";import{PublicKey as ho}from"@solana/web3.js";var Bn={chainId:101,address:ho.default.toBase58(),programId:Ai.toBase58(),decimals:9,symbol:"ETH",name:"Ethereum",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}},et={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ai.toBase58(),decimals:9,symbol:"WETH",name:"Wrapped ETH",logoURI:"https://raw.githubusercontent.com/cobaltx-io/tokens/main/logo/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"cobaltx",extensions:{coingeckoId:"solana"}};import{PublicKey as Sn}from"@solana/web3.js";import{PublicKey as xe,SystemProgram as wi,SYSVAR_RENT_PUBKEY as To}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bo}from"@solana/spl-token";function P({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Fa=[P({pubkey:Bo,isWritable:!1}),P({pubkey:wi.programId,isWritable:!1}),P({pubkey:To,isWritable:!1})];function In({publicKey:i,transformSol:e}){let t=xn(i.toString());if(t instanceof xe)return e&&t.equals(Ot)?St:t;if(e&&t.toString()===Ot.toBase58())return St;if(typeof t=="string"){if(t===xe.default.toBase58())return xe.default;try{return new xe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function xn(i){try{return new xe(i)}catch{return i}}var $t=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),dt=new xe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),He=new xe("SysvarRent111111111111111111111111111111111"),Wa=new xe("SysvarC1ock11111111111111111111111111111111"),ft=new xe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Va=new xe("Sysvar1nstructions1111111111111111111111111"),Io=wi.programId,Da=new xe("a2Gt18uJC8puJT9JRYQLU6rPi6okxQb4WqCjwtYshZB"),qa=new xe("bXSKiFqYrALF9gJy1KqHm8tv4QXk8nCgbLN8WRsGEbh"),St=new xe("So11111111111111111111111111111111111111112"),Ot=xe.default,Ga=new xe("71kRXzJMvSeArtXYNEWa8KAjpRJosdMQ7Dpgy5Jt5zfd"),Ua=new xe("ERFzpDteGNo8LTDKW1WwVGrkRMmA2y9WZHXNHxMA6BSV");function wt(i){return In({publicKey:i,transformSol:!0})}var Kn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ot.toBase58()||e instanceof Sn&&Ot.equals(e)){this.decimals=et.decimals,this.symbol=et.symbol,this.name=et.name,this.mint=new Sn(et.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Sn.default:In({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Xe=Kn;Xe.WSOL=new Kn(te(j({},et),{mint:et.address}));var Cn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},en=Cn;en.SOL=new Cn(Bn);import xo from"bn.js";var hi=new J(new xo(100)),tt=class extends J{toSignificant(e=5,t,n){return this.mul(hi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(hi).toFixed(e,t,n)}};var So=ae("CobaltX_price"),Ee=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new J(Nn(n.decimals),Nn(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&So.logWithError("mul token not equals");let n=super.mul(t);return new Ee({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as Ko}from"@solana/web3.js";import Co from"bn.js";function Bi(i){return typeof i=="object"&&i!==null&&![Xe,Ae,Ko,J,Co,Ee,tt].some(e=>typeof e=="object"&&i instanceof e)}function ve(i){return typeof i=="string"?xn(i):Array.isArray(i)?i.map(e=>ve(e)):Bi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,ve(t)])):i}var Ti=new nt(0),No=new nt(1),Wu=new nt(2),Vu=new nt(3),Du=new nt(5),Tn=new nt(10),qu=new nt(100),Gu=new nt(1e3),Uu=new nt(1e4);function Nn(i){return Tn.pow(ue(i))}function bn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Lo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Oo}from"@solana/spl-token";import{ComputeBudgetProgram as Ju,Keypair as tc,PublicKey as Ro,Transaction as ic,TransactionMessage as oc,VersionedTransaction as sc}from"@solana/web3.js";var ie={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as lc}from"@solana/spl-token";var mc=ae("CobaltX_txUtil");function Se(i,e){let[t,n]=Ro.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function re(i,e,t){return Se([i.toBuffer(),(t!=null?t:Oo).toBuffer(),e.toBuffer()],new Lo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as z}from"@solana/web3.js";var Mo=new z("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Pc=new z("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Eo=new z("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),vo=new z("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),_o=new z("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Fo=new z("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Rn=new z("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Ii=new z("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Wo=new z("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),tn=new z("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ln=new z("2TnjBuwqyBB9to5jURagDT7jLmBPefGRiKL2yh1zPZ4V"),xi=new z("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Si=new z("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Vo=new z("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),kc=new z("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Ac=new z("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),wc=new z("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),hc=new z("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Tc=new z("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),On=new z("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ki=new z("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Do=new z("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),qo=new z("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Go=new z("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Uo=new z("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Xo=new z("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),zo=new z("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Qo=new z("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ho=new z("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Re={AMM_V4:Ii,AMM_STABLE:Wo,CLMM_PROGRAM_ID:Ln,CLMM_LOCK_PROGRAM_ID:xi,CLMM_LOCK_AUTH_ID:Si,FARM_PROGRAM_ID_V3:Mo,FARM_PROGRAM_ID_V5:Eo,FARM_PROGRAM_ID_V6:vo,OPEN_BOOK_PROGRAM:Fo,SERUM_PROGRAM_ID_V3:Rn,UTIL1216:_o,Router:Vo,CREATE_CPMM_POOL_PROGRAM:On,CREATE_CPMM_POOL_AUTH:Ki,CREATE_CPMM_POOL_FEE_ACC:Do,LOCK_CPMM_PROGRAM:Xo,LOCK_CPMM_AUTH:Qo},Bc={SERUM_MARKET:z.default,OPENBOOK_MARKET:new z("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:z.default,FarmV3:new z("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new z("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new z("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new z("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new z("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new z("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new z("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new z("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new z("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:qo,CREATE_CPMM_POOL_AUTH:Go,CREATE_CPMM_POOL_FEE_ACC:Uo,FEE_DESTINATION_ID:new z("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:zo,LCOK_CPMM_AUTH:Ho};import ze from"bn.js";var Mt=1e4;function be(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=te(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new ze(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Mt){let u=new ze(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=nn(i.mul(new ze(Mt)),new ze(Mt-o.transferFeeBasisPoints)),c=new ze(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=nn(l.mul(new ze(o.transferFeeBasisPoints)),new ze(Mt)),p=m.gt(s)?s:m;return{amount:l,fee:p,expirationTime:a}}else{let u=nn(i.mul(new ze(o.transferFeeBasisPoints)),new ze(Mt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function it(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function nn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ze(0))?t.add(new ze(1)):t}import{PublicKey as Yo,AddressLookupTableAccount as Ci}from"@solana/web3.js";var Zo={AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM:new Ci({key:new Yo("AiAibtFJts8e4W1FjWYRH34aBJkJqghdmXiJozK7MvTM"),state:Ci.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as qc,sendAndConfirmTransaction as Gc,Transaction as Xc,TransactionMessage as Qc,VersionedTransaction as Hc}from"@solana/web3.js";import Zc from"axios";import{createTransferInstruction as sP,TOKEN_2022_PROGRAM_ID as aP,TOKEN_PROGRAM_ID as uP}from"@solana/spl-token";import{PublicKey as mP}from"@solana/web3.js";import Xs from"bn.js";import{PublicKey as ss}from"@solana/web3.js";import Mi,{isBN as Ei}from"bn.js";import{bits as wl,BitStructure as hl,blob as Jo,Blob as Tl,cstr as Bl,f32 as Il,f32be as xl,f64 as Sl,f64be as Kl,greedy as Cl,Layout as $o,ns64 as Nl,ns64be as Rl,nu64 as Ll,nu64be as Ol,offset as Ml,s16 as El,s16be as vl,s24 as _l,s24be as Fl,s32 as es,s32be as Wl,s40 as Vl,s40be as Dl,s48 as ql,s48be as Gl,s8 as Ul,seq as ts,struct as Xl,Structure as ns,u16 as is,u16be as zl,u24 as Ql,u24be as Hl,u32 as Yl,u32be as Zl,u40 as jl,u40be as Jl,u48 as $l,u48be as em,u8 as rs,UInt as os,union as tm,Union as nm,unionLayoutDiscriminator as im,utf8 as rm}from"@solana/buffer-layout";var Mn=$o,Ri=ns;var En=os;var Li=rs,yt=is;var ce=es;var Oi=ts;var ge=Jo;var Bt=class extends Mn{constructor(t,n,r){super(t,r);this.blob=ge(t),this.signed=n}decode(t,n=0){let r=new Mi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Mi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function V(i){return new En(1,i)}function _e(i){return new En(4,i)}function k(i){return new Bt(8,!1,i)}function q(i){return new Bt(16,!1,i)}function vi(i){return new Bt(8,!0,i)}function _i(i){return new Bt(16,!0,i)}var rn=class extends Mn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new rn(ge(32),e=>new ss(e),e=>e.toBuffer(),i)}function Te(i){return new rn(Li(),as,us,i)}function as(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function us(i){return i?1:0}var vn=class extends Ri{decode(e,t){return super.decode(e,t)}};function O(i,e,t){return new vn(i,e,t)}function H(i,e,t){let n,r=typeof e=="number"?e:Ei(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Ei(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Oi(i,r,t)}import{PublicKey as _m,SystemProgram as Wm}from"@solana/web3.js";import qm from"bn.js";import{createCloseAccountInstruction as zm,createInitializeAccountInstruction as Qm,createTransferInstruction as Hm,TOKEN_PROGRAM_ID as Ym}from"@solana/spl-token";import{TOKEN_PROGRAM_ID as Am}from"@solana/spl-token";import{Keypair as Bm,PublicKey as Im}from"@solana/web3.js";import Km from"bn.js";var Fi=O([S("mint"),S("owner"),k("amount"),_e("delegateOption"),S("delegate"),V("state"),_e("isNativeOption"),k("isNative"),k("delegatedAmount"),_e("closeAuthorityOption"),S("closeAuthority")]);var Rm=ae("CobaltX_Util");import{AccountLayout as nf,TOKEN_2022_PROGRAM_ID as rf,TOKEN_PROGRAM_ID as of}from"@solana/spl-token";import{PublicKey as af}from"@solana/web3.js";import cf from"bn.js";import{PublicKey as up}from"@solana/web3.js";import{MintLayout as lp,TOKEN_PROGRAM_ID as pp}from"@solana/spl-token";import{ASSOCIATED_TOKEN_PROGRAM_ID as Vt,TOKEN_2022_PROGRAM_ID as de,TOKEN_PROGRAM_ID as ne}from"@solana/spl-token";import{Keypair as pn,PublicKey as I,SystemProgram as at,TransactionInstruction as Ke}from"@solana/web3.js";import zn from"bn.js";import Ps from"bn.js";import qe from"bn.js";var ye=new qe(0),Fe=new qe(1),rt=new qe(-1),We=new qe(1).shln(64),on=new qe(1).shln(128),_n=We.sub(Fe),Et=64,Wi=on.subn(1),Ne=-443636,Le=-Ne,Ye=new qe("4295048016"),Ze=new qe("79226673521066979257578248091"),sn=new qe("4295048017"),an=new qe("79226673521066979257578248090"),Vi=16,Di="59543866431248",qi="184467440737095516",Gi="15793534762490258745",un=new qe(10).pow(new qe(6));var kp=new qe("18446744073700000000");import Q from"bn.js";function cn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Fn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Wn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function vt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ui(i,e){return vt(i,e)?null:Fn(i,e)}function Xi(i,e){return vt(i,e)?null:Wn(i,e)}var Ip=Buffer.from("amm_config","utf8"),cs=Buffer.from("pool","utf8"),ls=Buffer.from("pool_vault","utf8"),ms=Buffer.from("pool_reward_vault","utf8"),zi=Buffer.from("position","utf8"),ps=Buffer.from("tick_array","utf8"),ds=Buffer.from("operation","utf8"),fs=Buffer.from("pool_tick_array_bitmap_extension","utf8"),bs=Buffer.from("observation","utf8");function Qi(i,e,t,n){return Se([cs,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Vn(i,e,t){return Se([ls,e.toBuffer(),t.toBuffer()],i)}function Hi(i,e,t){return Se([ms,e.toBuffer(),t.toBuffer()],i)}function $(i,e,t){return Se([ps,e.toBuffer(),cn(t)],i)}function ot(i,e,t,n){return Se([zi,e.toBuffer(),cn(t),cn(n)],i)}function Me(i,e){return Se([zi,e.toBuffer()],i)}function It(i){return Se([Buffer.from("metadata","utf8"),ft.toBuffer(),i.toBuffer()],ft)}function ln(i){return Se([ds],i)}function Pe(i,e){return Se([fs,e.toBuffer()],i)}function Yi(i,e){return Se([bs,e.toBuffer()],i)}var Zi=Buffer.from("locked_position","utf8");function Dn(i,e){return Se([Zi,e.toBuffer()],i)}function qn(i,e){return Se([Zi,e.toBuffer()],i)}import{TOKEN_2022_PROGRAM_ID as ji}from"@solana/spl-token";import{PublicKey as Ve}from"@solana/web3.js";import le from"bn.js";import je from"bn.js";var _t=class{static getfeeGrowthInside(e,t,n){let r=new je(0),o=new je(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new je(0),a=new je(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=X.wrappingSubU128(X.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),u=t.tokenFeesOwedA.add(a),c=X.mulDivFloor(X.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=X.mulDivFloor(X.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,We),u=t.tokenFeesOwedA.add(a),c=X.mulDivFloor(X.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,We),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=X.wrappingSubU128(u,c.growthInsideLastX64),m=X.mulDivFloor(l,t.liquidity,We),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=X.wrappingSubU128(u,c.growthInsideLastX64),m=X.mulDivFloor(l,t.liquidity,We),p=c.rewardAmountOwed.add(m);o.push(p)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(X.wrappingSubU128(X.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,y,T,h;let a=U.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),u=U.getSqrtPriceX64FromTick(t.tickLower),c=U.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[p,d]=[be(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),be(m.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,s,!0)],[g,f]=[be(new je(new M(m.amountA.toString()).mul(l).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),be(new je(new M(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:p,amountB:d,amountSlippageA:g,amountSlippageB:f,expirationTime:it(p.expirationTime,d.expirationTime)}}};var ys=15,Y=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=E.getTickArrayStartIndexByTick(r,o),l=E.getInitializedTickArrayInRange(s,a,o,c,Math.floor(ys/2));for(let d=0;d<l.length;d++){let{publicKey:g}=$(t,n,l[d]);u.push(g)}let m=(await ut(e,u)).map(d=>d!==null?Ft.decode(d.data):null),p={};for(let d=0;d<u.length;d++){let g=m[d];g!==null&&(p[g.startTickIndex]=te(j({},g),{address:u[d]}))}return p}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=E.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:p,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,p,d]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Y.tickCount(t)),a=n?E.searchLowBitFromStart(r,o,s-1,1,t):E.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=we-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<we;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=$(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=E.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u-1}else for(u=u+1;u<we;){let p=c.ticks[u];if(p.liquidityGross.gtn(0)){l=p;break}u=u+1}let{publicKey:m}=$(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(E.checkIsOutOfBoundary(e)){if(e>Le)return!1;let n=E.getTickArrayStartIndexByTick(Ne,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return we*e}};var Gn=14,st=class{static maxTickInTickarrayBitmap(e){return e*we*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Y.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Y.tickCount(n):t+Y.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*we,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ui(1024,l);if(m!==null){let p=(c-m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Xi(1024,l);if(m!==null){let p=(c+m-512)*a;return{isInit:!0,tickIndex:p}}else return{isInit:!1,tickIndex:o-Y.tickCount(n)}}}},Wt=class{static getBitmapOffset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=st.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=st.maxTickInTickarrayBitmap(e),n=-t;if(Le<=t)throw Error(`extensionTickBoundary check error: ${Le}, ${t}`);if(n<=Ne)throw Error(`extensionTickBoundary check error: ${n}, ${Ne}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:E.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Y.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=st.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=E.mergeTickArrayBitmap(e).shln(gt-1-a),c=vt(512,u)?null:Fn(512,u);if(c!==null){let l=t-c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=E.mergeTickArrayBitmap(e).shrn(a),c=vt(512,u)?null:Wn(512,u);if(c!==null){let l=t+c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Y.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%st.maxTickInTickarrayBitmap(t),r=Math.floor(n/Y.tickCount(t));return e<0&&n!=0&&(r=gt-r),r}};var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:p,amountCalculated:d,accounts:g,sqrtPriceX64:f,feeAmount:b}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...g),{allTrade:p,expectedAmountOut:d.mul(rt),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=$(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:p,sqrtPriceX64:d,feeAmount:g}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(rt),c,o);return a.push(...p),{expectedAmountIn:m,remainingAccounts:a,executionPrice:d,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Wt.checkTickArrayIsInit(Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):E.checkTickArrayIsInitialized(E.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=$(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=$(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Y.tickCount(e.tickSpacing)),r=t?E.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):E.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=st.nextInitializedTickArrayStartIndex(E.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Wt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ne||t>Le)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],p=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(p===void 0)throw Error("get new reward mint info error");let d=te(j({},m),{perSecond:X.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ve(p)});if(d.tokenMint.equals(Ve.default))continue;if(n<=d.openTime.toNumber()||r.eq(ye)){s.push(d);continue}let g=new le(Math.min(d.endTime.toNumber(),n)),f=g.sub(d.lastUpdateTime),b=X.mulDivFloor(f,d.emissionsPerSecondX64,r),y=d.rewardGrowthGlobalX64.add(b),T=X.mulDivFloor(f,d.emissionsPerSecondX64,We),h=d.rewardTotalEmissioned.add(T);s.push(te(j({},d),{rewardGrowthGlobalX64:y,rewardTotalEmissioned:h,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=E.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=st.maxTickInTickarrayBitmap(e),n=-t;return t>Le&&(t=Y.getArrayStartIndex(Le,e)+Y.tickCount(e)),n<Ne&&(n=Y.getArrayStartIndex(Ne,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Y.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Ji.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=E.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=E.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:p}=$(u.programId,u.id,m);o.push({pubkey:p}),r[p.toString()]=u.id}}let s=await xt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Ft.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te(j({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(p=>p.accountInfo.mint),c=[];for(let p of u)for(let d of s)c.push(Me(d,p).publicKey);let l=await ut(t,c,{batchRequest:r}),m={};for(let p of l){if(p===null)continue;let d=Un.decode(p.data),g=d.poolId.toString(),f=e.find(L=>L.state.id.toBase58()===g);if(f===void 0)continue;let b=f.state,y=E._getTickPriceLegacy({poolInfo:b,tick:d.tickLower,baseIn:!0}),T=E._getTickPriceLegacy({poolInfo:b,tick:d.tickUpper,baseIn:!0}),{amountA:h,amountB:N}=Z.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,T.tickSqrtPriceX64,d.liquidity,!1),v=1/(1-Math.sqrt(Math.sqrt(y.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:d.poolId,nftMint:d.nftMint,priceLower:y.price,priceUpper:T.price,amountA:h,amountB:N,tickLower:d.tickLower,tickUpper:d.tickUpper,liquidity:d.liquidity,feeGrowthInsideLastX64A:d.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:d.feeGrowthInsideLastX64B,tokenFeesOwedA:d.tokenFeesOwedA,tokenFeesOwedB:d.tokenFeesOwedB,rewardInfos:d.rewardInfos.map(L=>te(j({},L),{pendingReward:new le(0)})),leverage:v,tokenFeeAmountA:new le(0),tokenFeeAmountB:new le(0)}];let B=await E.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickLower,f.state.tickSpacing),R=await E.getTickArrayAddressByTick(f.state.programId,d.poolId,d.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickLower}`]=B,m[`${f.state.programId.toString()}-${d.poolId.toString()}-${d.tickUpper}`]=R}if(o){let p=Object.values(m),d=await ut(t,p,{batchRequest:r}),g={};for(let f=0;f<p.length;f++){let b=d[f];if(b===null)continue;let y=p[f].toString();g[y]=Ft.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let y of b){let T=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,h=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,N=g[m[T].toString()],v=g[m[h].toString()],B=N.ticks[E.getTickOffsetInArray(y.tickLower,f.tickSpacing)],R=v.ticks[E.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:L,tokenFeeAmountB:D}=await _t.GetPositionFees(f,y,B,R),x=await _t.GetPositionRewards(f,y,B,R);y.tokenFeeAmountA=L.gte(new le(0))?L:new le(0),y.tokenFeeAmountB=D.gte(new le(0))?D:new le(0);for(let _=0;_<x.length;_++)y.rewardInfos[_].pendingReward=x[_].gte(new le(0))?x[_]:new le(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new M(0),catchLiquidityInsufficient:u=!1}){var fe;let c,l=n.toBase58()===e.mintA.address,[m,p]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new M(0))?c=l?Ye.add(new le(1)):Ze.sub(new le(1)):c=U.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=be(o,m,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:b,executionPrice:y,feeAmount:T}=pe.getOutputAmountAndRemainAccounts(e,t,n,d.amount.sub((fe=d.fee)!=null?fe:ye),c,u),h=be(f,p,r,!1),N=U.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),v=l?N:new M(1).div(N),B=f.mul(new le(Math.floor((1-s)*1e10))).div(new le(1e10)),R=be(B,p,r,!1),L=l?e.currentPrice:new M(1).div(e.currentPrice),D=new M(v).sub(L).abs(),x=L,_=new tt(new M(D).mul(10**15).toFixed(0),new M(x).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:d,amountOut:h,minAmountOut:R,expirationTime:it(d.expirationTime,h.expirationTime),currentPrice:e.currentPrice,executionPrice:v,priceImpact:_,fee:T,remainingAccounts:b,executionPriceX64:y}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,p]=[new Xe(te(j({},c),{mint:c.address,isToken2022:c.programId===ji.toBase58()})),new Xe(te(j({},l),{mint:l.address,isToken2022:l.programId===ji.toBase58()}))],{allTrade:d,realAmountIn:g,amountOut:f,minAmountOut:b,expirationTime:y,currentPrice:T,executionPrice:h,priceImpact:N,fee:v,remainingAccounts:B,executionPriceX64:R}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ve(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),L=te(j({},g),{amount:new Ae(m,g.amount),fee:g.fee===void 0?void 0:new Ae(m,g.fee)}),D=te(j({},f),{amount:new Ae(p,f.amount),fee:f.fee===void 0?void 0:new Ae(p,f.fee)}),x=te(j({},b),{amount:new Ae(p,b.amount),fee:b.fee===void 0?void 0:new Ae(p,b.fee)}),_=new Ee({baseToken:m,denominator:new le(10).pow(new le(20+m.decimals)),quoteToken:p,numerator:T.mul(new M(10**(20+p.decimals))).toFixed(0)}),fe=new Ee({baseToken:m,denominator:new le(10).pow(new le(20+m.decimals)),quoteToken:p,numerator:h.mul(new M(10**(20+p.decimals))).toFixed(0)}),se=new Ae(m,v);return{allTrade:d,realAmountIn:L,amountOut:D,minAmountOut:x,expirationTime:y,currentPrice:_,executionPrice:fe,priceImpact:N,fee:se,remainingAccounts:B,executionPriceX64:R}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new M(0)}){var x;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new M(0))?l=u?Ze.sub(new le(1)):Ye.add(new le(1)):l=U.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=be(o,c[n.toString()],r,!0),{expectedAmountIn:p,remainingAccounts:d,executionPrice:g,feeAmount:f}=pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((x=m.fee)!=null?x:ye),l),b=u?e.mintB.address:e.mintA.address,y=be(p,c[b],r,!1),T=U.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),h=u?T:new M(1).div(T),N=p.mul(new le(Math.floor((1+s)*1e10))).div(new le(1e10)),v=be(N,c[b],r,!0),B=u?e.currentPrice:new M(1).div(e.currentPrice),R=new M(h).sub(B).abs(),L=B,D=new tt(new M(R).mul(10**15).toFixed(0),new M(L).mul(10**15).toFixed(0));return{amountIn:y,maxAmountIn:v,realAmountOut:m,expirationTime:it(y.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:D,fee:f,remainingAccounts:d}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,b;let o=e[t],s=E.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=E.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,p=o.priceMax-o.priceMin,d;return l<=0?d=0:m===l?d=p/l:p===l?d=l/m:d=l/p*(l/m),{feeApr:o.feeApr*d,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*d,((f=o.rewardApr[1])!=null?f:0)*d,((b=o.rewardApr[2])!=null?b:0)*d],apr:o.apr*d}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[wt(e.mintA.address).toString()],p=r[wt(e.mintB.address).toString()],d=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!p)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=U.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),b=U.getSqrtPriceX64FromTick(s),y=U.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:h}=Z.getAmountsFromLiquidityWithSlippage(f,b,y,t,!1,!1,0),{amountSlippageA:N,amountSlippageB:v}=Z.getAmountsFromLiquidityWithSlippage(f,b,y,o,!1,!1,0),B=new M(T.toString()).div(new M(10).pow(d)).mul(m.value).add(new M(h.toString()).div(new M(10).pow(g)).mul(p.value)),R=new M(N.toString()).div(new M(10).pow(d)).mul(m.value).add(new M(v.toString()).div(new M(10).pow(g)).mul(p.value)),L=new M(1).div(B.add(R)),x=new M(l.volumeFee).mul(365).div(c).mul(L).mul(100).toNumber(),_=3600*24*365,fe=e.rewardDefaultInfos.map(se=>{var ee,$n;let he=se.mint.decimals,me=r[se.mint.address];return u<((ee=se.startTime)!=null?ee:0)||u>(($n=se.endTime)!=null?$n:0)||!se.perSecond||!me||he===void 0?0:new M(me.value).mul(new M(se.perSecond).mul(_)).div(new M(10).pow(he)).mul(L).mul(100).toNumber()});return{feeApr:x,rewardsApr:fe,apr:x+fe.reduce((se,he)=>se+he,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var y,T;let l=U.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),m=U.getSqrtPriceX64FromTick(n),p=U.getSqrtPriceX64FromTick(r),d=a?1-s:1+s,g=be(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,u,!c),f=new le(new M(g.amount.sub((T=g.fee)!=null?T:ye).toString()).mul(d).toFixed(0)),b;if(l.lte(m))b=t?Z.getLiquidityFromTokenAmountA(m,p,f,!a):new le(0);else if(l.lte(p)){let h=Z.getLiquidityFromTokenAmountA(l,p,f,!a),N=Z.getLiquidityFromTokenAmountB(m,l,f);b=t?h:N}else b=t?new le(0):Z.getLiquidityFromTokenAmountB(m,p,f);return pe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,y,T,h;let u=U.getSqrtPriceX64FromTick(n),c=U.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(U.priceToSqrtPriceX64(new M(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[p,d]=[be(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),be(m.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[g,f]=[be(m.amountA.muln(l),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),be(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:p,amountB:d,amountSlippageA:g,amountSlippageB:f,expirationTime:it(p.expirationTime,d.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ve(u.id));(await ut(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=mn.decode(u.data))});let s=t.map(u=>Pe(new Ve(u.programId),new Ve(u.id)).publicKey),a=await pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>te(j({},u),{[c.id]:te(j({},n[c.id]),{id:new Ve(c.id),version:6,programId:new Ve(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te(j({},c.config),{id:new Ve(c.config.id),fundOwner:""}),currentPrice:new M(c.price),exBitmapAccount:Pe(new Ve(c.programId),new Ve(c.id)).publicKey,exBitmapInfo:a[Pe(new Ve(c.programId),new Ve(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var X=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(ye)||(o=o.add(Fe)),o}static mulDivFloor(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).add(n.sub(Fe)).div(n)}static x64ToDecimal(e,t){return new M(e.toString()).div(M.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Q(e.mul(M.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(on).sub(t).mod(on)}};function Be(i,e){return Xn(i.mul(e),64,256)}function gs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Xn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var U=class{static sqrtPriceX64ToPrice(e,t,n){return X.x64ToDecimal(e).pow(2).mul(M.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return X.decimalToX64(e.mul(M.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(ye))return e;let o=t.shln(Et);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?X.mulDivCeil(s,e,a):X.mulDivRoundingUp(s,Fe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return X.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Et);if(r)return e.add(o.div(t));{let s=X.mulDivRoundingUp(o,Fe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ne||e>Le)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Q("18445821805675395072"):new Q("18446744073709551616");return(t&2)!=0&&(n=Be(n,new Q("18444899583751176192"))),(t&4)!=0&&(n=Be(n,new Q("18443055278223355904"))),(t&8)!=0&&(n=Be(n,new Q("18439367220385607680"))),(t&16)!=0&&(n=Be(n,new Q("18431993317065453568"))),(t&32)!=0&&(n=Be(n,new Q("18417254355718170624"))),(t&64)!=0&&(n=Be(n,new Q("18387811781193609216"))),(t&128)!=0&&(n=Be(n,new Q("18329067761203558400"))),(t&256)!=0&&(n=Be(n,new Q("18212142134806163456"))),(t&512)!=0&&(n=Be(n,new Q("17980523815641700352"))),(t&1024)!=0&&(n=Be(n,new Q("17526086738831433728"))),(t&2048)!=0&&(n=Be(n,new Q("16651378430235570176"))),(t&4096)!=0&&(n=Be(n,new Q("15030750278694412288"))),(t&8192)!=0&&(n=Be(n,new Q("12247334978884435968"))),(t&16384)!=0&&(n=Be(n,new Q("8131365268886854656"))),(t&32768)!=0&&(n=Be(n,new Q("3584323654725218816"))),(t&65536)!=0&&(n=Be(n,new Q("696457651848324352"))),(t&131072)!=0&&(n=Be(n,new Q("26294789957507116"))),(t&262144)!=0&&(n=Be(n,new Q("37481735321082"))),e>0&&(n=Wi.div(n)),n}static getTickFromPrice(e,t,n){return U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ze)||e.lt(Ye))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Q(t-64),r=gs(n,32,128),o=new Q("8000000000000000","hex"),s=0,a=new Q(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Q(0))&&s<Vi;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new Q(Di)),p=Xn(m.sub(new Q(qi)),64,128).toNumber(),d=Xn(m.add(new Q(Gi)),64,128).toNumber();return p==d?p:U.getSqrtPriceX64FromTick(d).lte(e)?d:p}},kt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=U.getTickFromSqrtPriceX64(U.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=kt.getTickWithPriceAndTickspacing(e,t,n,r),s=U.getSqrtPriceX64FromTick(o);return U.sqrtPriceX64ToPrice(s,n,r)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Et),s=t.sub(e);return r?X.mulDivRoundingUp(X.mulDivCeil(o,s,t),Fe,e):X.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");return r?X.mulDivCeil(n,t.sub(e),We):X.mulDivFloor(n,t.sub(e),We)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?X.mulDivRoundingUp(a,Fe,_n):a.shrn(Et)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),X.mulDivFloor(n,_n,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,r,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new Q(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,r,o),a=Z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new Q(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new Q(new M(u.toString()).mul(l).toFixed(0)),p=new Q(new M(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:p}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,h,N,v;let c=U.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),l=U.getSqrtPriceX64FromTick(t),m=U.getSqrtPriceX64FromTick(n),p=s?1+o:1-o,d=Z.getAmountsFromLiquidity(c,l,m,r,s),[g,f]=[be(d.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),be(d.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)],[b,y]=[be(new Q(new M(d.amountA.toString()).mul(p).toFixed(0)),(N=e.mintA.extensions)==null?void 0:N.feeConfig,a,u),be(new Q(new M(d.amountB.toString()).mul(p).toFixed(0)),(v=e.mintB.extensions)==null?void 0:v.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:b,amountSlippageB:y,expirationTime:it(g.expirationTime,f.expirationTime)}}},Pt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f=!1){if(p.eq(ye))throw new Error("amountSpecified must not be 0");if(g||(g=s?Ye.add(Fe):Ze.sub(Fe)),s){if(g.lt(Ye))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(Ze))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let b=p.gt(ye),y={amountSpecifiedRemaining:p,amountCalculated:ye,sqrtPriceX64:m,tick:c>d?Math.min(d+Y.tickCount(l)-1,c):d,accounts:[],liquidity:u,feeAmount:new Q(0)},T=d,h=n[d],N=0,v=!s&&h.startTickIndex===y.tick;for(;!y.amountSpecifiedRemaining.eq(ye)&&!y.sqrtPriceX64.eq(g);){N>10;let B={};B.sqrtPriceStartX64=y.sqrtPriceX64;let R=E.nextInitTick(h,y.tick,l,s,v),L=R||null,D=null;if(!(L!=null&&L.liquidityGross.gtn(0))){let _=pe.nextInitializedTickArrayStartIndex({tickCurrent:y.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!_.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:y.amountSpecifiedRemaining,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts};throw Error("swapCompute LiquidityInsufficient")}T=_.nextStartIndex;let{publicKey:fe}=$(e,t,T);D=fe,h=n[T];try{L=E.firstInitializedTick(h,s)}catch{throw Error("not found next tick info")}}B.tickNext=L.tick,B.initialized=L.liquidityGross.gtn(0),d!==T&&D&&(y.accounts.push(D),d=T),B.tickNext<Ne?B.tickNext=Ne:B.tickNext>Le&&(B.tickNext=Le),B.sqrtPriceNextX64=U.getSqrtPriceX64FromTick(B.tickNext);let x;if(s&&B.sqrtPriceNextX64.lt(g)||!s&&B.sqrtPriceNextX64.gt(g)?x=g:x=B.sqrtPriceNextX64,[y.sqrtPriceX64,B.amountIn,B.amountOut,B.feeAmount]=Pt.swapStepCompute(y.sqrtPriceX64,x,y.liquidity,y.amountSpecifiedRemaining,a),y.feeAmount=y.feeAmount.add(B.feeAmount),b?(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.sub(B.amountIn.add(B.feeAmount)),y.amountCalculated=y.amountCalculated.sub(B.amountOut)):(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.add(B.amountOut),y.amountCalculated=y.amountCalculated.add(B.amountIn.add(B.feeAmount))),y.sqrtPriceX64.eq(B.sqrtPriceNextX64)){if(B.initialized){let _=L.liquidityNet;s&&(_=_.mul(rt)),y.liquidity=Z.addDelta(y.liquidity,_)}v=B.tickNext!=y.tick&&!s&&h.startTickIndex===B.tickNext,y.tick=s?B.tickNext-1:B.tickNext}else if(y.sqrtPriceX64!=B.sqrtPriceStartX64){let _=U.getTickFromSqrtPriceX64(y.sqrtPriceX64);v=_!=y.tick&&!s&&h.startTickIndex===_,y.tick=_}++N}try{let{nextStartIndex:B,isExist:R}=Y.nextInitializedTickArray(y.tick,l,s,r,o);R&&d!==B&&(y.accounts.push($(e,t,B).publicKey),d=B)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ye,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new Q(0),amountIn:new Q(0),amountOut:new Q(0),feeAmount:new Q(0)},a=e.gte(t),u=r.gte(ye);if(u){let l=X.mulDivFloor(r,un.sub(new Q(o.toString())),un);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(rt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=U.getNextSqrtPriceX64FromOutput(e,n,r.mul(rt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(rt))&&(s.amountOut=r.mul(rt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=X.mulDivCeil(s.amountIn,new Q(o),un.sub(new Q(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var we=60,gt=512,E=class{static getTickArrayAddressByTick(e,t,n,r){let o=E.getTickArrayStartIndexByTick(n,r),{publicKey:s}=$(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=E.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=we)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Y.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Y.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*we,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*we,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*we:e+t*we}static mergeTickArrayBitmap(e){let t=new Ps(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*we));return[...E.searchLowBitFromStart(e,t,s-1,o,n),...E.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return E.searchHightBitFromStart(e,t,0,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=E.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=$(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>E.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>E.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ne||e>Le}static nextInitTick(e,t,n,r,o){if(Y.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<we;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=we-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<we;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=kt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=U.getSqrtPriceX64FromTick(t),o=U.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=kt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=U.getSqrtPriceX64FromTick(o),a=U.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}};var ks=O([ge(8),V("bump"),yt("index"),S(""),_e("protocolFeeRate"),_e("tradeFeeRate"),yt("tickSpacing"),H(k(),8,"")]),As=O([_e("blockTimestamp"),vi("tickCumulative"),H(k(),4)]),$i=O([ge(8),Te("initialized"),k("recentEpoch"),yt("observationIndex"),S("poolId"),H(As,100,"observations"),H(k(),4)]),ws=O([V("rewardState"),k("openTime"),k("endTime"),k("lastUpdateTime"),q("emissionsPerSecondX64"),k("rewardTotalEmissioned"),k("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),q("rewardGrowthGlobalX64")]),mn=O([ge(8),V("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),V("mintDecimalsA"),V("mintDecimalsB"),yt("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),ce("tickCurrent"),_e(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),k("protocolFeesTokenA"),k("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),V("status"),H(V(),7,""),H(ws,3,"rewardInfos"),H(k(),16,"tickArrayBitmap"),k("totalFeesTokenA"),k("totalFeesClaimedTokenA"),k("totalFeesTokenB"),k("totalFeesClaimedTokenB"),k("fundFeesTokenA"),k("fundFeesTokenB"),k("startTime"),H(k(),15*4-3,"padding")]),hs=O([q("growthInsideLastX64"),k("rewardAmountOwed")]),Un=O([ge(8),V("bump"),S("nftMint"),S("poolId"),ce("tickLower"),ce("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),H(hs,3,"rewardInfos"),H(k(),8,"")]),Od=O([ge(8),V("bump"),S("poolId"),ce("tickLowerIndex"),ce("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),H(q(),3,"rewardGrowthInside"),H(k(),8,"")]),Ts=O([ce("tick"),_i("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),H(q(),3,"rewardGrowthsOutsideX64"),H(_e(),13,"")]),Ft=O([ge(8),S("poolId"),ce("startTickIndex"),H(Ts,we,"ticks"),V("initializedTickCount"),H(V(),115,"")]),Bs=O([ge(329),H(S(),100,"whitelistMints")]),Ji=O([ge(8),S("poolId"),H(H(k(),8),Gn,"positiveTickArrayBitmap"),H(H(k(),8),Gn,"negativeTickArrayBitmap")]),Md=O([k(),V("bump"),S("owner"),S("poolId"),S("positionId"),S("nftAccount"),H(k(),8)]),Ed=O([ge(8),V("bump"),S("lockOwner"),S("poolId"),S("positionId"),S("nftAccount"),S("lockNftMint"),k("recentEpoch"),H(k(),8)]);$i.span;var er=ae("CobaltX_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},tr=[188,37,179,131,82,150,84,73],nr=[16,72,250,198,14,162,212,19],At=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g){let f=O([q("sqrtPriceX64"),k("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1}],y=Buffer.alloc(f.span);f.encode({sqrtPriceX64:d,startTime:g},y);let T=Buffer.from([...De.createPool,...y]);return new Ke({keys:b,programId:e,data:T})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new I(r.address),new I(o.address)],{publicKey:m}=Qi(t,s,c,l),{publicKey:p}=Yi(t,m),{publicKey:d}=Vn(t,m,c),{publicKey:g}=Vn(t,m,l),f=Pe(t,m).publicKey,b=[this.createPoolInstruction(t,m,n,s,p,c,d,new I(r.programId||ne),l,g,new I(o.programId||ne),f,a,u)];return{signers:[],instructions:b,instructionTypes:[ie.CreateAccount,ie.ClmmCreatePool],address:{poolId:m,observationId:p,exBitmapAccount:f,mintAVault:d,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T,h,N,v,B,R,L,D,x){let _=O([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),fe=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...fe],he=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:h,tickArrayLowerStartIndex:N,tickArrayUpperStartIndex:v,liquidity:B,amountMaxA:R,amountMaxB:L,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},he);let me=Buffer.from([...De.openPosition,...he]);return new Ke({keys:se,programId:e,data:me})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T,h,N,v,B,R,L,D){let x=O([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),_=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],fe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},..._],se=Buffer.alloc(x.span);x.encode({tickLowerIndex:y,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:N,liquidity:v,amountMaxA:B,amountMaxB:R,withMetadata:L==="create",baseFlag:!1,optionBaseFlag:0},se);let he=Buffer.from([...De.openPositionWithTokenEx,...se]);return new Ke({keys:fe,programId:e,data:he})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let p=[],[d,g]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let D=pn.generate();p.push(D),f=D.publicKey}let b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:T}=$(d,g,b),{publicKey:h}=$(d,g,y),{publicKey:N}=m?re(n.wallet,f,de):re(n.wallet,f,ne),{publicKey:v}=It(f),{publicKey:B}=Me(d,f),{publicKey:R}=ot(d,g,r,o),L=m?this.openPositionFromLiquidityInstruction22(d,n.feePayer,g,n.wallet,f,N,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,y,s,a,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(d,g).publicKey:void 0):this.openPositionFromLiquidityInstruction(d,n.feePayer,g,n.wallet,f,N,v,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,y,s,a,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(d,g).publicKey:void 0);return{signers:p,instructions:[L],instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:T,tickArrayUpper:h,positionNftAccount:N,metadataAccount:v,personalPosition:B,protocolPosition:R}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let p=[],[d,g]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let D=pn.generate();p.push(D),f=D.publicKey}let b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:T}=$(d,g,b),{publicKey:h}=$(d,g,y),{publicKey:N}=m?re(n.wallet,f,de):re(n.wallet,f,ne),{publicKey:v}=It(f),{publicKey:B}=Me(d,f),{publicKey:R}=ot(d,g,r,o),L=m?this.openPositionFromBaseInstruction22(d,n.feePayer,g,n.wallet,f,N,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,y,c,s,a,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(d,g).publicKey:void 0):this.openPositionFromBaseInstruction(d,n.feePayer,g,n.wallet,f,N,v,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,b,y,c,s,a,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(d,g).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:T,tickArrayUpper:h,positionNftAccount:N,metadataAccount:v,personalPosition:B,protocolPosition:R},instructions:[L],signers:p,instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount&&t.lookupTableAccount!=""?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T,h,N,v,B,R,L,D,x){let _=O([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),fe=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...fe],he=Buffer.alloc(_.span);_.encode({tickLowerIndex:T,tickUpperIndex:h,tickArrayLowerStartIndex:N,tickArrayUpperStartIndex:v,liquidity:new zn(0),amountMaxA:R==="MintA"?L:D,amountMaxB:R==="MintA"?D:L,withMetadata:B==="create",baseFlag:R==="MintA",optionBaseFlag:1},he);let me=Buffer.from([...De.openPosition,...he]);return new Ke({keys:se,programId:e,data:me})}static openPositionFromBaseInstruction22(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T,h,N,v,B,R,L,D){let x=O([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Te("withMetadata"),V("optionBaseFlag"),Te("baseFlag")]),_=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],fe=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},..._],se=Buffer.alloc(x.span);x.encode({tickLowerIndex:y,tickUpperIndex:T,tickArrayLowerStartIndex:h,tickArrayUpperStartIndex:N,liquidity:new zn(0),amountMaxA:B==="MintA"?R:L,amountMaxB:B==="MintA"?L:R,withMetadata:v==="create",baseFlag:B==="MintA",optionBaseFlag:1},se);let he=Buffer.from([...De.openPositionWithTokenEx,...se]);return new Ke({keys:fe,programId:e,data:he})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let p,d=[];if(l)p=new I((await l(1))[0]);else{let D=pn.generate();d.push(D),p=D.publicKey}let[g,f]=[new I(e.programId),new I(e.id)],b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:T}=$(g,f,b),{publicKey:h}=$(g,f,y),{publicKey:N}=m?re(n.wallet,p,de):re(n.wallet,p,ne),{publicKey:v}=It(p),{publicKey:B}=Me(g,p),{publicKey:R}=ot(g,f,r,o),L=m?this.openPositionFromLiquidityInstruction22(g,n.wallet,f,n.wallet,p,N,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,b,y,s,a,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(g,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(g,n.wallet,f,n.wallet,p,N,v,R,T,h,B,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,b,y,s,a,u,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Pe(g,f).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:T,tickArrayUpper:h,positionNftAccount:N,metadataAccount:v,personalPosition:B,protocolPosition:R},instructions:[L],signers:d,instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,s){let a=O([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:s?de:ne,isSigner:!1,isWritable:!1}],c=Buffer.alloc(a.span);a.encode({},c);let l=Buffer.from([...De.closePosition,...c]);return new Ke({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let s=new I(e.programId),a=o?re(n.wallet,r.nftMint,de).publicKey:re(n.wallet,r.nftMint,ne).publicKey,{publicKey:u}=Me(s,r.nftMint),c=[];return c.push(this.closePositionInstruction(s,n.wallet,r.nftMint,a,u,o)),{address:{positionNftAccount:a,personalPosition:u},signers:[],instructions:c,instructionTypes:[ie.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T){let h=O([q("liquidity"),k("amountMaxA"),k("amountMaxB"),V("optionBaseFlag"),Te("baseFlag")]),N=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...N],B=Buffer.alloc(h.span);h.encode({liquidity:f,amountMaxA:b,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},B);let R=Buffer.from([...De.increaseLiquidity,...B]);return new Ke({keys:v,programId:e,data:R})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a,nft2022:u}){let[c,l]=[new I(e.programId),new I(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(c,l,m),{publicKey:g}=$(c,l,p),{publicKey:f}=u?re(r.wallet,n.nftMint,de):re(r.wallet,n.nftMint,ne),{publicKey:b}=Me(c,n.nftMint),{publicKey:y}=ot(c,l,n.tickLower,n.tickUpper),T=this.increasePositionFromLiquidityInstruction(c,r.wallet,f,b,l,y,d,g,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Pe(c,l).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:y},signers:[],instructions:[T],instructionTypes:[ie.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a,nft2022:u}){let[c,l]=[new I(e.programId),new I(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(c,l,m),{publicKey:g}=$(c,l,p),{publicKey:f}=u?re(r.wallet,n.nftMint,de):re(r.wallet,n.nftMint,ne),{publicKey:b}=Me(c,n.nftMint),{publicKey:y}=ot(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,f,b,l,y,d,g,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,p])?Pe(c,l).publicKey:void 0)],signers:[],instructionTypes:[ie.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T){let h=O([q("liquidity"),k("amountMaxA"),k("amountMaxB"),V("optionBaseFlag"),Te("baseFlag")]),N=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...N],B=Buffer.alloc(h.span);h.encode({liquidity:new zn(0),amountMaxA:f==="MintA"?b:y,amountMaxB:f==="MintA"?y:b,baseFlag:f==="MintA",optionBaseFlag:1},B);let R=Buffer.from([...De.increaseLiquidity,...B]);return new Ke({keys:v,programId:e,data:R})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y,T,h){let N=O([q("liquidity"),k("amountMinA"),k("amountMinB")]),v=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...f.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...v],R=Buffer.alloc(N.span);N.encode({liquidity:b,amountMinA:y,amountMinB:T},R);let L=Buffer.from([...De.decreaseLiquidity,...R]);return new Ke({keys:B,programId:e,data:L})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u,nft2022:c}){let[l,m]=[new I(e.programId),new I(e.id)],p=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:g}=$(l,m,p),{publicKey:f}=$(l,m,d),{publicKey:b}=c?re(r.wallet,n.nftMint,de):re(r.wallet,n.nftMint,u),{publicKey:y}=Me(l,n.nftMint),{publicKey:T}=ot(l,m,n.tickLower,n.tickUpper),h=[];for(let B=0;B<e.rewardDefaultInfos.length;B++)h.push({poolRewardVault:new I(t.rewardInfos[B].vault),ownerRewardVault:r.rewardAccounts[B],rewardMint:new I(e.rewardDefaultInfos[B].mint.address)});let N=[],v=this.decreaseLiquidityInstruction(l,r.wallet,b,y,m,T,g,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),h,o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[p,d])?Pe(l,m).publicKey:void 0);return N.push(v),{address:{tickArrayLower:g,tickArrayUpper:f,positionNftAccount:b,personalPosition:y,protocolPosition:T},signers:[],instructions:N,instructionTypes:[ie.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,p,d,g,f,b,y){let T=O([k("amount"),k("otherAmountThreshold"),q("sqrtPriceLimitX64"),Te("isBaseInput")]),h=[{pubkey:I.findProgramAddressSync([Buffer.from("__event_authority")],e)[0],isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1}],N=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...m.map(L=>({pubkey:L,isSigner:!1,isWritable:!0}))],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h,...N],B=Buffer.alloc(T.span);T.encode({amount:d,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:b},B);let R=Buffer.from([...De.swap,...B]);return new Ke({keys:v,programId:e,data:R})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new I(e.programId),new I(e.id)],[p,d]=[new I(t.vault.A),new I(t.vault.B)],[g,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toString(),y=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?p:d,b?d:p,b?g:f,b?f:g,c,n,s,a,u,!0,Pe(l,m).publicKey)];return{signers:[],instructions:y,instructionTypes:[ie.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new I(e.programId),new I(e.id)],[p,d]=[new I(t.vault.A),new I(t.vault.B)],[g,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toBase58(),y=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?d:p,b?p:d,b?f:g,b?g:f,c,n,s,a,u,!1,Pe(l,m).publicKey)];return{signers:[],instructions:y,instructionTypes:[ie.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=O([k("openTime"),k("endTime"),q("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1}],f=Buffer.alloc(d.span);d.encode({openTime:ue(l),endTime:ue(m),emissionsPerSecondX64:p},f);let b=Buffer.from([...De.initReward,...f]);return new Ke({keys:g,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=Hi(o,s,r.mint).publicKey,u=ln(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ie.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,p){let d=O([V("rewardIndex"),q("emissionsPerSecondX64"),k("openTime"),k("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(d.span);d.encode({rewardIndex:c,emissionsPerSecondX64:p,openTime:ue(l),endTime:ue(m)},f);let b=Buffer.from([...De.setRewardEmissions,...f]);return new Ke({keys:g,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,u,c;for(let p=0;p<e.rewardDefaultInfos.length;p++)e.rewardDefaultInfos[p].mint.address===r.mint.toString()&&(a=p,u=new I(t.rewardInfos[p].vault),c=new I(t.rewardInfos[p].mint.address));(a===void 0||u===void 0)&&er.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=ln(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ie.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=O([V("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...De.collectReward,...l]);return new Ke({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new I(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&er.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ie.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,nft2022:a,getEphemeralSigners:u}){let c=[],l;if(u)l=new I((await u(1))[0]);else{let y=pn.generate();c.push(y),l=y.publicKey}let m=a?re(o,s,de).publicKey:re(o,s,ne).publicKey,{publicKey:p}=Me(n,s),d=qn(e,l).publicKey,g=re(o,l,ne).publicKey,f=It(l).publicKey,b=At.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:p,lockPositionId:d,lockNftMint:l,lockNftAccount:g,metadataAccount:f,withMetadata:!0,nft2022:a,positionNftMint:s,authPositionNftAccount:re(t,s,a?de:ne).publicKey,positionNftProgram:a?de:ne});return{address:{positionId:p,lockPositionId:d,lockNftAccount:g,lockNftMint:l,positionNftAccount:m,metadataAccount:f},instructions:[b],signers:c,instructionTypes:[ie.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:m,lockNftMint:p,lockNftAccount:d,metadataAccount:g,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!0,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:Vt,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1}],y=O([Te("withMetadata")]),T=Buffer.alloc(y.span);y.encode({withMetadata:f},T);let h=Buffer.from([...tr,...T]);return new Ke({keys:b,programId:e,data:h})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=re(r,o,ne),{publicKey:a}=Me(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Dn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1}];return new Ke({keys:u,programId:e,data:Buffer.from(tr)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=E.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=E.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=$(t,n,r),{publicKey:a}=$(t,n,o),{publicKey:u}=re(e.owner,e.ownerPosition.nftMint,ne),{publicKey:c}=Me(t,e.ownerPosition.nftMint),{publicKey:l}=ot(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new I(e.poolKeys.rewardInfos[g].mint.address)});let p=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],d=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Dn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...p];return new Ke({keys:d,programId:e.programId,data:Buffer.from(nr)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:p,vaultB:d,tickArrayLower:g,tickArrayUpper:f,userVaultA:b,userVaultB:y,mintA:T,mintB:h,rewardAccounts:N,exTickArrayBitmap:v}){let B=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[],...N.map(L=>[{pubkey:L.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:L.rewardMint,isSigner:!1,isWritable:!1}]).flat()],R=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:ne,isSigner:!1,isWritable:!1},{pubkey:de,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...B];return new Ke({keys:R,programId:e,data:Buffer.from(nr)})}};var zf=O([ge(8),V("bump"),Te("disableCreatePool"),yt("index"),k("tradeFeeRate"),k("protocolFeeRate"),k("fundFeeRate"),k("createPoolFee"),S("protocolOwner"),S("fundOwner"),H(k(),16)]),Ss=O([ge(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),V("bump"),V("status"),V("lpDecimals"),V("mintDecimalA"),V("mintDecimalB"),k("lpAmount"),k("protocolFeesMintA"),k("protocolFeesMintB"),k("fundFeesMintA"),k("fundFeesMintB"),k("openTime"),H(k(),32)]);import{ASSOCIATED_TOKEN_PROGRAM_ID as ab,TOKEN_2022_PROGRAM_ID as ub,TOKEN_PROGRAM_ID as cb}from"@solana/spl-token";import{Keypair as pb,PublicKey as db,SystemProgram as bb,TransactionInstruction as Ks}from"@solana/web3.js";var Yf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Zf=Buffer.from("amm_config","utf8"),jf=Buffer.from("pool","utf8"),Jf=Buffer.from("pool_lp_mint","utf8"),$f=Buffer.from("pool_vault","utf8"),eb=Buffer.from("observation","utf8");var tb=Buffer.from("locked_liquidity","utf8");var Ab=ae("CobaltX_cpmm"),Cs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function rr(i,e,t,n,r,o,s,a,u,c,l,m,p,d,g,f){let b=O([k("amountIn"),k("amounOutMin")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0}],T=Buffer.alloc(b.span);return b.encode({amountIn:g,amounOutMin:f},T),new Ks({keys:y,programId:i,data:Buffer.from([...Cs.swapBaseInput,...T])})}import Eb from"bn.js";import _b from"decimal.js-light";import Ns from"bn.js";var xb=new Ns(0);import Rs from"bn.js";var Nb=new Rs(1e6);import or from"bn.js";var Jb=new or(25),$b=new or(1e4);var Qn=O([V("instruction"),k("amountIn"),k("minAmountOut")]),Hn=O([V("instruction"),k("maxAmountIn"),k("amountOut")]),iy=O([V("instruction"),V("nonce")]),Ls=O([V("instruction"),V("nonce"),k("startTime")]),Os=O([k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalValue"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),k("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),k("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),k("lpReserve"),H(k(),3,"padding")]),ry=O([k("accountType"),k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalsValue"),k("abortTradeFactor"),k("priceTickMultiplier"),k("priceTick"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),k("swapQuote2BaseFee"),k("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),H(k(),64,"padding")]),Ms=O([V("instruction"),k("baseAmountIn"),k("quoteAmountIn"),k("fixedSide"),k("otherAmountMin")]),Es=O([V("instruction"),k("lpAmount"),k("baseAmountMin"),k("quoteAmountMin")]);var oy=O([k("fee")]);import{TOKEN_PROGRAM_ID as qy}from"@solana/spl-token";import{PublicKey as Xy}from"@solana/web3.js";import Qy from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as dy,TOKEN_PROGRAM_ID as ar}from"@solana/spl-token";import{PublicKey as by,SystemProgram as yy,SYSVAR_RENT_PUBKEY as gy,TransactionInstruction as ur}from"@solana/web3.js";import{PublicKey as vs}from"@solana/web3.js";var Yn=new vs("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),_s=5e4,Fs=O([k("x"),k("y"),k("price")]),ly=O([k("accountType"),k("status"),k("multiplier"),k("validDataCount"),H(Fs,_s,"DataElement")]);var sr=ae("CobaltX_liquidity_instruction");function Ws({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=ve(i),s=Buffer.alloc(Qn.span);Qn.encode({instruction:9,amountIn:ue(t),minAmountOut:ue(n)},s);let a=[P({pubkey:ar,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders})];return r===4&&a.push(P({pubkey:o.targetOrders})),a.push(P({pubkey:o.vault.A}),P({pubkey:o.vault.B})),r===5&&a.push(P({pubkey:Yn})),a.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1})),new ur({programId:o.programId,keys:a,data:s})}function Vs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=ve(i),s=Buffer.alloc(Hn.span);Hn.encode({instruction:11,maxAmountIn:ue(t),amountOut:ue(n)},s);let a=[P({pubkey:ar,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders}),P({pubkey:o.targetOrders}),P({pubkey:o.vault.A}),P({pubkey:o.vault.B})];return r===5&&a.push(P({pubkey:Yn})),a.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ur({programId:o.programId,keys:a,data:s})}function cr(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Ws(te(j({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Vs(te(j({},a),{maxAmountIn:r,amountOut:o}),t);sr.logWithError("invalid params","params",i)}throw sr.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Cy}from"@solana/web3.js";var Ly=ae("CobaltX_liquidity_serum");var Ds={[Rn.toBase58()]:3};var qs=O([ge(5),ge(8),S("ownAddress"),k("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),k("baseDepositsTotal"),k("baseFeesAccrued"),S("quoteVault"),k("quoteDepositsTotal"),k("quoteFeesAccrued"),k("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),k("baseLotSize"),k("quoteLotSize"),k("feeRateBps"),k("referrerRebatesAccrued"),ge(7)]);import{PublicKey as bg}from"@solana/web3.js";var Ag=ae("Serum");var Kg=O([_e("mintAuthorityOption"),S("mintAuthority"),k("supply"),V("decimals"),V("isInitialized"),_e("freezeAuthorityOption"),S("freezeAuthority")]);import{ASSOCIATED_TOKEN_PROGRAM_ID as Zn,TOKEN_2022_PROGRAM_ID as jn,TOKEN_PROGRAM_ID as bt}from"@solana/spl-token";import{PublicKey as A,SystemProgram as Dt,TransactionInstruction as qt}from"@solana/web3.js";import Je from"bn.js";function Gg(i,e,t,n,r,o,s,a,u,c,l,m){let p=O([V("instruction"),k("amountIn"),k("amountOut")]),d=[{pubkey:Dt.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=ve(t);d.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=ve(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=ve(t);d.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(p.span);return p.encode({instruction:4,amountIn:c,amountOut:l},g),new qt({keys:d,programId:i,data:g})}function Ug(i,e,t,n,r,o,s,a,u,c){let l=O([V("instruction")]),m=[{pubkey:Dt.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let d=ve(n);m.push({pubkey:d.config.id,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.A:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.mintA.address.equals(u)?d.vault.B:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let d=ve(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0})}else{let d=ve(n);m.push({pubkey:d.authority,isSigner:!1,isWritable:!1},{pubkey:d.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:d.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:d.openOrders,isSigner:!1,isWritable:!0},{pubkey:d.vault.A,isSigner:!1,isWritable:!0},{pubkey:d.vault.B,isSigner:!1,isWritable:!0},{pubkey:d.marketId,isSigner:!1,isWritable:!0},{pubkey:d.marketBids,isSigner:!1,isWritable:!0},{pubkey:d.marketAsks,isSigner:!1,isWritable:!0},{pubkey:d.marketEventQueue,isSigner:!1,isWritable:!0},...d.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:d.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:d.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:d.id,isSigner:!1,isWritable:!0},{pubkey:d.id,isSigner:!1,isWritable:!0}])}let p=Buffer.alloc(l.span);return l.encode({instruction:5},p),new qt({keys:m,programId:i,data:p})}function Gs(i,e,t,n,r,o,s,a,u,c,l,m,p,d,g){var B;let f=[],b=[P({pubkey:bt,isWritable:!1}),P({pubkey:jn,isWritable:!1}),P({pubkey:Zn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})];b.push(P({pubkey:t})),b.push(P({pubkey:r}));let y=[u,c],T=[l,m],h=[o,s,a];for(let R=0;R<y.length;R++){let L=y[R],D=h[R]===L.mintA.address;if(b.push(P({pubkey:new A(L.programId),isWritable:!1})),R===y.length-1?b.push(P({pubkey:r})):b.push(P({pubkey:n})),b.push(P({pubkey:new A(h[R])})),b.push(P({pubkey:new A(h[R+1])})),L.version===6){let x=T[R];b.push(P({pubkey:new A(x.config.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(D?x.vault.A:x.vault.B)})),b.push(P({pubkey:new A(D?x.vault.B:x.vault.A)})),b.push(P({pubkey:new A(L.observationId)})),b.push(P({pubkey:dt})),b.push(P({pubkey:Pe(new A(L.programId),new A(L.id)).publicKey})),f.push(Jn(L.sqrtPriceX64.toString(),D));for(let _ of(B=g[R])!=null?B:[])b.push(P({pubkey:new A(_)}))}else if(L.version===5){let x=T[R];b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.authority),isWritable:!1})),b.push(P({pubkey:new A(x.marketProgramId)})),b.push(P({pubkey:new A(x.marketAuthority)})),b.push(P({pubkey:tn,isWritable:!1})),b.push(P({pubkey:new A(x.openOrders)})),b.push(P({pubkey:new A(x.vault.A)})),b.push(P({pubkey:new A(x.vault.B)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.marketId)})),b.push(P({pubkey:new A(x.marketBids)})),b.push(P({pubkey:new A(x.marketAsks)})),b.push(P({pubkey:new A(x.marketEventQueue)})),b.push(P({pubkey:new A(x.marketBaseVault)})),b.push(P({pubkey:new A(x.marketQuoteVault)}))}else if(L.version===4){let x=T[R],_=L.status!==1;b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.authority),isWritable:!1})),b.push(P({pubkey:new A(_?x.id:x.marketProgramId)})),b.push(P({pubkey:new A(_?x.id:x.marketAuthority)})),b.push(P({pubkey:new A(_?x.id:x.openOrders)})),b.push(P({pubkey:new A(x.vault.A)})),b.push(P({pubkey:new A(x.vault.B)})),b.push(P({pubkey:new A(_?x.id:x.marketId)})),b.push(P({pubkey:new A(_?x.id:x.marketBids)})),b.push(P({pubkey:new A(_?x.id:x.marketAsks)})),b.push(P({pubkey:new A(_?x.id:x.marketEventQueue)})),b.push(P({pubkey:new A(_?x.id:x.marketBaseVault)})),b.push(P({pubkey:new A(_?x.id:x.marketQuoteVault)}))}else if(L.version===7){let x=T[R];b.push(P({pubkey:new A(x.authority)})),b.push(P({pubkey:new A(x.config.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(D?x.vault.A:x.vault.B)})),b.push(P({pubkey:new A(D?x.vault.B:x.vault.A)})),b.push(P({pubkey:new A(L.observationId)}))}else throw Error("pool type error")}let N=O([V("insId"),k("amountIn"),k("amountOut"),H(q(),f.length,"clmmPriceLimit")]),v=Buffer.alloc(N.span);return N.encode({insId:0,amountIn:p,amountOut:d,clmmPriceLimit:f},v),new qt({keys:b,programId:i,data:v})}function Jn(i,e){if(i)if(e){let t=new Je(i).div(new Je(25));return t.gt(sn)?t:sn}else{let t=new Je(i).mul(new Je(25));return t.lt(an)?t:an}else return e?sn:an}function Us({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],p=ve(m),d=t.equals(p.mintA.address)?Ye.add(Fe):Ze.sub(Fe);return At.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:p.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:p.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Je(0)),sqrtPriceLimitX64:d,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],p=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[rr(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,p?m.vaultA:m.vaultB,p?m.vaultB:m.vaultA,p?m.mintProgramA:m.mintProgramB,p?m.mintProgramB:m.mintProgramA,new A(m[p?"mintA":"mintB"].address),new A(m[p?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[p?ie.CpmmSwapBaseIn:ie.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[cr({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new Je(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ie.AmmV5SwapBaseIn:ie.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],p=n.poolInfo[1],d=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Gs(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,p,d,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new Je(0)),n.remainingAccounts)],instructionTypes:[ie.RouteSwap],lookupTableAddress:[d.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}function Xg({programId:i,wallet:e,amount:t,inputAccount:n,outputAccount:r,routeInfo:o,poolKeys:s}){var p;if(o.success===!1)throw Error("route info error");let a=[],u=[P({pubkey:bt,isWritable:!1}),P({pubkey:jn,isWritable:!1}),P({pubkey:Zn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})],c={[o.data.inputMint]:n,[o.data.outputMint]:r};u.push(P({pubkey:c[o.data.inputMint]})),u.push(P({pubkey:c[o.data.outputMint]}));for(let d=0;d<s.length;d++){let g=o.data.routePlan[d],f=s[d],b=g.inputMint===f.mintA.address;if(u.push(P({pubkey:new A(f.programId),isWritable:!1})),d===s.length-1)u.push(P({pubkey:c[g.outputMint]}));else{let y=g.outputMint;if(c[y]===void 0){let T=re(e,new A(y),f.programId===Re.CLMM_PROGRAM_ID.toBase58()||f.programId===Re.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(b?f.mintB.programId:f.mintA.programId):bt).publicKey;c[y]=T}u.push(P({pubkey:c[y]}))}if(u.push(P({pubkey:new A(g.inputMint)})),u.push(P({pubkey:new A(g.outputMint)})),f.programId===Re.CLMM_PROGRAM_ID.toBase58()){let y=f;u.push(P({pubkey:new A(y.config.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(b?y.vault.A:y.vault.B)})),u.push(P({pubkey:new A(b?y.vault.B:y.vault.A)})),u.push(P({pubkey:new A(y.observationId)})),u.push(P({pubkey:dt,isWritable:!1})),u.push(P({pubkey:new A(y.exBitmapAccount)})),a.push(Jn(g.lastPoolPriceX64,b));for(let T of(p=g.remainingAccounts)!=null?p:[])u.push(P({pubkey:new A(T)}))}else if(f.programId===Re.AMM_STABLE.toBase58()){let y=f;u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.authority),isWritable:!1})),u.push(P({pubkey:new A(y.marketProgramId),isWritable:!1})),u.push(P({pubkey:new A(y.marketAuthority),isWritable:!1})),u.push(P({pubkey:tn,isWritable:!1})),u.push(P({pubkey:new A(y.openOrders)})),u.push(P({pubkey:new A(y.vault.A)})),u.push(P({pubkey:new A(y.vault.B)})),u.push(P({pubkey:new A(y.marketId)})),u.push(P({pubkey:new A(y.marketBids)})),u.push(P({pubkey:new A(y.marketAsks)})),u.push(P({pubkey:new A(y.marketEventQueue)})),u.push(P({pubkey:new A(y.marketBaseVault)})),u.push(P({pubkey:new A(y.marketQuoteVault)}))}else if(f.programId===Re.AMM_V4.toBase58()){let y=f;u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.authority),isWritable:!1})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.vault.A)})),u.push(P({pubkey:new A(y.vault.B)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)}))}else if(f.programId===Re.CREATE_CPMM_POOL_PROGRAM.toBase58()){let y=f;u.push(P({pubkey:new A(y.authority)})),u.push(P({pubkey:new A(y.config.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(b?y.vault.A:y.vault.B)})),u.push(P({pubkey:new A(b?y.vault.B:y.vault.A)})),u.push(P({pubkey:new A(y.observationId)}))}else throw Error("pool type error")}let l=O([V("insId"),k("amountIn"),k("amountOut"),H(q(),a.length,"clmmPriceLimit")]),m=Buffer.alloc(l.span);return l.encode({insId:0,amountIn:t,amountOut:new Je(o.data.otherAmountThreshold),clmmPriceLimit:a},m),new qt({keys:u,programId:i,data:m})}function zg({programId:i,wallet:e,inputAccount:t,outputAccount:n,routeInfo:r,poolKeys:o}){var m;if(r.success===!1)throw Error("route info error");let s=[],a=[P({pubkey:bt,isWritable:!1}),P({pubkey:jn,isWritable:!1}),P({pubkey:Zn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})],u={[r.data.inputMint]:t,[r.data.outputMint]:n};for(let p=o.length-1;p>=0;p--){let d=r.data.routePlan[p],g=o[p],f=d.inputMint===g.mintA.address;if(a.push(P({pubkey:new A(g.programId)})),p===0)a.push(P({pubkey:u[d.inputMint]}));else{let b=d.inputMint;if(u[b]===void 0){let y=re(e,new A(b),g.programId===Re.CLMM_PROGRAM_ID.toBase58()||g.programId===Re.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(f?g.mintA.programId:g.mintB.programId):bt).publicKey;u[b]=y}a.push(P({pubkey:u[b]}))}if(p===o.length-1)a.push(P({pubkey:u[d.outputMint]}));else{let b=d.outputMint;if(u[b]===void 0){let y=re(e,new A(b),g.programId===Re.CLMM_PROGRAM_ID.toBase58()||g.programId===Re.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(f?g.mintB.programId:g.mintA.programId):bt).publicKey;u[b]=y}a.push(P({pubkey:u[b]}))}if(a.push(P({pubkey:new A(d.inputMint)})),a.push(P({pubkey:new A(d.outputMint)})),g.programId===Re.CLMM_PROGRAM_ID.toBase58()){let b=g;a.push(P({pubkey:new A(b.config.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(f?b.vault.A:b.vault.B)})),a.push(P({pubkey:new A(f?b.vault.B:b.vault.A)})),a.push(P({pubkey:new A(b.observationId)})),a.push(P({pubkey:dt,isWritable:!1})),a.push(P({pubkey:new A(b.exBitmapAccount)})),s.push(Jn(d.lastPoolPriceX64,f));for(let y of(m=d.remainingAccounts)!=null?m:[])a.push(P({pubkey:new A(y)}))}else if(g.programId===Re.AMM_STABLE.toBase58()){let b=g;a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.authority),isWritable:!1})),a.push(P({pubkey:new A(b.marketProgramId),isWritable:!1})),a.push(P({pubkey:new A(b.marketAuthority),isWritable:!1})),a.push(P({pubkey:tn,isWritable:!1})),a.push(P({pubkey:new A(b.openOrders)})),a.push(P({pubkey:new A(b.vault.A)})),a.push(P({pubkey:new A(b.vault.B)})),a.push(P({pubkey:new A(b.marketId)})),a.push(P({pubkey:new A(b.marketBids)})),a.push(P({pubkey:new A(b.marketAsks)})),a.push(P({pubkey:new A(b.marketEventQueue)})),a.push(P({pubkey:new A(b.marketBaseVault)})),a.push(P({pubkey:new A(b.marketQuoteVault)}))}else if(g.programId===Re.AMM_V4.toBase58()){let b=g;a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.authority),isWritable:!1})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.vault.A)})),a.push(P({pubkey:new A(b.vault.B)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(b.id)}))}else if(g.programId===Re.CREATE_CPMM_POOL_PROGRAM.toBase58()){let b=g;a.push(P({pubkey:new A(b.authority)})),a.push(P({pubkey:new A(b.config.id)})),a.push(P({pubkey:new A(b.id)})),a.push(P({pubkey:new A(f?b.vault.A:b.vault.B)})),a.push(P({pubkey:new A(f?b.vault.B:b.vault.A)})),a.push(P({pubkey:new A(b.observationId)}))}else throw Error("pool type error")}let c=O([V("insId"),k("amountIn"),k("amountOut"),H(q(),s.length,"clmmPriceLimit")]),l=Buffer.alloc(c.span);return c.encode({insId:1,amountIn:new Je(r.data.otherAmountThreshold),amountOut:new Je(r.data.outputAmount),clmmPriceLimit:s},l),new qt({keys:a,programId:i,data:l})}var LP=new Xs(0);export{Us as makeSwapInstruction,Gg as route1Instruction,Ug as route2Instruction,Gs as routeInstruction,Xg as swapBaseInAutoAccount,zg as swapBaseOutAutoAccount};
//# sourceMappingURL=index.mjs.map